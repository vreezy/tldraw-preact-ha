var QR=Object.defineProperty;var e3=(t,e,n)=>e in t?QR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var P=(t,e,n)=>e3(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var Bc,Pe,G_,Di,kb,V_,Tg,yy,kg,Mg,Y_,bc={},X_=[],t3=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,oh=Array.isArray;function yo(t,e){for(var n in e)t[n]=e[n];return t}function q_(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function kt(t,e,n){var r,o,i,s={};for(i in e)i=="key"?r=e[i]:i=="ref"?o=e[i]:s[i]=e[i];if(arguments.length>2&&(s.children=arguments.length>3?Bc.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(i in t.defaultProps)s[i]===void 0&&(s[i]=t.defaultProps[i]);return lc(t,s,r,o,null)}function lc(t,e,n,r,o){var i={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:o??++G_,__i:-1,__u:0};return o==null&&Pe.vnode!=null&&Pe.vnode(i),i}function Z_(){return{current:null}}function Z(t){return t.children}function ar(t,e){this.props=t,this.context=e}function Gs(t,e){if(e==null)return t.__?Gs(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?Gs(t):null}function J_(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return J_(t)}}function Ag(t){(!t.__d&&(t.__d=!0)&&Di.push(t)&&!iu.__r++||kb!==Pe.debounceRendering)&&((kb=Pe.debounceRendering)||V_)(iu)}function iu(){var t,e,n,r,o,i,s,a;for(Di.sort(Tg);t=Di.shift();)t.__d&&(e=Di.length,r=void 0,i=(o=(n=t).__v).__e,s=[],a=[],n.__P&&((r=yo({},o)).__v=o.__v+1,Pe.vnode&&Pe.vnode(r),Sy(n.__P,r,o,n.__n,n.__P.namespaceURI,32&o.__u?[i]:null,s,i??Gs(o),!!(32&o.__u),a),r.__v=o.__v,r.__.__k[r.__i]=r,tx(s,r,a),r.__e!=i&&J_(r)),Di.length>e&&Di.sort(Tg));iu.__r=0}function Q_(t,e,n,r,o,i,s,a,c,l,d){var h,p,f,g,m,y=r&&r.__k||X_,S=e.length;for(n.__d=c,n3(n,e,y),c=n.__d,h=0;h<S;h++)(f=n.__k[h])!=null&&(p=f.__i===-1?bc:y[f.__i]||bc,f.__i=h,Sy(t,f,p,o,i,s,a,c,l,d),g=f.__e,f.ref&&p.ref!=f.ref&&(p.ref&&vy(p.ref,null,f),d.push(f.ref,f.__c||g,f)),m==null&&g!=null&&(m=g),65536&f.__u||p.__k===f.__k?c=ex(f,c,t):typeof f.type=="function"&&f.__d!==void 0?c=f.__d:g&&(c=g.nextSibling),f.__d=void 0,f.__u&=-196609);n.__d=c,n.__e=m}function n3(t,e,n){var r,o,i,s,a,c=e.length,l=n.length,d=l,h=0;for(t.__k=[],r=0;r<c;r++)(o=e[r])!=null&&typeof o!="boolean"&&typeof o!="function"?(s=r+h,(o=t.__k[r]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?lc(null,o,null,null,null):oh(o)?lc(Z,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?lc(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=t,o.__b=t.__b+1,i=null,(a=o.__i=r3(o,n,s,d))!==-1&&(d--,(i=n[a])&&(i.__u|=131072)),i==null||i.__v===null?(a==-1&&h--,typeof o.type!="function"&&(o.__u|=65536)):a!==s&&(a==s-1?h--:a==s+1?h++:(a>s?h--:h++,o.__u|=65536))):o=t.__k[r]=null;if(d)for(r=0;r<l;r++)(i=n[r])!=null&&!(131072&i.__u)&&(i.__e==t.__d&&(t.__d=Gs(i)),nx(i,i))}function ex(t,e,n){var r,o;if(typeof t.type=="function"){for(r=t.__k,o=0;r&&o<r.length;o++)r[o]&&(r[o].__=t,e=ex(r[o],e,n));return e}t.__e!=e&&(e&&t.type&&!n.contains(e)&&(e=Gs(t)),n.insertBefore(t.__e,e||null),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType===8);return e}function bo(t,e){return e=e||[],t==null||typeof t=="boolean"||(oh(t)?t.some(function(n){bo(n,e)}):e.push(t)),e}function r3(t,e,n,r){var o=t.key,i=t.type,s=n-1,a=n+1,c=e[n];if(c===null||c&&o==c.key&&i===c.type&&!(131072&c.__u))return n;if(r>(c!=null&&!(131072&c.__u)?1:0))for(;s>=0||a<e.length;){if(s>=0){if((c=e[s])&&!(131072&c.__u)&&o==c.key&&i===c.type)return s;s--}if(a<e.length){if((c=e[a])&&!(131072&c.__u)&&o==c.key&&i===c.type)return a;a++}}return-1}function Mb(t,e,n){e[0]==="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||t3.test(e)?n:n+"px"}function Cl(t,e,n,r,o){var i;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||Mb(t.style,e,"");if(n)for(e in n)r&&n[e]===r[e]||Mb(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")i=e!==(e=e.replace(/(PointerCapture)$|Capture$/i,"$1")),e=e.toLowerCase()in t||e==="onFocusOut"||e==="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+i]=n,n?r?n.u=r.u:(n.u=yy,t.addEventListener(e,i?Mg:kg,i)):t.removeEventListener(e,i?Mg:kg,i);else{if(o=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!=="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function Ab(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=yy++;else if(e.t<n.u)return;return n(Pe.event?Pe.event(e):e)}}}function Sy(t,e,n,r,o,i,s,a,c,l){var d,h,p,f,g,m,y,S,v,_,w,x,C,E,I,T,k=e.type;if(e.constructor!==void 0)return null;128&n.__u&&(c=!!(32&n.__u),i=[a=e.__e=n.__e]),(d=Pe.__b)&&d(e);e:if(typeof k=="function")try{if(S=e.props,v="prototype"in k&&k.prototype.render,_=(d=k.contextType)&&r[d.__c],w=d?_?_.props.value:d.__:r,n.__c?y=(h=e.__c=n.__c).__=h.__E:(v?e.__c=h=new k(S,w):(e.__c=h=new ar(S,w),h.constructor=k,h.render=i3),_&&_.sub(h),h.props=S,h.state||(h.state={}),h.context=w,h.__n=r,p=h.__d=!0,h.__h=[],h._sb=[]),v&&h.__s==null&&(h.__s=h.state),v&&k.getDerivedStateFromProps!=null&&(h.__s==h.state&&(h.__s=yo({},h.__s)),yo(h.__s,k.getDerivedStateFromProps(S,h.__s))),f=h.props,g=h.state,h.__v=e,p)v&&k.getDerivedStateFromProps==null&&h.componentWillMount!=null&&h.componentWillMount(),v&&h.componentDidMount!=null&&h.__h.push(h.componentDidMount);else{if(v&&k.getDerivedStateFromProps==null&&S!==f&&h.componentWillReceiveProps!=null&&h.componentWillReceiveProps(S,w),!h.__e&&(h.shouldComponentUpdate!=null&&h.shouldComponentUpdate(S,h.__s,w)===!1||e.__v===n.__v)){for(e.__v!==n.__v&&(h.props=S,h.state=h.__s,h.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(D){D&&(D.__=e)}),x=0;x<h._sb.length;x++)h.__h.push(h._sb[x]);h._sb=[],h.__h.length&&s.push(h);break e}h.componentWillUpdate!=null&&h.componentWillUpdate(S,h.__s,w),v&&h.componentDidUpdate!=null&&h.__h.push(function(){h.componentDidUpdate(f,g,m)})}if(h.context=w,h.props=S,h.__P=t,h.__e=!1,C=Pe.__r,E=0,v){for(h.state=h.__s,h.__d=!1,C&&C(e),d=h.render(h.props,h.state,h.context),I=0;I<h._sb.length;I++)h.__h.push(h._sb[I]);h._sb=[]}else do h.__d=!1,C&&C(e),d=h.render(h.props,h.state,h.context),h.state=h.__s;while(h.__d&&++E<25);h.state=h.__s,h.getChildContext!=null&&(r=yo(yo({},r),h.getChildContext())),v&&!p&&h.getSnapshotBeforeUpdate!=null&&(m=h.getSnapshotBeforeUpdate(f,g)),Q_(t,oh(T=d!=null&&d.type===Z&&d.key==null?d.props.children:d)?T:[T],e,n,r,o,i,s,a,c,l),h.base=e.__e,e.__u&=-161,h.__h.length&&s.push(h),y&&(h.__E=h.__=null)}catch(D){if(e.__v=null,c||i!=null){for(e.__u|=c?160:32;a&&a.nodeType===8&&a.nextSibling;)a=a.nextSibling;i[i.indexOf(a)]=null,e.__e=a}else e.__e=n.__e,e.__k=n.__k;Pe.__e(D,e,n)}else i==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=o3(n.__e,e,n,r,o,i,s,c,l);(d=Pe.diffed)&&d(e)}function tx(t,e,n){e.__d=void 0;for(var r=0;r<n.length;r++)vy(n[r],n[++r],n[++r]);Pe.__c&&Pe.__c(e,t),t.some(function(o){try{t=o.__h,o.__h=[],t.some(function(i){i.call(o)})}catch(i){Pe.__e(i,o.__v)}})}function o3(t,e,n,r,o,i,s,a,c){var l,d,h,p,f,g,m,y=n.props,S=e.props,v=e.type;if(v==="svg"?o="http://www.w3.org/2000/svg":v==="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),i!=null){for(l=0;l<i.length;l++)if((f=i[l])&&"setAttribute"in f==!!v&&(v?f.localName===v:f.nodeType===3)){t=f,i[l]=null;break}}if(t==null){if(v===null)return document.createTextNode(S);t=document.createElementNS(o,v,S.is&&S),a&&(Pe.__m&&Pe.__m(e,i),a=!1),i=null}if(v===null)y===S||a&&t.data===S||(t.data=S);else{if(i=i&&Bc.call(t.childNodes),y=n.props||bc,!a&&i!=null)for(y={},l=0;l<t.attributes.length;l++)y[(f=t.attributes[l]).name]=f.value;for(l in y)if(f=y[l],l!="children"){if(l=="dangerouslySetInnerHTML")h=f;else if(!(l in S)){if(l=="value"&&"defaultValue"in S||l=="checked"&&"defaultChecked"in S)continue;Cl(t,l,null,f,o)}}for(l in S)f=S[l],l=="children"?p=f:l=="dangerouslySetInnerHTML"?d=f:l=="value"?g=f:l=="checked"?m=f:a&&typeof f!="function"||y[l]===f||Cl(t,l,f,y[l],o);if(d)a||h&&(d.__html===h.__html||d.__html===t.innerHTML)||(t.innerHTML=d.__html),e.__k=[];else if(h&&(t.innerHTML=""),Q_(t,oh(p)?p:[p],e,n,r,v==="foreignObject"?"http://www.w3.org/1999/xhtml":o,i,s,i?i[0]:n.__k&&Gs(n,0),a,c),i!=null)for(l=i.length;l--;)q_(i[l]);a||(l="value",v==="progress"&&g==null?t.removeAttribute("value"):g!==void 0&&(g!==t[l]||v==="progress"&&!g||v==="option"&&g!==y[l])&&Cl(t,l,g,y[l],o),l="checked",m!==void 0&&m!==t[l]&&Cl(t,l,m,y[l],o))}return t}function vy(t,e,n){try{if(typeof t=="function"){var r=typeof t.__u=="function";r&&t.__u(),r&&e==null||(t.__u=t(e))}else t.current=e}catch(o){Pe.__e(o,n)}}function nx(t,e,n){var r,o;if(Pe.unmount&&Pe.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||vy(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(i){Pe.__e(i,e)}r.base=r.__P=null}if(r=t.__k)for(o=0;o<r.length;o++)r[o]&&nx(r[o],e,n||typeof t.type!="function");n||q_(t.__e),t.__c=t.__=t.__e=t.__d=void 0}function i3(t,e,n){return this.constructor(t,n)}function Vs(t,e,n){var r,o,i,s;Pe.__&&Pe.__(t,e),o=(r=typeof n=="function")?null:n&&n.__k||e.__k,i=[],s=[],Sy(e,t=(!r&&n||e).__k=kt(Z,null,[t]),o||bc,bc,e.namespaceURI,!r&&n?[n]:o?null:e.firstChild?Bc.call(e.childNodes):null,i,!r&&n?n:o?o.__e:e.firstChild,r,s),tx(i,t,s)}function rx(t,e){Vs(t,e,rx)}function s3(t,e,n){var r,o,i,s,a=yo({},t.props);for(i in t.type&&t.type.defaultProps&&(s=t.type.defaultProps),e)i=="key"?r=e[i]:i=="ref"?o=e[i]:a[i]=e[i]===void 0&&s!==void 0?s[i]:e[i];return arguments.length>2&&(a.children=arguments.length>3?Bc.call(arguments,2):n),lc(t.type,a,r||t.key,o||t.ref,null)}function Ze(t,e){var n={__c:e="__cC"+Y_++,__:t,Consumer:function(r,o){return r.children(o)},Provider:function(r){var o,i;return this.getChildContext||(o=[],(i={})[e]=this,this.getChildContext=function(){return i},this.componentWillUnmount=function(){o=null},this.shouldComponentUpdate=function(s){this.props.value!==s.value&&o.some(function(a){a.__e=!0,Ag(a)})},this.sub=function(s){o.push(s);var a=s.componentWillUnmount;s.componentWillUnmount=function(){o&&o.splice(o.indexOf(s),1),a&&a.call(s)}}),r.children}};return n.Provider.__=n.Consumer.contextType=n}Bc=X_.slice,Pe={__e:function(t,e,n,r){for(var o,i,s;e=e.__;)if((o=e.__c)&&!o.__)try{if((i=o.constructor)&&i.getDerivedStateFromError!=null&&(o.setState(i.getDerivedStateFromError(t)),s=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(t,r||{}),s=o.__d),s)return o.__E=o}catch(a){t=a}throw t}},G_=0,ar.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=yo({},this.state),typeof t=="function"&&(t=t(yo({},n),this.props)),t&&yo(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),Ag(this))},ar.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Ag(this))},ar.prototype.render=Z,Di=[],V_=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Tg=function(t,e){return t.__v.__b-e.__v.__b},iu.__r=0,yy=0,kg=Ab(!1),Mg=Ab(!0),Y_=0;var a3=0;function u(t,e,n,r,o,i){e||(e={});var s,a,c=e;"ref"in e&&(s=e.ref,delete e.ref);var l={type:t,props:c,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--a3,__i:-1,__u:0,__source:o,__self:i};if(typeof t=="function"&&(s=t.defaultProps))for(a in s)c[a]===void 0&&(c[a]=s[a]);return Pe.vnode&&Pe.vnode(l),l}const Op="__TLDRAW_LIBRARY_VERSIONS__";function c3(){if(globalThis[Op])return globalThis[Op];const t={versions:[],didWarn:!1,scheduledNotice:null};return Object.defineProperty(globalThis,Op,{value:t,writable:!1,configurable:!1,enumerable:!1}),t}function fi(t,e,n){if(!t||!e||!n)throw new Error("Missing name/version/module system in built version of tldraw library");const r=c3();if(r.versions.push({name:t,version:e,modules:n}),!r.scheduledNotice)try{r.scheduledNotice=setTimeout(()=>{r.scheduledNotice=null,Ob(r)},100)}catch{Ob(r)}}function Ob(t){if(!t.versions.length||t.didWarn)return;const e=t.versions.sort((a,c)=>Db(a.version,c.version)),n=e[e.length-1].version,r=new Set,o=new Map;for(const a of e){if(o.has(a.name)){r.delete(a.name),Dp(o,a.name,new Set).add(a.version);continue}a.version===n?r.add(a.name):(r.delete(a.name),Dp(o,a.name,new Set).add(a.version))}if(o.size>0){const a=[`${ao("[tldraw]",["bold","bgRed","textWhite"])} ${ao("You have multiple versions of tldraw libraries installed. This can lead to bugs and unexpected behavior.",["textRed","bold"])}`,"",`The latest version you have installed is ${ao(`v${n}`,["bold","textBlue"])}. The following libraries are on the latest version:`,...Array.from(r,c=>`  • ✅ ${ao(c,["bold"])}`),"","The following libraries are not on the latest version, or have multiple versions installed:",...Array.from(o,([c,l])=>{const d=Array.from(l).sort(Db).map(h=>ao(`v${h}`,h===n?["textGreen"]:["textRed"]));return`  • ❌ ${ao(c,["bold"])} (${d.join(", ")})`})];console.log(a.join(`
`)),t.didWarn=!0;return}const i=new Map;for(const a of e)Dp(i,a.name,{version:a.version,modules:[]}).modules.push(a.modules);const s=new Map;for(const[a,c]of i)c.modules.length>1&&s.set(a,c);if(s.size>0){const a=[`${ao("[tldraw]",["bold","bgRed","textWhite"])} ${ao("You have multiple instances of some tldraw libraries active. This can lead to bugs and unexpected behavior. ",["textRed","bold"])}`,"","This usually means that your bundler is misconfigured, and is importing the same library multiple times - usually once as an ES Module, and once as a CommonJS module.","","The following libraries have been imported multiple times:",...Array.from(s,([c,l])=>{const d=l.modules.map((h,p)=>h==="esm"?`      ${p+1}. ES Modules`:`      ${p+1}. CommonJS`).join(`
`);return`  • ❌ ${ao(c,["bold"])} v${l.version}: 
${d}`}),"","You should configure your bundler to only import one version of each library."];console.log(a.join(`
`)),t.didWarn=!0;return}}function Db(t,e){const n=t.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/),r=e.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/);return!n||!r?t.localeCompare(e):n[1]!==r[1]?Number(n[1])-Number(r[1]):n[2]!==r[2]?Number(n[2])-Number(r[2]):n[3]!==r[3]?Number(n[3])-Number(r[3]):n[4]&&r[4]?n[4].localeCompare(r[4]):n[4]?1:r[4]?-1:0}const l3={bold:"1",textBlue:"94",textRed:"31",textGreen:"32",bgRed:"41",textWhite:"97"};function ao(t,e=[]){return`\x1B[${e.map(n=>l3[n]).join(";")}m${t}\x1B[m`}function Dp(t,e,n){return t.has(e)?t.get(e):(t.set(e,n),n)}var on=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ts(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ox="Expected a function",$b=NaN,d3="[object Symbol]",u3=/^\s+|\s+$/g,h3=/^[-+]0x[0-9a-f]+$/i,p3=/^0b[01]+$/i,f3=/^0o[0-7]+$/i,g3=parseInt,m3=typeof on=="object"&&on&&on.Object===Object&&on,y3=typeof self=="object"&&self&&self.Object===Object&&self,S3=m3||y3||Function("return this")(),v3=Object.prototype,b3=v3.toString,w3=Math.max,_3=Math.min,$p=function(){return S3.Date.now()};function x3(t,e,n){var r,o,i,s,a,c,l=0,d=!1,h=!1,p=!0;if(typeof t!="function")throw new TypeError(ox);e=Rb(e)||0,su(n)&&(d=!!n.leading,h="maxWait"in n,i=h?w3(Rb(n.maxWait)||0,e):i,p="trailing"in n?!!n.trailing:p);function f(C){var E=r,I=o;return r=o=void 0,l=C,s=t.apply(I,E),s}function g(C){return l=C,a=setTimeout(S,e),d?f(C):s}function m(C){var E=C-c,I=C-l,T=e-E;return h?_3(T,i-I):T}function y(C){var E=C-c,I=C-l;return c===void 0||E>=e||E<0||h&&I>=i}function S(){var C=$p();if(y(C))return v(C);a=setTimeout(S,m(C))}function v(C){return a=void 0,p&&r?f(C):(r=o=void 0,s)}function _(){a!==void 0&&clearTimeout(a),l=0,r=c=o=a=void 0}function w(){return a===void 0?s:v($p())}function x(){var C=$p(),E=y(C);if(r=arguments,o=this,c=C,E){if(a===void 0)return g(c);if(h)return a=setTimeout(S,e),f(c)}return a===void 0&&(a=setTimeout(S,e)),s}return x.cancel=_,x.flush=w,x}function P3(t,e,n){var r=!0,o=!0;if(typeof t!="function")throw new TypeError(ox);return su(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),x3(t,e,{leading:r,maxWait:e,trailing:o})}function su(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function I3(t){return!!t&&typeof t=="object"}function C3(t){return typeof t=="symbol"||I3(t)&&b3.call(t)==d3}function Rb(t){if(typeof t=="number")return t;if(C3(t))return $b;if(su(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=su(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(u3,"");var n=p3.test(t);return n||f3.test(t)?g3(t.slice(2),n?2:8):h3.test(t)?$b:+t}var E3=P3;const ix=ts(E3);var T3=200,by="__lodash_hash_undefined__",k3=1/0,M3="[object Function]",A3="[object GeneratorFunction]",O3=/[\\^$.*+?()[\]{}|]/g,D3=/^\[object .+?Constructor\]$/,$3=typeof on=="object"&&on&&on.Object===Object&&on,R3=typeof self=="object"&&self&&self.Object===Object&&self,wy=$3||R3||Function("return this")();function L3(t,e){var n=t?t.length:0;return!!n&&F3(t,e,0)>-1}function N3(t,e,n,r){for(var o=t.length,i=n+-1;++i<o;)if(e(t[i],i,t))return i;return-1}function F3(t,e,n){if(e!==e)return N3(t,z3,n);for(var r=n-1,o=t.length;++r<o;)if(t[r]===e)return r;return-1}function z3(t){return t!==t}function B3(t,e){return t.has(e)}function U3(t,e){return t==null?void 0:t[e]}function H3(t){var e=!1;if(t!=null&&typeof t.toString!="function")try{e=!!(t+"")}catch{}return e}function sx(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var j3=Array.prototype,K3=Function.prototype,ax=Object.prototype,Rp=wy["__core-js_shared__"],Lb=function(){var t=/[^.]+$/.exec(Rp&&Rp.keys&&Rp.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),cx=K3.toString,_y=ax.hasOwnProperty,W3=ax.toString,G3=RegExp("^"+cx.call(_y).replace(O3,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),V3=j3.splice,Y3=xy(wy,"Map"),Lp=xy(wy,"Set"),wc=xy(Object,"create");function Ui(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function X3(){this.__data__=wc?wc(null):{}}function q3(t){return this.has(t)&&delete this.__data__[t]}function Z3(t){var e=this.__data__;if(wc){var n=e[t];return n===by?void 0:n}return _y.call(e,t)?e[t]:void 0}function J3(t){var e=this.__data__;return wc?e[t]!==void 0:_y.call(e,t)}function Q3(t,e){var n=this.__data__;return n[t]=wc&&e===void 0?by:e,this}Ui.prototype.clear=X3;Ui.prototype.delete=q3;Ui.prototype.get=Z3;Ui.prototype.has=J3;Ui.prototype.set=Q3;function la(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function eL(){this.__data__=[]}function tL(t){var e=this.__data__,n=ih(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():V3.call(e,n,1),!0}function nL(t){var e=this.__data__,n=ih(e,t);return n<0?void 0:e[n][1]}function rL(t){return ih(this.__data__,t)>-1}function oL(t,e){var n=this.__data__,r=ih(n,t);return r<0?n.push([t,e]):n[r][1]=e,this}la.prototype.clear=eL;la.prototype.delete=tL;la.prototype.get=nL;la.prototype.has=rL;la.prototype.set=oL;function da(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function iL(){this.__data__={hash:new Ui,map:new(Y3||la),string:new Ui}}function sL(t){return sh(this,t).delete(t)}function aL(t){return sh(this,t).get(t)}function cL(t){return sh(this,t).has(t)}function lL(t,e){return sh(this,t).set(t,e),this}da.prototype.clear=iL;da.prototype.delete=sL;da.prototype.get=aL;da.prototype.has=cL;da.prototype.set=lL;function au(t){var e=-1,n=t?t.length:0;for(this.__data__=new da;++e<n;)this.add(t[e])}function dL(t){return this.__data__.set(t,by),this}function uL(t){return this.__data__.has(t)}au.prototype.add=au.prototype.push=dL;au.prototype.has=uL;function ih(t,e){for(var n=t.length;n--;)if(vL(t[n][0],e))return n;return-1}function hL(t){if(!lx(t)||mL(t))return!1;var e=bL(t)||H3(t)?G3:D3;return e.test(yL(t))}function pL(t,e,n){var r=-1,o=L3,i=t.length,s=!0,a=[],c=a;if(i>=T3){var l=fL(t);if(l)return sx(l);s=!1,o=B3,c=new au}else c=a;e:for(;++r<i;){var d=t[r],h=d;if(d=d!==0?d:0,s&&h===h){for(var p=c.length;p--;)if(c[p]===h)continue e;a.push(d)}else o(c,h,n)||(c!==a&&c.push(h),a.push(d))}return a}var fL=Lp&&1/sx(new Lp([,-0]))[1]==k3?function(t){return new Lp(t)}:wL;function sh(t,e){var n=t.__data__;return gL(e)?n[typeof e=="string"?"string":"hash"]:n.map}function xy(t,e){var n=U3(t,e);return hL(n)?n:void 0}function gL(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function mL(t){return!!Lb&&Lb in t}function yL(t){if(t!=null){try{return cx.call(t)}catch{}try{return t+""}catch{}}return""}function SL(t){return t&&t.length?pL(t):[]}function vL(t,e){return t===e||t!==t&&e!==e}function bL(t){var e=lx(t)?W3.call(t):"";return e==M3||e==A3}function lx(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function wL(){}var _L=SL;const xL=ts(_L),Ja={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},PL=Ja.Good;class dx{constructor(){P(this,"startTime",0);P(this,"name","");P(this,"frames",0);P(this,"started",!1);P(this,"frame",null);P(this,"recordFrame",()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))})}start(e){this.name=e,this.frames=0,this.started=!0,this.frame!==null&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,this.frame!==null&&cancelAnimationFrame(this.frame);const e=(performance.now()-this.startTime)/1e3,n=e===0?0:Math.floor(this.frames/e),r=n>55?Ja.Good:n>30?Ja.Mid:Ja.Poor,o=r===Ja.Mid?"black":"white",i=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${i} %c${n}%c fps`,`color: white; background: ${PL};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${r};color: ${o};`,"font-weight: normal")}isStarted(){return this.started}}function Py(t,e){const n=[];e:for(const r of t){for(const o of n)if(e?e(r,o):r===o)continue e;n.push(r)}return n}function be(t){return t.filter(e=>e!=null)}function Ht(t){return t[t.length-1]}function IL(t,e){let n,r=1/0;for(const o of t){const i=e(o);i<r&&(n=o,r=i)}return n}function CL(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Object.is(t[n],e[n]))return!1;return!0}function ux(t){const e=(...n)=>{try{return t(...n)}catch(r){throw r instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(r,e),r}};return e}const _c=()=>{},ni={ok(t){return{ok:!0,value:t}},err(t){return{ok:!1,error:t}}};function $t(t,e){const n=e&&t&&typeof t=="object"&&e in t?t[e]:t;throw new Error(`Unknown switch case ${n}`)}const He=ux((t,e)=>{if(!t)throw new Error(e||"Assertion Error")}),Hn=ux((t,e)=>{if(t==null)throw new Error(e??"value must be defined");return t});function Iy(){let t,e;const n=new Promise((r,o)=>{t=r,e=o});return Object.assign(n,{resolve:t,reject:e})}function Og(t){return new Promise(e=>setTimeout(e,t))}function Tn(...t){if(t.length===2){const[e,n]=t;n.addInitializer(function(){He(Reflect.isExtensible(this),"Cannot bind to a non-extensible class.");const o=e.bind(this),i=Reflect.defineProperty(this,n.name,{value:o,writable:!0,configurable:!0});He(i,"Cannot bind a non-configurable class method.")})}else{const[e,n,r]=t;if(!r||typeof r.value!="function")throw new TypeError(`Only methods can be decorated with @bind. <${n}> is not a method!`);return{configurable:!0,get(){const o=r.value.bind(this);return Object.defineProperty(this,n,{value:o,configurable:!0,writable:!0}),o}}}}class Gr{constructor(){P(this,"items",new WeakMap)}get(e,n){return this.items.has(e)||this.items.set(e,n(e)),this.items.get(e)}}function Cy(t,e){let n;const r=(...o)=>(n||(n={},n.promise=new Promise((i,s)=>{n.resolve=i,n.reject=s})),clearTimeout(n.timeout),n.latestArgs=o,n.timeout=setTimeout(()=>{const i=n;n=void 0;try{i.resolve(t(...i.latestArgs))}catch(s){i.reject(s)}},e),n.promise);return r.cancel=()=>{n&&clearTimeout(n.timeout)},r}const Nb=new WeakMap;function Ey(t,e){if(typeof t!="object"||t===null)return;let n=Nb.get(t);n||(n={tags:{},extras:{}},Nb.set(t,n)),e.tags&&(n.tags={...n.tags,...e.tags}),e.extras&&(n.extras={...n.extras,...e.extras})}async function Pr(t,e){return window.fetch(t,{referrerPolicy:"strict-origin-when-cross-origin",...e})}const xc=(t,e)=>{const n=new window.Image(t,e);return n.referrerPolicy="strict-origin-when-cross-origin",n};class wo{static async dataUrlToArrayBuffer(e){return Pr(e).then(function(n){return n.arrayBuffer()})}static async blobToDataUrl(e){return await new Promise((n,r)=>{if(e){const o=new FileReader;o.onload=()=>n(o.result),o.onerror=i=>r(i),o.onabort=i=>r(i),o.readAsDataURL(e)}})}static async blobToText(e){return await new Promise((n,r)=>{if(e){const o=new FileReader;o.onload=()=>n(o.result),o.onerror=i=>r(i),o.onabort=i=>r(i),o.readAsText(e)}})}}function Dg(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return e+""}function Fb(t){const e=new DataView(t);let n=0;for(let r=0;r<e.byteLength;r++)n=(n<<5)-n+e.getUint8(r),n|=0;return n+""}/*!
 * MIT License: https://github.com/ai/nanoid/blob/main/LICENSE
 * Modified code originally from <https://github.com/ai/nanoid>
 * Copyright 2017 Andrey Sitnik <andrey@sitnik.ru>
 *
 * `nanoid` is currently only distributed as an ES module. Some tools (jest, playwright) don't
 * properly support ESM-only code yet, and tldraw itself is distributed as both an ES module and a
 * CommonJS module. By including nanoid here, we can make sure it works well in every environment
 * where tldraw is used. We can also remove some unused features like custom alphabets.
 */const zb=globalThis.crypto,EL="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",TL=128;let Ai,Es;function kL(t){!Ai||Ai.length<t?(Ai=new Uint8Array(t*TL),zb.getRandomValues(Ai),Es=0):Es+t>Ai.length&&(zb.getRandomValues(Ai),Es=0),Es+=t}function ML(t=21){kL(t-=0);let e="";for(let n=Es-t;n<Es;n++)e+=EL[Ai[n]&63];return e}let AL=ML;function Ye(t){return AL(t)}/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function OL(t){const e=new Uint8Array(t);if(!e||!(typeof Buffer<"u"&&Buffer.isBuffer(e)||e instanceof Uint8Array)||e.length<16||!(e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10))return!1;function r(i,s,a,c,l=1024){if(!s)return-1;s=new RegExp(s,"g");const d=s.source.length,h=new TextDecoder,p=i.length;if(typeof c>"u"&&(c=p),a>=p||c<=0||a>=c)return-1;i=i.subarray(a,c);let f=-1,g=0,m=0,y="";e:for(;g<i.length;){const S=g+l,v=i.subarray(g,S),_=h.decode(v,{stream:!0}),w=y+_;let x,C=-1;for(;(x=s.exec(w))!==null;){C=x.index-y.length,f=m+C;break e}g=S,m+=_.length;const E=C>-1?C+d:_.length-d;y=_.slice(E)}return f>=0&&(f+=a>=0?a:p+a),f}const o=r(e,"IDAT",12);return o>=12?r(e,"acTL",8,o)>=8:!1}const DL=t=>new Uint8Array(t)[3]===44;/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Józef Sokołowski <j.k.sokolowski@gmail.com>
 */function Bb(t,e){let n=0;for(;t[e+n];)n+=t[e+n]+1;return n+1}function $L(t){return new TextDecoder("ascii").decode(t.slice(0,3))==="GIF"}function RL(t){const e=new Uint8Array(t);let n,r,o=0,i=0;if(!$L(t))return!1;for(n=e[10]&128,r=e[10]&7,o+=6,o+=7,o+=n?3*Math.pow(2,r+1):0;i<2&&o<e.length;)switch(e[o]){case 44:i+=1,n=e[o+9]&128,r=e[o+9]&7,o+=10,o+=n?3*Math.pow(2,r+1):0,o+=Bb(e,o+1)+1;break;case 33:o+=2,o+=Bb(e,o);break;case 59:o=e.length;break;default:o=e.length;break}return i>1}/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */let $g=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&($g=new Int32Array($g));const LL=(t,e)=>{let n=~~e^-1;for(let r=0;r<t.length;r++)n=$g[(n^t[r])&255]^n>>>8;return n^-1},Ub=4,Hb=4;class Fr{static isPng(e,n){return e.getUint8(n+0)===137&&e.getUint8(n+1)===80&&e.getUint8(n+2)===78&&e.getUint8(n+3)===71&&e.getUint8(n+4)===13&&e.getUint8(n+5)===10&&e.getUint8(n+6)===26&&e.getUint8(n+7)===10}static getChunkType(e,n){return[String.fromCharCode(e.getUint8(n)),String.fromCharCode(e.getUint8(n+1)),String.fromCharCode(e.getUint8(n+2)),String.fromCharCode(e.getUint8(n+3))].join("")}static readChunks(e,n=0){const r={};if(!Fr.isPng(e,n))throw new Error("Not a PNG");for(n+=8;n<=e.buffer.byteLength;){const o=n,i=e.getInt32(n);n+=4;const s=Fr.getChunkType(e,n);if(s==="IDAT"&&r[s]){n+=i+Ub+Hb;continue}if(s==="IEND")break;r[s]={start:o,dataOffset:n+4,size:i},n+=i+Ub+Hb}return r}static parsePhys(e,n){return{ppux:e.getUint32(n),ppuy:e.getUint32(n+4),unit:e.getUint8(n+4)}}static findChunk(e,n){return Fr.readChunks(e)[n]}static setPhysChunk(e,n=1,r){let o=46,i=0;const s=Fr.findChunk(e,"pHYs");s&&(o=s.start,i=s.size);const a=Fr.findChunk(e,"IDAT");a&&(o=a.start,i=0);const c=new ArrayBuffer(21),l=new DataView(c);l.setUint32(0,9),l.setUint8(4,112),l.setUint8(5,72),l.setUint8(6,89),l.setUint8(7,115);const d=2835.5;l.setInt32(8,d*n),l.setInt32(12,d*n),l.setInt8(16,1);const h=new Uint8Array(c.slice(4,17));l.setInt32(17,LL(h));const p=e.buffer.slice(0,o),f=e.buffer.slice(o+i);return new Blob([p,c,f],r)}}/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */function NL(t){return!t||t.length<12?!1:t[8]===87&&t[9]===69&&t[10]===66&&t[11]===80}function FL(t){const e=new Uint8Array(t);return!NL(e)||!e||e.length<21?!1:(e[20]>>1&1)===1}const hx=Object.freeze(["image/svg+xml"]),px=Object.freeze(["image/jpeg","image/png","image/webp"]),fx=Object.freeze(["image/gif","image/apng","image/avif"]),ah=Object.freeze([...px,...hx,...fx]),Ty=Object.freeze(["video/mp4","video/webm","video/quicktime"]),zL=[...ah,...Ty].join(",");class Kn{static loadVideo(e){return new Promise((n,r)=>{const o=document.createElement("video");o.onloadeddata=()=>n(o),o.onerror=i=>{console.error(i),r(new Error("Could not load video"))},o.crossOrigin="anonymous",o.src=e})}static async getVideoFrameAsDataUrl(e,n=0){const r=Iy();let o=!1;const i=()=>{if(!o)if(e.readyState>=e.HAVE_METADATA)o=!0,e.currentTime=n;else return;if(e.readyState>=e.HAVE_CURRENT_DATA){const a=document.createElement("canvas");a.width=e.videoWidth,a.height=e.videoHeight;const c=a.getContext("2d");if(!c)throw new Error("Could not get 2d context");c.drawImage(e,0,0),r.resolve(a.toDataURL())}},s=a=>{console.error(a),r.reject(new Error("Could not get video frame"))};e.addEventListener("loadedmetadata",i),e.addEventListener("loadeddata",i),e.addEventListener("canplay",i),e.addEventListener("seeked",i),e.addEventListener("error",s),e.addEventListener("stalled",s),i();try{return await r}finally{e.removeEventListener("loadedmetadata",i),e.removeEventListener("loadeddata",i),e.removeEventListener("canplay",i),e.removeEventListener("seeked",i),e.removeEventListener("error",s),e.removeEventListener("stalled",s)}}static loadImage(e){return new Promise((n,r)=>{const o=xc();o.onload=()=>n(o),o.onerror=i=>{console.error(i),r(new Error("Could not load image"))},o.crossOrigin="anonymous",o.referrerPolicy="strict-origin-when-cross-origin",o.src=e})}static async getVideoSize(e){return Kn.usingObjectURL(e,async n=>{const r=await Kn.loadVideo(n);return{w:r.videoWidth,h:r.videoHeight}})}static async getImageSize(e){const n=await Kn.usingObjectURL(e,Kn.loadImage);try{if(e.type==="image/png"){const r=new DataView(await e.arrayBuffer());if(Fr.isPng(r,0)){const o=Fr.findChunk(r,"pHYs");if(o){const i=Fr.parsePhys(r,o.dataOffset);if(i.unit===0&&i.ppux===i.ppuy){const s=Math.max(i.ppux/2834.5,1);return{w:Math.round(n.naturalWidth/s),h:Math.round(n.naturalHeight/s)}}}}}}catch(r){return console.error(r),{w:n.naturalWidth,h:n.naturalHeight}}return{w:n.naturalWidth,h:n.naturalHeight}}static async isAnimated(e){return e.type==="image/gif"?RL(await e.arrayBuffer()):e.type==="image/avif"?DL(await e.arrayBuffer()):e.type==="image/webp"?FL(await e.arrayBuffer()):e.type==="image/apng"?OL(await e.arrayBuffer()):!1}static isAnimatedImageType(e){return fx.includes(e||"")}static isStaticImageType(e){return px.includes(e||"")}static isVectorImageType(e){return hx.includes(e||"")}static isImageType(e){return ah.includes(e)}static async usingObjectURL(e,n){const r=URL.createObjectURL(e);try{return await n(r)}finally{URL.revokeObjectURL(r)}}}function De(t,e,n){return t+(e-t)*n}function Tr(t=""){let e=0,n=0,r=0,o=0;function i(){const s=e^e<<11;return e=n,n=r,r=o,o^=(o>>>19^s^s>>>8)>>>0,o/4294967296*2}for(let s=0;s<t.length+64;s++)e^=t.charCodeAt(s)|0,i();return i}function Ys(t,e,n,r=!1){const[o,i]=e,[s,a]=n,c=s+(t-o)/(i-o)*(a-s);return r?s<a?Math.max(Math.min(c,a),s):Math.max(Math.min(c,s),a):c}function wr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function kn(t,e){if(wr(t,e))return t[e]}function jb(t){return Object.keys(t)}function gt(t){return Object.values(t)}function Dn(t){return Object.entries(t)}function gx(t){return Object.fromEntries(t)}function dc(t,e){const n={};let r=!1;for(const[o,i]of Dn(t))e(o,i)?n[o]=i:r=!0;return r?n:t}function Uc(t,e){const n={};for(const[r,o]of Dn(t)){const i=e(r,o);n[r]=i}return n}function mx(t,e){if(t===e)return!0;const n=new Set(Object.keys(t)),r=new Set(Object.keys(e));if(n.size!==r.size)return!1;for(const o of n)if(!r.has(o)||!Object.is(t[o],e[o]))return!1;return!0}function BL(t){const e=UL(t.chars),n=HL(e,t.firstPositive,t.mostPositive,t.mostNegative),r=t.jitterRange??Math.floor(Math.pow(e.length,3)/5),o=jL(r,e.length);return{chars:t.chars,byChar:e.byChar,byCode:e.byCode,length:e.length,first:e.byCode[0],last:e.byCode[e.length-1],firstPositive:n.firstPositive,mostPositive:n.mostPositive,firstNegative:n.firstNegative,mostNegative:n.mostNegative,jitterRange:r,paddingDict:o}}function UL(t){const e={},n={},r=t.length;for(let o=0;o<r;o++){const i=t[o];e[o]=i,n[i]=o}return{byCode:e,byChar:n,length:r}}function HL(t,e,n,r){const o=e?t.byChar[e]:Math.ceil(t.length/2),i=n?t.byChar[n]:t.length-1,s=r?t.byChar[r]:0;if(o===void 0||i===void 0||s===void 0)throw new Error("invalid charSet");if(i-o<3)throw new Error("mostPositive must be at least 3 characters away from neutral");if(o-s<3)throw new Error("mostNegative must be at least 3 characters away from neutral");return{firstPositive:t.byCode[o],mostPositive:t.byCode[i],firstNegative:t.byCode[o-1],mostNegative:t.byCode[s]}}function jL(t,e){const n={};for(let r=0;r<100&&(n[r]=Math.pow(e,r),!(n[r]>t));r++);return n}var Np=null;function ky(){return Np||(Np=BL({chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",firstPositive:"a",mostPositive:"z",mostNegative:"A"}))}function Qo(t,e,n){const r=n.byChar[t],o=n.byChar[e];return Math.abs(r-o)}function My(t,e){const n=t[0];if(n>e.mostPositive||n<e.mostNegative)throw new Error("invalid firstChar on key");return n===e.mostPositive?Qo(n,e.firstPositive,e)+1+cu(t.slice(1),"positive",e):n===e.mostNegative?Qo(n,e.firstNegative,e)+1+cu(t.slice(1),"negative",e):n>=e.firstPositive?Qo(n,e.firstPositive,e)+2:Qo(n,e.firstNegative,e)+2}function cu(t,e,n){const r=t[0];if(r>n.mostPositive||r<n.mostNegative)throw new Error("invalid firstChar on key");return r===n.mostPositive&&e==="positive"?Qo(r,n.mostNegative,n)+1+cu(t.slice(1),e,n):r===n.mostNegative&&e==="negative"?Qo(r,n.mostPositive,n)+1+cu(t.slice(1),e,n):e==="positive"?Qo(r,n.mostNegative,n)+2:Qo(r,n.mostPositive,n)+2}function ch(t,e,n,r,o){const i=Math.max(t.length,e.length);return n==="start"?[t.padStart(i,r),e.padStart(i,r)]:[t.padEnd(i,r),e.padEnd(i,r)]}function KL(t,e,n){let[r,o]=ch(t,e,"end",n.first),i=Rg(r,o,n);i===1&&(r=r.padEnd(r.length+1,n.first),i=n.length);const s=vx(Math.floor(i/2),n);return Ay(r,s,n)}function Rg(t,e,n){const[r,o]=ch(t,e,"end",n.first).sort(),i=yx(o,r,n);return WL(i,n)}function Ay(t,e,n){const r=n.length,[o,i]=ch(t,e,"start",n.first),s=[];let a=0;for(let c=o.length-1;c>=0;c--){const l=n.byChar[o[c]],d=n.byChar[i[c]],h=l+d+a;a=Math.floor(h/r);const p=h%r;s.unshift(n.byCode[p])}return a>0&&s.unshift(n.byCode[a]),s.join("")}function yx(t,e,n){const r=n.length,[o,i]=ch(t,e,"start",n.first),s=[];let a=0;for(let c=o.length-1;c>=0;c--){let l=n.byChar[o[c]];const d=n.byChar[i[c]]+a;l<d?(a=1,l+=r):a=0;const h=l-d;s.unshift(n.byCode[h])}if(a>0)throw new Error("Subtraction result is negative. Ensure a is greater than or equal to b.");for(;s.length>1&&s[0]===n.byCode[0];)s.shift();return s.join("")}function Sx(t,e){return Ay(t,e.byCode[1],e)}function Lg(t,e){return yx(t,e.byCode[1],e)}function vx(t,e){if(t===0)return e.byCode[0];let n="";const r=e.length;for(;t>0;)n=e.byCode[t%r]+n,t=Math.floor(t/r);return n}function WL(t,e){let n=0;const r=t.length,o=e.length;for(let i=0;i<r;i++)n+=e.byChar[t[i]]*Math.pow(o,r-i-1);return n}function GL(t){return t.firstPositive+t.byCode[0]}function VL(t,e){return My(t,e)===t.length}function Kb(t,e){lu(t,e)}function lu(t,e){const n=_x(t,e),r=My(n,e);if(r>t.length)throw new Error("invalid order key length: "+t);return t.slice(0,r)}function bx(t,e){if(!VL(t,e))throw new Error("invalid integer length: "+t)}function wx(t,e){bx(t,e);const[n,r]=xx(t,e);if(r.split("").some(s=>s!==e.byCode[e.length-1])){const s=Sx(r,e);return n+s}const i=XL(n,e);return Px(i,"lower",e)}function YL(t,e){bx(t,e);const[n,r]=xx(t,e);if(r.split("").some(s=>s!==e.byCode[0])){const s=Lg(r,e);return n+s}const i=qL(n,e);return Px(i,"upper",e)}function _x(t,e){let n=0;if(t[0]===e.mostPositive)for(;t[n]===e.mostPositive;)n=n+1;if(t[0]===e.mostNegative)for(;t[n]===e.mostNegative;)n=n+1;return t.slice(0,n+1)}function xx(t,e){const n=_x(t,e),r=t.slice(n.length);return[n,r]}function XL(t,e){const n=t>=e.firstPositive,r=Sx(t,e),o=t[t.length-1]===e.mostPositive,i=r[r.length-1]===e.mostPositive;return n&&i?r+e.mostNegative:!n&&o?t.slice(0,t.length-1):r}function qL(t,e){const n=t>=e.firstPositive,r=t[t.length-1]===e.mostNegative;if(n&&r){const o=t.slice(0,t.length-1);return Lg(o,e)}return!n&&r?t+e.mostPositive:Lg(t,e)}function Px(t,e,n){const r=My(t,n),o=e==="upper"?n.byCode[n.length-1]:n.byCode[0];return t+o.repeat(r-t.length)}function Ix(t,e){const n=vx(Math.floor(Math.random()*e.jitterRange),e);return Ay(t,n,e)}function ZL(t,e,n){const r=t.padEnd(t.length+e,n.first);return Ix(r,n)}function JL(t,e,n){const r=lu(t,n),o=wx(r,n);let i=0;if(e!==null){const a=Rg(t,e,n);a<n.jitterRange+1&&(i=Math.max(i,Wb(a,n)))}const s=Rg(t,o,n);return s<n.jitterRange+1&&(i=Math.max(i,Wb(s,n))),i}function Wb(t,e){const n=e.jitterRange-t,r=Object.entries(e.paddingDict).find(([o,i])=>i>n);return r?parseInt(r[0]):0}function QL(t,e,n=ky()){if(t!==null&&Kb(t,n),e!==null&&Kb(e,n),t===null&&e===null)return GL(n);if(t===null){const r=lu(e,n);return YL(r,n)}if(e===null){const r=lu(t,n);return wx(r,n)}if(t>=e)throw new Error(t+" >= "+e);return KL(t,e,n)}function Cx(t,e,n=ky()){const r=QL(t,e,n),o=JL(r,e,n);return o?ZL(r,o,n):Ix(r,n)}function Ex(t,e,n,r=ky()){return e5(t,e,n,r,Cx,Ex)}function e5(t,e,n,r,o,i){if(n===0)return[];if(n===1)return[o(t,e,r)];if(e==null){let c=o(t,e,r);const l=[c];for(let d=0;d<n-1;d++)c=o(c,e,r),l.push(c);return l}if(t==null){let c=o(t,e,r);const l=[c];for(let d=0;d<n-1;d++)c=o(t,c,r),l.push(c);return l.reverse(),l}const s=Math.floor(n/2),a=o(t,e,r);return[...i(t,a,s,r),a,...i(a,e,n-s-1,r)]}const ua=Ex,Tx="a0";function t5(t){try{Cx(t,null)}catch{throw new Error("invalid index: "+t)}}function Xs(t,e,n){return ua(t??null,e??null,n)}function Fp(t,e){return ua(t??null,null,e)}function Pc(t,e){return ua(t??null,e??null,1)[0]}function Br(t=null){return ua(t,null,1)[0]}function n5(t=null){return ua(null,t,1)[0]}function Ic(t,e="a1"){return[e,...ua(e,null,t)]}function nn(t,e){return t.index<e.index?-1:t.index>e.index?1:0}function r5(t,e){return t.id>e.id?1:-1}function Oy(t){try{return localStorage.getItem(t)}catch{return null}}function Dy(t,e){try{localStorage.setItem(t,e)}catch{}}function o5(){try{localStorage.clear()}catch{}}function kx(t){try{return sessionStorage.getItem(t)}catch{return null}}function $y(t,e){try{sessionStorage.setItem(t,e)}catch{}}function Mx(t){try{sessionStorage.removeItem(t)}catch{}}function i5(){try{sessionStorage.clear()}catch{}}const s5=()=>typeof process<"u"&&!1,Ts=[],a5=60,md=Math.ceil(1e3/a5);let Da,zp=0,Ng=0;const c5=()=>{const t=Ts.splice(0,Ts.length);for(const e of t)e()};function Ax(){if(Da)return;const t=Date.now(),e=t-Ng;if(zp+e<md){Da=requestAnimationFrame(()=>{Da=void 0,Ax()});return}Da=requestAnimationFrame(()=>{Da=void 0,Ng=t,zp=Math.min(zp+e-md,md*10),c5()})}let Gb=!1;function Ox(t){return s5()?(t(),()=>{}):(Ts.includes(t)||(Ts.push(t),Gb||(Gb=!0,Ng=Date.now()-md-1),Ax()),()=>{const e=Ts.indexOf(t);e>-1&&Ts.splice(e,1)})}class l5{constructor(){P(this,"timeouts",new Map);P(this,"intervals",new Map);P(this,"rafs",new Map);this.setTimeout=this.setTimeout.bind(this),this.setInterval=this.setInterval.bind(this),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.dispose=this.dispose.bind(this)}setTimeout(e,n,r,...o){const i=window.setTimeout(n,r,o),s=this.timeouts.get(e)??[];return this.timeouts.set(e,[...s,i]),i}setInterval(e,n,r,...o){const i=window.setInterval(n,r,o),s=this.intervals.get(e)??[];return this.intervals.set(e,[...s,i]),i}requestAnimationFrame(e,n){const r=window.requestAnimationFrame(n),o=this.rafs.get(e)??[];return this.rafs.set(e,[...o,r]),r}dispose(e){var n,r,o;(n=this.timeouts.get(e))==null||n.forEach(i=>clearTimeout(i)),(r=this.intervals.get(e))==null||r.forEach(i=>clearInterval(i)),(o=this.rafs.get(e))==null||o.forEach(i=>cancelAnimationFrame(i)),this.timeouts.delete(e),this.intervals.delete(e),this.rafs.delete(e)}disposeAll(){for(const e of this.timeouts.keys())this.dispose(e)}forContext(e){return{setTimeout:(n,r,...o)=>this.setTimeout(e,n,r,o),setInterval:(n,r,...o)=>this.setInterval(e,n,r,o),requestAnimationFrame:n=>this.requestAnimationFrame(e,n),dispose:()=>this.dispose(e)}}}const ye=(t,e)=>{try{return new URL(t,e)}catch{return}};function d5(t){return t!==void 0}function u5(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[t=>t&&JSON.parse(JSON.stringify(t)),!1]}const Dx=u5(),ut=Dx[0];Dx[1];const h5=Object.getPrototypeOf(ut({}));fi("@tldraw/utils","3.3.1","esm");var $a=function(t){return t&&t.Math===Math&&t},pn=$a(typeof globalThis=="object"&&globalThis)||$a(typeof window=="object"&&window)||$a(typeof self=="object"&&self)||$a(typeof on=="object"&&on)||$a(typeof on=="object"&&on)||function(){return this}()||Function("return this")(),Ry={},fn=function(t){try{return!!t()}catch{return!0}},p5=fn,gi=!p5(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),f5=fn,lh=!f5(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),g5=lh,El=Function.prototype.call,$o=g5?El.bind(El):function(){return El.apply(El,arguments)},$x={},Rx={}.propertyIsEnumerable,Lx=Object.getOwnPropertyDescriptor,m5=Lx&&!Rx.call({1:2},1);$x.f=m5?function(e){var n=Lx(this,e);return!!n&&n.enumerable}:Rx;var Nx=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}},Fx=lh,zx=Function.prototype,Fg=zx.call,y5=Fx&&zx.bind.bind(Fg,Fg),Lt=Fx?y5:function(t){return function(){return Fg.apply(t,arguments)}},Bx=Lt,S5=Bx({}.toString),v5=Bx("".slice),ha=function(t){return v5(S5(t),8,-1)},b5=Lt,w5=fn,_5=ha,Bp=Object,x5=b5("".split),P5=w5(function(){return!Bp("z").propertyIsEnumerable(0)})?function(t){return _5(t)==="String"?x5(t,""):Bp(t)}:Bp,dh=function(t){return t==null},I5=dh,C5=TypeError,pa=function(t){if(I5(t))throw new C5("Can't call method on "+t);return t},E5=P5,T5=pa,uh=function(t){return E5(T5(t))},Up=typeof document=="object"&&document.all,gn=typeof Up>"u"&&Up!==void 0?function(t){return typeof t=="function"||t===Up}:function(t){return typeof t=="function"},k5=gn,ns=function(t){return typeof t=="object"?t!==null:k5(t)},Hp=pn,M5=gn,A5=function(t){return M5(t)?t:void 0},hh=function(t,e){return arguments.length<2?A5(Hp[t]):Hp[t]&&Hp[t][e]},O5=Lt,Ux=O5({}.isPrototypeOf),D5=pn,Vb=D5.navigator,Yb=Vb&&Vb.userAgent,$5=Yb?String(Yb):"",Hx=pn,jp=$5,Xb=Hx.process,qb=Hx.Deno,Zb=Xb&&Xb.versions||qb&&qb.version,Jb=Zb&&Zb.v8,yr,du;Jb&&(yr=Jb.split("."),du=yr[0]>0&&yr[0]<4?1:+(yr[0]+yr[1]));!du&&jp&&(yr=jp.match(/Edge\/(\d+)/),(!yr||yr[1]>=74)&&(yr=jp.match(/Chrome\/(\d+)/),yr&&(du=+yr[1])));var R5=du,Qb=R5,L5=fn,N5=pn,F5=N5.String,jx=!!Object.getOwnPropertySymbols&&!L5(function(){var t=Symbol("symbol detection");return!F5(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Qb&&Qb<41}),z5=jx,Kx=z5&&!Symbol.sham&&typeof Symbol.iterator=="symbol",B5=hh,U5=gn,H5=Ux,j5=Kx,K5=Object,Wx=j5?function(t){return typeof t=="symbol"}:function(t){var e=B5("Symbol");return U5(e)&&H5(e.prototype,K5(t))},W5=String,G5=function(t){try{return W5(t)}catch{return"Object"}},V5=gn,Y5=G5,X5=TypeError,Ly=function(t){if(V5(t))return t;throw new X5(Y5(t)+" is not a function")},q5=Ly,Z5=dh,Ny=function(t,e){var n=t[e];return Z5(n)?void 0:q5(n)},Kp=$o,Wp=gn,Gp=ns,J5=TypeError,Q5=function(t,e){var n,r;if(e==="string"&&Wp(n=t.toString)&&!Gp(r=Kp(n,t))||Wp(n=t.valueOf)&&!Gp(r=Kp(n,t))||e!=="string"&&Wp(n=t.toString)&&!Gp(r=Kp(n,t)))return r;throw new J5("Can't convert object to primitive value")},Gx={exports:{}},ew=pn,eN=Object.defineProperty,Fy=function(t,e){try{eN(ew,t,{value:e,configurable:!0,writable:!0})}catch{ew[t]=e}return e},tN=pn,nN=Fy,tw="__core-js_shared__",nw=Gx.exports=tN[tw]||nN(tw,{});(nw.versions||(nw.versions=[])).push({version:"3.38.1",mode:"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.1/LICENSE",source:"https://github.com/zloirock/core-js"});var zy=Gx.exports,rw=zy,By=function(t,e){return rw[t]||(rw[t]=e||{})},rN=pa,oN=Object,Hc=function(t){return oN(rN(t))},iN=Lt,sN=Hc,aN=iN({}.hasOwnProperty),mi=Object.hasOwn||function(e,n){return aN(sN(e),n)},cN=Lt,lN=0,dN=Math.random(),uN=cN(1 .toString),Vx=function(t){return"Symbol("+(t===void 0?"":t)+")_"+uN(++lN+dN,36)},hN=pn,pN=By,ow=mi,fN=Vx,gN=jx,mN=Kx,ks=hN.Symbol,Vp=pN("wks"),yN=mN?ks.for||ks:ks&&ks.withoutSetter||fN,Ro=function(t){return ow(Vp,t)||(Vp[t]=gN&&ow(ks,t)?ks[t]:yN("Symbol."+t)),Vp[t]},SN=$o,iw=ns,sw=Wx,vN=Ny,bN=Q5,wN=Ro,_N=TypeError,xN=wN("toPrimitive"),PN=function(t,e){if(!iw(t)||sw(t))return t;var n=vN(t,xN),r;if(n){if(e===void 0&&(e="default"),r=SN(n,t,e),!iw(r)||sw(r))return r;throw new _N("Can't convert object to primitive value")}return e===void 0&&(e="number"),bN(t,e)},IN=PN,CN=Wx,Yx=function(t){var e=IN(t,"string");return CN(e)?e:e+""},EN=pn,aw=ns,zg=EN.document,TN=aw(zg)&&aw(zg.createElement),Xx=function(t){return TN?zg.createElement(t):{}},kN=gi,MN=fn,AN=Xx,qx=!kN&&!MN(function(){return Object.defineProperty(AN("div"),"a",{get:function(){return 7}}).a!==7}),ON=gi,DN=$o,$N=$x,RN=Nx,LN=uh,NN=Yx,FN=mi,zN=qx,cw=Object.getOwnPropertyDescriptor;Ry.f=ON?cw:function(e,n){if(e=LN(e),n=NN(n),zN)try{return cw(e,n)}catch{}if(FN(e,n))return RN(!DN($N.f,e,n),e[n])};var fa={},BN=gi,UN=fn,Zx=BN&&UN(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),HN=ns,jN=String,KN=TypeError,rs=function(t){if(HN(t))return t;throw new KN(jN(t)+" is not an object")},WN=gi,GN=qx,VN=Zx,Tl=rs,lw=Yx,YN=TypeError,Yp=Object.defineProperty,XN=Object.getOwnPropertyDescriptor,Xp="enumerable",qp="configurable",Zp="writable";fa.f=WN?VN?function(e,n,r){if(Tl(e),n=lw(n),Tl(r),typeof e=="function"&&n==="prototype"&&"value"in r&&Zp in r&&!r[Zp]){var o=XN(e,n);o&&o[Zp]&&(e[n]=r.value,r={configurable:qp in r?r[qp]:o[qp],enumerable:Xp in r?r[Xp]:o[Xp],writable:!1})}return Yp(e,n,r)}:Yp:function(e,n,r){if(Tl(e),n=lw(n),Tl(r),GN)try{return Yp(e,n,r)}catch{}if("get"in r||"set"in r)throw new YN("Accessors not supported");return"value"in r&&(e[n]=r.value),e};var qN=gi,ZN=fa,JN=Nx,Uy=qN?function(t,e,n){return ZN.f(t,e,JN(1,n))}:function(t,e,n){return t[e]=n,t},Jx={exports:{}},Bg=gi,QN=mi,Qx=Function.prototype,eF=Bg&&Object.getOwnPropertyDescriptor,Hy=QN(Qx,"name"),tF=Hy&&(function(){}).name==="something",nF=Hy&&(!Bg||Bg&&eF(Qx,"name").configurable),rF={EXISTS:Hy,PROPER:tF,CONFIGURABLE:nF},oF=Lt,iF=gn,Ug=zy,sF=oF(Function.toString);iF(Ug.inspectSource)||(Ug.inspectSource=function(t){return sF(t)});var eP=Ug.inspectSource,aF=pn,cF=gn,dw=aF.WeakMap,lF=cF(dw)&&/native code/.test(String(dw)),dF=By,uF=Vx,uw=dF("keys"),tP=function(t){return uw[t]||(uw[t]=uF(t))},jy={},hF=lF,nP=pn,pF=ns,fF=Uy,Jp=mi,Qp=zy,gF=tP,mF=jy,hw="Object already initialized",Hg=nP.TypeError,yF=nP.WeakMap,uu,Cc,hu,SF=function(t){return hu(t)?Cc(t):uu(t,{})},vF=function(t){return function(e){var n;if(!pF(e)||(n=Cc(e)).type!==t)throw new Hg("Incompatible receiver, "+t+" required");return n}};if(hF||Qp.state){var $r=Qp.state||(Qp.state=new yF);$r.get=$r.get,$r.has=$r.has,$r.set=$r.set,uu=function(t,e){if($r.has(t))throw new Hg(hw);return e.facade=t,$r.set(t,e),e},Cc=function(t){return $r.get(t)||{}},hu=function(t){return $r.has(t)}}else{var hs=gF("state");mF[hs]=!0,uu=function(t,e){if(Jp(t,hs))throw new Hg(hw);return e.facade=t,fF(t,hs,e),e},Cc=function(t){return Jp(t,hs)?t[hs]:{}},hu=function(t){return Jp(t,hs)}}var rP={set:uu,get:Cc,has:hu,enforce:SF,getterFor:vF},Ky=Lt,bF=fn,wF=gn,kl=mi,jg=gi,_F=rF.CONFIGURABLE,xF=eP,oP=rP,PF=oP.enforce,IF=oP.get,pw=String,yd=Object.defineProperty,CF=Ky("".slice),EF=Ky("".replace),TF=Ky([].join),kF=jg&&!bF(function(){return yd(function(){},"length",{value:8}).length!==8}),MF=String(String).split("String"),AF=Jx.exports=function(t,e,n){CF(pw(e),0,7)==="Symbol("&&(e="["+EF(pw(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!kl(t,"name")||_F&&t.name!==e)&&(jg?yd(t,"name",{value:e,configurable:!0}):t.name=e),kF&&n&&kl(n,"arity")&&t.length!==n.arity&&yd(t,"length",{value:n.arity});try{n&&kl(n,"constructor")&&n.constructor?jg&&yd(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch{}var r=PF(t);return kl(r,"source")||(r.source=TF(MF,typeof e=="string"?e:"")),t};Function.prototype.toString=AF(function(){return wF(this)&&IF(this).source||xF(this)},"toString");var OF=Jx.exports,DF=gn,$F=fa,RF=OF,LF=Fy,iP=function(t,e,n,r){r||(r={});var o=r.enumerable,i=r.name!==void 0?r.name:e;if(DF(n)&&RF(n,i,r),r.global)o?t[e]=n:LF(e,n);else{try{r.unsafe?t[e]&&(o=!0):delete t[e]}catch{}o?t[e]=n:$F.f(t,e,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return t},sP={},NF=Math.ceil,FF=Math.floor,zF=Math.trunc||function(e){var n=+e;return(n>0?FF:NF)(n)},BF=zF,os=function(t){var e=+t;return e!==e||e===0?0:BF(e)},UF=os,HF=Math.max,jF=Math.min,KF=function(t,e){var n=UF(t);return n<0?HF(n+e,0):jF(n,e)},WF=os,GF=Math.min,aP=function(t){var e=WF(t);return e>0?GF(e,9007199254740991):0},VF=aP,jc=function(t){return VF(t.length)},YF=uh,XF=KF,qF=jc,fw=function(t){return function(e,n,r){var o=YF(e),i=qF(o);if(i===0)return!t&&-1;var s=XF(r,i),a;if(t&&n!==n){for(;i>s;)if(a=o[s++],a!==a)return!0}else for(;i>s;s++)if((t||s in o)&&o[s]===n)return t||s||0;return!t&&-1}},ZF={includes:fw(!0),indexOf:fw(!1)},JF=Lt,ef=mi,QF=uh,e4=ZF.indexOf,t4=jy,gw=JF([].push),cP=function(t,e){var n=QF(t),r=0,o=[],i;for(i in n)!ef(t4,i)&&ef(n,i)&&gw(o,i);for(;e.length>r;)ef(n,i=e[r++])&&(~e4(o,i)||gw(o,i));return o},Wy=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],n4=cP,r4=Wy,o4=r4.concat("length","prototype");sP.f=Object.getOwnPropertyNames||function(e){return n4(e,o4)};var lP={};lP.f=Object.getOwnPropertySymbols;var i4=hh,s4=Lt,a4=sP,c4=lP,l4=rs,d4=s4([].concat),u4=i4("Reflect","ownKeys")||function(e){var n=a4.f(l4(e)),r=c4.f;return r?d4(n,r(e)):n},mw=mi,h4=u4,p4=Ry,f4=fa,g4=function(t,e,n){for(var r=h4(e),o=f4.f,i=p4.f,s=0;s<r.length;s++){var a=r[s];!mw(t,a)&&!(n&&mw(n,a))&&o(t,a,i(e,a))}},m4=fn,y4=gn,S4=/#|\.prototype\./,Kc=function(t,e){var n=b4[v4(t)];return n===_4?!0:n===w4?!1:y4(e)?m4(e):!!e},v4=Kc.normalize=function(t){return String(t).replace(S4,".").toLowerCase()},b4=Kc.data={},w4=Kc.NATIVE="N",_4=Kc.POLYFILL="P",x4=Kc,Ml=pn,P4=Ry.f,I4=Uy,C4=iP,E4=Fy,T4=g4,k4=x4,ga=function(t,e){var n=t.target,r=t.global,o=t.stat,i,s,a,c,l,d;if(r?s=Ml:o?s=Ml[n]||E4(n,{}):s=Ml[n]&&Ml[n].prototype,s)for(a in e){if(l=e[a],t.dontCallGetSet?(d=P4(s,a),c=d&&d.value):c=s[a],i=k4(r?a:n+(o?".":"#")+a,t.forced),!i&&c!==void 0){if(typeof l==typeof c)continue;T4(l,c)}(t.sham||c&&c.sham)&&I4(l,"sham",!0),C4(s,a,l,t)}},dP={},M4=cP,A4=Wy,O4=Object.keys||function(e){return M4(e,A4)},D4=gi,$4=Zx,R4=fa,L4=rs,N4=uh,F4=O4;dP.f=D4&&!$4?Object.defineProperties:function(e,n){L4(e);for(var r=N4(n),o=F4(n),i=o.length,s=0,a;i>s;)R4.f(e,a=o[s++],r[a]);return e};var z4=hh,B4=z4("document","documentElement"),U4=rs,H4=dP,yw=Wy,j4=jy,K4=B4,W4=Xx,G4=tP,Sw=">",vw="<",Kg="prototype",Wg="script",uP=G4("IE_PROTO"),tf=function(){},hP=function(t){return vw+Wg+Sw+t+vw+"/"+Wg+Sw},bw=function(t){t.write(hP("")),t.close();var e=t.parentWindow.Object;return t=null,e},V4=function(){var t=W4("iframe"),e="java"+Wg+":",n;return t.style.display="none",K4.appendChild(t),t.src=String(e),n=t.contentWindow.document,n.open(),n.write(hP("document.F=Object")),n.close(),n.F},Al,Sd=function(){try{Al=new ActiveXObject("htmlfile")}catch{}Sd=typeof document<"u"?document.domain&&Al?bw(Al):V4():bw(Al);for(var t=yw.length;t--;)delete Sd[Kg][yw[t]];return Sd()};j4[uP]=!0;var pP=Object.create||function(e,n){var r;return e!==null?(tf[Kg]=U4(e),r=new tf,tf[Kg]=null,r[uP]=e):r=Sd(),n===void 0?r:H4.f(r,n)},Y4=Ro,X4=pP,q4=fa.f,Gg=Y4("unscopables"),Vg=Array.prototype;Vg[Gg]===void 0&&q4(Vg,Gg,{configurable:!0,value:X4(null)});var Gy=function(t){Vg[Gg][t]=!0},Z4=ga,J4=Hc,Q4=jc,e6=os,t6=Gy;Z4({target:"Array",proto:!0},{at:function(e){var n=J4(this),r=Q4(n),o=e6(e),i=o>=0?o:r+o;return i<0||i>=r?void 0:n[i]}});t6("at");var n6=pn,r6=Lt,Wc=function(t,e){return r6(n6[t].prototype[e])},o6=Wc;o6("Array","at");var i6=ha,fP=Array.isArray||function(e){return i6(e)==="Array"},s6=TypeError,a6=9007199254740991,c6=function(t){if(t>a6)throw s6("Maximum allowed index exceeded");return t},l6=ha,d6=Lt,u6=function(t){if(l6(t)==="Function")return d6(t)},ww=u6,h6=Ly,p6=lh,f6=ww(ww.bind),g6=function(t,e){return h6(t),e===void 0?t:p6?f6(t,e):function(){return t.apply(e,arguments)}},m6=fP,y6=jc,S6=c6,v6=g6,gP=function(t,e,n,r,o,i,s,a){for(var c=o,l=0,d=s?v6(s,a):!1,h,p;l<r;)l in n&&(h=d?d(n[l],l,e):n[l],i>0&&m6(h)?(p=y6(h),c=gP(t,e,h,p,c,i-1)-1):(S6(c+1),t[c]=h),c++),l++;return c},mP=gP,b6=Ro,w6=b6("toStringTag"),yP={};yP[w6]="z";var _6=String(yP)==="[object z]",x6=_6,P6=gn,vd=ha,I6=Ro,C6=I6("toStringTag"),E6=Object,T6=vd(function(){return arguments}())==="Arguments",k6=function(t,e){try{return t[e]}catch{}},SP=x6?vd:function(t){var e,n,r;return t===void 0?"Undefined":t===null?"Null":typeof(n=k6(e=E6(t),C6))=="string"?n:T6?vd(e):(r=vd(e))==="Object"&&P6(e.callee)?"Arguments":r},M6=Lt,A6=fn,vP=gn,O6=SP,D6=hh,$6=eP,bP=function(){},wP=D6("Reflect","construct"),Vy=/^\s*(?:class|function)\b/,R6=M6(Vy.exec),L6=!Vy.test(bP),Ra=function(e){if(!vP(e))return!1;try{return wP(bP,[],e),!0}catch{return!1}},_P=function(e){if(!vP(e))return!1;switch(O6(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return L6||!!R6(Vy,$6(e))}catch{return!0}};_P.sham=!0;var N6=!wP||A6(function(){var t;return Ra(Ra.call)||!Ra(Object)||!Ra(function(){t=!0})||t})?_P:Ra,_w=fP,F6=N6,z6=ns,B6=Ro,U6=B6("species"),xw=Array,H6=function(t){var e;return _w(t)&&(e=t.constructor,F6(e)&&(e===xw||_w(e.prototype))?e=void 0:z6(e)&&(e=e[U6],e===null&&(e=void 0))),e===void 0?xw:e},j6=H6,xP=function(t,e){return new(j6(t))(e===0?0:e)},K6=ga,W6=mP,G6=Ly,V6=Hc,Y6=jc,X6=xP;K6({target:"Array",proto:!0},{flatMap:function(e){var n=V6(this),r=Y6(n),o;return G6(e),o=X6(n,0),o.length=W6(o,n,n,r,0,1,e,arguments.length>1?arguments[1]:void 0),o}});var q6=Gy;q6("flatMap");var Z6=Wc;Z6("Array","flatMap");var J6=ga,Q6=mP,e8=Hc,t8=jc,n8=os,r8=xP;J6({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,n=e8(this),r=t8(n),o=r8(n,0);return o.length=Q6(o,n,n,r,0,e===void 0?1:n8(e)),o}});var o8=Gy;o8("flat");var i8=Wc;i8("Array","flat");var s8=SP,a8=String,Gc=function(t){if(s8(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return a8(t)},c8=ga,l8=Lt,d8=pa,u8=os,h8=Gc,p8=fn,f8=l8("".charAt),g8=p8(function(){return"𠮷".at(-2)!=="\uD842"});c8({target:"String",proto:!0,forced:g8},{at:function(e){var n=h8(d8(this)),r=n.length,o=u8(e),i=o>=0?o:r+o;return i<0||i>=r?void 0:f8(n,i)}});var m8=Wc;m8("String","at");var y8=rs,PP=function(){var t=y8(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},Yy=fn,S8=pn,Xy=S8.RegExp,qy=Yy(function(){var t=Xy("a","y");return t.lastIndex=2,t.exec("abcd")!==null}),v8=qy||Yy(function(){return!Xy("a","y").sticky}),b8=qy||Yy(function(){var t=Xy("^r","gy");return t.lastIndex=2,t.exec("str")!==null}),w8={BROKEN_CARET:b8,MISSED_STICKY:v8,UNSUPPORTED_Y:qy},_8=fn,x8=pn,P8=x8.RegExp,I8=_8(function(){var t=P8(".","s");return!(t.dotAll&&t.test(`
`)&&t.flags==="s")}),C8=fn,E8=pn,T8=E8.RegExp,k8=C8(function(){var t=T8("(?<a>b)","g");return t.exec("b").groups.a!=="b"||"b".replace(t,"$<a>c")!=="bc"}),Ms=$o,ph=Lt,M8=Gc,A8=PP,O8=w8,D8=By,$8=pP,R8=rP.get,L8=I8,N8=k8,F8=D8("native-string-replace",String.prototype.replace),pu=RegExp.prototype.exec,Yg=pu,z8=ph("".charAt),B8=ph("".indexOf),U8=ph("".replace),nf=ph("".slice),Xg=function(){var t=/a/,e=/b*/g;return Ms(pu,t,"a"),Ms(pu,e,"a"),t.lastIndex!==0||e.lastIndex!==0}(),IP=O8.BROKEN_CARET,qg=/()??/.exec("")[1]!==void 0,H8=Xg||qg||IP||L8||N8;H8&&(Yg=function(e){var n=this,r=R8(n),o=M8(e),i=r.raw,s,a,c,l,d,h,p;if(i)return i.lastIndex=n.lastIndex,s=Ms(Yg,i,o),n.lastIndex=i.lastIndex,s;var f=r.groups,g=IP&&n.sticky,m=Ms(A8,n),y=n.source,S=0,v=o;if(g&&(m=U8(m,"y",""),B8(m,"g")===-1&&(m+="g"),v=nf(o,n.lastIndex),n.lastIndex>0&&(!n.multiline||n.multiline&&z8(o,n.lastIndex-1)!==`
`)&&(y="(?: "+y+")",v=" "+v,S++),a=new RegExp("^(?:"+y+")",m)),qg&&(a=new RegExp("^"+y+"$(?!\\s)",m)),Xg&&(c=n.lastIndex),l=Ms(pu,g?a:n,v),g?l?(l.input=nf(l.input,S),l[0]=nf(l[0],S),l.index=n.lastIndex,n.lastIndex+=l[0].length):n.lastIndex=0:Xg&&l&&(n.lastIndex=n.global?l.index+l[0].length:c),qg&&l&&l.length>1&&Ms(F8,l[0],a,function(){for(d=1;d<arguments.length-2;d++)arguments[d]===void 0&&(l[d]=void 0)}),l&&f)for(l.groups=h=$8(null),d=0;d<f.length;d++)p=f[d],h[p[0]]=l[p[1]];return l});var Zy=Yg,j8=ga,Pw=Zy;j8({target:"RegExp",proto:!0,forced:/./.exec!==Pw},{exec:Pw});var K8=lh,CP=Function.prototype,Iw=CP.apply,Cw=CP.call,W8=typeof Reflect=="object"&&Reflect.apply||(K8?Cw.bind(Iw):function(){return Cw.apply(Iw,arguments)}),Ew=$o,Tw=iP,G8=Zy,kw=fn,EP=Ro,V8=Uy,Y8=EP("species"),rf=RegExp.prototype,X8=function(t,e,n,r){var o=EP(t),i=!kw(function(){var l={};return l[o]=function(){return 7},""[t](l)!==7}),s=i&&!kw(function(){var l=!1,d=/a/;return t==="split"&&(d={},d.constructor={},d.constructor[Y8]=function(){return d},d.flags="",d[o]=/./[o]),d.exec=function(){return l=!0,null},d[o](""),!l});if(!i||!s||n){var a=/./[o],c=e(o,""[t],function(l,d,h,p,f){var g=d.exec;return g===G8||g===rf.exec?i&&!f?{done:!0,value:Ew(a,d,h,p)}:{done:!0,value:Ew(l,h,d,p)}:{done:!1}});Tw(String.prototype,t,c[0]),Tw(rf,o,c[1])}r&&V8(rf[o],"sham",!0)},Jy=Lt,q8=os,Z8=Gc,J8=pa,Q8=Jy("".charAt),Mw=Jy("".charCodeAt),ez=Jy("".slice),Aw=function(t){return function(e,n){var r=Z8(J8(e)),o=q8(n),i=r.length,s,a;return o<0||o>=i?t?"":void 0:(s=Mw(r,o),s<55296||s>56319||o+1===i||(a=Mw(r,o+1))<56320||a>57343?t?Q8(r,o):s:t?ez(r,o,o+2):(s-55296<<10)+(a-56320)+65536)}},tz={codeAt:Aw(!1),charAt:Aw(!0)},nz=tz.charAt,rz=function(t,e,n){return e+(n?nz(t,e).length:1)},Qy=Lt,oz=Hc,iz=Math.floor,of=Qy("".charAt),sz=Qy("".replace),sf=Qy("".slice),az=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,cz=/\$([$&'`]|\d{1,2})/g,TP=function(t,e,n,r,o,i){var s=n+t.length,a=r.length,c=cz;return o!==void 0&&(o=oz(o),c=az),sz(i,c,function(l,d){var h;switch(of(d,0)){case"$":return"$";case"&":return t;case"`":return sf(e,0,n);case"'":return sf(e,s);case"<":h=o[sf(d,1,-1)];break;default:var p=+d;if(p===0)return l;if(p>a){var f=iz(p/10);return f===0?l:f<=a?r[f-1]===void 0?of(d,1):r[f-1]+of(d,1):l}h=r[p-1]}return h===void 0?"":h})},Ow=$o,lz=rs,dz=gn,uz=ha,hz=Zy,pz=TypeError,fz=function(t,e){var n=t.exec;if(dz(n)){var r=Ow(n,t,e);return r!==null&&lz(r),r}if(uz(t)==="RegExp")return Ow(hz,t,e);throw new pz("RegExp#exec called on incompatible receiver")},gz=W8,Dw=$o,fh=Lt,mz=X8,yz=fn,Sz=rs,vz=gn,bz=dh,wz=os,_z=aP,ps=Gc,xz=pa,Pz=rz,Iz=Ny,Cz=TP,Ez=fz,Tz=Ro,Zg=Tz("replace"),kz=Math.max,Mz=Math.min,Az=fh([].concat),af=fh([].push),$w=fh("".indexOf),Rw=fh("".slice),Oz=function(t){return t===void 0?t:String(t)},Dz=function(){return"a".replace(/./,"$0")==="$0"}(),Lw=function(){return/./[Zg]?/./[Zg]("a","$0")==="":!1}(),$z=!yz(function(){var t=/./;return t.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(t,"$<a>")!=="7"});mz("replace",function(t,e,n){var r=Lw?"$":"$0";return[function(i,s){var a=xz(this),c=bz(i)?void 0:Iz(i,Zg);return c?Dw(c,i,a,s):Dw(e,ps(a),i,s)},function(o,i){var s=Sz(this),a=ps(o);if(typeof i=="string"&&$w(i,r)===-1&&$w(i,"$<")===-1){var c=n(e,s,a,i);if(c.done)return c.value}var l=vz(i);l||(i=ps(i));var d=s.global,h;d&&(h=s.unicode,s.lastIndex=0);for(var p=[],f;f=Ez(s,a),!(f===null||(af(p,f),!d));){var g=ps(f[0]);g===""&&(s.lastIndex=Pz(a,_z(s.lastIndex),h))}for(var m="",y=0,S=0;S<p.length;S++){f=p[S];for(var v=ps(f[0]),_=kz(Mz(wz(f.index),a.length),0),w=[],x,C=1;C<f.length;C++)af(w,Oz(f[C]));var E=f.groups;if(l){var I=Az([v],w,_,a);E!==void 0&&af(I,E),x=ps(gz(i,void 0,I))}else x=Cz(v,a,_,w,E,i);_>=y&&(m+=Rw(a,y,_)+x,y=_+v.length)}return m+Rw(a,y)}]},!$z||!Dz||Lw);var Rz=ns,Lz=ha,Nz=Ro,Fz=Nz("match"),zz=function(t){var e;return Rz(t)&&((e=t[Fz])!==void 0?!!e:Lz(t)==="RegExp")},Bz=$o,Uz=mi,Hz=Ux,jz=PP,Nw=RegExp.prototype,Kz=function(t){var e=t.flags;return e===void 0&&!("flags"in Nw)&&!Uz(t,"flags")&&Hz(Nw,t)?Bz(jz,t):e},Wz=ga,Gz=$o,eS=Lt,Fw=pa,Vz=gn,Yz=dh,Xz=zz,La=Gc,qz=Ny,Zz=Kz,Jz=TP,Qz=Ro,eB=Qz("replace"),tB=TypeError,cf=eS("".indexOf);eS("".replace);var zw=eS("".slice),nB=Math.max;Wz({target:"String",proto:!0},{replaceAll:function(e,n){var r=Fw(this),o,i,s,a,c,l,d,h,p,f,g=0,m="";if(!Yz(e)){if(o=Xz(e),o&&(i=La(Fw(Zz(e))),!~cf(i,"g")))throw new tB("`.replaceAll` does not allow non-global regexes");if(s=qz(e,eB),s)return Gz(s,e,r,n)}for(a=La(r),c=La(e),l=Vz(n),l||(n=La(n)),d=c.length,h=nB(1,d),p=cf(a,c);p!==-1;)f=l?La(n(c,p,a)):Jz(c,a,p,[],void 0,n),m+=zw(a,g,p)+f,g=p+d,p=p+h>a.length?-1:cf(a,c,p+h);return g<a.length&&(m+=zw(a,g)),m}});var rB=Wc;rB("String","replaceAll");function kP(t){return t&&typeof t=="object"&&"parents"in t}function MP(t){for(let e=0,n=t.parents.length;e<n;e++)if(t.parents[e].__unsafe__getWithoutCapture(!0),t.parents[e].lastChangedEpoch!==t.parentEpochs[e])return!0;return!1}function fu(t,e){if(t.children.remove(e)&&t.children.isEmpty&&kP(t))for(let n=0,r=t.parents.length;n<r;n++)fu(t.parents[n],t)}function tS(t,e){if(t.children.add(e)&&kP(t))for(let n=0,r=t.parents.length;n<r;n++)tS(t.parents[n],t)}function AP(t,e){return t===e||Object.is(t,e)||!!(t&&e&&typeof t.equals=="function"&&t.equals(e))}function yi(t,e){const n=Symbol.for(`com.tldraw.state/${t}`),r=globalThis;return r[n]??(r[n]=e()),r[n]}const _o=yi("empty_array",()=>Object.freeze([])),Bw=8;class gu{constructor(){P(this,"arraySize",0);P(this,"array",Array(Bw));P(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<Bw?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const n=this.array.indexOf(e);return n===-1?!1:(this.array[n]=void 0,this.arraySize--,n!==this.arraySize&&(this.array[n]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let n=0;n<this.arraySize;n++){const r=this.array[n];typeof r<"u"&&e(r)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}has(e){return this.array?this.array.indexOf(e)!==-1:this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const Wn=Symbol.for("com.tldraw.state/RESET_VALUE");class OP{constructor(e){P(this,"index",0);P(this,"buffer");this.capacity=e,this.buffer=new Array(e)}pushEntry(e,n,r){if(r!==void 0){if(r===Wn){this.clear();return}this.buffer[this.index]=[e,n,r],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:n,capacity:r,buffer:o}=this;for(let i=0;i<r;i++){const s=(n-1+r-i)%r,a=o[s];if(!a)return Wn;const[c,l]=a;if(i===0&&e>=l)return[];if(c<=e&&e<l){const d=i+1,h=new Array(d);for(let p=0;p<d;p++)h[p]=o[(s+p)%r][2];return h}}return Wn}}class oB{constructor(e,n){P(this,"offset",0);P(this,"maybeRemoved");this.below=e,this.child=n}}const pt=yi("capture",()=>({stack:null}));function Ol(t){const e=pt.stack;pt.stack=null;try{return t()}finally{pt.stack=e}}function DP(t){pt.stack=new oB(pt.stack,t),t.parentSet.clear()}function $P(){const t=pt.stack;if(pt.stack=t.below,t.offset<t.child.parents.length){for(let e=t.offset;e<t.child.parents.length;e++){const n=t.child.parents[e];t.child.parentSet.has(n)||fu(n,t.child)}t.child.parents.length=t.offset,t.child.parentEpochs.length=t.offset}if(t.maybeRemoved)for(let e=0;e<t.maybeRemoved.length;e++){const n=t.maybeRemoved[e];t.child.parentSet.has(n)||fu(n,t.child)}}function mu(t){if(pt.stack){if(pt.stack.child.parentSet.has(t))return;if(pt.stack.child.parentSet.add(t),pt.stack.child.isActivelyListening&&tS(t,pt.stack.child),pt.stack.offset<pt.stack.child.parents.length){const n=pt.stack.child.parents[pt.stack.offset];n!==t&&(pt.stack.maybeRemoved?pt.stack.maybeRemoved.push(n):pt.stack.maybeRemoved=[n])}pt.stack.child.parents[pt.stack.offset]=t,pt.stack.child.parentEpochs[pt.stack.offset]=t.lastChangedEpoch,pt.stack.offset++}}const ei=-1;class iB{constructor(e,n,r){P(this,"_isActivelyListening",!1);P(this,"lastTraversedEpoch",ei);P(this,"lastReactedEpoch",ei);P(this,"_scheduleCount",0);P(this,"parentSet",new gu);P(this,"parentEpochs",[]);P(this,"parents",[]);P(this,"_scheduleEffect");P(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=e,this.runEffect=n,this._scheduleEffect=r==null?void 0:r.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==Pn()){if(this.parents.length&&!MP(this)){this.lastReactedEpoch=Pn();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,n=this.parents.length;e<n;e++)tS(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,n=this.parents.length;e<n;e++)fu(this.parents[e],this)}execute(){try{DP(this);const e=Pn(),n=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,n}finally{$P()}}}const ma=yi("EffectScheduler",()=>iB);function xo(t,e,n){const r=new ma(t,e,n);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function sB(t,e,n){const r=new ma(t,e,n);return{scheduler:r,start:o=>{const i=(o==null?void 0:o.force)??!1;r.attach(),i?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}class aB{constructor(e){P(this,"initialAtomValues",new Map);this.parent=e}get isRoot(){return this.parent===null}commit(){if(Ue.globalIsReacting)for(const e of this.initialAtomValues.keys())LP(e);else this.isRoot?RP(this.initialAtomValues.keys()):this.initialAtomValues.forEach((e,n)=>{this.parent.initialAtomValues.has(n)||this.parent.initialAtomValues.set(n,e)})}abort(){Ue.globalEpoch++,this.initialAtomValues.forEach((e,n)=>{var r;n.set(e),(r=n.historyBuffer)==null||r.clear()}),this.commit()}}const Ue=yi("transactions",()=>({globalEpoch:ei+1,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:ei+1}));function cB(){return Ue.reactionEpoch}function Pn(){return Ue.globalEpoch}function lB(){return Ue.globalIsReacting}function nS(t,e){e.lastTraversedEpoch!==Ue.globalEpoch&&(e.lastTraversedEpoch=Ue.globalEpoch,e instanceof ma?t.add(e):e.children.visit(n=>nS(t,n)))}function RP(t){var n;if(Ue.globalIsReacting)throw new Error("flushChanges cannot be called during a reaction");const e=Ue.currentTransaction;try{Ue.currentTransaction=null,Ue.globalIsReacting=!0,Ue.reactionEpoch=Ue.globalEpoch;const r=new Set;for(const i of t)i.children.visit(s=>nS(r,s));for(const i of r)i.maybeScheduleEffect();let o=0;for(;(n=Ue.cleanupReactors)!=null&&n.size;){if(o++>1e3)throw new Error("Reaction update depth limit exceeded");const i=Ue.cleanupReactors;Ue.cleanupReactors=null;for(const s of i)s.maybeScheduleEffect()}}finally{Ue.cleanupReactors=null,Ue.globalIsReacting=!1,Ue.currentTransaction=e}}function dB(t,e){Ue.currentTransaction?Ue.currentTransaction.initialAtomValues.has(t)||Ue.currentTransaction.initialAtomValues.set(t,e):Ue.globalIsReacting?LP(t):RP([t])}function LP(t){const e=Ue.cleanupReactors??(Ue.cleanupReactors=new Set);t.children.visit(n=>nS(e,n))}function uB(){Ue.globalEpoch++}function hB(t){const e=new aB(Ue.currentTransaction);Ue.currentTransaction=e;try{let n,r=!1;try{n=t(()=>r=!0)}catch(o){throw e.abort(),o}return r?e.abort():e.commit(),n}finally{Ue.currentTransaction=Ue.currentTransaction.parent}}function Kr(t){return Ue.currentTransaction?t():hB(t)}class pB{constructor(e,n,r){P(this,"isEqual");P(this,"computeDiff");P(this,"lastChangedEpoch",Pn());P(this,"children",new gu);P(this,"historyBuffer");this.name=e,this.current=n,this.isEqual=(r==null?void 0:r.isEqual)??null,r&&(r.historyLength&&(this.historyBuffer=new OP(r.historyLength)),this.computeDiff=r.computeDiff)}__unsafe__getWithoutCapture(e){return this.current}get(){return mu(this),this.current}set(e,n){var o,i;if(((o=this.isEqual)==null?void 0:o.call(this,this.current,e))??AP(this.current,e))return this.current;uB(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,Pn(),n??((i=this.computeDiff)==null?void 0:i.call(this,this.current,e,this.lastChangedEpoch,Pn()))??Wn),this.lastChangedEpoch=Pn();const r=this.current;return this.current=e,dB(this,r),e}update(e){return this.set(e(this.current))}getDiffSince(e){var n;return mu(this),e>=this.lastChangedEpoch?_o:((n=this.historyBuffer)==null?void 0:n.getChangesSince(e))??Wn}}const fB=yi("Atom",()=>pB);function Tt(t,e,n){return new fB(t,e,n)}let Uw=!1;function gB(){Uw||(Uw=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const Qa=Symbol.for("com.tldraw.state/UNINITIALIZED");function Li(t){return t===Qa}const Jg=yi("WithDiff",()=>class{constructor(e,n){this.value=e,this.diff=n}});function ec(t,e){return new Jg(t,e)}class mB{constructor(e,n,r){P(this,"lastChangedEpoch",ei);P(this,"lastTraversedEpoch",ei);P(this,"lastCheckedEpoch",ei);P(this,"parentSet",new gu);P(this,"parents",[]);P(this,"parentEpochs",[]);P(this,"children",new gu);P(this,"historyBuffer");P(this,"state",Qa);P(this,"error",null);P(this,"computeDiff");P(this,"isEqual");this.name=e,this.derive=n,r!=null&&r.historyLength&&(this.historyBuffer=new OP(r.historyLength)),this.computeDiff=r==null?void 0:r.computeDiff,this.isEqual=(r==null?void 0:r.isEqual)??AP}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(e){var o;const n=this.lastChangedEpoch===ei,r=Pn();if(!n&&(this.lastCheckedEpoch===r||this.isActivelyListening&&lB()&&this.lastTraversedEpoch<cB()||!MP(this)))if(this.lastCheckedEpoch=r,this.error){if(e)return this.state;throw this.error.thrownValue}else return this.state;try{DP(this);const i=this.derive(this.state,this.lastCheckedEpoch),s=i instanceof Jg?i.value:i,a=this.state===Qa;if(a||!this.isEqual(s,this.state)){if(this.historyBuffer&&!a){const c=i instanceof Jg?i.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,Pn(),c??((o=this.computeDiff)==null?void 0:o.call(this,this.state,s,this.lastCheckedEpoch,Pn()))??Wn)}this.lastChangedEpoch=Pn(),this.state=s}return this.error=null,this.lastCheckedEpoch=Pn(),this.state}catch(i){if(this.state!==Qa&&(this.state=Qa,this.lastChangedEpoch=Pn()),this.lastCheckedEpoch=Pn(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:i},!e)throw i;return this.state}finally{$P()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{mu(this)}}getDiffSince(e){var n;return this.__unsafe__getWithoutCapture(!0),mu(this),e>=this.lastChangedEpoch?_o:((n=this.historyBuffer)==null?void 0:n.getChangesSince(e))??Wn}}const gh=yi("Computed",()=>mB);function yB(t={},e,n,r){const o=r.value,i=Symbol.for("__@tldraw/state__computed__"+n);return r.value=function(){let s=this[i];return s||(s=new gh(n,o.bind(this),t),Object.defineProperty(this,i,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()},r.value[NP]=!0,r}function SB(t={},e,n,r){const o=r.get,i=Symbol.for("__@tldraw/state__computed__"+n);return r.get=function(){let s=this[i];return s||(s=new gh(n,o.bind(this),t),Object.defineProperty(this,i,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()},r}function vB(t,e,n){He(n.kind==="method","@computed can only be used on methods");const r=Symbol.for("__@tldraw/state__computed__"+String(n.name)),o=function(){let i=this[r];return i||(i=new gh(String(n.name),e.bind(this),t),Object.defineProperty(this,r,{enumerable:!1,configurable:!1,writable:!1,value:i})),i.get()};return o[NP]=!0,o}function Hw(t={},e){if(e.length===2){const[n,r]=e;return vB(t,n,r)}else{const[n,r,o]=e;return o.get?(gB(),SB(t,n,r,o)):yB(t,n,r,o)}}const NP="@@__isComputedMethod__@@";function K(){if(arguments.length===1){const t=arguments[0];return(...e)=>Hw(t,e)}else return typeof arguments[0]=="string"?new gh(arguments[0],arguments[1],arguments[2]):Hw(void 0,arguments)}const FP=1,bB=yi("apiVersion",()=>FP);if(bB!==FP)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");fi("@tldraw/state","3.3.1","esm");var To,Qe,lf,jw,qs=0,zP=[],mt=Pe,Kw=mt.__b,Ww=mt.__r,Gw=mt.diffed,Vw=mt.__c,Yw=mt.unmount,Xw=mt.__;function is(t,e){mt.__h&&mt.__h(Qe,t,qs||e),qs=0;var n=Qe.__H||(Qe.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function Q(t){return qs=1,Vc(BP,t)}function Vc(t,e,n){var r=is(To++,2);if(r.t=t,!r.__c&&(r.__=[n?n(e):BP(void 0,e),function(a){var c=r.__N?r.__N[0]:r.__[0],l=r.t(c,a);c!==l&&(r.__N=[l,r.__[1]],r.__c.setState({}))}],r.__c=Qe,!Qe.u)){var o=function(a,c,l){if(!r.__c.__H)return!0;var d=r.__c.__H.__.filter(function(p){return!!p.__c});if(d.every(function(p){return!p.__N}))return!i||i.call(this,a,c,l);var h=!1;return d.forEach(function(p){if(p.__N){var f=p.__[0];p.__=p.__N,p.__N=void 0,f!==p.__[0]&&(h=!0)}}),!(!h&&r.__c.props===a)&&(!i||i.call(this,a,c,l))};Qe.u=!0;var i=Qe.shouldComponentUpdate,s=Qe.componentWillUpdate;Qe.componentWillUpdate=function(a,c,l){if(this.__e){var d=i;i=void 0,o(a,c,l),i=d}s&&s.call(this,a,c,l)},Qe.shouldComponentUpdate=o}return r.__N||r.__}function q(t,e){var n=is(To++,3);!mt.__s&&rS(n.__H,e)&&(n.__=t,n.i=e,Qe.__H.__h.push(n))}function je(t,e){var n=is(To++,4);!mt.__s&&rS(n.__H,e)&&(n.__=t,n.i=e,Qe.__h.push(n))}function B(t){return qs=5,ce(function(){return{current:t}},[])}function mh(t,e,n){qs=6,je(function(){return typeof t=="function"?(t(e()),function(){return t(null)}):t?(t.current=e(),function(){return t.current=null}):void 0},n==null?n:n.concat(t))}function ce(t,e){var n=is(To++,7);return rS(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function V(t,e){return qs=8,ce(function(){return t},e)}function tt(t){var e=Qe.context[t.__c],n=is(To++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(Qe)),e.props.value):t.__}function yh(t,e){mt.useDebugValue&&mt.useDebugValue(e?e(t):t)}function wB(t){var e=is(To++,10),n=Q();return e.__=t,Qe.componentDidCatch||(Qe.componentDidCatch=function(r,o){e.__&&e.__(r,o),n[1](r)}),[n[0],function(){n[1](void 0)}]}function Sh(){var t=is(To++,11);if(!t.__){for(var e=Qe.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function _B(){for(var t;t=zP.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(bd),t.__H.__h.forEach(Qg),t.__H.__h=[]}catch(e){t.__H.__h=[],mt.__e(e,t.__v)}}mt.__b=function(t){Qe=null,Kw&&Kw(t)},mt.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Xw&&Xw(t,e)},mt.__r=function(t){Ww&&Ww(t),To=0;var e=(Qe=t.__c).__H;e&&(lf===Qe?(e.__h=[],Qe.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.i=n.__N=void 0})):(e.__h.forEach(bd),e.__h.forEach(Qg),e.__h=[],To=0)),lf=Qe},mt.diffed=function(t){Gw&&Gw(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(zP.push(e)!==1&&jw===mt.requestAnimationFrame||((jw=mt.requestAnimationFrame)||xB)(_B)),e.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.i=void 0})),lf=Qe=null},mt.__c=function(t,e){e.some(function(n){try{n.__h.forEach(bd),n.__h=n.__h.filter(function(r){return!r.__||Qg(r)})}catch(r){e.some(function(o){o.__h&&(o.__h=[])}),e=[],mt.__e(r,n.__v)}}),Vw&&Vw(t,e)},mt.unmount=function(t){Yw&&Yw(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{bd(r)}catch(o){e=o}}),n.__H=void 0,e&&mt.__e(e,n.__v))};var qw=typeof requestAnimationFrame=="function";function xB(t){var e,n=function(){clearTimeout(r),qw&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,100);qw&&(e=requestAnimationFrame(n))}function bd(t){var e=Qe,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),Qe=e}function Qg(t){var e=Qe;t.__c=t.__(),Qe=e}function rS(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function BP(t,e){return typeof e=="function"?e(t):e}function em(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var r in e)if(r!=="__source"&&t[r]!==e[r])return!0;return!1}function yu(t,e){this.props=t,this.context=e}function $e(t,e){function n(o){var i=this.props.ref,s=i==o.ref;return!s&&i&&(i.call?i(null):i.current=null),e?!e(this.props,o)||!s:em(this.props,o)}function r(o){return this.shouldComponentUpdate=n,kt(t,o)}return r.displayName="Memo("+(t.displayName||t.name)+")",r.prototype.isReactComponent=!0,r.__f=!0,r}(yu.prototype=new ar).isPureReactComponent=!0,yu.prototype.shouldComponentUpdate=function(t,e){return em(this.props,t)||em(this.state,e)};var Zw=Pe.__b;Pe.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),Zw&&Zw(t)};var PB=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function X(t){function e(n){if(!("ref"in n))return t(n,null);var r=n.ref;delete n.ref;var o=t(n,r);return n.ref=r,o}return e.$$typeof=PB,e.render=e,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var Jw=function(t,e){return t==null?null:bo(bo(t).map(e))},Wr={map:Jw,forEach:Jw,count:function(t){return t?bo(t).length:0},only:function(t){var e=bo(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:bo},IB=Pe.__e;Pe.__e=function(t,e,n,r){if(t.then){for(var o,i=e;i=i.__;)if((o=i.__c)&&o.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),o.__c(t,e)}IB(t,e,n,r)};var Qw=Pe.unmount;function UP(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),t.__c.__H=null),(t=function(r,o){for(var i in o)r[i]=o[i];return r}({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c=null),t.__k=t.__k&&t.__k.map(function(r){return UP(r,e,n)})),t}function HP(t,e,n){return t&&n&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(r){return HP(r,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=n)),t}function uc(){this.__u=0,this.t=null,this.__b=null}function jP(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function KP(t){var e,n,r;function o(i){if(e||(e=t()).then(function(s){n=s.default||s},function(s){r=s}),r)throw r;if(!n)throw e;return kt(n,i)}return o.displayName="Lazy",o.__f=!0,o}function As(){this.u=null,this.o=null}Pe.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),Qw&&Qw(t)},(uc.prototype=new ar).__c=function(t,e){var n=e.__c,r=this;r.t==null&&(r.t=[]),r.t.push(n);var o=jP(r.__v),i=!1,s=function(){i||(i=!0,n.__R=null,o?o(a):a())};n.__R=s;var a=function(){if(!--r.__u){if(r.state.__a){var c=r.state.__a;r.__v.__k[0]=HP(c,c.__c.__P,c.__c.__O)}var l;for(r.setState({__a:r.__b=null});l=r.t.pop();)l.forceUpdate()}};r.__u++||32&e.__u||r.setState({__a:r.__b=r.__v.__k[0]}),t.then(s,s)},uc.prototype.componentWillUnmount=function(){this.t=[]},uc.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=UP(this.__b,n,r.__O=r.__P)}this.__b=null}var o=e.__a&&kt(Z,null,t.fallback);return o&&(o.__u&=-33),[kt(Z,null,e.__a?null:t.children),o]};var e0=function(t,e,n){if(++n[1]===n[0]&&t.o.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.o.size))for(n=t.u;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.u=n=n[2]}};function CB(t){return this.getChildContext=function(){return t.context},t.children}function EB(t){var e=this,n=t.i;e.componentWillUnmount=function(){Vs(null,e.l),e.l=null,e.i=null},e.i&&e.i!==n&&e.componentWillUnmount(),e.l||(e.i=n,e.l={nodeType:1,parentNode:n,childNodes:[],contains:function(){return!0},appendChild:function(r){this.childNodes.push(r),e.i.appendChild(r)},insertBefore:function(r,o){this.childNodes.push(r),e.i.appendChild(r)},removeChild:function(r){this.childNodes.splice(this.childNodes.indexOf(r)>>>1,1),e.i.removeChild(r)}}),Vs(kt(CB,{context:e.context},t.__v),e.l)}function oS(t,e){var n=kt(EB,{__v:t,i:e});return n.containerInfo=e,n}(As.prototype=new ar).__a=function(t){var e=this,n=jP(e.__v),r=e.o.get(t);return r[0]++,function(o){var i=function(){e.props.revealOrder?(r.push(o),e0(e,t,r)):o()};n?n(i):i()}},As.prototype.render=function(t){this.u=null,this.o=new Map;var e=bo(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.o.set(e[n],this.u=[1,0,this.u]);return t.children},As.prototype.componentDidUpdate=As.prototype.componentDidMount=function(){var t=this;this.o.forEach(function(e,n){e0(t,n,e)})};var WP=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,TB=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,kB=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,MB=/[A-Z0-9]/g,AB=typeof document<"u",OB=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function iS(t,e,n){return e.__k==null&&(e.textContent=""),Vs(t,e),typeof n=="function"&&n(),t?t.__c:null}function GP(t,e,n){return rx(t,e),typeof n=="function"&&n(),t?t.__c:null}ar.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(ar.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var t0=Pe.event;function DB(){}function $B(){return this.cancelBubble}function RB(){return this.defaultPrevented}Pe.event=function(t){return t0&&(t=t0(t)),t.persist=DB,t.isPropagationStopped=$B,t.isDefaultPrevented=RB,t.nativeEvent=t};var sS,LB={enumerable:!1,configurable:!0,get:function(){return this.class}},n0=Pe.vnode;Pe.vnode=function(t){typeof t.type=="string"&&function(e){var n=e.props,r=e.type,o={},i=r.indexOf("-")===-1;for(var s in n){var a=n[s];if(!(s==="value"&&"defaultValue"in n&&a==null||AB&&s==="children"&&r==="noscript"||s==="class"||s==="className")){var c=s.toLowerCase();s==="defaultValue"&&"value"in n&&n.value==null?s="value":s==="download"&&a===!0?a="":c==="translate"&&a==="no"?a=!1:c[0]==="o"&&c[1]==="n"?c==="ondoubleclick"?s="ondblclick":c!=="onchange"||r!=="input"&&r!=="textarea"||OB(n.type)?c==="onfocus"?s="onfocusin":c==="onblur"?s="onfocusout":kB.test(s)&&(s=c):c=s="oninput":i&&TB.test(s)?s=s.replace(MB,"-$&").toLowerCase():a===null&&(a=void 0),c==="oninput"&&o[s=c]&&(s="oninputCapture"),o[s]=a}}r=="select"&&o.multiple&&Array.isArray(o.value)&&(o.value=bo(n.children).forEach(function(l){l.props.selected=o.value.indexOf(l.props.value)!=-1})),r=="select"&&o.defaultValue!=null&&(o.value=bo(n.children).forEach(function(l){l.props.selected=o.multiple?o.defaultValue.indexOf(l.props.value)!=-1:o.defaultValue==l.props.value})),n.class&&!n.className?(o.class=n.class,Object.defineProperty(o,"className",LB)):(n.className&&!n.class||n.class&&n.className)&&(o.class=o.className=n.className),e.props=o}(t),t.$$typeof=WP,n0&&n0(t)};var r0=Pe.__r;Pe.__r=function(t){r0&&r0(t),sS=t.__c};var o0=Pe.diffed;Pe.diffed=function(t){o0&&o0(t);var e=t.props,n=t.__e;n!=null&&t.type==="textarea"&&"value"in e&&e.value!==n.value&&(n.value=e.value==null?"":e.value),sS=null};var VP={ReactCurrentDispatcher:{current:{readContext:function(t){return sS.__n[t.__c].props.value},useCallback:V,useContext:tt,useDebugValue:yh,useDeferredValue:lS,useEffect:q,useId:Sh,useImperativeHandle:mh,useInsertionEffect:uS,useLayoutEffect:je,useMemo:ce,useReducer:Vc,useRef:B,useState:Q,useSyncExternalStore:Yc,useTransition:dS}}},NB="18.3.1";function YP(t){return kt.bind(null,t)}function ko(t){return!!t&&t.$$typeof===WP}function XP(t){return ko(t)&&t.type===Z}function qP(t){return!!t&&!!t.displayName&&(typeof t.displayName=="string"||t.displayName instanceof String)&&t.displayName.startsWith("Memo(")}function ya(t){return ko(t)?s3.apply(null,arguments):t}function aS(t){return!!t.__k&&(Vs(null,t),!0)}function ZP(t){return t&&(t.base||t.nodeType===1&&t)||null}var JP=function(t,e){return t(e)},Hi=function(t,e){return t(e)},QP=Z;function cS(t){t()}function lS(t){return t}function dS(){return[!1,cS]}var uS=je,eI=ko;function Yc(t,e){var n=e(),r=Q({h:{__:n,v:e}}),o=r[0].h,i=r[1];return je(function(){o.__=n,o.v=e,df(o)&&i({h:o})},[t,n,e]),q(function(){return df(o)&&i({h:o}),t(function(){df(o)&&i({h:o})})},[t]),n}function df(t){var e,n,r=t.v,o=t.__;try{var i=r();return!((e=o)===(n=i)&&(e!==0||1/e==1/n)||e!=e&&n!=n)}catch{return!0}}var we={useState:Q,useId:Sh,useReducer:Vc,useEffect:q,useLayoutEffect:je,useInsertionEffect:uS,useTransition:dS,useDeferredValue:lS,useSyncExternalStore:Yc,startTransition:cS,useRef:B,useImperativeHandle:mh,useMemo:ce,useCallback:V,useContext:tt,useDebugValue:yh,version:"18.3.1",Children:Wr,render:iS,hydrate:GP,unmountComponentAtNode:aS,createPortal:oS,createElement:kt,createContext:Ze,createFactory:YP,cloneElement:ya,createRef:Z_,Fragment:Z,isValidElement:ko,isElement:eI,isFragment:XP,isMemo:qP,findDOMNode:ZP,Component:ar,PureComponent:yu,memo:$e,forwardRef:X,flushSync:Hi,unstable_batchedUpdates:JP,StrictMode:QP,Suspense:uc,SuspenseList:As,lazy:KP,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:VP};const FB=Object.freeze(Object.defineProperty({__proto__:null,Children:Wr,Component:ar,Fragment:Z,PureComponent:yu,StrictMode:QP,Suspense:uc,SuspenseList:As,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:VP,cloneElement:ya,createContext:Ze,createElement:kt,createFactory:YP,createPortal:oS,createRef:Z_,default:we,findDOMNode:ZP,flushSync:Hi,forwardRef:X,hydrate:GP,isElement:eI,isFragment:XP,isMemo:qP,isValidElement:ko,lazy:KP,memo:$e,render:iS,startTransition:cS,unmountComponentAtNode:aS,unstable_batchedUpdates:JP,useCallback:V,useContext:tt,useDebugValue:yh,useDeferredValue:lS,useEffect:q,useErrorBoundary:wB,useId:Sh,useImperativeHandle:mh,useInsertionEffect:uS,useLayoutEffect:je,useMemo:ce,useReducer:Vc,useRef:B,useState:Q,useSyncExternalStore:Yc,useTransition:dS,version:NB},Symbol.toStringTag,{value:"Module"}));function vh(t,e){const n=we.useRef(e);n.current=e;const[r,o,i]=we.useMemo(()=>{let s=null;const a=d=>(s=d,()=>{s=null}),c=new ma(`useStateTracking(${t})`,()=>{var d;return(d=n.current)==null?void 0:d.call(n)},{scheduleEffect(){s==null||s()}});return[c,a,()=>c.scheduleCount]},[t]);return we.useSyncExternalStore(o,i,i),we.useEffect(()=>(r.attach(),r.maybeScheduleEffect(),()=>{r.detach()}),[r]),r.execute()}const i0={apply(t,e,n){return vh(t.displayName??t.name??"tracked(???)",()=>t.apply(e,n))}},zB=Symbol.for("react.memo"),BB=Symbol.for("react.forward_ref");function Nt(t){let e=null;const n=t.$$typeof;return n===zB&&(t=t.type,e=t.compare),n===BB?$e(X(new Proxy(t.render,i0))):$e(new Proxy(t,i0),e)}function tI(t,e,n){return Q(()=>{const r=typeof e=="function"?e():e;return Tt(`useAtom(${t})`,r,n)})[0]}function UB(){const t=arguments[0],e=arguments[1],n=arguments.length===3?void 0:arguments[2],r=arguments.length===3?arguments[2]:arguments[3];return ce(()=>K(`useComputed(${t})`,e,n),r)}function ri(t,e,n=_o){q(()=>{const r=new ma(t,e);return r.attach(),r.execute(),()=>{r.detach()}},n)}function U(){const t=arguments,e=t.length===3?t[2]:[t[0]],n=t.length===3?t[0]:`useValue(${t[0].name})`,r=B(!0);r.current=!0;const o=ce(()=>t.length===1?t[0]:K(n,()=>{if(r.current)return t[1]();try{return t[1]()}catch{return{}}}),e);try{const{subscribe:i,getSnapshot:s}=ce(()=>({subscribe:a=>xo(`useValue(${n})`,()=>{o.get(),a()}),getSnapshot:()=>o.get()}),[o]);return Yc(i,s,s)}finally{r.current=!1}}fi("@tldraw/state-react","3.3.1","esm");class wd{constructor(e){P(this,"nextValue");P(this,"diff");this.previousValue=e}get(){var r,o,i,s;const e=((o=(r=this.diff)==null?void 0:r.removed)==null?void 0:o.size)??0,n=((s=(i=this.diff)==null?void 0:i.added)==null?void 0:s.size)??0;if(!(e===0&&n===0))return{value:this.nextValue,diff:this.diff}}_add(e,n){var r,o;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),this.diff??(this.diff={}),n?(r=this.diff.removed)==null||r.delete(e):((o=this.diff).added??(o.added=new Set),this.diff.added.add(e))}add(e){var o,i,s;const n=this.previousValue.has(e);if(n)return((i=(o=this.diff)==null?void 0:o.removed)==null?void 0:i.has(e))?this._add(e,n):void 0;(s=this.nextValue)!=null&&s.has(e)||this._add(e,n)}_remove(e,n){var r,o;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),this.diff??(this.diff={}),n?((r=this.diff).removed??(r.removed=new Set),this.diff.removed.add(e)):(o=this.diff.added)==null||o.delete(e)}remove(e){var o,i,s,a;const n=this.previousValue.has(e);if(!n)return((i=(o=this.diff)==null?void 0:o.added)==null?void 0:i.has(e))?this._remove(e,n):void 0;(a=(s=this.diff)==null?void 0:s.removed)!=null&&a.has(e)||this._remove(e,n)}}class bh{constructor(e,n){P(this,"createDefaultProperties");P(this,"validator");P(this,"ephemeralKeys");P(this,"ephemeralKeySet");P(this,"scope");this.typeName=e,this.createDefaultProperties=n.createDefaultProperties,this.validator=n.validator??{validate:o=>o},this.scope=n.scope??"document",this.ephemeralKeys=n.ephemeralKeys;const r=new Set;if(n.ephemeralKeys)for(const[o,i]of Dn(n.ephemeralKeys))i&&r.add(o);this.ephemeralKeySet=r}create(e){const n={...this.createDefaultProperties(),id:this.createId()};for(const[r,o]of Object.entries(e))o!==void 0&&(n[r]=o);return n.typeName=this.typeName,n}clone(e){return{...ut(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??Ye())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance(e){return(e==null?void 0:e.typeName)===this.typeName}isId(e){if(!e)return!1;for(let n=0;n<this.typeName.length;n++)if(e[n]!==this.typeName[n])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new bh(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,n){return n&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(n,e):this.validator.validate(e)}}function Qr(t,e){return new bh(t,{createDefaultProperties:()=>({}),validator:e.validator,scope:e.scope,ephemeralKeys:e.ephemeralKeys})}function Su(){return{added:{},updated:{},removed:{}}}function tm(t){const e={added:t.removed,removed:t.added,updated:{}};for(const[n,r]of Object.values(t.updated))e.updated[n.id]=[r,n];return e}function nI(t){return Object.keys(t.added).length===0&&Object.keys(t.updated).length===0&&Object.keys(t.removed).length===0}function hS(t){const e={added:{},removed:{},updated:{}};return hc(e,t),e}function hc(t,e){for(const n of e){for(const[r,o]of Dn(n.added))if(t.removed[r]){const i=t.removed[r];delete t.removed[r],i!==o&&(t.updated[r]=[i,o])}else t.added[r]=o;for(const[r,[o,i]]of Dn(n.updated)){if(t.added[r]){t.added[r]=i,delete t.updated[r],delete t.removed[r];continue}if(t.updated[r]){t.updated[r]=[t.updated[r][0],i],delete t.removed[r];continue}t.updated[r]=n.updated[r],delete t.removed[r]}for(const[r,o]of Dn(n.removed))t.added[r]?delete t.added[r]:t.updated[r]?(t.removed[r]=t.updated[r][0],delete t.updated[r]):t.removed[r]=o}}var vu={exports:{}};vu.exports;(function(t,e){var n=200,r="__lodash_hash_undefined__",o=1,i=2,s=9007199254740991,a="[object Arguments]",c="[object Array]",l="[object AsyncFunction]",d="[object Boolean]",h="[object Date]",p="[object Error]",f="[object Function]",g="[object GeneratorFunction]",m="[object Map]",y="[object Number]",S="[object Null]",v="[object Object]",_="[object Promise]",w="[object Proxy]",x="[object RegExp]",C="[object Set]",E="[object String]",I="[object Symbol]",T="[object Undefined]",k="[object WeakMap]",D="[object ArrayBuffer]",A="[object DataView]",O="[object Float32Array]",$="[object Float64Array]",z="[object Int8Array]",R="[object Int16Array]",W="[object Int32Array]",j="[object Uint8Array]",G="[object Uint8ClampedArray]",le="[object Uint16Array]",he="[object Uint32Array]",ve=/[\\^$.*+?()[\]{}|]/g,me=/^\[object .+?Constructor\]$/,Be=/^(?:0|[1-9]\d*)$/,ie={};ie[O]=ie[$]=ie[z]=ie[R]=ie[W]=ie[j]=ie[G]=ie[le]=ie[he]=!0,ie[a]=ie[c]=ie[D]=ie[d]=ie[A]=ie[h]=ie[p]=ie[f]=ie[m]=ie[y]=ie[v]=ie[x]=ie[C]=ie[E]=ie[k]=!1;var at=typeof on=="object"&&on&&on.Object===Object&&on,Ke=typeof self=="object"&&self&&self.Object===Object&&self,We=at||Ke||Function("return this")(),Ee=e&&!e.nodeType&&e,Je=Ee&&!0&&t&&!t.nodeType&&t,Ne=Je&&Je.exports===Ee,vt=Ne&&at.process,Ft=function(){try{return vt&&vt.binding&&vt.binding("util")}catch{}}(),bn=Ft&&Ft.isTypedArray;function _t(M,L){for(var Y=-1,oe=M==null?0:M.length,ct=0,_e=[];++Y<oe;){var bt=M[Y];L(bt,Y,M)&&(_e[ct++]=bt)}return _e}function qt(M,L){for(var Y=-1,oe=L.length,ct=M.length;++Y<oe;)M[ct+Y]=L[Y];return M}function oo(M,L){for(var Y=-1,oe=M==null?0:M.length;++Y<oe;)if(L(M[Y],Y,M))return!0;return!1}function Ta(M,L){for(var Y=-1,oe=Array(M);++Y<M;)oe[Y]=L(Y);return oe}function Bo(M){return function(L){return M(L)}}function Y$(M,L){return M.has(L)}function X$(M,L){return M==null?void 0:M[L]}function q$(M){var L=-1,Y=Array(M.size);return M.forEach(function(oe,ct){Y[++L]=[ct,oe]}),Y}function Z$(M,L){return function(Y){return M(L(Y))}}function J$(M){var L=-1,Y=Array(M.size);return M.forEach(function(oe){Y[++L]=oe}),Y}var Q$=Array.prototype,eR=Function.prototype,Sl=Object.prototype,Ip=We["__core-js_shared__"],ub=eR.toString,Dr=Sl.hasOwnProperty,hb=function(){var M=/[^.]+$/.exec(Ip&&Ip.keys&&Ip.keys.IE_PROTO||"");return M?"Symbol(src)_1."+M:""}(),pb=Sl.toString,tR=RegExp("^"+ub.call(Dr).replace(ve,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),fb=Ne?We.Buffer:void 0,vl=We.Symbol,gb=We.Uint8Array,mb=Sl.propertyIsEnumerable,nR=Q$.splice,Pi=vl?vl.toStringTag:void 0,yb=Object.getOwnPropertySymbols,rR=fb?fb.isBuffer:void 0,oR=Z$(Object.keys,Object),Cp=us(We,"DataView"),ka=us(We,"Map"),Ep=us(We,"Promise"),Tp=us(We,"Set"),kp=us(We,"WeakMap"),Ma=us(Object,"create"),iR=Ei(Cp),sR=Ei(ka),aR=Ei(Ep),cR=Ei(Tp),lR=Ei(kp),Sb=vl?vl.prototype:void 0,Mp=Sb?Sb.valueOf:void 0;function Ii(M){var L=-1,Y=M==null?0:M.length;for(this.clear();++L<Y;){var oe=M[L];this.set(oe[0],oe[1])}}function dR(){this.__data__=Ma?Ma(null):{},this.size=0}function uR(M){var L=this.has(M)&&delete this.__data__[M];return this.size-=L?1:0,L}function hR(M){var L=this.__data__;if(Ma){var Y=L[M];return Y===r?void 0:Y}return Dr.call(L,M)?L[M]:void 0}function pR(M){var L=this.__data__;return Ma?L[M]!==void 0:Dr.call(L,M)}function fR(M,L){var Y=this.__data__;return this.size+=this.has(M)?0:1,Y[M]=Ma&&L===void 0?r:L,this}Ii.prototype.clear=dR,Ii.prototype.delete=uR,Ii.prototype.get=hR,Ii.prototype.has=pR,Ii.prototype.set=fR;function io(M){var L=-1,Y=M==null?0:M.length;for(this.clear();++L<Y;){var oe=M[L];this.set(oe[0],oe[1])}}function gR(){this.__data__=[],this.size=0}function mR(M){var L=this.__data__,Y=wl(L,M);if(Y<0)return!1;var oe=L.length-1;return Y==oe?L.pop():nR.call(L,Y,1),--this.size,!0}function yR(M){var L=this.__data__,Y=wl(L,M);return Y<0?void 0:L[Y][1]}function SR(M){return wl(this.__data__,M)>-1}function vR(M,L){var Y=this.__data__,oe=wl(Y,M);return oe<0?(++this.size,Y.push([M,L])):Y[oe][1]=L,this}io.prototype.clear=gR,io.prototype.delete=mR,io.prototype.get=yR,io.prototype.has=SR,io.prototype.set=vR;function Ci(M){var L=-1,Y=M==null?0:M.length;for(this.clear();++L<Y;){var oe=M[L];this.set(oe[0],oe[1])}}function bR(){this.size=0,this.__data__={hash:new Ii,map:new(ka||io),string:new Ii}}function wR(M){var L=_l(this,M).delete(M);return this.size-=L?1:0,L}function _R(M){return _l(this,M).get(M)}function xR(M){return _l(this,M).has(M)}function PR(M,L){var Y=_l(this,M),oe=Y.size;return Y.set(M,L),this.size+=Y.size==oe?0:1,this}Ci.prototype.clear=bR,Ci.prototype.delete=wR,Ci.prototype.get=_R,Ci.prototype.has=xR,Ci.prototype.set=PR;function bl(M){var L=-1,Y=M==null?0:M.length;for(this.__data__=new Ci;++L<Y;)this.add(M[L])}function IR(M){return this.__data__.set(M,r),this}function CR(M){return this.__data__.has(M)}bl.prototype.add=bl.prototype.push=IR,bl.prototype.has=CR;function Uo(M){var L=this.__data__=new io(M);this.size=L.size}function ER(){this.__data__=new io,this.size=0}function TR(M){var L=this.__data__,Y=L.delete(M);return this.size=L.size,Y}function kR(M){return this.__data__.get(M)}function MR(M){return this.__data__.has(M)}function AR(M,L){var Y=this.__data__;if(Y instanceof io){var oe=Y.__data__;if(!ka||oe.length<n-1)return oe.push([M,L]),this.size=++Y.size,this;Y=this.__data__=new Ci(oe)}return Y.set(M,L),this.size=Y.size,this}Uo.prototype.clear=ER,Uo.prototype.delete=TR,Uo.prototype.get=kR,Uo.prototype.has=MR,Uo.prototype.set=AR;function OR(M,L){var Y=xl(M),oe=!Y&&VR(M),ct=!Y&&!oe&&Ap(M),_e=!Y&&!oe&&!ct&&Eb(M),bt=Y||oe||ct||_e,Ot=bt?Ta(M.length,String):[],zt=Ot.length;for(var ft in M)Dr.call(M,ft)&&!(bt&&(ft=="length"||ct&&(ft=="offset"||ft=="parent")||_e&&(ft=="buffer"||ft=="byteLength"||ft=="byteOffset")||HR(ft,zt)))&&Ot.push(ft);return Ot}function wl(M,L){for(var Y=M.length;Y--;)if(xb(M[Y][0],L))return Y;return-1}function DR(M,L,Y){var oe=L(M);return xl(M)?oe:qt(oe,Y(M))}function Aa(M){return M==null?M===void 0?T:S:Pi&&Pi in Object(M)?BR(M):GR(M)}function vb(M){return Oa(M)&&Aa(M)==a}function bb(M,L,Y,oe,ct){return M===L?!0:M==null||L==null||!Oa(M)&&!Oa(L)?M!==M&&L!==L:$R(M,L,Y,oe,bb,ct)}function $R(M,L,Y,oe,ct,_e){var bt=xl(M),Ot=xl(L),zt=bt?c:Ho(M),ft=Ot?c:Ho(L);zt=zt==a?v:zt,ft=ft==a?v:ft;var Fn=zt==v,fr=ft==v,Zt=zt==ft;if(Zt&&Ap(M)){if(!Ap(L))return!1;bt=!0,Fn=!1}if(Zt&&!Fn)return _e||(_e=new Uo),bt||Eb(M)?wb(M,L,Y,oe,ct,_e):FR(M,L,zt,Y,oe,ct,_e);if(!(Y&o)){var er=Fn&&Dr.call(M,"__wrapped__"),tr=fr&&Dr.call(L,"__wrapped__");if(er||tr){var jo=er?M.value():M,so=tr?L.value():L;return _e||(_e=new Uo),ct(jo,so,Y,oe,_e)}}return Zt?(_e||(_e=new Uo),zR(M,L,Y,oe,ct,_e)):!1}function RR(M){if(!Cb(M)||KR(M))return!1;var L=Pb(M)?tR:me;return L.test(Ei(M))}function LR(M){return Oa(M)&&Ib(M.length)&&!!ie[Aa(M)]}function NR(M){if(!WR(M))return oR(M);var L=[];for(var Y in Object(M))Dr.call(M,Y)&&Y!="constructor"&&L.push(Y);return L}function wb(M,L,Y,oe,ct,_e){var bt=Y&o,Ot=M.length,zt=L.length;if(Ot!=zt&&!(bt&&zt>Ot))return!1;var ft=_e.get(M);if(ft&&_e.get(L))return ft==L;var Fn=-1,fr=!0,Zt=Y&i?new bl:void 0;for(_e.set(M,L),_e.set(L,M);++Fn<Ot;){var er=M[Fn],tr=L[Fn];if(oe)var jo=bt?oe(tr,er,Fn,L,M,_e):oe(er,tr,Fn,M,L,_e);if(jo!==void 0){if(jo)continue;fr=!1;break}if(Zt){if(!oo(L,function(so,Ti){if(!Y$(Zt,Ti)&&(er===so||ct(er,so,Y,oe,_e)))return Zt.push(Ti)})){fr=!1;break}}else if(!(er===tr||ct(er,tr,Y,oe,_e))){fr=!1;break}}return _e.delete(M),_e.delete(L),fr}function FR(M,L,Y,oe,ct,_e,bt){switch(Y){case A:if(M.byteLength!=L.byteLength||M.byteOffset!=L.byteOffset)return!1;M=M.buffer,L=L.buffer;case D:return!(M.byteLength!=L.byteLength||!_e(new gb(M),new gb(L)));case d:case h:case y:return xb(+M,+L);case p:return M.name==L.name&&M.message==L.message;case x:case E:return M==L+"";case m:var Ot=q$;case C:var zt=oe&o;if(Ot||(Ot=J$),M.size!=L.size&&!zt)return!1;var ft=bt.get(M);if(ft)return ft==L;oe|=i,bt.set(M,L);var Fn=wb(Ot(M),Ot(L),oe,ct,_e,bt);return bt.delete(M),Fn;case I:if(Mp)return Mp.call(M)==Mp.call(L)}return!1}function zR(M,L,Y,oe,ct,_e){var bt=Y&o,Ot=_b(M),zt=Ot.length,ft=_b(L),Fn=ft.length;if(zt!=Fn&&!bt)return!1;for(var fr=zt;fr--;){var Zt=Ot[fr];if(!(bt?Zt in L:Dr.call(L,Zt)))return!1}var er=_e.get(M);if(er&&_e.get(L))return er==L;var tr=!0;_e.set(M,L),_e.set(L,M);for(var jo=bt;++fr<zt;){Zt=Ot[fr];var so=M[Zt],Ti=L[Zt];if(oe)var Tb=bt?oe(Ti,so,Zt,L,M,_e):oe(so,Ti,Zt,M,L,_e);if(!(Tb===void 0?so===Ti||ct(so,Ti,Y,oe,_e):Tb)){tr=!1;break}jo||(jo=Zt=="constructor")}if(tr&&!jo){var Pl=M.constructor,Il=L.constructor;Pl!=Il&&"constructor"in M&&"constructor"in L&&!(typeof Pl=="function"&&Pl instanceof Pl&&typeof Il=="function"&&Il instanceof Il)&&(tr=!1)}return _e.delete(M),_e.delete(L),tr}function _b(M){return DR(M,qR,UR)}function _l(M,L){var Y=M.__data__;return jR(L)?Y[typeof L=="string"?"string":"hash"]:Y.map}function us(M,L){var Y=X$(M,L);return RR(Y)?Y:void 0}function BR(M){var L=Dr.call(M,Pi),Y=M[Pi];try{M[Pi]=void 0;var oe=!0}catch{}var ct=pb.call(M);return oe&&(L?M[Pi]=Y:delete M[Pi]),ct}var UR=yb?function(M){return M==null?[]:(M=Object(M),_t(yb(M),function(L){return mb.call(M,L)}))}:ZR,Ho=Aa;(Cp&&Ho(new Cp(new ArrayBuffer(1)))!=A||ka&&Ho(new ka)!=m||Ep&&Ho(Ep.resolve())!=_||Tp&&Ho(new Tp)!=C||kp&&Ho(new kp)!=k)&&(Ho=function(M){var L=Aa(M),Y=L==v?M.constructor:void 0,oe=Y?Ei(Y):"";if(oe)switch(oe){case iR:return A;case sR:return m;case aR:return _;case cR:return C;case lR:return k}return L});function HR(M,L){return L=L??s,!!L&&(typeof M=="number"||Be.test(M))&&M>-1&&M%1==0&&M<L}function jR(M){var L=typeof M;return L=="string"||L=="number"||L=="symbol"||L=="boolean"?M!=="__proto__":M===null}function KR(M){return!!hb&&hb in M}function WR(M){var L=M&&M.constructor,Y=typeof L=="function"&&L.prototype||Sl;return M===Y}function GR(M){return pb.call(M)}function Ei(M){if(M!=null){try{return ub.call(M)}catch{}try{return M+""}catch{}}return""}function xb(M,L){return M===L||M!==M&&L!==L}var VR=vb(function(){return arguments}())?vb:function(M){return Oa(M)&&Dr.call(M,"callee")&&!mb.call(M,"callee")},xl=Array.isArray;function YR(M){return M!=null&&Ib(M.length)&&!Pb(M)}var Ap=rR||JR;function XR(M,L){return bb(M,L)}function Pb(M){if(!Cb(M))return!1;var L=Aa(M);return L==f||L==g||L==l||L==w}function Ib(M){return typeof M=="number"&&M>-1&&M%1==0&&M<=s}function Cb(M){var L=typeof M;return M!=null&&(L=="object"||L=="function")}function Oa(M){return M!=null&&typeof M=="object"}var Eb=bn?Bo(bn):LR;function qR(M){return YR(M)?OR(M):NR(M)}function ZR(){return[]}function JR(){return!1}t.exports=XR})(vu,vu.exports);var HB=vu.exports;const jB=ts(HB);function KB(t){if(t.length===0)return new Set;const e=t[0],n=t.slice(1),r=new Set;for(const o of e)n.every(i=>i.has(o))&&r.add(o);return r}function WB(t,e){const n={};for(const r of e)t.has(r)||(n.added??(n.added=new Set),n.added.add(r));for(const r of t)e.has(r)||(n.removed??(n.removed=new Set),n.removed.add(r));return n.added||n.removed?n:void 0}function s0(t,e){for(const[n,r]of Object.entries(t)){const o=r,i=e[n];if("eq"in o&&i!==o.eq||"neq"in o&&i===o.neq||"gt"in o&&(typeof i!="number"||i<=o.gt))return!1}return!0}function a0(t,e,n){const r=Object.fromEntries(Object.keys(n).map(o=>[o,new Set]));for(const[o,i]of Object.entries(n))if("eq"in i){const a=t.index(e,o).get().get(i.eq);if(a)for(const c of a)r[o].add(c)}else if("neq"in i){const s=t.index(e,o);for(const[a,c]of s.get())if(a!==i.neq)for(const l of c)r[o].add(l)}else if("gt"in i){const s=t.index(e,o);for(const[a,c]of s.get())if(a>i.gt)for(const l of c)r[o].add(l)}return KB(Object.values(r))}class GB{constructor(e,n){P(this,"indexCache",new Map);P(this,"historyCache",new Map);this.atoms=e,this.history=n}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const n=K("filterHistory:"+e,(r,o)=>{if(Li(r))return this.history.get();const i=this.history.getDiffSince(o);if(i===Wn)return this.history.get();const s={added:{},removed:{},updated:{}};let a=0,c=0,l=0;for(const d of i){for(const h of gt(d.added))if(h.typeName===e)if(s.removed[h.id]){const p=s.removed[h.id];delete s.removed[h.id],c--,p!==h&&(s.updated[h.id]=[p,h],l++)}else s.added[h.id]=h,a++;for(const[h,p]of gt(d.updated))p.typeName===e&&(s.added[p.id]?s.added[p.id]=p:s.updated[p.id]?s.updated[p.id]=[s.updated[p.id][0],p]:(s.updated[p.id]=[h,p],l++));for(const h of gt(d.removed))h.typeName===e&&(s.added[h.id]?(delete s.added[h.id],a--):s.updated[h.id]?(s.removed[h.id]=s.updated[h.id][0],delete s.updated[h.id],l--,c++):(s.removed[h.id]=h,c++))}return a||c||l?ec(this.history.get(),s):r},{historyLength:100});return this.historyCache.set(e,n),n}index(e,n){const r=e+":"+n;if(this.indexCache.has(r))return this.indexCache.get(r);const o=this.__uncached_createIndex(e,n);return this.indexCache.set(r,o),o}__uncached_createIndex(e,n){const r=this.filterHistory(e),o=()=>{r.get();const i=new Map;for(const s of gt(this.atoms.get())){const a=s.get();if(a.typeName===e){const c=a[n];i.has(c)||i.set(c,new Set),i.get(c).add(a.id)}}return i};return K("index:"+e+":"+n,(i,s)=>{if(Li(i))return o();const a=r.getDiffSince(s);if(a===Wn)return o();const c=new Map,l=(f,g)=>{let m=c.get(f);m||(m=new wd(i.get(f)??new Set)),m.add(g),c.set(f,m)},d=(f,g)=>{let m=c.get(f);m||(m=new wd(i.get(f)??new Set)),m.remove(g),c.set(f,m)};for(const f of a){for(const g of gt(f.added))if(g.typeName===e){const m=g[n];l(m,g.id)}for(const[g,m]of gt(f.updated))if(m.typeName===e){const y=g[n],S=m[n];y!==S&&(d(y,m.id),l(S,m.id))}for(const g of gt(f.removed))if(g.typeName===e){const m=g[n];d(m,g.id)}}let h,p;for(const[f,g]of c){const m=g.get();m&&(h||(h=new Map(i)),p||(p=new Map),m.value.size===0?h.delete(f):h.set(f,m.value),p.set(f,m.diff))}return h&&p?ec(h,p):i},{historyLength:100})}record(e,n=()=>({}),r="record:"+e+(n?":"+n.toString():"")){const o=this.ids(e,n,r);return K(r,()=>{var i;for(const s of o.get())return(i=this.atoms.get()[s])==null?void 0:i.get()})}records(e,n=()=>({}),r="records:"+e+(n?":"+n.toString():"")){const o=this.ids(e,n,"ids:"+r);return K(r,()=>[...o.get()].map(i=>{const s=this.atoms.get()[i];if(!s)throw new Error("no atom found for record id: "+i);return s.get()}))}ids(e,n=()=>({}),r="ids:"+e+(n?":"+n.toString():"")){const o=this.filterHistory(e),i=()=>{o.get();const c=n();return Object.keys(c).length===0?new Set(gt(this.atoms.get()).flatMap(l=>{const d=l.get();return d.typeName===e?d.id:[]})):a0(this,e,c)},s=c=>{const l=i(),d=WB(c,l);return d?ec(l,d):c},a=K("ids_query:"+r,n,{isEqual:jB});return K("query:"+r,(c,l)=>{const d=a.get();if(Li(c))return i();if(l<a.lastChangedEpoch)return s(c);const h=o.getDiffSince(l);if(h===Wn)return s(c);const p=new wd(c);for(const g of h){for(const m of gt(g.added))m.typeName===e&&s0(d,m)&&p.add(m.id);for(const[m,y]of gt(g.updated))y.typeName===e&&(s0(d,y)?p.add(y.id):p.remove(y.id));for(const m of gt(g.removed))m.typeName===e&&p.remove(m.id)}const f=p.get();return f?ec(f.value,f.diff):c},{historyLength:50})}exec(e,n){const r=a0(this,e,n);if(r.size===0)return _o;const o=this.atoms.get();return[...r].map(i=>o[i].get())}}class VB{constructor(e){P(this,"_beforeCreateHandlers",{});P(this,"_afterCreateHandlers",{});P(this,"_beforeChangeHandlers",{});P(this,"_afterChangeHandlers",{});P(this,"_beforeDeleteHandlers",{});P(this,"_afterDeleteHandlers",{});P(this,"_operationCompleteHandlers",[]);P(this,"_isEnabled",!0);this.store=e}isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,n){if(!this._isEnabled)return e;const r=this._beforeCreateHandlers[e.typeName];if(r){let o=e;for(const i of r)o=i(o,n);return o}return e}handleAfterCreate(e,n){if(!this._isEnabled)return;const r=this._afterCreateHandlers[e.typeName];if(r)for(const o of r)o(e,n)}handleBeforeChange(e,n,r){if(!this._isEnabled)return n;const o=this._beforeChangeHandlers[n.typeName];if(o){let i=n;for(const s of o)i=s(e,i,r);return i}return n}handleAfterChange(e,n,r){if(!this._isEnabled)return;const o=this._afterChangeHandlers[n.typeName];if(o)for(const i of o)i(e,n,r)}handleBeforeDelete(e,n){if(!this._isEnabled)return!0;const r=this._beforeDeleteHandlers[e.typeName];if(r){for(const o of r)if(o(e,n)===!1)return!1}return!0}handleAfterDelete(e,n){if(!this._isEnabled)return;const r=this._afterDeleteHandlers[e.typeName];if(r)for(const o of r)o(e,n)}handleOperationComplete(e){if(this._isEnabled)for(const n of this._operationCompleteHandlers)n(e)}register(e){const n=[];for(const[r,o]of Object.entries(e))o!=null&&o.beforeCreate&&n.push(this.registerBeforeCreateHandler(r,o.beforeCreate)),o!=null&&o.afterCreate&&n.push(this.registerAfterCreateHandler(r,o.afterCreate)),o!=null&&o.beforeChange&&n.push(this.registerBeforeChangeHandler(r,o.beforeChange)),o!=null&&o.afterChange&&n.push(this.registerAfterChangeHandler(r,o.afterChange)),o!=null&&o.beforeDelete&&n.push(this.registerBeforeDeleteHandler(r,o.beforeDelete)),o!=null&&o.afterDelete&&n.push(this.registerAfterDeleteHandler(r,o.afterDelete));return()=>{for(const r of n)r()}}registerBeforeCreateHandler(e,n){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(n),()=>ki(this._beforeCreateHandlers[e],n)}registerAfterCreateHandler(e,n){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(n),()=>ki(this._afterCreateHandlers[e],n)}registerBeforeChangeHandler(e,n){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(n),()=>ki(this._beforeChangeHandlers[e],n)}registerAfterChangeHandler(e,n){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(n),()=>ki(this._afterChangeHandlers[e],n)}registerBeforeDeleteHandler(e,n){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(n),()=>ki(this._beforeDeleteHandlers[e],n)}registerAfterDeleteHandler(e,n){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(n),()=>ki(this._afterDeleteHandlers[e],n)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>ki(this._operationCompleteHandlers,e)}}function ki(t,e){const n=t.indexOf(e);n>=0&&t.splice(n,1)}class pS{constructor(e){P(this,"id");P(this,"atoms",Tt("store_atoms",{}));P(this,"history",Tt("history",0,{historyLength:1e3}));P(this,"query",new GB(this.atoms,this.history));P(this,"listeners",new Set);P(this,"historyAccumulator",new XB);P(this,"historyReactor");P(this,"schema");P(this,"props");P(this,"scopedTypes");P(this,"sideEffects",new VB(this));P(this,"isMergingRemoteChanges",!1);P(this,"_integrityChecker");P(this,"_isPossiblyCorrupted",!1);P(this,"pendingAfterEvents",null);P(this,"_isInAtomicOp",!1);const{initialData:n,schema:r,id:o}=e;this.id=o??Ye(),this.schema=r,this.props=e.props,n&&this.atoms.set(gx(Dn(n).map(([i,s])=>[i,Tt("atom:"+i,this.schema.validateRecord(this,s,"initialize",null))]))),this.historyReactor=sB("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:i=>this.cancelHistoryReactor=Ox(i)}),this.scopedTypes={document:new Set(gt(this.schema.types).filter(i=>i.scope==="document").map(i=>i.typeName)),session:new Set(gt(this.schema.types).filter(i=>i.scope==="session").map(i=>i.typeName)),presence:new Set(gt(this.schema.types).filter(i=>i.scope==="presence").map(i=>i.typeName))}}cancelHistoryReactor(){}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:n,source:r}of e){let o=null,i=null,s=null;for(const{onHistory:a,filters:c}of this.listeners)if(!(c.source!=="all"&&c.source!==r))if(c.scope!=="all")if(c.scope==="document"){if(i??(i=this.filterChangesByScope(n,"document")),!i)continue;a({changes:i,source:r})}else if(c.scope==="session"){if(o??(o=this.filterChangesByScope(n,"session")),!o)continue;a({changes:o,source:r})}else{if(s??(s=this.filterChangesByScope(n,"presence")),!s)continue;a({changes:s,source:r})}else a({changes:n,source:r})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,n){const r={added:dc(e.added,(o,i)=>this.scopedTypes[n].has(i.typeName)),updated:dc(e.updated,(o,i)=>this.scopedTypes[n].has(i[1].typeName)),removed:dc(e.removed,(o,i)=>this.scopedTypes[n].has(i.typeName))};return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0?null:r}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(n=>this.schema.validateRecord(this,n,e,null))}put(e,n){this.atomic(()=>{const r={},o={},i=this.atoms.__unsafe__getWithoutCapture();let s=null,a,c=!1;const l=this.isMergingRemoteChanges?"remote":"user";for(let d=0,h=e.length;d<h;d++){a=e[d];const p=(s??i)[a.id];if(p){const f=p.__unsafe__getWithoutCapture();if(a=this.sideEffects.handleBeforeChange(f,a,l),this.schema.validateRecord(this,a,n??"updateRecord",f)===f)continue;p.set(a),c=!0;const m=p.__unsafe__getWithoutCapture();r[a.id]=[f,m],this.addDiffForAfterEvent(f,m)}else a=this.sideEffects.handleBeforeCreate(a,l),c=!0,a=this.schema.validateRecord(this,a,n??"createRecord",null),o[a.id]=a,this.addDiffForAfterEvent(null,a),s||(s={...i}),s[a.id]=Tt("atom:"+a.id,a)}s&&this.atoms.set(s),c&&this.updateHistory({added:o,updated:r,removed:{}})})}remove(e){this.atomic(()=>{const n=new Set,r=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const i of e){const s=this.atoms.__unsafe__getWithoutCapture()[i];s&&this.sideEffects.handleBeforeDelete(s.get(),r)===!1&&n.add(i)}let o;this.atoms.update(i=>{let s;for(const a of e){if(n.has(a)||!(a in i))continue;s||(s={...i}),o||(o={}),delete s[a];const c=i[a].get();o[a]=c,this.addDiffForAfterEvent(c,null)}return s??i}),o&&this.updateHistory({added:{},updated:{},removed:o})})}get(e){var n;return(n=this.atoms.get()[e])==null?void 0:n.get()}unsafeGetWithoutCapture(e){var n;return(n=this.atoms.__unsafe__getWithoutCapture()[e])==null?void 0:n.__unsafe__getWithoutCapture()}serialize(e="document"){const n={};for(const[r,o]of Dn(this.atoms.get())){const i=o.get();(e==="all"||this.scopedTypes[e].has(i.typeName))&&(n[r]=i)}return n}getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}getSnapshot(e="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(e)}migrateSnapshot(e){const n=this.schema.migrateStoreSnapshot(e);if(n.type==="error")throw new Error(`Failed to migrate snapshot: ${n.reason}`);return{store:n.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){const n=this.schema.migrateStoreSnapshot(e);if(n.type==="error")throw new Error(`Failed to migrate snapshot: ${n.reason}`);const r=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(n.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(r)}}loadSnapshot(e){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(e)}allRecords(){return gt(this.atoms.get()).map(e=>e.get())}clear(){this.remove(jb(this.atoms.get()))}update(e,n){const r=this.atoms.get()[e];if(!r){console.error(`Record ${e} not found. This is probably an error`);return}this.put([n(r.__unsafe__getWithoutCapture())])}has(e){return!!this.atoms.get()[e]}listen(e,n){this._flushHistory();const r={onHistory:e,filters:{source:(n==null?void 0:n.source)??"all",scope:(n==null?void 0:n.scope)??"all"}};return this.listeners.add(r),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(r),this.listeners.size===0&&this.historyReactor.stop()}}mergeRemoteChanges(e){if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.isMergingRemoteChanges=!0,Kr(e)}finally{this.isMergingRemoteChanges=!1}}extractingChanges(e){const n=[],r=this.historyAccumulator.addInterceptor(o=>n.push(o.changes));try{return Kr(e),hS(n)}finally{r()}}applyDiff(e,{runCallbacks:n=!0,ignoreEphemeralKeys:r=!1}={}){this.atomic(()=>{const o=gt(e.added);for(const[s,a]of gt(e.updated)){const c=this.schema.getType(a.typeName);if(r&&c.ephemeralKeySet.size){const l=this.get(a.id);if(!l){o.push(a);continue}let d=null;for(const[h,p]of Object.entries(a))c.ephemeralKeySet.has(h)||Object.is(p,kn(l,h))||(d||(d={...l}),d[h]=p);d&&o.push(d)}else o.push(a)}const i=jb(e.removed);o.length&&this.put(o),i.length&&this.remove(i)},n)}createComputedCache(e,n,r){const o=new Gr;return{get:i=>{const s=this.atoms.get()[i];if(s)return o.get(s,()=>{const a=r?K(s.name+":equals",()=>s.get(),{isEqual:r}):s;return K(e+":"+i,()=>n(a.get()))}).get()}}}createSelectedComputedCache(e,n,r){const o=new Gr;return{get:i=>{const s=this.atoms.get()[i];if(s)return o.get(s,()=>{const a=K(e+":"+i+":selector",()=>n(s.get()));return K(e+":"+i,()=>r(a.get()))}).get()}}}ensureStoreIsUsable(){this.atomic(()=>{var e;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(e=this._integrityChecker)==null||e.call(this)})}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}addDiffForAfterEvent(e,n){if(He(this.pendingAfterEvents,"must be in event operation"),e===n||(e&&n&&He(e.id===n.id),!e&&!n))return;const r=(e||n).id,o=this.pendingAfterEvents.get(r);o?o.after=n:this.pendingAfterEvents.set(r,{before:e,after:n})}flushAtomicCallbacks(){let e=0;const n=this.isMergingRemoteChanges?"remote":"user";for(;this.pendingAfterEvents;){const r=this.pendingAfterEvents;if(this.pendingAfterEvents=null,!!this.sideEffects.isEnabled()){if(e++,e>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:o,after:i}of r.values())o&&i?this.sideEffects.handleAfterChange(o,i,n):o&&!i?this.sideEffects.handleAfterDelete(o,n):!o&&i&&this.sideEffects.handleAfterCreate(i,n);this.pendingAfterEvents||this.sideEffects.handleOperationComplete(n)}}}atomic(e,n=!0){return Kr(()=>{if(this._isInAtomicOp)return this.pendingAfterEvents||(this.pendingAfterEvents=new Map),e();this.pendingAfterEvents=new Map;const r=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(n??r),this._isInAtomicOp=!0;try{const o=e();return this.flushAtomicCallbacks(),o}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(r),this._isInAtomicOp=!1}})}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor(n=>e(n,this.isMergingRemoteChanges?"remote":"user"))}}function YB(t){if(t.length===0)return[];const e=[];let n=[t[0]],r;for(let o=1,i=t.length;o<i;o++)r=t[o],n[0].source!==r.source&&(e.push(n),n=[]),n.push(r);return e.push(n),e.map(o=>({source:o[0].source,changes:hS(o.map(i=>i.changes))}))}class XB{constructor(){P(this,"_history",[]);P(this,"_interceptors",new Set)}addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const n of this._interceptors)n(e)}flush(){const e=YB(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function qB(t,e,n){const r=new Gr;return{get(o,i){return r.get(o,()=>(o instanceof pS?o:o.store).createComputedCache(t,c=>e(o,c),n)).get(i)}}}function ZB(t){const e=[];for(let n=t.length-1;n>=0;n--){const r=t[n];if("id"in r)e.unshift(r);else{const o=r.dependsOn,i=e[0];i&&(e[0]={...i,dependsOn:o.concat(i.dependsOn??[])})}}return e}function zs({sequence:t,sequenceId:e,retroactive:n=!0}){const r={sequenceId:e,retroactive:n,sequence:ZB(t)};return rI(r),r}function Rn(t,e){return Object.fromEntries(Dn(e).map(([n,r])=>[n,`${t}/${r}`]))}function Jn(t){const e=t.sequenceId;return zs({sequenceId:e,retroactive:t.retroactive??!0,sequence:t.sequence.map(n=>"id"in n?{...n,scope:"record",filter:r=>{var o,i;return r.typeName===t.recordType&&(((o=n.filter)==null?void 0:o.call(n,r))??!0)&&(((i=t.filter)==null?void 0:i.call(t,r))??!0)}}:n)})}function JB(t){const e=new Map(t.map(i=>[i.id,i])),n=new Set,r=[];function o(i){He(!n.has(i.id),`Circular dependency in migrations: ${i.id}`),n.add(i.id);const{version:s,sequenceId:a}=bu(i.id),c=e.get(`${a}/${s-1}`);if(c&&o(c),i.dependsOn)for(const l of i.dependsOn){const d=e.get(l);d&&o(d)}e.delete(i.id),r.push(i)}for(const i of e.values())o(i);return r}function bu(t){const[e,n]=t.split("/");return{sequenceId:e,version:parseInt(n)}}function c0(t,e){e&&He(t.startsWith(e+"/"),`Every migration in sequence '${e}' must have an id starting with '${e}/'. Got invalid id: '${t}'`),He(t.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${t}'`)}function rI(t){if(He(!t.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${t.sequenceId}`),He(t.sequenceId.length,"sequenceId must be a non-empty string"),t.sequence.length===0)return;c0(t.sequence[0].id,t.sequenceId);let e=bu(t.sequence[0].id).version;He(e===1,`Expected the first migrationId to be '${t.sequenceId}/1' but got '${t.sequence[0].id}'`);for(let n=1;n<t.sequence.length;n++){const r=t.sequence[n].id;c0(r,t.sequenceId);const o=bu(r).version;He(o===e+1,`Migration id numbers must increase in increments of 1, expected ${t.sequenceId}/${e+1} but got '${t.sequence[n].id}'`),e=o}}var Go=(t=>(t.IncompatibleSubtype="incompatible-subtype",t.UnknownType="unknown-type",t.TargetVersionTooNew="target-version-too-new",t.TargetVersionTooOld="target-version-too-old",t.MigrationError="migration-error",t.UnrecognizedSubtype="unrecognized-subtype",t))(Go||{});function QB(t){if(t.schemaVersion>2||t.schemaVersion<1)return ni.err("Bad schema version");if(t.schemaVersion===2)return ni.ok(t);const e={schemaVersion:2,sequences:{"com.tldraw.store":t.storeVersion}};for(const[n,r]of Object.entries(t.recordVersions))if(e.sequences[`com.tldraw.${n}`]=r.version,"subTypeKey"in r)for(const[o,i]of Object.entries(r.subTypeVersions))e.sequences[`com.tldraw.${n}.${o}`]=i;return ni.ok(e)}class fS{constructor(e,n){P(this,"migrations",{});P(this,"sortedMigrations");var o;this.types=e,this.options=n;for(const i of n.migrations??[])He(!this.migrations[i.sequenceId],`Duplicate migration sequenceId ${i.sequenceId}`),rI(i),this.migrations[i.sequenceId]=i;const r=Object.values(this.migrations).flatMap(i=>i.sequence);this.sortedMigrations=JB(r);for(const i of this.sortedMigrations)if((o=i.dependsOn)!=null&&o.length)for(const s of i.dependsOn){const a=r.find(c=>c.id===s);He(a,`Migration '${i.id}' depends on missing migration '${s}'`)}}static create(e,n){return new fS(e,n??{})}validateRecord(e,n,r,o){try{const i=kn(this.types,n.typeName);if(!i)throw new Error(`Missing definition for record type ${n.typeName}`);return i.validate(n,o??void 0)}catch(i){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:n,phase:r,recordBefore:o,error:i});throw i}}getMigrationsSince(e){const n=QB(e);if(!n.ok)return n;const r=n.value,o=new Set(Object.keys(r.sequences).filter(s=>this.migrations[s]));for(const s in this.migrations)r.sequences[s]===void 0&&this.migrations[s].retroactive&&o.add(s);if(o.size===0)return ni.ok([]);const i=new Set;for(const s of o){const a=r.sequences[s];if(typeof a!="number"&&this.migrations[s].retroactive||a===0){for(const d of this.migrations[s].sequence)i.add(d.id);continue}const c=`${s}/${a}`,l=this.migrations[s].sequence.findIndex(d=>d.id===c);if(l===-1)return ni.err("Incompatible schema?");for(const d of this.migrations[s].sequence.slice(l+1))i.add(d.id)}return ni.ok(this.sortedMigrations.filter(({id:s})=>i.has(s)))}migratePersistedRecord(e,n,r="up"){const o=this.getMigrationsSince(n);if(!o.ok)return console.error("Error migrating record",o.error),{type:"error",reason:Go.MigrationError};let i=o.value;if(i.length===0)return{type:"success",value:e};if(i.some(s=>s.scope==="store"))return{type:"error",reason:r==="down"?Go.TargetVersionTooOld:Go.TargetVersionTooNew};if(r==="down"){if(!i.every(s=>s.down))return{type:"error",reason:Go.TargetVersionTooOld};i=i.slice().reverse()}e=ut(e);try{for(const s of i){if(s.scope==="store")throw new Error;if(!(s.filter?s.filter(e):!0))continue;const c=s[r](e);c&&(e=ut(c))}}catch(s){return console.error("Error migrating record",s),{type:"error",reason:Go.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e){let{store:n}=e;const r=this.getMigrationsSince(e.schema);if(!r.ok)return console.error("Error migrating store",r.error),{type:"error",reason:Go.MigrationError};const o=r.value;if(o.length===0)return{type:"success",value:n};n=ut(n);try{for(const i of o)if(i.scope==="record")for(const[s,a]of Object.entries(n)){if(!(i.filter?i.filter(a):!0))continue;const l=i.up(a);l&&(n[s]=ut(l))}else if(i.scope==="store"){const s=i.up(n);s&&(n=ut(s))}else $t(i)}catch(i){return console.error("Error migrating store",i),{type:"error",reason:Go.MigrationError}}return{type:"success",value:n}}createIntegrityChecker(e){var n,r;return((r=(n=this.options).createIntegrityChecker)==null?void 0:r.call(n,e))??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e,sequence:n})=>[e,n.length?bu(n.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e})=>[e,0]))}}getType(e){const n=kn(this.types,e);return He(n,"record type does not exists"),n}}fi("@tldraw/store","3.3.1","esm");function e9(t){if(!t.length)return null;let e="";for(const n of t)typeof n=="number"?e+=`.${n}`:n.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${n.slice(1)}`:e+=n:e+=`.${n}`;return e=e.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),e.startsWith(".")?e.slice(1):e}class Re extends Error{constructor(n,r=[]){const o=e9(r),i=n.split(`
`).map((s,a)=>a===0?s:`  ${s}`).join(`
`);super(r?`At ${o}: ${i}`:i);P(this,"name","ValidationError");this.rawMessage=n,this.path=r}}function $n(t,e){try{return e()}catch(n){throw n instanceof Re?new Re(n.rawMessage,[t,...n.path]):new Re(n.toString(),[t])}}function ai(t){if(t===null)return"null";if(Array.isArray(t))return"an array";const e=typeof t;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:$t(e)}}class mn{constructor(e,n){this.validationFn=e,this.validateUsingKnownGoodVersionFn=n}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,n){return Object.is(e,n)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,n):this.validate(n)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return s9(this)}optional(){return iI(this)}refine(e){return new mn(n=>e(this.validate(n)),(n,r)=>{const o=this.validateUsingKnownGoodVersion(n,r);return Object.is(n,o)?n:e(o)})}check(e,n){return typeof e=="string"?this.refine(r=>($n(`(check ${e})`,()=>n(r)),r)):this.refine(r=>(e(r),r))}}class t9 extends mn{constructor(e){super(n=>{const r=l0.validate(n);for(let o=0;o<r.length;o++)$n(o,()=>e.validate(r[o]));return r},(n,r)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(r);const o=l0.validate(r);let i=n.length!==o.length;for(let s=0;s<o.length;s++){const a=o[s];if(s>=n.length){i=!0,$n(s,()=>e.validate(a));continue}if(Object.is(n[s],a))continue;const c=$n(s,()=>e.validateUsingKnownGoodVersion(n[s],a));Object.is(c,n[s])||(i=!0)}return i?r:n}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new Re("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new Re("Expected an array with length greater than 1")})}}class wu extends mn{constructor(e,n=!1){super(r=>{if(typeof r!="object"||r===null)throw new Re(`Expected object, got ${ai(r)}`);for(const[o,i]of Object.entries(e))$n(o,()=>{i.validate(kn(r,o))});if(!n){for(const o of Object.keys(r))if(!wr(e,o))throw new Re("Unexpected property",[o])}return r},(r,o)=>{if(typeof o!="object"||o===null)throw new Re(`Expected object, got ${ai(o)}`);let i=!1;for(const[s,a]of Object.entries(e)){const c=kn(r,s),l=kn(o,s);if(Object.is(c,l))continue;const d=$n(s,()=>{const h=a;return h.validateUsingKnownGoodVersion?h.validateUsingKnownGoodVersion(c,l):h.validate(l)});Object.is(d,c)||(i=!0)}if(!n){for(const s of Object.keys(o))if(!wr(e,s))throw new Re("Unexpected property",[s])}for(const s of Object.keys(r))if(!wr(o,s)){i=!0;break}return i?o:r}),this.config=e,this.shouldAllowUnknownProperties=n}allowUnknownProperties(){return new wu(this.config,!0)}extend(e){return new wu({...this.config,...e})}}class wh extends mn{constructor(e,n,r,o){super(i=>{this.expectObject(i);const{matchingSchema:s,variant:a}=this.getMatchingSchemaAndVariant(i);return s===void 0?this.unknownValueValidation(i,a):$n(`(${e} = ${a})`,()=>s.validate(i))},(i,s)=>{this.expectObject(s),this.expectObject(i);const{matchingSchema:a,variant:c}=this.getMatchingSchemaAndVariant(s);return a===void 0?this.unknownValueValidation(s,c):kn(i,e)!==kn(s,e)?$n(`(${e} = ${c})`,()=>a.validate(s)):$n(`(${e} = ${c})`,()=>a.validateUsingKnownGoodVersion?a.validateUsingKnownGoodVersion(i,s):a.validate(s))}),this.key=e,this.config=n,this.unknownValueValidation=r,this.useNumberKeys=o}expectObject(e){if(typeof e!="object"||e===null)throw new Re(`Expected an object, got ${ai(e)}`,[])}getMatchingSchemaAndVariant(e){const n=kn(e,this.key);if(!this.useNumberKeys&&typeof n!="string")throw new Re(`Expected a string for key "${this.key}", got ${ai(n)}`);if(this.useNumberKeys&&!Number.isFinite(Number(n)))throw new Re(`Expected a number for key "${this.key}", got "${n}"`);return{matchingSchema:wr(this.config,n)?this.config[n]:void 0,variant:n}}validateUnknownVariants(e){return new wh(this.key,this.config,e,this.useNumberKeys)}}class n9 extends mn{constructor(e,n){super(r=>{if(typeof r!="object"||r===null)throw new Re(`Expected object, got ${ai(r)}`);for(const[o,i]of Object.entries(r))$n(o,()=>{e.validate(o),n.validate(i)});return r},(r,o)=>{if(typeof o!="object"||o===null)throw new Re(`Expected object, got ${ai(o)}`);let i=!1;for(const[s,a]of Object.entries(o)){if(!wr(r,s)){i=!0,$n(s,()=>{e.validate(s),n.validate(a)});continue}const c=kn(r,s),l=a;if(Object.is(c,l))continue;const d=$n(s,()=>n.validateUsingKnownGoodVersion?n.validateUsingKnownGoodVersion(c,l):n.validate(l));Object.is(d,c)||(i=!0)}for(const s of Object.keys(r))if(!wr(o,s)){i=!0;break}return i?o:r}),this.keyValidator=e,this.valueValidator=n}}function gS(t){return new mn(e=>{if(typeof e!==t)throw new Re(`Expected ${t}, got ${ai(e)}`);return e})}const r9=new mn(t=>t),Se=gS("string"),ge=gS("number").check(t=>{if(Number.isNaN(t))throw new Re("Expected a number, got NaN");if(!Number.isFinite(t))throw new Re(`Expected a finite number, got ${t}`)}),_u=ge.check(t=>{if(t<0)throw new Re(`Expected a positive number, got ${t}`)}),Ct=ge.check(t=>{if(t<=0)throw new Re(`Expected a non-zero positive number, got ${t}`)}),oI=ge.check(t=>{if(!Number.isInteger(t))throw new Re(`Expected an integer, got ${t}`)}),_d=oI.check(t=>{if(t<0)throw new Re(`Expected a positive integer, got ${t}`)}),o9=oI.check(t=>{if(t<=0)throw new Re(`Expected a non-zero positive integer, got ${t}`)}),Te=gS("boolean");function cn(t){return new mn(e=>{if(e!==t)throw new Re(`Expected ${t}, got ${JSON.stringify(e)}`);return t})}const l0=new mn(t=>{if(!Array.isArray(t))throw new Re(`Expected an array, got ${ai(t)}`);return t});function Kt(t){return new t9(t)}function Me(t){return new wu(t)}function nm(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null||Object.getPrototypeOf(t)===h5)}function rm(t){return t===null||typeof t=="number"||typeof t=="string"||typeof t=="boolean"?!0:Array.isArray(t)?t.every(rm):nm(t)?Object.values(t).every(rm):!1}const Wt=new mn(t=>{if(rm(t))return t;throw new Re(`Expected json serializable value, got ${typeof t}`)},(t,e)=>{if(Array.isArray(t)&&Array.isArray(e)){let n=t.length!==e.length;for(let r=0;r<e.length;r++){if(r>=t.length){n=!0,Wt.validate(e[r]);continue}const o=t[r],i=e[r];if(Object.is(o,i))continue;const s=Wt.validateUsingKnownGoodVersion(o,i);Object.is(s,o)||(n=!0)}return n?e:t}else if(nm(t)&&nm(e)){let n=!1;for(const r of Object.keys(e)){if(!wr(t,r)){n=!0,Wt.validate(e[r]);continue}const o=t[r],i=e[r];if(Object.is(o,i))continue;const s=Wt.validateUsingKnownGoodVersion(o,i);Object.is(s,o)||(n=!0)}for(const r of Object.keys(t))if(!wr(e,r)){n=!0;break}return n?e:t}else return Wt.validate(e)});function xu(t,e){return new n9(t,e)}function mS(t,e){return new wh(t,e,(n,r)=>{throw new Re(`Expected one of ${Object.keys(e).map(o=>JSON.stringify(o)).join(" or ")}, got ${JSON.stringify(r)}`,[t])},!1)}function i9(t,e){return new wh(t,e,(n,r)=>{throw new Re(`Expected one of ${Object.keys(e).map(o=>JSON.stringify(o)).join(" or ")}, got ${JSON.stringify(r)}`,[t])},!0)}function eo(t,e){return new mn(n=>$n(t,()=>e.validate(n)),(n,r)=>$n(t,()=>e.validateUsingKnownGoodVersion?e.validateUsingKnownGoodVersion(n,r):e.validate(r)))}function _h(t){return new mn(e=>{if(!t.has(e)){const n=Array.from(t,r=>JSON.stringify(r)).join(" or ");throw new Re(`Expected ${n}, got ${e}`)}return e})}function iI(t){return new mn(e=>{if(e!==void 0)return t.validate(e)},(e,n)=>{if(!(e===void 0&&n===void 0)&&n!==void 0)return t.validateUsingKnownGoodVersion&&e!==void 0?t.validateUsingKnownGoodVersion(e,n):t.validate(n)})}function s9(t){return new mn(e=>e===null?null:t.validate(e),(e,n)=>n===null?null:t.validateUsingKnownGoodVersion&&e!==null?t.validateUsingKnownGoodVersion(e,n):t.validate(n))}function xh(...t){return _h(new Set(t))}function yS(t){try{return new URL(t)}catch{if(t.startsWith("/")||t.startsWith("./"))try{return new URL(t,"http://example.com")}catch{throw new Re(`Expected a valid url, got ${JSON.stringify(t)}`)}throw new Re(`Expected a valid url, got ${JSON.stringify(t)}`)}}const a9=new Set(["http:","https:","mailto:"]),Xn=Se.check(t=>{if(t==="")return;const e=yS(t);if(!a9.has(e.protocol.toLowerCase()))throw new Re(`Expected a valid url, got ${JSON.stringify(t)} (invalid protocol)`)}),c9=new Set(["http:","https:","data:","asset:"]),ji=Se.check(t=>{if(t==="")return;const e=yS(t);if(!c9.has(e.protocol.toLowerCase()))throw new Re(`Expected a valid url, got ${JSON.stringify(t)} (invalid protocol)`)});Se.check(t=>{if(t==="")return;if(!yS(t).protocol.toLowerCase().match(/^https?:$/))throw new Re(`Expected a valid url, got ${JSON.stringify(t)} (invalid protocol)`)});const SS=Se.refine(t=>{try{return t5(t),t}catch{throw new Re(`Expected an index key, got ${JSON.stringify(t)}`)}});fi("@tldraw/validate","3.3.1","esm");function Gn(t){return Se.refine(e=>{if(!e.startsWith(`${t}:`))throw new Error(`${t} ID must start with "${t}:"`);return e})}const Ph=Gn("asset");function vS(t,e){return Me({id:Ph,typeName:cn("asset"),type:cn(t),props:e,meta:Wt})}const Ki=Me({x:ge,y:ge,z:ge.optional()}),pc=Me({x:ge,y:ge,w:ge,h:ge}),sI=ge.check(t=>{if(t<0||t>1)throw new Re("Opacity must be between 0 and 1")}),l9=Se.refine(t=>{if(!t.startsWith("page:")&&!t.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return t}),rr=Gn("shape");function d9(t,e,n){return Me({id:rr,typeName:cn("shape"),x:ge,y:ge,rotation:ge,index:SS,parentId:l9,type:cn(t),isLocked:Te,opacity:sI,props:e?Me(e):Wt,meta:n?Me(n):Wt})}const u9=Gn("binding");function h9(t,e,n){return Me({id:u9,typeName:cn("binding"),type:cn(t),fromId:rr,toId:rr,props:e?Me(e):Wt,meta:n?Me(n):Wt})}Rn("com.tldraw.binding",{});Jn({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function Ni(t){return`binding:${Ye()}`}function p9(t){return Qr("binding",{scope:"document",validator:eo("binding",mS("type",Uc(t,(e,{props:n,meta:r})=>h9(e,n,r))))}).withDefaultProperties(()=>({meta:{}}))}class Yt{constructor(e,n,r){this.id=e,this.defaultValue=n,this.type=r}static define(e,n){const{defaultValue:r,type:o=r9}=n;return new Yt(e,r,o)}static defineEnum(e,n){const{defaultValue:r,values:o}=n;return new f9(e,r,o)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,n){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,n):this.validate(n)}}class f9 extends Yt{constructor(e,n,r){super(e,n,xh(...r)),this.values=r}}const Dl=Rn("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),g9=Jn({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:Dl.AddIsLocked,up:t=>{t.isLocked=!1},down:t=>{delete t.isLocked}},{id:Dl.HoistOpacity,up:t=>{t.opacity=Number(t.props.opacity??"1"),delete t.props.opacity},down:t=>{const e=t.opacity;delete t.opacity,t.props.opacity=e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}},{id:Dl.AddMeta,up:t=>{t.meta={}}},{id:Dl.AddWhite,up:t=>{},down:t=>{t.props.color==="white"&&(t.props.color="black")}}]});function Os(t){return t?t.typeName==="shape":!1}function In(t){return t?t.startsWith("shape:"):!1}function Xe(t){return`shape:${t??Ye()}`}function aI(t){const e=new Map;for(const[n,r]of Object.entries(t))if(r instanceof Yt){if(e.has(r))throw new Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);e.set(r,n)}return e}function kr(t,e){return Uc(e,(n,r)=>`com.tldraw.shape.${t}/${r}`)}function m9(t){return Qr("shape",{scope:"document",validator:eo("shape",mS("type",Uc(t,(e,{props:n,meta:r})=>d9(e,n,r))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}function d0(t,e){const n=[];for(const[r,{migrations:o}]of Object.entries(e)){const i=`com.tldraw.${t}.${r}`;o?"sequenceId"in o?(He(i===o.sequenceId,`sequenceId mismatch for ${r} ${bh} migrations. Expected '${i}', got '${o.sequenceId}'`),n.push(o)):"sequence"in o?n.push(zs({sequenceId:i,retroactive:!1,sequence:o.sequence.map(s=>"id"in s?cI(t,r,s):s)})):n.push(zs({sequenceId:i,retroactive:!1,sequence:Object.keys(o.migrators).map(s=>Number(s)).sort((s,a)=>s-a).map(s=>({id:`${i}/${s}`,scope:"record",filter:a=>a.typeName===t&&a.type===r,up:a=>{const c=o.migrators[s].up(a);if(c)return c},down:a=>{const c=o.migrators[s].down(a);if(c)return c}}))})):n.push(zs({sequenceId:i,retroactive:!1,sequence:[]}))}return n}function cI(t,e,n){return{id:n.id,dependsOn:n.dependsOn,scope:"record",filter:r=>r.typeName===t&&r.type===e,up:r=>{const o=n.up(r.props);o&&(r.props=o)},down:typeof n.down=="function"?r=>{const o=n.down(r.props);o&&(r.props=o)}:void 0}}const lI=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],Pu={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",note:{fill:"#923632",text:"#f2f2f2"},semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",note:{fill:"#843906",text:"#f2f2f2"},semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#89231A",text:"#f2f2f2"},semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#681683",text:"#f2f2f2"},semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",note:{fill:"#98571B",text:"#f2f2f2"},semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function Lo(t){return t.isDarkMode?Pu.darkMode:Pu.lightMode}const qn=Yt.defineEnum("tldraw:color",{defaultValue:"black",values:lI}),dI=Yt.defineEnum("tldraw:labelColor",{defaultValue:"black",values:lI}),Wi=Yt.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),Gi=Yt.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),Vr=Yt.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),uI={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},Yr=Yt.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),hI=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],Iu=Yt.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:hI}),Cu=Yt.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:hI}),pI={labelColor:dI,color:qn,fill:Gi,dash:Wi,size:Yr,arrowheadStart:Iu,arrowheadEnd:Cu,font:Vr,start:Ki,end:Ki,bend:ge,text:Se,labelPosition:ge,scale:Ct},Ps=kr("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5});function $l(t){return cI("shape","arrow",t)}const fI=zs({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[$l({id:Ps.AddLabelColor,up:t=>{t.labelColor="black"},down:"retired"}),$l({id:Ps.AddIsPrecise,up:({start:t,end:e})=>{t.type==="binding"&&(t.isPrecise=!(t.normalizedAnchor.x===.5&&t.normalizedAnchor.y===.5)),e.type==="binding"&&(e.isPrecise=!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5))},down:({start:t,end:e})=>{t.type==="binding"&&(t.isPrecise||(t.normalizedAnchor={x:.5,y:.5}),delete t.isPrecise),e.type==="binding"&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise)}}),$l({id:Ps.AddLabelPosition,up:t=>{t.labelPosition=.5},down:t=>{delete t.labelPosition}}),{id:Ps.ExtractBindings,scope:"store",up:t=>{const e=Object.values(t).filter(n=>n.typeName==="shape"&&n.type==="arrow");for(const n of e){const{start:r,end:o}=n.props;if(r.type==="binding"){const i=Ni(),s={typeName:"binding",id:i,type:"arrow",fromId:n.id,toId:r.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:r.normalizedAnchor,isExact:r.isExact,isPrecise:r.isPrecise}};t[i]=s,n.props.start={x:0,y:0}}else delete n.props.start.type;if(o.type==="binding"){const i=Ni(),s={typeName:"binding",id:i,type:"arrow",fromId:n.id,toId:o.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:o.normalizedAnchor,isExact:o.isExact,isPrecise:o.isPrecise}};t[i]=s,n.props.end={x:0,y:0}}else delete n.props.end.type}}},$l({id:Ps.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}})]}),gI={terminal:xh("start","end"),normalizedAnchor:Ki,isExact:Te,isPrecise:Te},mI={sequence:[{dependsOn:[Ps.ExtractBindings]}]},y9=eo("camera",Me({typeName:cn("camera"),id:Gn("camera"),x:ge,y:ge,z:ge,meta:Wt})),S9=Rn("com.tldraw.camera",{AddMeta:1}),v9=Jn({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:S9.AddMeta,up:t=>{t.meta={}}}]}),Ur=Qr("camera",{validator:y9,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),b9=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),yI=_h(b9),w9=Me({type:yI,rotation:ge}),_9=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),x9=_h(_9),P9=new Set(["starting","paused","active","stopping"]),SI=Me({id:Se,points:Kt(Ki),size:_u,color:x9,opacity:ge,state:_h(P9),delay:ge,shrink:ge,taper:Te}),Ec=Gn("page"),I9=eo("page",Me({typeName:cn("page"),id:Ec,name:Se,index:SS,meta:Wt})),C9=Rn("com.tldraw.page",{AddMeta:1}),E9=Jn({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:C9.AddMeta,up:t=>{t.meta={}}}]}),Zn=Qr("page",{validator:I9,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function _n(t){return Zn.isId(t)}const T9={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1};function vI(t){return t?dc(t,e=>T9[e]):null}Gn("instance");function k9(t){const e={};for(const[r,o]of t)e[r]=iI(o);const n=eo("instance",Me({typeName:cn("instance"),id:Gn("instance"),currentPageId:Ec,followingUserId:Se.nullable(),brush:pc.nullable(),opacityForNextShape:sI,stylesForNextShape:Me(e),cursor:w9,scribbles:Kt(SI),isFocusMode:Te,isDebugMode:Te,isToolLocked:Te,exportBackground:Te,screenBounds:pc,insets:Kt(Te),zoomBrush:pc.nullable(),isPenMode:Te,isGridMode:Te,chatMessage:Se,isChatting:Te,highlightedUserIds:Kt(Se),isFocused:Te,devicePixelRatio:ge,isCoarsePointer:Te,isHoveringCanvas:Te.nullable(),openMenus:Kt(Se),isChangingStyle:Te,isReadonly:Te,meta:Wt,duplicateProps:Me({shapeIds:Kt(Gn("shape")),offset:Me({x:ge,y:ge})}).nullable()}));return Qr("instance",{validator:n,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}const lt=Rn("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),M9=Jn({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:lt.AddTransparentExportBgs,up:t=>({...t,exportBackground:!0})},{id:lt.RemoveDialog,up:({dialog:t,...e})=>e},{id:lt.AddToolLockMode,up:t=>({...t,isToolLocked:!1})},{id:lt.RemoveExtraPropsForNextShape,up:({propsForNextShape:t,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(t).filter(([n])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(n)))})},{id:lt.AddLabelColor,up:({propsForNextShape:t,...e})=>({...e,propsForNextShape:{...t,labelColor:"black"}})},{id:lt.AddFollowingUserId,up:t=>({...t,followingUserId:null})},{id:lt.RemoveAlignJustify,up:t=>{let e=t.propsForNextShape.align;return e==="justify"&&(e="start"),{...t,propsForNextShape:{...t.propsForNextShape,align:e}}}},{id:lt.AddZoom,up:t=>({...t,zoomBrush:null})},{id:lt.AddVerticalAlign,up:t=>({...t,propsForNextShape:{...t.propsForNextShape,verticalAlign:"middle"}})},{id:lt.AddScribbleDelay,up:t=>t.scribble!==null?{...t,scribble:{...t.scribble,delay:0}}:{...t}},{id:lt.RemoveUserId,up:({userId:t,...e})=>e},{id:lt.AddIsPenModeAndIsGridMode,up:t=>({...t,isPenMode:!1,isGridMode:!1})},{id:lt.HoistOpacity,up:({propsForNextShape:{opacity:t,...e},...n})=>({...n,opacityForNextShape:Number(t??"1"),propsForNextShape:e})},{id:lt.AddChat,up:t=>({...t,chatMessage:"",isChatting:!1})},{id:lt.AddHighlightedUserIds,up:t=>({...t,highlightedUserIds:[]})},{id:lt.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:t,...e})=>({...e,stylesForNextShape:{}})},{id:lt.AddMeta,up:t=>({...t,meta:{}})},{id:lt.RemoveCursorColor,up:t=>{const{color:e,...n}=t.cursor;return{...t,cursor:n}}},{id:lt.AddLonelyProperties,up:t=>({...t,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:lt.ReadOnlyReadonly,up:({isReadOnly:t,...e})=>({...e,isReadonly:t})},{id:lt.AddHoveringCanvas,up:t=>({...t,isHoveringCanvas:null})},{id:lt.AddScribbles,up:({scribble:t,...e})=>({...e,scribbles:[]})},{id:lt.AddInset,up:t=>({...t,insets:[!1,!1,!1,!1]}),down:({insets:t,...e})=>({...e})},{id:lt.AddDuplicateProps,up:t=>({...t,duplicateProps:null}),down:({duplicateProps:t,...e})=>({...e})},{id:lt.RemoveCanMoveCamera,up:({canMoveCamera:t,...e})=>({...e}),down:t=>({...t,canMoveCamera:!0})}]}),hn="instance:instance",A9=eo("instance_page_state",Me({typeName:cn("instance_page_state"),id:Gn("instance_page_state"),pageId:Ec,selectedShapeIds:Kt(rr),hintingShapeIds:Kt(rr),erasingShapeIds:Kt(rr),hoveredShapeId:rr.nullable(),editingShapeId:rr.nullable(),croppingShapeId:rr.nullable(),focusedGroupId:rr.nullable(),meta:Wt})),Na=Rn("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),O9=Jn({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:Na.AddCroppingId,up(t){t.croppingShapeId=null}},{id:Na.RemoveInstanceIdAndCameraId,up(t){delete t.instanceId,delete t.cameraId}},{id:Na.AddMeta,up:t=>{t.meta={}}},{id:Na.RenameProperties,up:t=>{},down:t=>{}},{id:Na.RenamePropertiesAgain,up:t=>{t.selectedShapeIds=t.selectedIds,delete t.selectedIds,t.hintingShapeIds=t.hintingIds,delete t.hintingIds,t.erasingShapeIds=t.erasingIds,delete t.erasingIds,t.hoveredShapeId=t.hoveredId,delete t.hoveredId,t.editingShapeId=t.editingId,delete t.editingId,t.croppingShapeId=t.croppingShapeId??t.croppingId??null,delete t.croppingId,t.focusedGroupId=t.focusLayerId,delete t.focusLayerId},down:t=>{t.selectedIds=t.selectedShapeIds,delete t.selectedShapeIds,t.hintingIds=t.hintingShapeIds,delete t.hintingShapeIds,t.erasingIds=t.erasingShapeIds,delete t.erasingShapeIds,t.hoveredId=t.hoveredShapeId,delete t.hoveredShapeId,t.editingId=t.editingShapeId,delete t.editingShapeId,t.croppingId=t.croppingShapeId,delete t.croppingShapeId,t.focusLayerId=t.focusedGroupId,delete t.focusedGroupId}}]}),vr=Qr("instance_page_state",{validator:A9,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),D9=eo("pointer",Me({typeName:cn("pointer"),id:Gn("pointer"),x:ge,y:ge,lastActivityTimestamp:ge,meta:Wt})),$9=Rn("com.tldraw.pointer",{AddMeta:1}),R9=Jn({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:$9.AddMeta,up:t=>{t.meta={}}}]}),bS=Qr("pointer",{validator:D9,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),Eu=bS.createId("pointer"),L9=eo("instance_presence",Me({typeName:cn("instance_presence"),id:Gn("instance_presence"),userId:Se,userName:Se,lastActivityTimestamp:ge,followingUserId:Se.nullable(),cursor:Me({x:ge,y:ge,type:yI,rotation:ge}),color:Se,camera:Me({x:ge,y:ge,z:ge}),screenBounds:pc,selectedShapeIds:Kt(Gn("shape")),currentPageId:Gn("page"),brush:pc.nullable(),scribbles:Kt(SI),chatMessage:Se,meta:Wt})),Fa=Rn("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5}),N9=Jn({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:Fa.AddScribbleDelay,up:t=>{t.scribble!==null&&(t.scribble.delay=0)}},{id:Fa.RemoveInstanceId,up:t=>{delete t.instanceId}},{id:Fa.AddChatMessage,up:t=>{t.chatMessage=""}},{id:Fa.AddMeta,up:t=>{t.meta={}}},{id:Fa.RenameSelectedShapeIds,up:t=>{}}]}),F9=Qr("instance_presence",{validator:L9,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),z9=eo("document",Me({typeName:cn("document"),id:cn("document:document"),gridSize:ge,name:Se,meta:Wt})),u0=Rn("com.tldraw.document",{AddName:1,AddMeta:2}),B9=Jn({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:u0.AddName,up:t=>{t.name=""},down:t=>{delete t.name}},{id:u0.AddMeta,up:t=>{t.meta={}}}]}),wS=Qr("document",{validator:z9,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),om=wS.createId("document");function U9(t,e){return t.index<e.index?-1:t.index>e.index?1:0}function h0(t){t.typeName==="asset"&&("src"in t&&(t.src="<redacted>"),"src"in t.props&&(t.props.src="<redacted>"))}function H9({error:t,phase:e,record:n,recordBefore:r}){throw Ey(t,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:r?h0(ut(r)):void 0,recordAfter:h0(ut(n))}}),t}function j9(){return[Zn.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function K9(t){const e=t.query.ids("page"),n=t.query.records("instance_page_state"),r=()=>{if(!t.has(om))return t.put([wS.create({id:om,name:t.props.defaultName})]),r();if(!t.has(Eu))return t.put([bS.create({id:Eu})]),r();const o=e.get();if(o.size===0)return t.put(j9()),r();const i=()=>[...o].map(d=>t.get(d)).sort(U9)[0].id,s=t.get(hn);if(s){if(!o.has(s.currentPageId))return t.put([{...s,currentPageId:i()}]),r()}else return t.put([t.schema.types.instance.create({id:hn,currentPageId:i(),exportBackground:!0})]),r();const a=new Set,c=new Set;for(const d of o){const h=vr.createId(d);t.get(h)||a.add(h);const f=Ur.createId(d);t.has(f)||c.add(f)}a.size>0&&t.put([...a].map(d=>vr.create({id:d,pageId:vr.parseId(d)}))),c.size>0&&t.put([...c].map(d=>Ur.create({id:d})));const l=n.get();for(const d of l){if(!o.has(d.pageId)){t.remove([d.id]);continue}if(d.croppingShapeId&&!t.has(d.croppingShapeId))return t.put([{...d,croppingShapeId:null}]),r();if(d.focusedGroupId&&!t.has(d.focusedGroupId))return t.put([{...d,focusedGroupId:null}]),r();if(d.hoveredShapeId&&!t.has(d.hoveredShapeId))return t.put([{...d,hoveredShapeId:null}]),r();const h=d.selectedShapeIds.filter(g=>t.has(g));if(h.length!==d.selectedShapeIds.length)return t.put([{...d,selectedShapeIds:h}]),r();const p=d.hintingShapeIds.filter(g=>t.has(g));if(p.length!==d.hintingShapeIds.length)return t.put([{...d,hintingShapeIds:p}]),r();const f=d.erasingShapeIds.filter(g=>t.has(g));if(f.length!==d.erasingShapeIds.length)return t.put([{...d,erasingShapeIds:f}]),r()}};return r}const W9=vS("bookmark",Me({title:Se,description:Se,image:Se,favicon:Se,src:ji.nullable()})),p0=Rn("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),G9=Jn({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:t=>t.type==="bookmark",sequence:[{id:p0.MakeUrlsValid,up:t=>{ji.isValid(t.props.src)||(t.props.src="")},down:t=>{}},{id:p0.AddFavicon,up:t=>{ji.isValid(t.props.favicon)||(t.props.favicon="")},down:t=>{delete t.props.favicon}}]}),V9=vS("image",Me({w:ge,h:ge,name:Se,isAnimated:Te,mimeType:Se.nullable(),src:ji.nullable(),fileSize:Ct.optional()})),za=Rn("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),Y9=Jn({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:t=>t.type==="image",sequence:[{id:za.AddIsAnimated,up:t=>{t.props.isAnimated=!1},down:t=>{delete t.props.isAnimated}},{id:za.RenameWidthHeight,up:t=>{t.props.w=t.props.width,t.props.h=t.props.height,delete t.props.width,delete t.props.height},down:t=>{t.props.width=t.props.w,t.props.height=t.props.h,delete t.props.w,delete t.props.h}},{id:za.MakeUrlsValid,up:t=>{ji.isValid(t.props.src)||(t.props.src="")},down:t=>{}},{id:za.AddFileSize,up:t=>{t.props.fileSize=-1},down:t=>{delete t.props.fileSize}},{id:za.MakeFileSizeOptional,up:t=>{t.props.fileSize===-1&&(t.props.fileSize=void 0)},down:t=>{t.props.fileSize===void 0&&(t.props.fileSize=-1)}}]}),X9=vS("video",Me({w:ge,h:ge,name:Se,isAnimated:Te,mimeType:Se.nullable(),src:ji.nullable(),fileSize:ge.optional()})),Ba=Rn("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),q9=Jn({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:t=>t.type==="video",sequence:[{id:Ba.AddIsAnimated,up:t=>{t.props.isAnimated=!1},down:t=>{delete t.props.isAnimated}},{id:Ba.RenameWidthHeight,up:t=>{t.props.w=t.props.width,t.props.h=t.props.height,delete t.props.width,delete t.props.height},down:t=>{t.props.width=t.props.w,t.props.height=t.props.h,delete t.props.w,delete t.props.h}},{id:Ba.MakeUrlsValid,up:t=>{ji.isValid(t.props.src)||(t.props.src="")},down:t=>{}},{id:Ba.AddFileSize,up:t=>{t.props.fileSize=-1},down:t=>{delete t.props.fileSize}},{id:Ba.MakeFileSizeOptional,up:t=>{t.props.fileSize===-1&&(t.props.fileSize=void 0)},down:t=>{t.props.fileSize===void 0&&(t.props.fileSize=-1)}}]}),Z9=eo("asset",mS("type",{image:V9,video:X9,bookmark:W9})),J9=Rn("com.tldraw.asset",{AddMeta:1}),Q9=Jn({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:J9.AddMeta,up:t=>{t.meta={}}}]}),qo=Qr("asset",{validator:Z9,scope:"document"}).withDefaultProperties(()=>({meta:{}})),bI={w:Ct,h:Ct,assetId:Ph.nullable(),url:Xn},f0=kr("bookmark",{NullAssetId:1,MakeUrlsValid:2}),wI={sequence:[{id:f0.NullAssetId,up:t=>{t.assetId===void 0&&(t.assetId=null)},down:"retired"},{id:f0.MakeUrlsValid,up:t=>{Xn.isValid(t.url)||(t.url="")},down:t=>{}}]},_I=Me({type:xh("free","straight"),points:Kt(Ki)}),xI={color:qn,fill:Gi,dash:Wi,size:Yr,segments:Kt(_I),isComplete:Te,isClosed:Te,isPen:Te,scale:Ct},g0=kr("draw",{AddInPen:1,AddScale:2}),PI={sequence:[{id:g0.AddInPen,up:t=>{const{points:e}=t.segments[0];if(e.length===0){t.isPen=!1;return}let n=!(e[0].z===0||e[0].z===.5);e[1]&&(n=n&&!(e[1].z===0||e[1].z===.5)),t.isPen=n},down:"retired"},{id:g0.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},e7=/(^\/r\/[^/]+\/?$)/,t7=[{hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],fromEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(e7))return t}},{hostnames:["figma.com"],fromEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/^\/embed\/?$/)){const n=e.searchParams.get("url");if(n)return n}}},{hostnames:["google.*"],fromEmbedUrl:t=>{const e=ye(t);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom"),[o,i]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${o},${i},${r}z`}}},{hostnames:["val.town"],fromEmbedUrl:t=>{const e=ye(t),n=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{hostnames:["codesandbox.io"],fromEmbedUrl:t=>{const e=ye(t),n=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{hostnames:["codepen.io"],fromEmbedUrl:t=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,n=t.match(e);if(n){const[r,o,i]=n;return`https://codepen.io/${o}/pen/${i}`}}},{hostnames:["scratch.mit.edu"],fromEmbedUrl:t=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,n=t.match(e);if(n){const[r,o]=n;return`https://scratch.mit.edu/projects/${o}`}}},{hostnames:["*.youtube.com","youtube.com","youtu.be"],fromEmbedUrl:t=>{const e=ye(t);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r)return`https://www.youtube.com/watch?v=${r[1]}`}}},{hostnames:["calendar.google.*"],fromEmbedUrl:t=>{const e=ye(t),n=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&n){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const o of r)e.searchParams.delete(o);return e.searchParams.set("cid",n),e.href}}},{hostnames:["docs.google.*"],fromEmbedUrl:t=>{const e=ye(t);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const n=Array.from(e.searchParams.keys());for(const r of n)e.searchParams.delete(r);return e.href}}},{hostnames:["gist.github.com"],fromEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return t.split("/").pop()?t:void 0}},{hostnames:["replit.com"],fromEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{hostnames:["felt.com"],fromEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{hostnames:["open.spotify.com"],fromEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{hostnames:["vimeo.com","player.vimeo.com"],fromEmbedUrl:t=>{const e=ye(t);if(e&&e.hostname==="player.vimeo.com"){const n=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(n)return"https://vimeo.com/"+n[1]}}},{hostnames:["excalidraw.com"],fromEmbedUrl:t=>{const e=ye(t);if(e&&e.hash.match(/#room=/))return t}},{hostnames:["observablehq.com"],fromEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{hostnames:["desmos.com"],fromEmbedUrl:t=>{const e=ye(t);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return t.replace("?embed","")}}],II={w:Ct,h:Ct,url:Se},Rl=kr("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),CI={sequence:[{id:Rl.GenOriginalUrlInEmbed,up:t=>{try{const e=t.url,n=new URL(e).host.replace("www.","");let r;for(const o of t7)if(o.hostnames.includes(n))try{r=o.fromEmbedUrl(e)}catch(i){console.warn(i)}t.tmpOldUrl=t.url,t.url=r??""}catch{t.url="",t.tmpOldUrl=t.url}},down:"retired"},{id:Rl.RemoveDoesResize,up:t=>{delete t.doesResize},down:"retired"},{id:Rl.RemoveTmpOldUrl,up:t=>{delete t.tmpOldUrl},down:"retired"},{id:Rl.RemovePermissionOverrides,up:t=>{delete t.overridePermissions},down:"retired"}]},EI={w:Ct,h:Ct,name:Se},TI={sequence:[]},Tu=Yt.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),ku=Yt.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),br=Yt.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),kI={geo:br,labelColor:dI,color:qn,fill:Gi,dash:Wi,size:Yr,font:Vr,align:Tu,verticalAlign:ku,url:Xn,w:Ct,h:Ct,growY:_u,text:Se,scale:Ct},co=kr("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9}),MI={sequence:[{id:co.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:co.AddLabelColor,up:t=>{t.labelColor="black"},down:"retired"},{id:co.RemoveJustify,up:t=>{t.align==="justify"&&(t.align="start")},down:"retired"},{id:co.AddCheckBox,up:t=>{},down:"retired"},{id:co.AddVerticalAlign,up:t=>{t.verticalAlign="middle"},down:"retired"},{id:co.MigrateLegacyAlign,up:t=>{let e;switch(t.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}t.align=e},down:"retired"},{id:co.AddCloud,up:t=>{},down:"retired"},{id:co.MakeUrlsValid,up:t=>{Xn.isValid(t.url)||(t.url="")},down:t=>{}},{id:co.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},AI={},OI={sequence:[]},DI={color:qn,size:Yr,segments:Kt(_I),isComplete:Te,isPen:Te,scale:Ct},n7=kr("highlight",{AddScale:1}),$I={sequence:[{id:n7.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},r7=Me({topLeft:Ki,bottomRight:Ki}),RI={w:Ct,h:Ct,playing:Te,url:Xn,assetId:Ph.nullable(),crop:r7.nullable(),flipX:Te,flipY:Te},Ll=kr("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4}),LI={sequence:[{id:Ll.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:Ll.AddCropProp,up:t=>{t.crop=null},down:t=>{delete t.crop}},{id:Ll.MakeUrlsValid,up:t=>{Xn.isValid(t.url)||(t.url="")},down:t=>{}},{id:Ll.AddFlipProps,up:t=>{t.flipX=!1,t.flipY=!1},down:t=>{delete t.flipX,delete t.flipY}}]},Mu=Yt.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),o7=Me({id:Se,index:SS,x:ge,y:ge}),NI={color:qn,dash:Wi,size:Yr,spline:Mu,points:xu(Se,o7),scale:Ct},Ua=kr("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),FI={sequence:[{id:Ua.AddSnapHandles,up:t=>{for(const e of Object.values(t.handles))e.canSnap=!0},down:"retired"},{id:Ua.RemoveExtraHandleProps,up:t=>{t.handles=gx(Object.values(t.handles).map(e=>[e.index,{x:e.x,y:e.y}]))},down:t=>{const e=Object.entries(t.handles).map(([n,r])=>({index:n,...r})).sort(nn);t.handles=Object.fromEntries(e.map((n,r)=>{const o=r===0?"start":r===e.length-1?"end":`handle:${n.index}`;return[o,{id:o,type:"vertex",canBind:!1,canSnap:!0,index:n.index,x:n.x,y:n.y}]}))}},{id:Ua.HandlesToPoints,up:t=>{const e=Object.entries(t.handles).map(([n,{x:r,y:o}])=>({x:r,y:o,index:n})).sort(nn);t.points=e.map(({x:n,y:r})=>({x:n,y:r})),delete t.handles},down:t=>{const e=Ic(t.points.length);t.handles=Object.fromEntries(t.points.map((n,r)=>[e[r],{x:n.x,y:n.y}])),delete t.points}},{id:Ua.PointIndexIds,up:t=>{const e=Ic(t.points.length);t.points=Object.fromEntries(t.points.map((n,r)=>{const o=e[r];return[o,{id:o,index:o,x:n.x,y:n.y}]}))},down:t=>{const e=Object.values(t.points).sort(nn);t.points=e.map(({x:n,y:r})=>({x:n,y:r}))}},{id:Ua.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},zI={color:qn,size:Yr,font:Vr,fontSizeAdjustment:_u,align:Tu,verticalAlign:ku,growY:_u,url:Xn,text:Se,scale:Ct},Mi=kr("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7}),BI={sequence:[{id:Mi.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:Mi.RemoveJustify,up:t=>{t.align==="justify"&&(t.align="start")},down:"retired"},{id:Mi.MigrateLegacyAlign,up:t=>{switch(t.align){case"start":t.align="start-legacy";return;case"end":t.align="end-legacy";return;default:t.align="middle-legacy";return}},down:"retired"},{id:Mi.AddVerticalAlign,up:t=>{t.verticalAlign="middle"},down:"retired"},{id:Mi.MakeUrlsValid,up:t=>{Xn.isValid(t.url)||(t.url="")},down:t=>{}},{id:Mi.AddFontSizeAdjustment,up:t=>{t.fontSizeAdjustment=0},down:t=>{delete t.fontSizeAdjustment}},{id:Mi.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},im=Yt.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),UI={color:qn,size:Yr,font:Vr,textAlign:im,w:Ct,text:Se,scale:Ct,autoSize:Te},m0=kr("text",{RemoveJustify:1,AddTextAlign:2}),HI={sequence:[{id:m0.RemoveJustify,up:t=>{t.align==="justify"&&(t.align="start")},down:"retired"},{id:m0.AddTextAlign,up:t=>{t.textAlign=t.align,delete t.align},down:t=>{t.align=t.textAlign,delete t.textAlign}}]},jI={w:Ct,h:Ct,time:ge,playing:Te,url:Xn,assetId:Ph.nullable()},y0=kr("video",{AddUrlProp:1,MakeUrlsValid:2}),KI={sequence:[{id:y0.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:y0.MakeUrlsValid,up:t=>{Xn.isValid(t.url)||(t.url="")},down:t=>{}}]},Nl=Rn("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),i7=zs({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:Nl.RemoveCodeAndIconShapeTypes,scope:"store",up:t=>{for(const[e,n]of Dn(t))n.typeName==="shape"&&(n.type==="icon"||n.type==="code")&&delete t[e]}},{id:Nl.AddInstancePresenceType,scope:"store",up(t){}},{id:Nl.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:t=>{for(const[e,n]of Dn(t))n.typeName.match(/^(user|user_presence)$/)&&delete t[e]}},{id:Nl.RemoveUserDocument,scope:"store",up:t=>{for(const[e,n]of Dn(t))n.typeName.match("user_document")&&delete t[e]}}]}),s7={arrow:{migrations:fI,props:pI},bookmark:{migrations:wI,props:bI},draw:{migrations:PI,props:xI},embed:{migrations:CI,props:II},frame:{migrations:TI,props:EI},geo:{migrations:MI,props:kI},group:{migrations:OI,props:AI},highlight:{migrations:$I,props:DI},image:{migrations:LI,props:RI},line:{migrations:FI,props:NI},note:{migrations:BI,props:zI},text:{migrations:HI,props:UI},video:{migrations:KI,props:jI}},a7={arrow:{migrations:mI,props:gI}};function c7({shapes:t=s7,bindings:e=a7,migrations:n}={}){const r=new Map;for(const a of gt(t))for(const c of aI(a.props??{}).keys()){if(r.has(c.id)&&r.get(c.id)!==c)throw new Error(`Multiple StyleProp instances with the same id: ${c.id}`);r.set(c.id,c)}const o=m9(t),i=p9(e),s=k9(r);return fS.create({asset:qo,binding:i,camera:Ur,document:wS,instance:s,instance_page_state:vr,page:Zn,instance_presence:F9,pointer:bS,shape:o},{migrations:[i7,Q9,v9,B9,M9,O9,E9,N9,R9,g9,G9,Y9,q9,...d0("shape",t),...d0("binding",e),...n??[]],onValidationFailure:H9,createIntegrityChecker:K9})}const Tc=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ca",label:"Català"},{locale:"cs",label:"Čeština"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Español"},{locale:"fr",label:"Français"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Português - Brasil"},{locale:"pt-pt",label:"Português - Europeu"},{locale:"ro",label:"Română"},{locale:"ru",label:"Russian"},{locale:"sl",label:"Slovenščina"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Tiếng Việt"},{locale:"tr",label:"Türkçe"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:"עברית"},{locale:"ar",label:"عربي"},{locale:"fa",label:"فارسی"},{locale:"ku",label:"کوردی"},{locale:"ne",label:"नेपाली"},{locale:"hi-in",label:"हिन्दी"},{locale:"te",label:"తెలుగు"},{locale:"th",label:"ภาษาไทย"},{locale:"my",label:"မြန်မာစာ"},{locale:"ko-kr",label:"한국어"},{locale:"ja",label:"日本語"},{locale:"zh-cn",label:"简体中文"},{locale:"zh-tw",label:"繁體中文 (台灣)"}];function l7(){const t=typeof window<"u"?window.navigator.languages??["en"]:["en"];return d7(t)}function d7(t){for(const e of t){const n=u7(e);if(n)return n}return"en"}const S0={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function u7(t){const e=Tc.find(o=>o.locale===t.toLowerCase());if(e)return e.locale;const[n,r]=t.split(/[-_]/).map(o=>o.toLowerCase());if(r){const o=Tc.find(i=>i.locale===n);if(o)return o.locale}return n in S0?S0[n]:null}fi("@tldraw/tlschema","3.3.1","esm");var WI={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function n(){for(var i="",s=0;s<arguments.length;s++){var a=arguments[s];a&&(i=o(i,r(a)))}return i}function r(i){if(typeof i=="string"||typeof i=="number")return i;if(typeof i!="object")return"";if(Array.isArray(i))return n.apply(null,i);if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]"))return i.toString();var s="";for(var a in i)e.call(i,a)&&i[a]&&(s=o(s,a));return s}function o(i,s){return s?i?i+" "+s:i+s:i}t.exports?(n.default=n,t.exports=n):window.classNames=n})()})(WI);var h7=WI.exports;const de=ts(h7),GI="3.3.1",v0={major:"2024-09-13T14:36:29.063Z",minor:"2024-10-09T10:22:00.866Z",patch:"2024-10-10T14:19:06.977Z"},p7={error:null};class _S extends ar{constructor(){super(...arguments);P(this,"state",p7)}static getDerivedStateFromError(n){return{error:n}}componentDidCatch(n){var r,o;(o=(r=this.props).onError)==null||o.call(r,n)}render(){const{error:n}=this.state;if(n!==null){const{fallback:r}=this.props;return u(r,{error:n})}return this.props.children}}function kc({children:t,fallback:e,...n}){return e===null?t:u(_S,{fallback:e,...n,children:t})}const Xc=Ze(null);function F(){const t=we.useContext(Xc);if(!t)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return t}function xS(){return we.useContext(Xc)}function f7(){return u("div",{className:"tl-background"})}function Sa(t,e,n,r,o,i){je(()=>{const s=t.current;if(!s||e===void 0)return;let a=`translate(${e}px, ${n}px)`;r!==void 0&&(a+=` scale(${r})`),o!==void 0&&(a+=` rotate(${o}rad)`),i&&(a+=` translate(${i.x}px, ${i.y}px)`),s.style.transform=a})}const Rt={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:-1+(4-2*t)*t,easeInCubic:t=>t*t*t,easeOutCubic:t=>--t*t*t+1,easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1- --t*t*t*t,easeInOutQuart:t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1+--t*t*t*t*t,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInExpo:t=>t<=0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t>=1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t<=0?0:t>=1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2};class b{constructor(e=0,n=0,r=1){this.x=e,this.y=n,this.z=r}get pressure(){return this.z}set(e=this.x,n=this.y,r=this.z){return this.x=e,this.y=n,this.z=r,this}setTo({x:e=0,y:n=0,z:r=1}){return this.x=e,this.y=n,this.z=r,this}rot(e){if(e===0)return this;const{x:n,y:r}=this,o=Math.sin(e),i=Math.cos(e);return this.x=n*i-r*o,this.y=n*o+r*i,this}rotWith(e,n){if(n===0)return this;const r=this.x-e.x,o=this.y-e.y,i=Math.sin(n),s=Math.cos(n);return this.x=e.x+(r*s-o*i),this.y=e.y+(r*i+o*s),this}clone(){const{x:e,y:n,z:r}=this;return new b(e,n,r)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,n){return this.x-=e,this.y-=n,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,n){return this.x+=e,this.y+=n,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,n){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),n!==void 0&&(this.x=Math.min(this.x,n),this.y=Math.min(this.y,n)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,n){const r=b.Tan(e,this);return this.add(r.mul(n))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return b.Dpr(this,e)}cpr(e){return b.Cpr(this,e)}len2(){return b.Len2(this)}len(){return b.Len(this)}pry(e){return b.Pry(this,e)}per(){const{x:e,y:n}=this;return this.x=n,this.y=-e,this}uni(){return b.Uni(this)}tan(e){return b.Tan(this,e)}dist(e){return b.Dist(this,e)}distanceToLineSegment(e,n){return b.DistanceToLineSegment(e,n,this)}slope(e){return b.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return b.Angle(this,e)}toAngle(){return b.ToAngle(this)}lrp(e,n){return this.x=this.x+(e.x-this.x)*n,this.y=this.y+(e.y-this.y)*n,this}equals(e){return b.Equals(this,e)}equalsXY(e,n){return b.EqualsXY(this,e,n)}norm(){const e=this.len();return this.x=e===0?0:this.x/e,this.y=e===0?0:this.y/e,this}toFixed(){return b.ToFixed(this)}toString(){return b.ToString(b.ToFixed(this))}toJson(){return b.ToJson(this)}toArray(){return b.ToArray(this)}static Add(e,n){return new b(e.x+n.x,e.y+n.y)}static AddXY(e,n,r){return new b(e.x+n,e.y+r)}static Sub(e,n){return new b(e.x-n.x,e.y-n.y)}static SubXY(e,n,r){return new b(e.x-n,e.y-r)}static AddScalar(e,n){return new b(e.x+n,e.y+n)}static SubScalar(e,n){return new b(e.x-n,e.y-n)}static Div(e,n){return new b(e.x/n,e.y/n)}static Mul(e,n){return new b(e.x*n,e.y*n)}static DivV(e,n){return new b(e.x/n.x,e.y/n.y)}static MulV(e,n){return new b(e.x*n.x,e.y*n.y)}static Neg(e){return new b(-e.x,-e.y)}static Per(e){return new b(e.y,-e.x)}static Abs(e){return new b(Math.abs(e.x),Math.abs(e.y))}static Dist(e,n){return((e.y-n.y)**2+(e.x-n.x)**2)**.5}static DistMin(e,n,r){return(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y)<r**2}static Dist2(e,n){return(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y)}static Dpr(e,n){return e.x*n.x+e.y*n.y}static Cross(e,n){return new b(e.y*n.z-e.z*n.y,e.z*n.x-e.x*n.z)}static Cpr(e,n){return e.x*n.y-n.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,n){return b.Dpr(e,n)/b.Len(n)}static Uni(e){return b.Div(e,b.Len(e))}static Tan(e,n){return b.Uni(b.Sub(e,n))}static Min(e,n){return new b(Math.min(e.x,n.x),Math.min(e.y,n.y))}static Max(e,n){return new b(Math.max(e.x,n.x),Math.max(e.y,n.y))}static From({x:e,y:n,z:r=1}){return new b(e,n,r)}static FromArray(e){return new b(e[0],e[1])}static Rot(e,n=0){const r=Math.sin(n),o=Math.cos(n);return new b(e.x*o-e.y*r,e.x*r+e.y*o)}static RotWith(e,n,r){const o=e.x-n.x,i=e.y-n.y,s=Math.sin(r),a=Math.cos(r);return new b(n.x+(o*a-i*s),n.y+(o*s+i*a))}static NearestPointOnLineThroughPoint(e,n,r){return b.Mul(n,b.Sub(r,e).pry(n)).add(e)}static NearestPointOnLineSegment(e,n,r,o=!0){if(b.Equals(e,r)||b.Equals(n,r))return b.From(r);const i=b.Tan(n,e),s=b.Add(e,b.Mul(i,b.Sub(r,e).pry(i)));if(o){if(s.x<Math.min(e.x,n.x))return b.Cast(e.x<n.x?e:n);if(s.x>Math.max(e.x,n.x))return b.Cast(e.x>n.x?e:n);if(s.y<Math.min(e.y,n.y))return b.Cast(e.y<n.y?e:n);if(s.y>Math.max(e.y,n.y))return b.Cast(e.y>n.y?e:n)}return s}static DistanceToLineThroughPoint(e,n,r){return b.Dist(r,b.NearestPointOnLineThroughPoint(e,n,r))}static DistanceToLineSegment(e,n,r,o=!0){return b.Dist(r,b.NearestPointOnLineSegment(e,n,r,o))}static Snap(e,n=1){return new b(Math.round(e.x/n)*n,Math.round(e.y/n)*n)}static Cast(e){return e instanceof b?e:b.From(e)}static Slope(e,n){return e.x===n.y?NaN:(e.y-n.y)/(e.x-n.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,n){return Math.atan2(n.y-e.y,n.x-e.x)}static Lrp(e,n,r){return b.Sub(n,e).mul(r).add(e)}static Med(e,n){return new b((e.x+n.x)/2,(e.y+n.y)/2)}static Equals(e,n){return Math.abs(e.x-n.x)<1e-4&&Math.abs(e.y-n.y)<1e-4}static EqualsXY(e,n,r){return e.x===n&&e.y===r}static Clockwise(e,n,r){return(r.x-e.x)*(n.y-e.y)-(n.x-e.x)*(r.y-e.y)<0}static Rescale(e,n){const r=b.Len(e);return new b(n*e.x/r,n*e.y/r)}static ScaleWithOrigin(e,n,r){return b.Sub(e,r).mul(n).add(r)}static ToFixed(e){return new b(mo(e.x),mo(e.y))}static ToInt(e){return new b(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,n,r){return b.Add(e,b.Tan(n,e).mul(r))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let n=Math.atan2(e.y,e.x);return n<0&&(n+=Math.PI*2),n}static FromAngle(e,n=1){return new b(Math.cos(e)*n,Math.sin(e)*n)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:n,y:r,z:o}=e;return{x:n,y:r,z:o}}static Average(e){const n=e.length,r=new b(0,0);if(n===0)return r;for(let o=0;o<n;o++)r.add(e[o]);return r.div(n)}static Clamp(e,n,r){return r===void 0?new b(Math.min(Math.max(e.x,n)),Math.min(Math.max(e.y,n))):new b(Math.min(Math.max(e.x,n),r),Math.min(Math.max(e.y,n),r))}static PointsBetween(e,n,r=6){const o=[];for(let i=0;i<r;i++){const s=Rt.easeInQuad(i/(r-1)),a=b.Lrp(e,n,s);a.z=Math.min(1,.5+Math.abs(.5-g7(s))*.65),o.push(a)}return o}static SnapToGrid(e,n=8){return new b(Math.round(e.x/n)*n,Math.round(e.y/n)*n)}}const g7=t=>t<.5?2*t*t:-1+(4-2*t)*t;function Fe(t){return`${N(t.x)},${N(t.y)} `}function Cn(t,e){return`${N((t.x+e.x)/2)},${N((t.y+e.y)/2)} `}const ze=Math.PI,it=ze/2,Ve=ze*2,m7=Math.sin;function Bt(t,e,n){return Math.max(e,typeof n<"u"?Math.min(t,n):t)}function Fl(t,e=1e10){return t?Math.round(t*e)/e:0}function oi(t,e,n=1e-6){return Math.abs(t-e)<=n}function VI(t,e){const n=Math.pow(t-e,2)/Math.pow(t+e,2);return ze*(t+e)*(1+3*n/(10+Math.sqrt(4-3*n)))}function ii(t){return t=t%Ve,t<0?t=t+Ve:t===0&&(t=0),t}function qc(t,e){return t=ii(t),e=ii(e),t>e&&(e+=Ve),e-t}function YI(t,e){return Ve-qc(t,e)}function xd(t,e){const n=(e-t)%Ve;return 2*n%Ve-n}function sm(t){return(Ve+t)%Ve}function Au(t,e){const n=Ve/e;let r=Math.floor((sm(t)+n/2)/n)*n%Ve;return r<ze&&(r+=Ve),r>ze&&(r-=Ve),r}function XI(t,e){return t===e||oi(t%(Math.PI/2)-e%(Math.PI/2),0)}function y7(t){return t*ze/180}function S7(t){return t*180/ze}function Vi(t,e,n){return new b(t.x,t.y).add(b.FromAngle(n,e))}function uf(t,e,n){const r=t/2,o=e/2,i=[];let s=1/0,a=-1/0,c=1/0,l=-1/0;for(let g=0;g<n;g++){const m=Ve/n,y=-it+g*m,S=r+r*Math.cos(y),v=o+o*Math.sin(y);S<s&&(s=S),v<c&&(c=v),S>a&&(a=S),v>l&&(l=v),i.push(new b(S,v))}const d=a-s,h=l-c,p=t-d,f=e-h;if(p!==0||f!==0)for(let g=0;g<i.length;g++){const m=i[g];m.x=(m.x-s)/d*t,m.y=(m.y-c)/h*e}return i}function Ha(t,e,n,r){return t<r&&n<e}function gr(t,e,n,r){const o=Math.max(t,n),i=Math.min(e,r);return o<=i?[o,i]:null}function b0(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}function Vn(t,e){let n=0,r,o;for(let i=0;i<e.length;i++){if(r=e[i],r.x===t.x&&r.y===t.y||(o=e[(i+1)%e.length],b.Dist(t,r)+b.Dist(t,o)===b.Dist(r,o)))return!0;r.y<=t.y?o.y>t.y&&b0(r,o,t)>0&&(n+=1):o.y<=t.y&&b0(r,o,t)<0&&(n-=1)}return n!==0}function N(t){return Math.round(t*1e4)/1e4}function mo(t){return Math.round(t*100)/100}const w0=t=>Math.abs(t)<Number.MAX_SAFE_INTEGER;function Zo(t,e,n){return n<0?qc(t,e):YI(t,e)}function am(t,e,n,r){let o;if(Math.abs(t)>ze){o=xd(e,r);const i=xd(r,n);return Math.abs(o)<Math.abs(i)?o/t:(t-i)/t}else{o=xd(e,r);const i=o/t;return Math.sign(o)!==Math.sign(t)?Math.abs(i)>.5?1:0:i}}function v7(t,e,n,r){const o=2*((e-t)%Ve)%Ve-(e-t)%Ve;return r?(Ve-Math.abs(o))*(n?1:-1):o}function PS(t,e,n){const r=-2*(t.x*(e.y-n.y)-t.y*(e.x-n.x)+e.x*n.y-n.x*e.y),o=((t.x*t.x+t.y*t.y)*(n.y-e.y)+(e.x*e.x+e.y*e.y)*(t.y-n.y)+(n.x*n.x+n.y*n.y)*(e.y-t.y))/r,i=((t.x*t.x+t.y*t.y)*(e.x-n.x)+(e.x*e.x+e.y*e.y)*(n.x-t.x)+(n.x*n.x+n.y*n.y)*(t.x-e.x))/r;return!Number.isFinite(o)||!Number.isFinite(i)?null:new b(o,i)}function b7(t,e,n,r,o){if(n===null)return[b.From(t),b.From(e)];const i=[],s=b.Angle(n,t),a=b.Angle(n,e),c=qc(s,a);for(let l=0;l<o;l++){const d=l/(o-1),h=s+c*d,p=Vi(n,r,h);i.push(p)}return i}const hf=({brush:t,color:e,opacity:n,className:r})=>{const o=B(null);Sa(o,t.x,t.y);const i=N(Math.max(1,t.w)),s=N(Math.max(1,t.h));return u("svg",{className:"tl-overlays__item",ref:o,children:e?u("g",{className:"tl-brush",opacity:n,children:[u("rect",{width:i,height:s,fill:e,opacity:.75}),u("rect",{width:i,height:s,fill:"none",stroke:e,opacity:.1})]}):u("rect",{className:`tl-brush tl-brush__default ${r}`,width:i,height:s})})},et={isSafari:!1,isIos:!1,isChromeForIos:!1,isFirefox:!1,isAndroid:!1,isWebview:!1,isDarwin:!1};typeof window<"u"&&"navigator"in window&&(et.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),et.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),et.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),et.isFirefox=/firefox/i.test(navigator.userAgent),et.isAndroid=/android/i.test(navigator.userAgent),et.isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1);const _0={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.1,.25,.5,1,2,4,8]},pf={duration:0,easing:Rt.easeInOutCubic},x0={CAMERA_MOVE:-10},w7=["top","right","bottom","left"],P0=0,IS=2,zl=1,I0=5,_7=128;var ff={};const x7={},qI=wn("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),Pt={logPreventDefaults:wn("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:wn("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:wn("logElementRemoves",{defaults:{all:!1}}),debugSvg:wn("debugSvg",{defaults:{all:!1}}),showFps:wn("showFps",{defaults:{all:!1}}),measurePerformance:wn("measurePerformance",{defaults:{all:!1}}),throwToBlob:wn("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:wn("reconnectOnPing",{defaults:{all:!1}}),debugCursors:wn("debugCursors",{defaults:{all:!1}}),forceSrgb:wn("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:wn("debugGeometry",{defaults:{all:!1}}),hideShapes:wn("hideShapes",{defaults:{all:!1}}),editOnType:wn("editOnType",{defaults:{all:!1}})};if(typeof Element<"u"){const t=Element.prototype.removeChild;xo("element removal logging",()=>{Pt.logElementRemoves.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),t.call(this,e)}:Element.prototype.removeChild=t})}function wn(t,{defaults:e,shouldStoreForSession:n=!0}){return P7({name:t,defaults:e,shouldStoreForSession:n})}function P7(t){const e=C7(t),n=t.shouldStoreForSession?I7(t.name):null,r=Tt(`debug:${t.name}`,n??e);return typeof window<"u"&&(t.shouldStoreForSession&&xo(`debug:${t.name}`,()=>{const o=r.get();o===e?Mx(`tldraw_debug:${t.name}`):$y(`tldraw_debug:${t.name}`,JSON.stringify(o))}),Object.defineProperty(window,`tldraw${t.name.replace(/^[a-z]/,o=>o.toUpperCase())}`,{get(){return r.get()},set(o){r.set(o)},configurable:!0})),Object.assign(r,t)}function I7(t){try{return JSON.parse(kx(`tldraw_debug:${t}`)??"null")}catch{return null}}function gf(t){try{return t()}catch{return null}}function C7(t){switch(gf(()=>ff.TLDRAW_ENV)??gf(()=>ff.VERCEL_PUBLIC_TLDRAW_ENV)??gf(()=>ff.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return t.defaults.production??t.defaults.all;case"preview":case"staging":return t.defaults.staging??t.defaults.all;default:return t.defaults.development??t.defaults.all}}function Ou(t){if(t instanceof HTMLElement)return t;if(t.parentElement)return Ou(t.parentElement);throw Error("Could not find a parent element of an HTML type!")}function Ce(t){t.preventDefault(),Pt.logPreventDefaults.get()&&console.warn("preventDefault called on event:",t)}function Zc(t,e){if(t.setPointerCapture(e.pointerId),Pt.logPointerCaptures.get()){const n=qI.get();n.set(t,(n.get(t)??0)+1),console.warn("setPointerCapture called on element:",t,e)}}function Jc(t,e){if(t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),Pt.logPointerCaptures.get())){const n=qI.get();n.get(t)===1?n.delete(t):n.has(t)?n.set(t,n.get(t)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",t,e)}}const Mt=t=>t.stopPropagation(),Jt=(t,e,n)=>{t&&t.style.setProperty(e,n)},rn=t=>et.isDarwin?t.metaKey:t.ctrlKey||t.metaKey;function Mn(t){return t.isKilled=!0,{point:{x:t.clientX,y:t.clientY,z:t.pressure},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,metaKey:t.metaKey,accelKey:rn(t),pointerId:t.pointerId,button:t.button,isPen:t.pointerType==="pen"}}function ZI(){const t=F();return ce(function(){let r,o;function i(m){if(!m.isKilled){if(m.button===IS){t.dispatch({type:"pointer",target:"canvas",name:"right_click",...Mn(m)});return}m.button!==0&&m.button!==1&&m.button!==5||(Zc(m.currentTarget,m),t.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...Mn(m)}))}}function s(m){m.isKilled||m.clientX===r&&m.clientY===o||(r=m.clientX,o=m.clientY,t.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...Mn(m)}))}function a(m){m.isKilled||m.button!==0&&m.button!==1&&m.button!==2&&m.button!==5||(r=m.clientX,o=m.clientY,Jc(m.currentTarget,m),t.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...Mn(m)}))}function c(m){if(m.isKilled||t.getInstanceState().isPenMode&&m.pointerType!=="pen")return;const y=m.pointerType==="mouse"||m.pointerType==="pen";t.updateInstanceState({isHoveringCanvas:y?!0:null})}function l(m){if(m.isKilled||t.getInstanceState().isPenMode&&m.pointerType!=="pen")return;const y=m.pointerType==="mouse"||m.pointerType==="pen";t.updateInstanceState({isHoveringCanvas:y?!1:null})}function d(m){m.isKilled=!0,Ce(m)}function h(m){m.isKilled=!0,m.target instanceof HTMLElement&&m.target.tagName!=="A"&&m.target.tagName!=="TEXTAREA"&&!(t.getEditingShape()&&m.target.className.includes("tl-text-content"))&&Ce(m)}function p(m){Ce(m)}async function f(m){var S,v;if(Ce(m),Mt(m),!((v=(S=m.dataTransfer)==null?void 0:S.files)!=null&&v.length))return;const y=Array.from(m.dataTransfer.files);await t.putExternalContent({type:"files",files:y,point:t.screenToPage({x:m.clientX,y:m.clientY}),ignoreParent:!1})}function g(m){Mt(m)}return{onPointerDown:i,onPointerMove:s,onPointerUp:a,onPointerEnter:c,onPointerLeave:l,onDragOver:p,onDrop:f,onTouchStart:d,onTouchEnd:h,onClick:g}},[t])}function E7(){const t=F();q(()=>{let e=t.getInstanceState().isCoarsePointer;const n=s=>{const a=s.pointerType!=="mouse";e!==a&&(e=a,t.updateInstanceState({isCoarsePointer:a}))};window.addEventListener("pointerdown",n,{capture:!0});const r=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),o=et.isFirefox&&!et.isAndroid&&!et.isIos,i=()=>{const s=o?!1:r.matches;e===s&&(e=s,t.updateInstanceState({isCoarsePointer:s}))};return r&&(r.addEventListener("change",i),i()),()=>{window.removeEventListener("pointerdown",n,{capture:!0}),r&&r.removeEventListener("change",i)}},[t])}const JI=Ze(null);function T7({container:t,children:e}){return u(JI.Provider,{value:t,children:e})}function At(){return Hn(tt(JI),"useContainer used outside of <Tldraw />")}function k7(){const t=F(),e=At(),n=U("isFocused",()=>t.getIsFocused(),[t]);q(()=>{if(!e)return;function r(o){if(o.isSpecialRedispatchedEvent)return;Ce(o);const i=e.querySelector(".tl-canvas");if(!i)return;const s=new DragEvent("drop",o);s.isSpecialRedispatchedEvent=!0,i.dispatchEvent(s)}return e.addEventListener("dragover",r),e.addEventListener("drop",r),()=>{e.removeEventListener("dragover",r),e.removeEventListener("drop",r)}},[e]),q(()=>{if(typeof window>"u"||!("matchMedia"in window))return;let r=null;const o=()=>{r!=null&&r();const i=`(resolution: ${window.devicePixelRatio}dppx)`,s=matchMedia(i),a=c=>{c.type==="change"&&o()};s.addEventListener?s.addEventListener("change",o):s.addListener&&s.addListener(a),r=()=>{s.removeEventListener?s.removeEventListener("change",o):s.removeListener&&s.removeListener(a)},t.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return o(),()=>{r==null||r()}},[t]),q(()=>{if(!n)return;const r=a=>{if(a.altKey&&(t.isIn("zoom")||!t.getPath().endsWith(".idle"))&&!Bl()&&Ce(a),a.isKilled)return;switch(a.isKilled=!0,a.key){case"=":case"-":case"0":{if(a.metaKey||a.ctrlKey){Ce(a);return}break}case"Tab":{if(Bl()||t.menus.hasAnyOpenMenus())return;break}case",":return;case"Escape":{if((t.getEditingShape()||t.getSelectedShapeIds().length>0)&&Ce(a),t.menus.getOpenMenus().length>0)return;t.inputs.keys.has("Escape")||(t.inputs.keys.add("Escape"),t.cancel(),e.focus());return}default:if(Bl()||t.menus.hasAnyOpenMenus())return}const c={type:"keyboard",name:a.repeat?"key_repeat":"key_down",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,metaKey:a.metaKey,accelKey:rn(a)};t.dispatch(c)},o=a=>{if(a.isKilled||(a.isKilled=!0,Bl()||t.menus.hasAnyOpenMenus())||a.key===",")return;const c={type:"keyboard",name:"key_up",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,metaKey:a.metaKey,accelKey:rn(a)};t.dispatch(c)};function i(a){var c,l;if(e.contains(a.target)){const d=a.touches[0].pageX,h=a.touches[0].radiusX||0;(d-h<10||d+h>t.getViewportScreenBounds().width-10)&&(((c=a.target)==null?void 0:c.tagName)==="BUTTON"&&((l=a.target)==null||l.click()),Ce(a))}}const s=a=>{e.contains(a.target)&&(a.ctrlKey||a.metaKey)&&Ce(a)};return e.addEventListener("touchstart",i,{passive:!1}),e.addEventListener("wheel",s,{passive:!1}),document.addEventListener("gesturestart",Ce),document.addEventListener("gesturechange",Ce),document.addEventListener("gestureend",Ce),e.addEventListener("keydown",r),e.addEventListener("keyup",o),()=>{e.removeEventListener("touchstart",i),e.removeEventListener("wheel",s),document.removeEventListener("gesturestart",Ce),document.removeEventListener("gesturechange",Ce),document.removeEventListener("gestureend",Ce),e.removeEventListener("keydown",r),e.removeEventListener("keyup",o)}},[t,e,n])}const M7=["input","select","button","textarea"];function Bl(){const{activeElement:t}=document;return!!(t&&(t.getAttribute("contenteditable")||M7.indexOf(t.tagName.toLowerCase())>-1))}const A7=["textarea","input"];function O7(t){const e=F();q(()=>{const n=t.current;if(!n)return;const r=o=>{var i;if(o instanceof PointerEvent&&o.pointerType==="pen"){o.isKilled=!0;const{target:s}=o;if(A7.includes((i=s.tagName)==null?void 0:i.toLocaleLowerCase())||e.isIn("select.editing_shape"))return;Ce(o)}};return n.addEventListener("touchstart",r),n.addEventListener("touchend",r),()=>{n.removeEventListener("touchstart",r),n.removeEventListener("touchend",r)}},[e,t])}function D7(t,e,n){return Math.max(e,Math.min(t,n))}const Gt={toVector(t,e){return t===void 0&&(t=e),Array.isArray(t)?t:[t,t]},add(t,e){return[t[0]+e[0],t[1]+e[1]]},sub(t,e){return[t[0]-e[0],t[1]-e[1]]},addTo(t,e){t[0]+=e[0],t[1]+=e[1]},subTo(t,e){t[0]-=e[0],t[1]-=e[1]}};function C0(t,e,n){return e===0||Math.abs(e)===1/0?Math.pow(t,n*5):t*e*n/(e+n*t)}function E0(t,e,n,r=.15){return r===0?D7(t,e,n):t<e?-C0(e-t,n-e,r)+e:t>n?+C0(t-n,n-e,r)+n:t}function $7(t,[e,n],[r,o]){const[[i,s],[a,c]]=t;return[E0(e,i,s,r),E0(n,a,c,o)]}function R7(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function L7(t){var e=R7(t,"string");return typeof e=="symbol"?e:String(e)}function en(t,e,n){return e=L7(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function T0(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,r)}return n}function yt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?T0(Object(n),!0).forEach(function(r){en(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T0(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const QI={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function k0(t){return t?t[0].toUpperCase()+t.slice(1):""}const N7=["enter","leave"];function F7(t=!1,e){return t&&!N7.includes(e)}function z7(t,e="",n=!1){const r=QI[t],o=r&&r[e]||e;return"on"+k0(t)+k0(o)+(F7(n,o)?"Capture":"")}const B7=["gotpointercapture","lostpointercapture"];function U7(t){let e=t.substring(2).toLowerCase();const n=!!~e.indexOf("passive");n&&(e=e.replace("passive",""));const r=B7.includes(e)?"capturecapture":"capture",o=!!~e.indexOf(r);return o&&(e=e.replace("capture","")),{device:e,capture:o,passive:n}}function H7(t,e=""){const n=QI[t],r=n&&n[e]||e;return t+r}function eC(t){return"touches"in t}function j7(t){return eC(t)?"touch":"pointerType"in t?t.pointerType:"mouse"}function K7(t){return Array.from(t.touches).filter(e=>{var n,r;return e.target===t.currentTarget||((n=t.currentTarget)===null||n===void 0||(r=n.contains)===null||r===void 0?void 0:r.call(n,e.target))})}function cm(t,e){try{const n=e.clientX-t.clientX,r=e.clientY-t.clientY,o=(e.clientX+t.clientX)/2,i=(e.clientY+t.clientY)/2,s=Math.hypot(n,r);return{angle:-(Math.atan2(n,r)*180)/Math.PI,distance:s,origin:[o,i]}}catch{}return null}function W7(t){return K7(t).map(e=>e.identifier)}function M0(t,e){const[n,r]=Array.from(t.touches).filter(o=>e.includes(o.identifier));return cm(n,r)}const A0=40,O0=800;function tC(t){let{deltaX:e,deltaY:n,deltaMode:r}=t;return r===1?(e*=A0,n*=A0):r===2&&(e*=O0,n*=O0),[e,n]}function G7(t){const e={};if("buttons"in t&&(e.buttons=t.buttons),"shiftKey"in t){const{shiftKey:n,altKey:r,metaKey:o,ctrlKey:i}=t;Object.assign(e,{shiftKey:n,altKey:r,metaKey:o,ctrlKey:i})}return e}function Du(t,...e){return typeof t=="function"?t(...e):t}function V7(){}function Y7(...t){return t.length===0?V7:t.length===1?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function D0(t,e){return Object.assign({},e,t||{})}const X7=32;class nC{constructor(e,n,r){this.ctrl=e,this.args=n,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:n,ingKey:r,args:o}=this;n[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=o,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const n=this.state,r=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=e.target,n.currentTarget=e.currentTarget,n.lastOffset=r.from?Du(r.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=e.timeStamp)}computeValues(e){const n=this.state;n._values=e,n.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:n,config:r,shared:o}=this;n.args=this.args;let i=0;if(e&&(n.event=e,r.preventDefault&&e.cancelable&&n.event.preventDefault(),n.type=e.type,o.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,o.locked=!!document.pointerLockElement,Object.assign(o,G7(e)),o.down=o.pressed=o.buttons%2===1||o.touches>0,i=e.timeStamp-n.timeStamp,n.timeStamp=e.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const C=n._delta.map(Math.abs);Gt.addTo(n._distance,C)}this.axisIntent&&this.axisIntent(e);const[s,a]=n._movement,[c,l]=r.threshold,{_step:d,values:h}=n;if(r.hasCustomTransform?(d[0]===!1&&(d[0]=Math.abs(s)>=c&&h[0]),d[1]===!1&&(d[1]=Math.abs(a)>=l&&h[1])):(d[0]===!1&&(d[0]=Math.abs(s)>=c&&Math.sign(s)*c),d[1]===!1&&(d[1]=Math.abs(a)>=l&&Math.sign(a)*l)),n.intentional=d[0]!==!1||d[1]!==!1,!n.intentional)return;const p=[0,0];if(r.hasCustomTransform){const[C,E]=h;p[0]=d[0]!==!1?C-d[0]:0,p[1]=d[1]!==!1?E-d[1]:0}else p[0]=d[0]!==!1?s-d[0]:0,p[1]=d[1]!==!1?a-d[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(p);const f=n.offset,g=n._active&&!n._blocked||n.active;g&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=o[this.ingKey]=n._active,e&&(n.first&&("bounds"in r&&(n._bounds=Du(r.bounds,n)),this.setup&&this.setup()),n.movement=p,this.computeOffset()));const[m,y]=n.offset,[[S,v],[_,w]]=n._bounds;n.overflow=[m<S?-1:m>v?1:0,y<_?-1:y>w?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const x=n._active?r.rubberband||[0,0]:[0,0];if(n.offset=$7(n._bounds,n.offset,x),n.delta=Gt.sub(n.offset,f),this.computeMovement(),g&&(!n.last||i>X7)){n.delta=Gt.sub(n.offset,f);const C=n.delta.map(Math.abs);Gt.addTo(n.distance,C),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&i>0&&(n.velocity=[C[0]/i,C[1]/i],n.timeDelta=i)}}emit(){const e=this.state,n=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const o=this.handler(yt(yt(yt({},n),e),{},{[this.aliasKey]:e.values}));o!==void 0&&(e.memo=o)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function q7([t,e],n){const r=Math.abs(t),o=Math.abs(e);if(r>o&&r>n)return"x";if(o>r&&o>n)return"y"}class Z7 extends nC{constructor(...e){super(...e),en(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Gt.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Gt.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const n=this.state,r=this.config;if(!n.axis&&e){const o=typeof r.axisThreshold=="object"?r.axisThreshold[j7(e)]:r.axisThreshold;n.axis=q7(n._movement,o)}n._blocked=(r.lockDirection||!!r.axis)&&!n.axis||!!r.axis&&r.axis!==n.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const J7=t=>t,$0=.15,rC={enabled(t=!0){return t},eventOptions(t,e,n){return yt(yt({},n.shared.eventOptions),t)},preventDefault(t=!1){return t},triggerAllEvents(t=!1){return t},rubberband(t=0){switch(t){case!0:return[$0,$0];case!1:return[0,0];default:return Gt.toVector(t)}},from(t){if(typeof t=="function")return t;if(t!=null)return Gt.toVector(t)},transform(t,e,n){const r=t||n.shared.transform;return this.hasCustomTransform=!!r,r||J7},threshold(t){return Gt.toVector(t,0)}},Q7=0,Qc=yt(yt({},rC),{},{axis(t,e,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(t=Q7){return t},bounds(t={}){if(typeof t=="function")return i=>Qc.bounds(t(i));if("current"in t)return()=>t.current;if(typeof HTMLElement=="function"&&t instanceof HTMLElement)return t;const{left:e=-1/0,right:n=1/0,top:r=-1/0,bottom:o=1/0}=t;return[[e,n],[r,o]]}}),el=typeof window<"u"&&window.document&&window.document.createElement;function oC(){return el&&"ontouchstart"in window}function eU(){return oC()||el&&window.navigator.maxTouchPoints>1}function tU(){return el&&"onpointerdown"in window}function nU(){return el&&"exitPointerLock"in window.document}function rU(){try{return"constructor"in GestureEvent}catch{return!1}}const ir={isBrowser:el,gesture:rU(),touch:oC(),touchscreen:eU(),pointer:tU(),pointerLock:nU()},oU=250,iU=180,sU=.5,aU=50,cU=250,lU=10,R0={mouse:0,touch:0,pen:8};yt(yt({},Qc),{},{device(t,e,{pointer:{touch:n=!1,lock:r=!1,mouse:o=!1}={}}){return this.pointerLock=r&&ir.pointerLock,ir.touch&&n?"touch":this.pointerLock?"mouse":ir.pointer&&!o?"pointer":ir.touch?"touch":"mouse"},preventScrollAxis(t,e,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&t?oU:void 0,!(!ir.touchscreen||n===!1))return t||(n!==void 0?"y":void 0)},pointerCapture(t,e,{pointer:{capture:n=!0,buttons:r=1,keys:o=!0}={}}){return this.pointerButtons=r,this.keys=o,!this.pointerLock&&this.device==="pointer"&&n},threshold(t,e,{filterTaps:n=!1,tapsThreshold:r=3,axis:o=void 0}){const i=Gt.toVector(t,n?r:o?1:0);return this.filterTaps=n,this.tapsThreshold=r,i},swipe({velocity:t=sU,distance:e=aU,duration:n=cU}={}){return{velocity:this.transform(Gt.toVector(t)),distance:this.transform(Gt.toVector(e)),duration:n}},delay(t=0){switch(t){case!0:return iU;case!1:return 0;default:return t}},axisThreshold(t){return t?yt(yt({},R0),t):R0},keyboardDisplacement(t=lU){return t}});function iC(t){const[e,n]=t.overflow,[r,o]=t._delta,[i,s]=t._direction;(e<0&&r>0&&i<0||e>0&&r<0&&i>0)&&(t._movement[0]=t._movementBound[0]),(n<0&&o>0&&s<0||n>0&&o<0&&s>0)&&(t._movement[1]=t._movementBound[1])}const dU=30,uU=100;class hU extends nC{constructor(...e){super(...e),en(this,"ingKey","pinching"),en(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:n,lastOffset:r}=this.state;e==="wheel"?this.state.offset=Gt.add(n,r):this.state.offset=[(1+n[0])*r[0],n[1]+r[1]]}computeMovement(){const{offset:e,lastOffset:n}=this.state;this.state.movement=[e[0]/n[0],e[1]-n[1]]}axisIntent(){const e=this.state,[n,r]=e._movement;if(!e.axis){const o=Math.abs(n)*dU-Math.abs(r);o<0?e.axis="angle":o>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const n=this.state,r=this.ctrl.touchIds;if(n._active&&n._touchIds.every(i=>r.has(i))||r.size<2)return;this.start(e),n._touchIds=Array.from(r).slice(0,2);const o=M0(e,n._touchIds);o&&this.pinchStart(e,o)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const n=this.state,r=n._pointerEvents,o=this.ctrl.pointerIds;if(n._active&&Array.from(r.keys()).every(s=>o.has(s))||(r.size<2&&r.set(e.pointerId,e),n._pointerEvents.size<2))return;this.start(e);const i=cm(...Array.from(r.values()));i&&this.pinchStart(e,i)}pinchStart(e,n){const r=this.state;r.origin=n.origin,this.computeValues([n.distance,n.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const n=M0(e,this.state._touchIds);n&&this.pinchMove(e,n)}pointerMove(e){const n=this.state._pointerEvents;if(n.has(e.pointerId)&&n.set(e.pointerId,e),!this.state._active)return;const r=cm(...Array.from(n.values()));r&&this.pinchMove(e,r)}pinchMove(e,n){const r=this.state,o=r._values[1],i=n.angle-o;let s=0;Math.abs(i)>270&&(s+=Math.sign(i)),this.computeValues([n.distance,n.angle-360*s]),r.origin=n.origin,r.turns=s,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(n=>!this.ctrl.touchIds.has(n))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const n=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}n._pointerEvents.has(e.pointerId)&&n._pointerEvents.delete(e.pointerId),n._active&&n._pointerEvents.size<2&&(n._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const n=this.state;n._active||(this.start(e),this.computeValues([e.scale,e.rotation]),n.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const n=this.state;this.computeValues([e.scale,e.rotation]),n.origin=[e.clientX,e.clientY];const r=n._movement;n._movement=[e.scale-1,e.rotation],n._delta=Gt.sub(n._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const n=this.config.modifierKey;n&&(Array.isArray(n)?!n.find(r=>e[r]):!e[n])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const r=this.state;r._delta=[-tC(e)[1]/uU*r.offset[0],0],Gt.addTo(r._movement,r._delta),iC(r),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const n=this.config.device;n&&(e(n,"start",this[n+"Start"].bind(this)),e(n,"change",this[n+"Move"].bind(this)),e(n,"end",this[n+"End"].bind(this)),e(n,"cancel",this[n+"End"].bind(this)),e("lostPointerCapture","",this[n+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const pU=yt(yt({},rC),{},{device(t,e,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!ir.touch&&ir.gesture)return"gesture";if(ir.touch&&r)return"touch";if(ir.touchscreen){if(ir.pointer)return"pointer";if(ir.touch)return"touch"}},bounds(t,e,{scaleBounds:n={},angleBounds:r={}}){const o=s=>{const a=D0(Du(n,s),{min:-1/0,max:1/0});return[a.min,a.max]},i=s=>{const a=D0(Du(r,s),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof n!="function"&&typeof r!="function"?[o(),i()]:s=>[o(s),i(s)]},threshold(t,e,n){return this.lockDirection=n.axis==="lock",Gt.toVector(t,this.lockDirection?[.1,3]:0)},modifierKey(t){return t===void 0?"ctrlKey":t},pinchOnWheel(t=!0){return t}});yt(yt({},Qc),{},{mouseOnly:(t=!0)=>t});class fU extends Z7{constructor(...e){super(...e),en(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const n=this.state;n._delta=tC(e),Gt.addTo(n._movement,n._delta),iC(n),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const gU=Qc;yt(yt({},Qc),{},{mouseOnly:(t=!0)=>t});const CS=new Map,lm=new Map;function mU(t){CS.set(t.key,t.engine),lm.set(t.key,t.resolver)}const yU={key:"pinch",engine:hU,resolver:pU},SU={key:"wheel",engine:fU,resolver:gU};function vU(t,e){if(t==null)return{};var n={},r=Object.keys(t),o,i;for(i=0;i<r.length;i++)o=r[i],!(e.indexOf(o)>=0)&&(n[o]=t[o]);return n}function bU(t,e){if(t==null)return{};var n=vU(t,e),r,o;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(o=0;o<i.length;o++)r=i[o],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}const wU={target(t){if(t)return()=>"current"in t?t.current:t},enabled(t=!0){return t},window(t=ir.isBrowser?window:void 0){return t},eventOptions({passive:t=!0,capture:e=!1}={}){return{passive:t,capture:e}},transform(t){return t}},_U=["target","eventOptions","window","enabled","transform"];function Pd(t={},e){const n={};for(const[r,o]of Object.entries(e))switch(typeof o){case"function":n[r]=o.call(n,t[r],r,t);break;case"object":n[r]=Pd(t[r],o);break;case"boolean":o&&(n[r]=t[r]);break}return n}function xU(t,e,n={}){const r=t,{target:o,eventOptions:i,window:s,enabled:a,transform:c}=r,l=bU(r,_U);if(n.shared=Pd({target:o,eventOptions:i,window:s,enabled:a,transform:c},wU),e){const d=lm.get(e);n[e]=Pd(yt({shared:n.shared},l),d)}else for(const d in l){const h=lm.get(d);h&&(n[d]=Pd(yt({shared:n.shared},l[d]),h))}return n}class sC{constructor(e,n){en(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=n}add(e,n,r,o,i){const s=this._listeners,a=H7(n,r),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},l=yt(yt({},c),i);e.addEventListener(a,o,l);const d=()=>{e.removeEventListener(a,o,l),s.delete(d)};return s.add(d),d}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class PU{constructor(){en(this,"_timeouts",new Map)}add(e,n,r=140,...o){this.remove(e),this._timeouts.set(e,window.setTimeout(n,r,...o))}remove(e){const n=this._timeouts.get(e);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class IU{constructor(e){en(this,"gestures",new Set),en(this,"_targetEventStore",new sC(this)),en(this,"gestureEventStores",{}),en(this,"gestureTimeoutStores",{}),en(this,"handlers",{}),en(this,"config",{}),en(this,"pointerIds",new Set),en(this,"touchIds",new Set),en(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),CU(this,e)}setEventIds(e){if(eC(e))return this.touchIds=new Set(W7(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,n){this.handlers=e,this.nativeHandlers=n}applyConfig(e,n){this.config=xU(e,n,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const n=this.config.shared,r={};let o;if(!(n.target&&(o=n.target(),!o))){if(n.enabled){for(const s of this.gestures){const a=this.config[s],c=L0(r,a.eventOptions,!!o);if(a.enabled){const l=CS.get(s);new l(this,e,s).bind(c)}}const i=L0(r,n.eventOptions,!!o);for(const s in this.nativeHandlers)i(s,"",a=>this.nativeHandlers[s](yt(yt({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const i in r)r[i]=Y7(...r[i]);if(!o)return r;for(const i in r){const{device:s,capture:a,passive:c}=U7(i);this._targetEventStore.add(o,s,"",r[i],{capture:a,passive:c})}}}}function fs(t,e){t.gestures.add(e),t.gestureEventStores[e]=new sC(t,e),t.gestureTimeoutStores[e]=new PU}function CU(t,e){e.drag&&fs(t,"drag"),e.wheel&&fs(t,"wheel"),e.scroll&&fs(t,"scroll"),e.move&&fs(t,"move"),e.pinch&&fs(t,"pinch"),e.hover&&fs(t,"hover")}const L0=(t,e,n)=>(r,o,i,s={},a=!1)=>{var c,l;const d=(c=s.capture)!==null&&c!==void 0?c:e.capture,h=(l=s.passive)!==null&&l!==void 0?l:e.passive;let p=a?r:z7(r,o,d);n&&h&&(p+="Passive"),t[p]=t[p]||[],t[p].push(i)},EU=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function TU(t){const e={},n={},r=new Set;for(let o in t)EU.test(o)?(r.add(RegExp.lastMatch),n[o]=t[o]):e[o]=t[o];return[n,e,r]}function gs(t,e,n,r,o,i){if(!t.has(n)||!CS.has(r))return;const s=n+"Start",a=n+"End",c=l=>{let d;return l.first&&s in e&&e[s](l),n in e&&(d=e[n](l)),l.last&&a in e&&e[a](l),d};o[r]=c,i[r]=i[r]||{}}function kU(t,e){const[n,r,o]=TU(t),i={};return gs(o,n,"onDrag","drag",i,e),gs(o,n,"onWheel","wheel",i,e),gs(o,n,"onScroll","scroll",i,e),gs(o,n,"onPinch","pinch",i,e),gs(o,n,"onMove","move",i,e),gs(o,n,"onHover","hover",i,e),{handlers:i,config:e,nativeHandlers:r}}function MU(t,e={},n,r){const o=we.useMemo(()=>new IU(t),[]);if(o.applyHandlers(t,r),o.applyConfig(e,n),we.useEffect(o.effect.bind(o)),we.useEffect(()=>o.clean.bind(o),[]),e.target===void 0)return o.bind.bind(o)}function AU(t){return t.forEach(mU),function(n,r){const{handlers:o,nativeHandlers:i,config:s}=kU(n,r||{});return MU(o,s,void 0,i)}}const N0=10,OU=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function aC(t){let{deltaY:e,deltaX:n}=t,r=0;return t.ctrlKey||t.altKey||t.metaKey?r=(Math.abs(e)>N0?N0*Math.sign(e):e)/100:t.shiftKey&&!OU&&(n=e,e=0),{x:-n,y:-e,z:-r}}const DU=AU([SU,yU]);let ms;const $U=t=>ms===void 0?(ms=t,!1):t-ms>120&&t-ms<160?(ms=t,!0):(ms=t,!1);function RU(t){const e=F(),n=ce(()=>{let r="not sure";const o=({event:m})=>{if(!e.getInstanceState().isFocused||(r="not sure",$U(Date.now())))return;const y=e.getEditingShapeId();if(y){const _=e.getShape(y);if(_&&e.getShapeUtil(_).canScroll(_)){const x=e.getShapePageBounds(y);if(x!=null&&x.containsPoint(e.inputs.currentPagePoint))return}}Ce(m),Mt(m);const S=aC(m);if(S.x===0&&S.y===0)return;const v={type:"wheel",name:"wheel",delta:S,point:new b(m.clientX,m.clientY),shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey,metaKey:m.metaKey,accelKey:rn(m)};e.dispatch(v)};let i=1,s=1,a=1,c=0;const l=new b,d=new b,h=m=>{const y=t.current;r="not sure";const{event:S,origin:v,da:_}=m;S instanceof WheelEvent||(S.target===y||y!=null&&y.contains(S.target))&&(d.x=v[0],d.y=v[1],l.x=v[0],l.y=v[1],i=_[0],s=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:v[0],y:v[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:S.shiftKey,altKey:S.altKey,ctrlKey:S.metaKey||S.ctrlKey,metaKey:S.metaKey,accelKey:rn(S)}))},p=m=>{if(m&&(r="zooming"),r==="zooming")return;const y=Math.abs(c-i),S=b.Dist(l,d);switch(r){case"not sure":{y>24?r="zooming":S>16&&(r="panning");break}case"panning":{y>64&&(r="zooming");break}}};return{onWheel:o,onPinchStart:h,onPinchEnd:m=>{const y=t.current,{event:S,origin:v,offset:_}=m;if(S instanceof WheelEvent||!(S.target===y||y!=null&&y.contains(S.target)))return;const w=_[0];r="not sure",e.timers.requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:v[0],y:v[1],z:w},delta:{x:v[0],y:v[1]},shiftKey:S.shiftKey,altKey:S.altKey,ctrlKey:S.metaKey||S.ctrlKey,metaKey:S.metaKey,accelKey:rn(S)})})},onPinch:m=>{const y=t.current,{event:S,origin:v,offset:_,da:w}=m;if(S instanceof WheelEvent||!(S.target===y||y!=null&&y.contains(S.target)))return;const x=m.type==="gesturechange"||m.type==="gestureend";c=w[0];const C=v[0]-d.x,E=v[1]-d.y;switch(d.x=v[0],d.y=v[1],p(x),r){case"zooming":{a=_[0],e.dispatch({type:"pinch",name:"pinch",point:{x:v[0],y:v[1],z:a},delta:{x:C,y:E},shiftKey:S.shiftKey,altKey:S.altKey,ctrlKey:S.metaKey||S.ctrlKey,metaKey:S.metaKey,accelKey:rn(S)});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:v[0],y:v[1],z:s},delta:{x:C,y:E},shiftKey:S.shiftKey,altKey:S.altKey,ctrlKey:S.metaKey||S.ctrlKey,metaKey:S.metaKey,accelKey:rn(S)});break}}}}},[e,t]);DU(n,{target:t,eventOptions:{passive:!1},pinch:{from:()=>[e.getZoomLevel(),0],scaleBounds:()=>{const r=e.getBaseZoom(),o=e.getCameraOptions().zoomSteps,i=o[0]*r,s=o[o.length-1]*r;return{from:e.getZoomLevel(),max:s,min:i}}}})}function mf(t,e,n){const r=t.getShape(e),o=t.getShapeHandles(r);return{shape:r,handle:o.find(i=>i.id===n)}}function LU(t,e){const n=F();return ce(()=>{const r=c=>{if(c.isKilled)return;const l=Ou(c.currentTarget);Zc(l,c);const{shape:d,handle:h}=mf(n,t,e);h&&n.dispatch({type:"pointer",target:"handle",handle:h,shape:d,name:"pointer_down",...Mn(c)})};let o,i;return{onPointerDown:r,onPointerMove:c=>{if(c.isKilled||c.clientX===o&&c.clientY===i)return;o=c.clientX,i=c.clientY;const{shape:l,handle:d}=mf(n,t,e);d&&n.dispatch({type:"pointer",target:"handle",handle:d,shape:l,name:"pointer_move",...Mn(c)})},onPointerUp:c=>{if(c.isKilled)return;const l=Ou(c.currentTarget);Jc(l,c);const{shape:d,handle:h}=mf(n,t,e);h&&n.dispatch({type:"pointer",target:"handle",handle:h,shape:d,name:"pointer_up",...Mn(c)})}}},[n,t,e])}function NU(t){const e=F();je(()=>{const n=ix(()=>{t.current&&e.updateViewportScreenBounds(t.current)},200,{trailing:!0}),r=e.timers.setInterval(n,1e3);window.addEventListener("resize",n);const o=new ResizeObserver(a=>{a[0].contentRect&&n()}),i=t.current;let s=null;return i&&(o.observe(i),s=FU(i),s.addEventListener("scroll",n)),()=>{clearInterval(r),window.removeEventListener("resize",n),o.disconnect(),s==null||s.removeEventListener("scroll",n),n.cancel()}},[e,t])}/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */const FU=t=>{let e=t.parentElement;for(;e;){if(e===document.body)return document;const{overflowY:n}=window.getComputedStyle(e);if(e.scrollHeight>e.clientHeight&&(n==="auto"||n==="scroll"||n==="overlay"))return e;e=e.parentElement}return document};class ee{constructor(e=0,n=0,r=0,o=0){P(this,"x",0);P(this,"y",0);P(this,"w",0);P(this,"h",0);this.x=e,this.y=n,this.w=r,this.h=o}get point(){return new b(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new b(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new b(this.minX,this.minY),new b(this.maxX,this.minY),new b(this.maxX,this.maxY),new b(this.minX,this.maxY)]}get cornersAndCenter(){return[new b(this.minX,this.minY),new b(this.maxX,this.minY),new b(this.maxX,this.maxY),new b(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new b(this.w,this.h)}toFixed(){return this.x=Fl(this.x),this.y=Fl(this.y),this.w=Fl(this.w),this.h=Fl(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,n=0,r=0,o=0){return this.x=e,this.y=n,this.w=r,this.h=o,this}expand(e){const n=Math.min(this.minX,e.minX),r=Math.min(this.minY,e.minY),o=Math.max(this.maxX,e.maxX),i=Math.max(this.maxY,e.maxY);return this.x=n,this.y=r,this.w=o-n,this.h=i-r,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:n,w:r,h:o}=this;return new ee(e,n,r,o)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const n=Math.round(this.minX/e)*e,r=Math.round(this.minY/e)*e,o=Math.round(this.maxX/e)*e,i=Math.round(this.maxY/e)*e;this.minX=n,this.minY=r,this.width=Math.max(1,o-n),this.height=Math.max(1,i-r)}collides(e){return ee.Collides(this,e)}contains(e){return ee.Contains(this,e)}includes(e){return ee.Includes(this,e)}containsPoint(e,n=0){return ee.ContainsPoint(this,e,n)}getHandlePoint(e){switch(e){case"top_left":return new b(this.minX,this.minY);case"top_right":return new b(this.maxX,this.minY);case"bottom_left":return new b(this.minX,this.maxY);case"bottom_right":return new b(this.maxX,this.maxY);case"top":return new b(this.midX,this.minY);case"right":return new b(this.maxX,this.midY);case"bottom":return new b(this.midX,this.maxY);case"left":return new b(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,n,r){const{minX:o,minY:i,maxX:s,maxY:a}=this;let{minX:c,minY:l,maxX:d,maxY:h}=this;switch(e){case"left":case"top_left":case"bottom_left":{c+=n;break}case"right":case"top_right":case"bottom_right":{d+=n;break}}switch(e){case"top":case"top_left":case"top_right":{l+=r;break}case"bottom":case"bottom_left":case"bottom_right":{h+=r;break}}const p=(d-c)/(s-o),f=(h-l)/(a-i),g=p<0,m=f<0;if(g){const y=d;d=c,c=y}if(m){const y=h;h=l,l=y}this.minX=c,this.minY=l,this.width=Math.abs(d-c),this.height=Math.abs(h-l)}union(e){const n=Math.min(this.minX,e.x),r=Math.min(this.minY,e.y),o=Math.max(this.maxX,e.w+e.x),i=Math.max(this.maxY,e.h+e.y);return this.x=n,this.y=r,this.width=o-n,this.height=i-r,this}static From(e){return new ee(e.x,e.y,e.w,e.h)}static FromCenter(e,n){return new ee(e.x-n.x/2,e.y-n.y/2,n.x,n.y)}static FromPoints(e){if(e.length===0)return new ee;let n=1/0,r=1/0,o=-1/0,i=-1/0,s;for(let a=0,c=e.length;a<c;a++)s=e[a],n=Math.min(s.x,n),r=Math.min(s.y,r),o=Math.max(s.x,o),i=Math.max(s.y,i);return new ee(n,r,o-n,i-r)}static Expand(e,n){const r=Math.min(n.minX,e.minX),o=Math.min(n.minY,e.minY),i=Math.max(n.maxX,e.maxX),s=Math.max(n.maxY,e.maxY);return new ee(r,o,i-r,s-o)}static ExpandBy(e,n){return new ee(e.minX-n,e.minY-n,e.width+n*2,e.height+n*2)}static Collides(e,n){return!(e.maxX<n.minX||e.minX>n.maxX||e.maxY<n.minY||e.minY>n.maxY)}static Contains(e,n){return e.minX<n.minX&&e.minY<n.minY&&e.maxY>n.maxY&&e.maxX>n.maxX}static Includes(e,n){return ee.Collides(e,n)||ee.Contains(e,n)}static ContainsPoint(e,n,r=0){return!(n.x<e.minX-r||n.y<e.minY-r||n.x>e.maxX+r||n.y>e.maxY+r)}static Common(e){let n=1/0,r=1/0,o=-1/0,i=-1/0;for(let s=0;s<e.length;s++){const a=e[s];n=Math.min(n,a.minX),r=Math.min(r,a.minY),o=Math.max(o,a.maxX),i=Math.max(i,a.maxY)}return new ee(n,r,o-n,i-r)}static Sides(e,n=0){const{corners:r}=e;return[[r[0],r[1]],[r[1],r[2]],[r[2],r[3]],[r[3],r[0]]]}static Resize(e,n,r,o,i=!1){const{minX:s,minY:a,maxX:c,maxY:l}=e;let{minX:d,minY:h,maxX:p,maxY:f}=e;switch(n){case"left":case"top_left":case"bottom_left":{d+=r;break}case"right":case"top_right":case"bottom_right":{p+=r;break}}switch(n){case"top":case"top_left":case"top_right":{h+=o;break}case"bottom":case"bottom_left":case"bottom_right":{f+=o;break}}const g=(p-d)/(c-s),m=(f-h)/(l-a),y=g<0,S=m<0;if(i){const _=(c-s)/(l-a),w=Math.abs(p-d),x=Math.abs(f-h),C=w*(m<0?1:-1)*(1/_),E=x*(g<0?1:-1)*_,I=_<w/x;switch(n){case"top_left":{I?h=f+C:d=p+E;break}case"top_right":{I?h=f+C:p=d-E;break}case"bottom_right":{I?f=h-C:p=d-E;break}case"bottom_left":{I?f=h-C:d=p+E;break}case"bottom":case"top":{const T=(d+p)/2,k=x*_;d=T-k/2,p=T+k/2;break}case"left":case"right":{const T=(h+f)/2,k=w/_;h=T-k/2,f=T+k/2;break}}}if(y){const _=p;p=d,d=_}if(S){const _=f;f=h,h=_}const v=new ee(d,h,Math.abs(p-d),Math.abs(f-h));return{box:v,scaleX:+(v.width/e.width*(g>0?1:-1)).toFixed(5),scaleY:+(v.height/e.height*(m>0?1:-1)).toFixed(5)}}equals(e){return ee.Equals(this,e)}static Equals(e,n){return n.x===e.x&&n.y===e.y&&n.w===e.w&&n.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new ee(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}}function zU(t){switch(t){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return t}}function BU(t){switch(t){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return t}}function UU(t){return t==="top_left"||t==="top_right"||t==="bottom_right"||t==="bottom_left"}class J{constructor(e,n,r,o,i,s){P(this,"a",1);P(this,"b",0);P(this,"c",0);P(this,"d",1);P(this,"e",0);P(this,"f",0);this.a=e,this.b=n,this.c=r,this.d=o,this.e=i,this.f=s}equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const n=e,{a:r,b:o,c:i,d:s,e:a,f:c}=this;return this.a=r*n.a+i*n.b,this.c=r*n.c+i*n.d,this.e=r*n.e+i*n.f+a,this.b=o*n.a+s*n.b,this.d=o*n.c+s*n.d,this.f=o*n.e+s*n.f+c,this}rotate(e,n,r){return e===0?this:n===void 0?this.multiply(J.Rotate(e)):this.translate(n,r).multiply(J.Rotate(e)).translate(-n,-r)}translate(e,n){return this.multiply(J.Translate(e,n))}scale(e,n){return this.multiply(J.Scale(e,n))}invert(){const{a:e,b:n,c:r,d:o,e:i,f:s}=this,a=e*o-n*r;return this.a=o/a,this.b=n/-a,this.c=r/-a,this.d=e/a,this.e=(o*i-r*s)/-a,this.f=(n*i-e*s)/a,this}applyToPoint(e){return J.applyToPoint(this,e)}applyToPoints(e){return J.applyToPoints(this,e)}rotation(){return J.Rotation(this)}point(){return J.Point(this)}decomposed(){return J.Decompose(this)}toCssString(){return J.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return J.Decompose(this)}clone(){return new J(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new J(1,0,0,1,0,0)}static Translate(e,n){return new J(1,0,0,1,e,n)}static Rotate(e,n,r){if(e===0)return J.Identity();const o=Math.cos(e),i=Math.sin(e),s=new J(o,i,-i,o,0,0);return n===void 0?s:J.Compose(J.Translate(n,r),s,J.Translate(-n,-r))}static Scale(e,n,r,o){const i=new J(e,0,0,n,0,0);return r===void 0?i:J.Compose(J.Translate(r,o),i,J.Translate(-r,-o))}static Multiply(e,n){return{a:e.a*n.a+e.c*n.b,c:e.a*n.c+e.c*n.d,e:e.a*n.e+e.c*n.f+e.e,b:e.b*n.a+e.d*n.b,d:e.b*n.c+e.d*n.d,f:e.b*n.e+e.d*n.f+e.f}}static Inverse(e){const n=e.a*e.d-e.b*e.c;return{a:e.d/n,b:e.b/-n,c:e.c/-n,d:e.a/n,e:(e.d*e.e-e.c*e.f)/-n,f:(e.b*e.e-e.a*e.f)/n}}static Absolute(e){const n=e.a*e.d-e.b*e.c;return{a:e.d/n,b:e.b/-n,c:e.c/-n,d:e.a/n,e:(e.d*e.e-e.c*e.f)/n,f:(e.b*e.e-e.a*e.f)/-n}}static Compose(...e){const n=J.Identity();for(let r=0,o=e.length;r<o;r++)n.multiply(e[r]);return n}static Point(e){return new b(e.e,e.f)}static Rotation(e){let n;if(e.a!==0||e.c!==0){const r=(e.a*e.a+e.c*e.c)**.5;n=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const r=(e.b*e.b+e.d*e.d)**.5;n=it+Math.acos(e.b/r)*(e.d>0?-1:1)}else n=0;return sm(n)}static Decompose(e){let n,r,o;if(e.a!==0||e.c!==0){const i=(e.a*e.a+e.c*e.c)**.5;n=i,r=(e.a*e.d-e.b*e.c)/i,o=Math.acos(e.a/i)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const i=(e.b*e.b+e.d*e.d)**.5;n=(e.a*e.d-e.b*e.c)/i,r=i,o=it+Math.acos(e.b/i)*(e.d>0?-1:1)}else n=0,r=0,o=0;return{x:e.e,y:e.f,scaleX:n,scaleY:r,rotation:sm(o)}}static Smooth(e,n=1e10){return e.a=Math.round(e.a*n)/n,e.b=Math.round(e.b*n)/n,e.c=Math.round(e.c*n)/n,e.d=Math.round(e.d*n)/n,e.e=Math.round(e.e*n)/n,e.f=Math.round(e.f*n)/n,e}static toCssString(e){return`matrix(${N(e.a)}, ${N(e.b)}, ${N(e.c)}, ${N(e.d)}, ${N(e.e)}, ${N(e.f)})`}static applyToPoint(e,n){return new b(e.a*n.x+e.c*n.y+e.e,e.b*n.x+e.d*n.y+e.f,n.z)}static applyToXY(e,n,r){return[e.a*n+e.c*r+e.e,e.b*n+e.d*r+e.f]}static applyToPoints(e,n){return n.map(r=>new b(e.a*r.x+e.c*r.y+e.e,e.b*r.x+e.d*r.y+e.f,r.z))}static applyToBounds(e,n){return new ee(e.e+n.minX,e.f+n.minY,n.width,n.height)}static From(e){return new J(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof J?e:J.From(e)}}class Si{constructor(e){P(this,"isFilled",!1);P(this,"isClosed",!0);P(this,"isLabel",!1);P(this,"debugColor");P(this,"ignore");P(this,"_vertices");P(this,"_bounds");P(this,"_area");P(this,"_length");this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isLabel=e.isLabel??!1,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e,n=0,r=!1){return this.isClosed&&(this.isFilled||r)&&Vn(e,this.vertices)?!0:b.Dist2(e,this.nearestPoint(e))<=n*n}distanceToPoint(e,n=!1){return e.dist(this.nearestPoint(e))*(this.isClosed&&(this.isFilled||n)&&Vn(e,this.vertices)?-1:1)}distanceToLineSegment(e,n){if(e.equals(n))return this.distanceToPoint(e);const{vertices:r}=this;let o,i=1/0,s,a,c;for(let l=0;l<r.length;l++)a=r[l],c=b.NearestPointOnLineSegment(e,n,a,!0),s=b.Dist2(a,c),s<i&&(i=s,o=c);if(!o)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&Vn(o,this.vertices)?-i:i}hitTestLineSegment(e,n,r=0){return this.distanceToLineSegment(e,n)<=r}nearestPointOnLineSegment(e,n){const{vertices:r}=this;let o,i=1/0,s,a,c;for(let l=0;l<r.length;l++)a=r[l],c=b.NearestPointOnLineSegment(e,n,a,!0),s=b.Dist2(a,c),s<i&&(i=s,o=c);if(!o)throw Error("nearest point not found");return o}isPointInBounds(e,n=0){const{bounds:r}=this;return!(e.x<r.minX-n||e.y<r.minY-n||e.x>r.maxX+n||e.y>r.maxY+n)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return ee.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let n=0;for(let r=0,o=e.length;r<o;r++){const i=e[r],s=e[(r+1)%o];n+=i.x*s.y-s.x*i.y}return n/2}toSimpleSvgPath(){let e="";const{vertices:n}=this,r=n.length;if(r===0)return e;e+=`M${n[0].x},${n[0].y}`;for(let o=1;o<r;o++)e+=`L${n[o].x},${n[o].y}`;return this.isClosed&&(e+="Z"),e}get length(){return this._length?this._length:(this._length=this.getLength(),this._length)}getLength(){const{vertices:e}=this;let n,r=e[0],o=0;for(let i=1;i<e.length;i++)n=e[i],o+=b.Dist2(r,n),r=n;return Math.sqrt(o)}}class Ir extends Si{constructor(n){super({...n,isClosed:!0,isFilled:!1});P(this,"children",[]);P(this,"ignoredChildren",[]);for(const r of n.children)r.ignore?this.ignoredChildren.push(r):this.children.push(r);if(this.children.length===0)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter(n=>!n.isLabel).flatMap(n=>n.vertices)}nearestPoint(n){let r=1/0,o;const{children:i}=this;if(i.length===0)throw Error("no children");let s,a;for(const c of i)s=c.nearestPoint(n),a=b.Dist2(s,n),a<r&&(r=a,o=s);if(!o)throw Error("nearest point not found");return o}distanceToPoint(n,r=!1){return Math.min(...this.children.map((o,i)=>o.distanceToPoint(n,r||i>0)))}hitTestPoint(n,r,o){return!!this.children.filter(i=>!i.isLabel).find(i=>i.hitTestPoint(n,r,o))}hitTestLineSegment(n,r,o){return!!this.children.filter(i=>!i.isLabel).find(i=>i.hitTestLineSegment(n,r,o))}getArea(){return this.children[0].area}toSimpleSvgPath(){let n="";for(const o of this.children)n+=o.toSimpleSvgPath();const r=ee.FromPoints(this.vertices).corners;for(let o=0,i=r.length;o<i;o++){const s=r[o],a=r[(o-1+i)%i],c=s.dist(a),l=r[(o+1)%i],d=s.dist(l),h=s.clone().lrp(a,4/c),p=s,f=s.clone().lrp(l,4/d);n+=`M${h.x},${h.y} L${p.x},${p.y} L${f.x},${f.y} `}return n}getLength(){return this.children.reduce((n,r)=>r.isLabel?n:n+r.length,0)}getSvgPathData(){return this.children.map((n,r)=>n.isLabel?"":n.getSvgPathData(r===0)).join(" ")}}function HU(t=!0){const[e,n]=Q(0),r=F();q(()=>{if(!t)return;const o=()=>n(i=>i+1);return r.on("tick",o),()=>{r.off("tick",o)}},[r,t])}const jU=Nt(function({showStroke:e=!0,showVertices:n=!0,showClosestPointOnOutline:r=!0}){const o=F();HU(r);const i=o.getZoomLevel(),s=o.getRenderingShapes(),{inputs:{currentPagePoint:a}}=o;return u("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:s.map(c=>{const l=o.getShape(c.id);if(l.type==="group")return null;const d=o.getShapeGeometry(l),h=o.getShapePageTransform(l),p=o.getPointInShapeSpace(l,a),f=d.nearestPoint(p),g=d.distanceToPoint(p,!0),m=Math.abs(g)*i,y=g<0,{vertices:S}=d;return u("g",{transform:h.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&u("g",{stroke:d.debugColor??"red",opacity:"1",strokeWidth:2/i,fill:"none",children:u(cC,{geometry:d})}),n&&S.map((v,_)=>u("circle",{cx:v.x,cy:v.y,r:2/i,fill:`hsl(${Ys(_,[0,S.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/i},`v${_}`)),r&&m<150&&u("line",{x1:f.x,y1:f.y,x2:p.x,y2:p.y,opacity:1-m/150,stroke:y?"goldenrod":"dodgerblue",strokeWidth:2/i})]},c.id+"_outline")})})});function cC({geometry:t}){return t instanceof Ir?u(Z,{children:[...t.children,...t.ignoredChildren].map((e,n)=>u(cC,{geometry:e},n))}):u("path",{d:t.toSimpleSvgPath()})}function lC(t){return xL(t)}function dC(){const t=F(),e=UB("userIds",()=>lC(t.getCollaborators().map(n=>n.userId)).sort(),{isEqual:(n,r)=>{var o;return n.join(",")===((o=r.join)==null?void 0:o.call(r,","))}},[t]);return U(e)}function Ih(t){const e=F();return U(`latestPresence:${t}`,()=>e.getCollaborators().find(r=>r.userId===t),[e,t])??null}const KU=Nt(function(){return dC().map(n=>u(WU,{collaboratorId:n},n))}),WU=Nt(function({collaboratorId:e}){const n=F(),r=Ih(e),o=VU(n,r);if(!(r&&r.currentPageId===n.getCurrentPageId()))return null;switch(o){case"inactive":{const{followingUserId:i,highlightedUserIds:s}=n.getInstanceState();if(!(i===r.userId||s.includes(r.userId)))return null;break}case"idle":{const{highlightedUserIds:i}=n.getInstanceState();if(r.followingUserId===n.user.getId()&&!(r.chatMessage||i.includes(r.userId)))return null;break}}return u(GU,{latestPresence:r})}),GU=Nt(function({latestPresence:e}){const n=F(),{CollaboratorBrush:r,CollaboratorScribble:o,CollaboratorCursor:i,CollaboratorHint:s,CollaboratorShapeIndicator:a}=ht(),c=n.getZoomLevel(),l=n.getViewportPageBounds(),{userId:d,chatMessage:h,brush:p,scribbles:f,selectedShapeIds:g,userName:m,cursor:y,color:S}=e,v=!(y.x<l.minX-12/c||y.y<l.minY-16/c||y.x>l.maxX-12/c||y.y>l.maxY-16/c);return u(Z,{children:[p&&r?u(r,{className:"tl-collaborator__brush",brush:p,color:S,opacity:.1},d+"_brush"):null,v&&i?u(i,{className:"tl-collaborator__cursor",point:y,color:S,zoom:c,name:m!=="New User"?m:null,chatMessage:h},d+"_cursor"):s?u(s,{className:"tl-collaborator__cursor-hint",point:y,color:S,zoom:c,viewport:l},d+"_cursor_hint"):null,o&&f.length?u(Z,{children:f.map(_=>u(o,{className:"tl-collaborator__scribble",scribble:_,color:S,zoom:c,opacity:_.color==="laser"?.5:.1},d+"_scribble_"+_.id))}):null,a&&g.filter(_=>!n.isShapeHidden(_)).map(_=>u(a,{className:"tl-collaborator__shape-indicator",shapeId:_,color:S,opacity:.5},d+"_"+_))]})});function F0(t,e){return e>t.options.collaboratorInactiveTimeoutMs?"inactive":e>t.options.collaboratorIdleTimeoutMs?"idle":"active"}function VU(t,e){const n=B((e==null?void 0:e.lastActivityTimestamp)??-1),[r,o]=Q(()=>F0(t,Date.now()-n.current));return q(()=>{const i=t.timers.setInterval(()=>{o(F0(t,Date.now()-n.current))},t.options.collaboratorCheckIntervalMs);return()=>clearInterval(i)},[t]),e&&(n.current=e.lastActivityTimestamp),r}const uC=$e(function({id:e,shape:n,util:r,index:o,backgroundIndex:i,opacity:s}){const a=F(),{ShapeErrorFallback:c}=ht(),l=B(null),d=B(null),h=B({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});ri("set shape stuff",()=>{const g=a.getShape(e);if(!g)return;const m=h.current,y=a.getShapeClipPath(e)??"none";y!==m.clipPath&&(Jt(l.current,"clip-path",y),Jt(d.current,"clip-path",y),m.clipPath=y);const S=a.getShapePageTransform(e),v=J.toCssString(S),_=a.getShapeGeometry(g).bounds;v!==m.transform&&(Jt(l.current,"transform",v),Jt(d.current,"transform",v),m.transform=v);const w=Math.max(_.width,1),x=Math.max(_.height,1);(w!==m.width||x!==m.height)&&(Jt(l.current,"width",w+"px"),Jt(l.current,"height",x+"px"),Jt(d.current,"width",w+"px"),Jt(d.current,"height",x+"px"),m.width=w,m.height=x)},[a]),ri("set opacity and z-index",()=>{const g=l.current,m=d.current;Jt(g,"opacity",s),Jt(m,"opacity",s),Jt(g,"z-index",o),Jt(m,"z-index",i)},[s,o,i]),ri("set display",()=>{if(!a.getShape(e))return;const y=a.getCulledShapes().has(e);y!==h.current.isCulled&&(Jt(l.current,"display",y?"none":"block"),Jt(d.current,"display",y?"none":"block"),h.current.isCulled=y)},[a]);const p=V(g=>a.annotateError(g,{origin:"shape",willCrashApp:!1}),[a]);if(!n)return null;const f="fill"in n.props&&n.props.fill!=="none";return u(Z,{children:[r.backgroundComponent&&u("div",{ref:d,className:"tl-shape tl-shape-background","data-shape-type":n.type,draggable:!1,children:u(kc,{fallback:c,onError:p,children:u(pC,{shape:n,util:r})})}),u("div",{ref:l,className:"tl-shape","data-shape-type":n.type,"data-shape-is-filled":f,draggable:!1,children:u(kc,{fallback:c,onError:p,children:u(hC,{shape:n,util:r})})})]})}),hC=$e(function({shape:e,util:n}){return vh("InnerShape:"+e.type,()=>n.component(n.editor.store.unsafeGetWithoutCapture(e.id)))},(t,e)=>t.shape.props===e.shape.props&&t.shape.meta===e.shape.meta),pC=$e(function({shape:e,util:n}){return vh("InnerShape:"+e.type,()=>{var r;return(r=n.backgroundComponent)==null?void 0:r.call(n,n.editor.store.unsafeGetWithoutCapture(e.id))})},(t,e)=>t.shape.props===e.shape.props&&t.shape.meta===e.shape.meta);function YU({className:t}){const e=F(),{Background:n,SvgDefs:r,ShapeIndicators:o}=ht(),i=B(null),s=B(null),a=B(null),c=At();NU(i),k7(),E7(),RU(i),O7(i);const l=B({lodDisableTextOutline:!1,allowTextOutline:!0});ri("position layers",function(){const{x:v,y:_,z:w}=e.getCamera();if(l.current.allowTextOutline&&et.isSafari&&(c.style.setProperty("--tl-text-outline","none"),l.current.allowTextOutline=!1),l.current.allowTextOutline&&w<e.options.textShadowLod!==l.current.lodDisableTextOutline){const E=w<e.options.textShadowLod;c.style.setProperty("--tl-text-outline",E?"none":"var(--tl-text-outline-reference)"),l.current.lodDisableTextOutline=E}const x=w>=1?Ys(w,[1,8],[.125,.5],!0):Ys(w,[.1,1],[-2,.125],!0),C=`scale(${N(w)}) translate(${N(v+x)}px,${N(_+x)}px)`;Jt(s.current,"transform",C),Jt(a.current,"transform",C)},[e,c]);const d=ZI(),h=U("shapeSvgDefs",()=>{const S=new Map;for(const v of gt(e.shapeUtils)){if(!v)return;const _=v.getCanvasSvgDefs();for(const{key:w,component:x}of _)S.has(w)||S.set(w,u(x,{},w))}return[...S.values()]},[e]),p=U("debug_shapes",()=>Pt.hideShapes.get(),[Pt]),f=U("debug_svg",()=>Pt.debugSvg.get(),[Pt]),g=U("debug_geometry",()=>Pt.debugGeometry.get(),[Pt]),m=U("isEditingAnything",()=>e.getEditingShapeId()!==null,[e]),y=U("isSelectingAnything",()=>!!e.getSelectedShapeIds().length,[e]);return u(Z,{children:[u("div",{ref:i,draggable:!1,"data-iseditinganything":m,"data-isselectinganything":y,className:de("tl-canvas",t),"data-testid":"canvas",...d,children:[u("svg",{className:"tl-svg-context",children:u("defs",{children:[h,u(cH,{}),u(lH,{}),r&&u(r,{})]})}),n&&u("div",{className:"tl-background__wrapper",children:u(n,{})}),u(qU,{}),u("div",{ref:s,className:"tl-html-layer tl-shapes",draggable:!1,children:[u(pH,{}),u(hH,{}),p?null:f?u(oH,{}):u(sH,{})]}),u("div",{className:"tl-overlays",children:u("div",{ref:a,className:"tl-html-layer",children:[g?u(jU,{}):null,u(tH,{}),u(JU,{}),u(ZU,{}),u(QU,{}),o&&u(o,{}),u(aH,{}),u(eH,{}),u(uH,{}),u(KU,{})]})}),u(fH,{})]}),u(XU,{})]})}function XU(){const{InFrontOfTheCanvas:t}=ht();return t?u(t,{}):null}function qU(){const t=F(),e=U("gridSize",()=>t.getDocumentSettings().gridSize,[t]),{x:n,y:r,z:o}=U("camera",()=>t.getCamera(),[t]),i=U("isGridMode",()=>t.getInstanceState().isGridMode,[t]),{Grid:s}=ht();return s&&i?u(s,{x:n,y:r,z:o,size:e}):null}function ZU(){const t=F(),e=U("scribbles",()=>t.getInstanceState().scribbles,[t]),n=U("zoomLevel",()=>t.getZoomLevel(),[t]),{Scribble:r}=ht();return r&&e.length?e.map(o=>u(r,{className:"tl-user-scribble",scribble:o,zoom:n},o.id)):null}function JU(){const t=F(),e=U("brush",()=>t.getInstanceState().brush,[t]),{Brush:n}=ht();return n&&e?u(n,{className:"tl-user-brush",brush:e}):null}function QU(){const t=F(),e=U("zoomBrush",()=>t.getInstanceState().zoomBrush,[t]),{ZoomBrush:n}=ht();return n&&e?u(n,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function eH(){const t=F(),e=U("snapLines",()=>t.snaps.getIndicators(),[t]),n=U("zoomLevel",()=>t.getZoomLevel(),[t]),{SnapIndicator:r}=ht();return r&&e.length>0?e.map(o=>u(r,{className:"tl-user-snapline",line:o,zoom:n},o.id)):null}function tH(){const t=F(),e=U("handles shapeIdWithHandles",()=>{const{isReadonly:n,isChangingStyle:r}=t.getInstanceState();if(n||r)return!1;const o=t.getOnlySelectedShape();return!o||!t.getShapeHandles(o)?!1:o.id},[t]);return e?u(nH,{shapeId:e}):null}function nH({shapeId:t}){const e=F(),{Handles:n}=ht(),r=U("zoomLevel",()=>e.getZoomLevel(),[e]),o=U("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),i=U("handles transform",()=>e.getShapePageTransform(t),[e,t]),s=U("handles",()=>{const c=e.getShapeHandles(t);if(!c)return null;const l=(o?e.options.coarseHandleRadius:e.options.handleRadius)/r*2;return c.filter(d=>d.type!=="virtual"||!c.some(h=>h!==d&&h.type==="vertex"&&b.Dist(d,h)<l)).sort(d=>d.type==="vertex"?1:-1)},[e,r,o,t]),a=U("isHidden",()=>e.isShapeHidden(t),[e,t]);return!n||!s||!i||a?null:u(n,{children:u("g",{transform:J.toCssString(i),children:s.map(c=>u(rH,{shapeId:t,handle:c,zoom:r,isCoarse:o},c.id))})})}function rH({shapeId:t,handle:e,zoom:n,isCoarse:r}){const o=LU(t,e.id),{Handle:i}=ht();return i?u("g",{"aria-label":"handle",transform:`translate(${e.x}, ${e.y})`,...o,children:u(i,{shapeId:t,handle:e,zoom:n,isCoarse:r})}):null}function oH(){const t=F();return U("rendering shapes",()=>t.getRenderingShapes(),[t]).map(n=>u(Z,{children:[u(uC,{...n}),u(dH,{id:n.id,mode:"iframe"})]},n.id+"_fragment"))}function iH(){const t=F(),e=B(new Set);return ri("reflow for culled shapes",()=>{const n=t.getCulledShapes();if(e.current.size===n.size&&[...n].every(o=>e.current.has(o)))return;e.current=n;const r=document.getElementsByClassName("tl-canvas");r.length!==0&&r[0].offsetHeight},[t]),null}function sH(){const t=F(),e=U("rendering shapes",()=>t.getRenderingShapes(),[t]);return u(Z,{children:[e.map(n=>u(uC,{...n},n.id+"_shape")),et.isSafari&&u(iH,{})]})}function aH(){const t=F(),{ShapeIndicator:e}=ht(),n=U("hinting shape ids",()=>Py(t.getHintingShapeIds()),[t]);return!n.length||!e?null:n.map(r=>u(e,{className:"tl-user-indicator__hint",shapeId:r},r+"_hinting"))}function cH(){return u("g",{id:"cursor",children:[u("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[u("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),u("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),u("g",{fill:"white",transform:"translate(-12,-12)",children:[u("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),u("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),u("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[u("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),u("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function lH(){return u("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function dH({id:t,mode:e}){const n=F(),[r,o]=Q(null),i=U("is in root",()=>{const s=n.getShape(t);return(s==null?void 0:s.parentId)===n.getCurrentPageId()},[n,t]);return q(()=>{if(!i)return;let s=null;const a=xo("shape to svg",async()=>{const c=Math.random();s=c;const d=n.isShapeOfType(t,"frame")?0:10;let h=n.getShapePageBounds(t);if(!h)return;h=h.clone().expandBy(d);const p=await n.getSvgString([t],{padding:d,background:n.getInstanceState().exportBackground});if(s!==c||!p)return;const f=`data:image/svg+xml;utf8,${encodeURIComponent(p.svg)}`;o({src:f,bounds:h})});return()=>{s=null,a()}},[n,t,i]),!i||!r?null:e==="iframe"?u("iframe",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,border:"none",transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):u("img",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}})}function uH(){const t=F(),e=U("selection rotation",()=>t.getSelectionRotation(),[t]),n=U("selection bounds",()=>t.getSelectionRotatedPageBounds(),[t]),{SelectionForeground:r}=ht();return!n||!r?null:u(r,{bounds:n,rotation:e})}function hH(){const t=F(),e=U("selection rotation",()=>t.getSelectionRotation(),[t]),n=U("selection bounds",()=>t.getSelectionRotatedPageBounds(),[t]),{SelectionBackground:r}=ht();return!n||!r?null:u(r,{bounds:n,rotation:e})}function pH(){const{OnTheCanvas:t}=ht();return t?u(t,{}):null}function fH(){const t=F(),e=U("camera state",()=>t.getCameraState(),[t]);return u("div",{className:de("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":e==="idle"})})}function gH({className:t,zoom:e,point:n,color:r,viewport:o,opacity:i=1}){const s=B(null);return Sa(s,Bt(n.x,o.minX+5/e,o.maxX-5/e),Bt(n.y,o.minY+5/e,o.maxY-5/e),1/e,b.Angle(o.center,n)),u("svg",{ref:s,className:de("tl-overlays__item",t),children:[u("use",{href:"#cursor_hint",color:r,strokeWidth:3,stroke:"var(--color-background)"}),u("use",{href:"#cursor_hint",color:r,opacity:i})]})}const z0=$e(function({className:e,zoom:n,point:r,color:o,name:i,chatMessage:s}){const a=B(null);return Sa(a,r==null?void 0:r.x,r==null?void 0:r.y,1/n),r?u("div",{ref:a,className:de("tl-overlays__item",e),children:[u("svg",{className:"tl-cursor",children:u("use",{href:"#cursor",color:o})}),s?u(Z,{children:[i&&u("div",{className:"tl-nametag-title",style:{color:o},children:i}),u("div",{className:"tl-nametag-chat",style:{backgroundColor:o},children:s})]}):i&&u("div",{className:"tl-nametag",style:{backgroundColor:o},children:i})]}):null});function fC(){return va(Sh())}function va(t){return t.replace(/:/g,"_")}function mH({x:t,y:e,z:n,size:r}){const o=`grid_${fC()}`,i=F(),{gridSteps:s}=i.options;return u("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[u("defs",{children:s.map(({min:a,mid:c,step:l},d)=>{const h=l*r*n,p=.5+t*n,f=.5+e*n,g=p>0?p%h:h+p%h,m=f>0?f%h:h+f%h,y=n<c?Ys(n,[a,c],[0,1]):1;return u("pattern",{id:`${o}_${l}`,width:h,height:h,patternUnits:"userSpaceOnUse",children:u("circle",{className:"tl-grid-dot",cx:g,cy:m,r:1,opacity:y})},d)})}),s.map(({step:a},c)=>u("rect",{width:"100%",height:"100%",fill:`url(#${o}_${a})`},c))]})}function yH({handle:t,isCoarse:e,className:n,zoom:r}){const o=F(),i=(e?o.options.coarseHandleRadius:o.options.handleRadius)/r;if(t.type==="clone"){const a=3/r,c=`M0,${-a} A${a},${a} 0 0,1 0,${a}`,l=w7.indexOf(t.id);return u("g",{className:de(`tl-handle tl-handle__${t.type}`,n),children:[u("circle",{className:"tl-handle__bg",r:i}),u("path",{className:"tl-handle__fg",d:c,transform:`rotate(${-90+90*l})`})]})}const s=(t.type==="create"&&e?3:4)/Math.max(r,.25);return u("g",{className:de(`tl-handle tl-handle__${t.type}`,n),children:[u("circle",{className:"tl-handle__bg",r:i}),u("circle",{className:"tl-handle__fg",r:s})]})}const SH=({children:t})=>u("svg",{className:"tl-user-handles tl-overlays__item",children:t}),vH=()=>{const{Spinner:t}=ht();return u(KS,{children:t?u(t,{}):null})};function ES(t,e=!0){const n=t.length;if(n<2)return"";let r=t[0],o=t[1];if(n===2)return`M${Fe(r)}L${Fe(o)}`;let i="";for(let s=2,a=n-1;s<a;s++)r=t[s],o=t[s+1],i+=Cn(r,o);return e?`M${Cn(t[0],t[1])}Q${Fe(t[1])}${Cn(t[1],t[2])}T${i}${Cn(t[n-1],t[0])}${Cn(t[0],t[1])}Z`:`M${Fe(t[0])}Q${Fe(t[1])}${Cn(t[1],t[2])}${t.length>3?"T":""}${i}L${Fe(t[n-1])}`}function B0({scribble:t,zoom:e,color:n,opacity:r,className:o}){return t.points.length?u("svg",{className:o&&de("tl-overlays__item",o),children:u("path",{className:"tl-scribble",d:ES(t.points,!1),stroke:n??`var(--color-${t.color})`,fill:"none",strokeWidth:8/e,opacity:r??t.opacity})}):null}function gC({bounds:t,rotation:e}){const n=B(null);return Sa(n,t.x,t.y,1,e),je(()=>{const r=n.current;r&&(r.style.width=N(Math.max(1,t.width))+"px",r.style.height=N(Math.max(1,t.height))+"px")},[t.width,t.height]),u("div",{ref:n,className:"tl-selection__bg",draggable:!1})}function bH({bounds:t,rotation:e}){const n=F(),r=B(null),o=U("only selected shape",()=>n.getOnlySelectedShape(),[n]),i=o?n.getShapeUtil(o).expandSelectionOutlinePx(o):0;return Sa(r,t==null?void 0:t.x,t==null?void 0:t.y,1,e,{x:-i,y:-i}),t=t.clone().expandBy(i).zeroFix(),u("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:u("rect",{className:de("tl-selection__fg__outline"),width:N(t.width),height:N(t.height)})})}const wH=()=>u("div",{className:"tl-shape-error-boundary"}),_H=({shape:t,util:e})=>vh("Indicator: "+t.type,()=>e.indicator(e.editor.store.unsafeGetWithoutCapture(t.id))),xH=({editor:t,id:e})=>{const n=U("shape for indicator",()=>t.store.get(e),[t,e]),{ShapeIndicatorErrorFallback:r}=ht();return!n||n.isLocked?null:u(kc,{fallback:r,onError:o=>t.annotateError(o,{origin:"react.shapeIndicator",willCrashApp:!1}),children:u(_H,{shape:n,util:t.getShapeUtil(n)},n.id)})},U0=$e(function({shapeId:e,className:n,color:r,hidden:o,opacity:i}){const s=F(),a=B(null);return ri("indicator transform",()=>{const c=a.current;if(!c)return;const l=s.getShapePageTransform(e);l&&c.style.setProperty("transform",l.toCssString())},[s,e]),je(()=>{const c=a.current;c&&c.style.setProperty("display",o?"none":"block")},[o]),u("svg",{ref:a,className:de("tl-overlays__item",n),children:u("g",{className:"tl-shape-indicator",stroke:r??"var(--color-selected)",opacity:i,children:u(xH,{editor:s,id:e})})})}),PH=()=>u("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),mC=$e(function(){const e=F(),n=B(new Set),r=U("should display selected ids",()=>{const s=n.current,a=new Set;if(e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle){const c=e.getSelectedShapeIds();for(const l of c)a.add(l);if(e.isInAny("select.idle","select.editing_shape")){const l=e.getInstanceState();if(l.isHoveringCanvas&&!l.isCoarsePointer){const d=e.getHoveredShapeId();d&&a.add(d)}}}if(s.size!==a.size)return n.current=a,a;for(const c of a)if(!s.has(c))return n.current=a,a;return s},[e]),o=U("rendering shapes",()=>e.getRenderingShapes(),[e]),{ShapeIndicator:i}=ht();return i?o.map(({id:s})=>u(i,{shapeId:s,hidden:!r.has(s)},s+"_indicator")):null});function IH({points:t,zoom:e}){const n=2.5/e,r=t.reduce((p,f)=>Math.min(p,f.x),1/0),o=t.reduce((p,f)=>Math.max(p,f.x),-1/0),i=t.reduce((p,f)=>Math.min(p,f.y),1/0),s=t.reduce((p,f)=>Math.max(p,f.y),-1/0),a=t.some(p=>p.x===r&&p.y===i);let c,l,d,h;return a?(c=r,l=i,d=o,h=s):(c=r,l=s,d=o,h=i),u("g",{className:"tl-snap-indicator",stroke:"lime",children:[u("line",{x1:c,y1:l,x2:d,y2:h}),t.map((p,f)=>u("g",{transform:`translate(${p.x},${p.y})`,children:u("path",{className:"tl-snap-point",d:`M ${-n},${-n} L ${n},${n} M ${-n},${n} L ${n},${-n}`})},f))]})}function CH({gaps:t,direction:e,zoom:n}){const r=3.5/n;let o=[-1/0,1/0],i=null;const s=e==="horizontal";for(const c of t){if(i=gr(o[0],o[1],s?c.startEdge[0].y:c.startEdge[0].x,s?c.startEdge[1].y:c.startEdge[1].x),i)o=i;else continue;if(i=gr(o[0],o[1],s?c.endEdge[0].y:c.endEdge[0].x,s?c.endEdge[1].y:c.endEdge[1].x),i)o=i;else continue}if(o===null)return null;const a=(o[0]+o[1])/2;return u("g",{className:"tl-snap-indicator",stroke:"cyan",children:t.map(({startEdge:c,endEdge:l},d)=>u(Z,{children:s?u(Z,{children:[u("line",{x1:c[0].x,y1:a-2*r,x2:c[1].x,y2:a+2*r}),u("line",{x1:l[0].x,y1:a-2*r,x2:l[1].x,y2:a+2*r}),u("line",{x1:c[0].x,y1:a,x2:l[0].x,y2:a}),u("line",{x1:(c[0].x+l[0].x)/2,y1:a-r,x2:(c[0].x+l[0].x)/2,y2:a+r})]}):u(Z,{children:[u("line",{x1:a-2*r,y1:c[0].y,x2:a+2*r,y2:c[1].y}),u("line",{x1:a-2*r,y1:l[0].y,x2:a+2*r,y2:l[1].y}),u("line",{x1:a,y1:c[0].y,x2:a,y2:l[0].y}),u("line",{x1:a-r,y1:(c[0].y+l[0].y)/2,x2:a+r,y2:(c[0].y+l[0].y)/2})]})},d))})}function EH({className:t,line:e,zoom:n}){return u("svg",{className:de("tl-overlays__item",t),children:e.type==="points"?u(IH,{...e,zoom:n}):e.type==="gaps"?u(CH,{...e,zoom:n}):null})}function TS(){return u("svg",{width:16,height:16,viewBox:"0 0 16 16",children:u("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[u("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),u("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:u("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const TH=()=>null;function yC(t,e){const n=B(t);return e(t,n.current)?n.current:(n.current=t,t)}const kH=(t,e)=>(t??(t=null),e??(e=null),t===e?!0:!t||!e?!1:CL(t,e));function Jo(t){return yC(t,kH)}const MH=(t,e)=>(t??(t=null),e??(e=null),t===e?!0:!t||!e?!1:mx(t,e));function tl(t){return yC(t,MH)}const SC=Ze(null);function AH({overrides:t={},children:e}){const n=tl(t),r=ce(()=>({Background:f7,SvgDefs:TH,Brush:hf,ZoomBrush:hf,CollaboratorBrush:hf,Cursor:z0,CollaboratorCursor:z0,CollaboratorHint:gH,CollaboratorShapeIndicator:U0,Grid:mH,Scribble:B0,SnapIndicator:EH,Handles:SH,Handle:yH,CollaboratorScribble:B0,ErrorFallback:bC,ShapeErrorFallback:wH,ShapeIndicatorErrorFallback:PH,Spinner:TS,SelectionBackground:gC,SelectionForeground:bH,ShapeIndicators:mC,ShapeIndicator:U0,OnTheCanvas:null,InFrontOfTheCanvas:null,Canvas:YU,LoadingScreen:vH,...n}),[n]);return u(SC.Provider,{value:r,children:e})}function ht(){const t=tt(SC);if(!t)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return t}const Ch={openWindow(t,e){window.open(t,e,"noopener noreferrer")},refreshPage(){window.location.reload()},async hardReset(){var t;return await((t=window.__tldraw__hardReset)==null?void 0:t.call(window))}};function vC(){Ch.hardReset()}function OH(){Ch.refreshPage()}const DH="https://github.com/tldraw/tldraw/issues/new",bC=({error:t,editor:e})=>{const n=B(null),[r,o]=Q(!1),[i,s]=Q(!1),[a,c]=Q(!1);let l=null;try{l=ht().Canvas??null}catch{}const d=t instanceof Error?t.message:String(t),h=t instanceof Error?t.stack:null,p=U("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[f,g]=Q(null);je(()=>{var x;p!==null&&g(p);let _=(x=n.current)==null?void 0:x.parentElement,w=!1;for(;_;){if(_.classList.contains("tl-theme__dark")||_.classList.contains("tl-theme__light")){w=!0;break}_=_.parentElement}if(w){g(null);return}typeof window<"u"&&"matchMedia"in window&&g(window.matchMedia("(prefers-color-scheme: dark)").matches)},[p]),q(()=>{if(i){const _=e==null?void 0:e.timers.setTimeout(()=>{s(!1)},2e3);return()=>clearTimeout(_)}},[i,e]);const m=()=>{const _=document.createElement("textarea");_.value=h??d,document.body.appendChild(_),_.select(),document.execCommand("copy"),_.remove(),s(!0)},y=()=>{OH()},S=async()=>{vC()},v=new URL(DH);return v.searchParams.set("title",d),v.searchParams.set("labels","bug"),v.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${h??d}
\`\`\`

My browser: ${navigator.userAgent}`),u("div",{ref:n,className:de("tl-container tl-error-boundary",f===null?"":f?"tl-theme__dark":"tl-theme__light"),children:[u("div",{className:"tl-error-boundary__overlay"}),e&&u(_S,{onError:_c,fallback:()=>null,children:u(Xc.Provider,{value:e,children:u("div",{className:"tl-overlay tl-error-boundary__canvas",children:l?u(l,{}):null})})}),u("div",{className:de("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?u(Z,{children:[u("h2",{children:"Are you sure?"}),u("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),u("div",{className:"tl-error-boundary__content__actions",children:[u("button",{onClick:()=>c(!1),children:"Cancel"}),u("button",{className:"tl-error-boundary__reset",onClick:S,children:"Reset data"})]})]}):u(Z,{children:[u("h2",{children:"Something's gone wrong."}),u("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",u("a",{href:v.toString(),children:"create a GitHub issue"})," or"," ",u("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),r&&u(Z,{children:["Message:",u("h4",{children:u("code",{children:d})}),"Stack trace:",u("div",{className:"tl-error-boundary__content__error",children:[u("pre",{children:u("code",{children:h??d})}),u("button",{onClick:m,children:i?"Copied!":"Copy"})]})]}),u("div",{className:"tl-error-boundary__content__actions",children:[u("button",{onClick:()=>o(!r),children:r?"Hide details":"Show details"}),u("div",{className:"tl-error-boundary__content__actions__group",children:[u("button",{className:"tl-error-boundary__reset",onClick:()=>c(!0),children:"Reset data"}),u("button",{className:"tl-error-boundary__refresh",onClick:y,children:"Refresh Page"})]})]})]})})]})},wC="TLDRAW_USER_DATA_v3",_C=Me({id:Se,name:Se.nullable().optional(),locale:Se.nullable().optional(),color:Se.nullable().optional(),colorScheme:xh("light","dark","system").optional(),animationSpeed:ge.nullable().optional(),edgeScrollSpeed:ge.nullable().optional(),isSnapMode:Te.nullable().optional(),isWrapMode:Te.nullable().optional(),isDynamicSizeMode:Te.nullable().optional(),isPasteAtCursorMode:Te.nullable().optional()}),ho={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8},kS=Math.max(...Object.values(ho));function $H(t){t.version<ho.AddAnimationSpeed&&(t.user.animationSpeed=1),t.version<ho.AddIsSnapMode&&(t.user.isSnapMode=!1),t.version<ho.MakeFieldsNullable,t.version<ho.AddEdgeScrollSpeed&&(t.user.edgeScrollSpeed=1),t.version<ho.AddExcalidrawSelectMode&&(t.user.isWrapMode=!1),t.version<ho.AllowSystemColorScheme&&(t.user.isDarkMode===!0?t.user.colorScheme="dark":t.user.isDarkMode===!1&&(t.user.colorScheme="light"),delete t.user.isDarkMode),t.version<ho.AddDynamicSizeMode&&(t.user.isDynamicSizeMode=!1),t.version<ho.AddPasteAtCursor&&(t.user.isPasteAtCursorMode=!1),t.version=kS}const dm=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function xC(){return dm[Math.floor(Math.random()*dm.length)]}function RH(){var t,e;return typeof window<"u"&&"matchMedia"in window?((e=(t=window.matchMedia)==null?void 0:t.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:e.matches)??!1:!1}const lo=Object.freeze({name:"New User",locale:l7(),color:xC(),edgeScrollSpeed:1,animationSpeed:RH()?0:1,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,colorScheme:"system"});function yf(){return{id:Ye(),color:xC()}}function PC(t){if(t===null||typeof t!="object"||!("version"in t)||!("user"in t)||typeof t.version!="number")return yf();const e=ut(t);$H(e);try{return _C.validate(e.user)}catch{return yf()}}function LH(){const t=JSON.parse(Oy(wC)||"null")??null;return PC(t)}const Eh=Tt("globalUserData",null);function NH(){Dy(wC,JSON.stringify({version:kS,user:Eh.get()}))}function IC(t){_C.validate(t),Eh.set(t),NH(),zH()}const FH=typeof process<"u"&&!1,Bs=typeof BroadcastChannel<"u"&&!FH?new BroadcastChannel("tldraw-user-sync"):null;Bs==null||Bs.addEventListener("message",t=>{const e=t.data;(e==null?void 0:e.type)===EC&&(e==null?void 0:e.origin)!==CC()&&Eh.set(PC(e.data))});let Sf=null;function CC(){return Sf===null&&(Sf=Ye()),Sf}const EC="tldraw-user-preferences-change";function zH(){Bs==null||Bs.postMessage({type:EC,origin:CC(),data:{user:TC(),version:kS}})}function TC(){let t=Eh.get();return t||(t=LH(),IC(t)),t}const BH=K("defaultLocalStorageUserPrefs",()=>TC());function kC(t={}){return{userPreferences:t.userPreferences??BH,setUserPreferences:t.setUserPreferences??IC}}var MC={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function o(c,l,d){this.fn=c,this.context=l,this.once=d||!1}function i(c,l,d,h,p){if(typeof d!="function")throw new TypeError("The listener must be a function");var f=new o(d,h||c,p),g=n?n+l:l;return c._events[g]?c._events[g].fn?c._events[g]=[c._events[g],f]:c._events[g].push(f):(c._events[g]=f,c._eventsCount++),c}function s(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],d,h;if(this._eventsCount===0)return l;for(h in d=this._events)e.call(d,h)&&l.push(n?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},a.prototype.listeners=function(l){var d=n?n+l:l,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var p=0,f=h.length,g=new Array(f);p<f;p++)g[p]=h[p].fn;return g},a.prototype.listenerCount=function(l){var d=n?n+l:l,h=this._events[d];return h?h.fn?1:h.length:0},a.prototype.emit=function(l,d,h,p,f,g){var m=n?n+l:l;if(!this._events[m])return!1;var y=this._events[m],S=arguments.length,v,_;if(y.fn){switch(y.once&&this.removeListener(l,y.fn,void 0,!0),S){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,d),!0;case 3:return y.fn.call(y.context,d,h),!0;case 4:return y.fn.call(y.context,d,h,p),!0;case 5:return y.fn.call(y.context,d,h,p,f),!0;case 6:return y.fn.call(y.context,d,h,p,f,g),!0}for(_=1,v=new Array(S-1);_<S;_++)v[_-1]=arguments[_];y.fn.apply(y.context,v)}else{var w=y.length,x;for(_=0;_<w;_++)switch(y[_].once&&this.removeListener(l,y[_].fn,void 0,!0),S){case 1:y[_].fn.call(y[_].context);break;case 2:y[_].fn.call(y[_].context,d);break;case 3:y[_].fn.call(y[_].context,d,h);break;case 4:y[_].fn.call(y[_].context,d,h,p);break;default:if(!v)for(x=1,v=new Array(S-1);x<S;x++)v[x-1]=arguments[x];y[_].fn.apply(y[_].context,v)}}return!0},a.prototype.on=function(l,d,h){return i(this,l,d,h,!1)},a.prototype.once=function(l,d,h){return i(this,l,d,h,!0)},a.prototype.removeListener=function(l,d,h,p){var f=n?n+l:l;if(!this._events[f])return this;if(!d)return s(this,f),this;var g=this._events[f];if(g.fn)g.fn===d&&(!p||g.once)&&(!h||g.context===h)&&s(this,f);else{for(var m=0,y=[],S=g.length;m<S;m++)(g[m].fn!==d||p&&!g[m].once||h&&g[m].context!==h)&&y.push(g[m]);y.length?this._events[f]=y.length===1?y[0]:y:s(this,f)}return this},a.prototype.removeAllListeners=function(l){var d;return l?(d=n?n+l:l,this._events[d]&&s(this,d)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a})(MC);var UH=MC.exports;const HH=ts(UH),Us="TLDRAW_TAB_ID_v2",Po=globalThis.window;function jH(){return Po?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(Po.navigator.platform)||et.isDarwin&&"ontouchend"in document:!1}const $u=Po?Po[Us]??kx(Us)??"TLDRAW_INSTANCE_STATE_V1_"+Ye():"<error>";Po&&(Po[Us]=$u,jH()?$y(Us,$u):Mx(Us));Po==null||Po.addEventListener("beforeunload",()=>{$y(Us,$u)});const AC={Initial:0},Th=Math.max(...Object.values(AC));function KH(t){t.version<AC.Initial,t.version=Th}const OC=Me({version:ge,currentPageId:Ec.optional(),isFocusMode:Te.optional(),exportBackground:Te.optional(),isDebugMode:Te.optional(),isToolLocked:Te.optional(),isGridMode:Te.optional(),pageStates:Kt(Me({pageId:Ec,camera:Me({x:ge,y:ge,z:ge}).optional(),selectedShapeIds:Kt(rr).optional(),focusedGroupId:rr.nullable().optional()})).optional()});function WH(t){if(!t||typeof t!="object")return console.warn("Invalid instance state"),null;if(!("version"in t)||typeof t.version!="number")return console.warn("No version in instance state"),null;t.version!==Th&&(t=ut(t),KH(t));try{return OC.validate(t)}catch(e){return console.warn(e),null}}function MS(t){const e=t.query.ids("page");return K("sessionStateSnapshot",()=>{const n=t.get(hn);if(!n)return null;const r=[...e.get()];return{version:Th,currentPageId:n.currentPageId,exportBackground:n.exportBackground,isFocusMode:n.isFocusMode,isDebugMode:n.isDebugMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,pageStates:r.map(o=>{const i=t.get(vr.createId(o)),s=t.get(Ur.createId(o));return{pageId:o,camera:{x:(s==null?void 0:s.x)??0,y:(s==null?void 0:s.y)??0,z:(s==null?void 0:s.z)??1},selectedShapeIds:(i==null?void 0:i.selectedShapeIds)??[],focusedGroupId:(i==null?void 0:i.focusedGroupId)??null}})}})}function um(t,e,n){const r=WH(e);if(!r)return;const o=vI(t.get(hn)),i=n!=null&&n.forceOverwrite?r:o,s=n!=null&&n.forceOverwrite?o:r,a=t.schema.types.instance.create({id:hn,...o,currentPageId:r.currentPageId,isDebugMode:(i==null?void 0:i.isDebugMode)??(s==null?void 0:s.isDebugMode),isFocusMode:(i==null?void 0:i.isFocusMode)??(s==null?void 0:s.isFocusMode),isToolLocked:(i==null?void 0:i.isToolLocked)??(s==null?void 0:s.isToolLocked),isGridMode:(i==null?void 0:i.isGridMode)??(s==null?void 0:s.isGridMode),exportBackground:(i==null?void 0:i.exportBackground)??(s==null?void 0:s.exportBackground)});t.atomic(()=>{var c,l,d;for(const h of r.pageStates??[]){if(!t.has(h.pageId))continue;const p=Ur.createId(h.pageId),f=vr.createId(h.pageId),g=t.get(p),m=t.get(f);t.put([Ur.create({id:p,x:((c=h.camera)==null?void 0:c.x)??(g==null?void 0:g.x),y:((l=h.camera)==null?void 0:l.y)??(g==null?void 0:g.y),z:((d=h.camera)==null?void 0:d.z)??(g==null?void 0:g.z)}),vr.create({id:f,pageId:h.pageId,selectedShapeIds:h.selectedShapeIds??(m==null?void 0:m.selectedShapeIds),focusedGroupId:h.focusedGroupId??(m==null?void 0:m.focusedGroupId)})])}t.put([a]),t.ensureStoreIsUsable()})}function GH(t){var o;const e=[];for(const i of Object.values(t))(o=i.typeName)!=null&&o.match(/^(instance.*|pointer|camera)$/)&&e.push(i);const n=e.filter(i=>i.typeName==="instance"&&i.id!==hn)[0];if(!n)return null;const r={version:Th,currentPageId:n.currentPageId,exportBackground:!!n.exportBackground,isFocusMode:!!n.isFocusMode,isDebugMode:!!n.isDebugMode,isToolLocked:!!n.isToolLocked,isGridMode:!1,pageStates:e.filter(i=>i.typeName==="instance_page_state"&&i.instanceId===n.id).map(i=>{const s=t[i.cameraId]??{x:0,y:0,z:1};return{pageId:i.pageId,camera:{x:s.x,y:s.y,z:s.z},selectedShapeIds:i.selectedShapeIds,focusedGroupId:i.focusedGroupId}})};try{return OC.validate(r),r}catch{return null}}function DC(t,e,n){let r={};if("store"in e){const s=t.schema.migrateStoreSnapshot(e);if(s.type!=="success")throw new Error("Failed to migrate store snapshot: "+s.reason);r.document={schema:t.schema.serialize(),store:dc(s.value,(a,{typeName:c})=>t.scopedTypes.document.has(c))}}else r=e;const o=vI(t.get(hn)),i=$C.get(t,MS).get();t.atomic(()=>{r.document&&t.loadStoreSnapshot(r.document),o&&t.update(hn,s=>({...s,...o})),i&&um(t,i),r.session&&um(t,r.session,{forceOverwrite:n==null?void 0:n.forceOverwriteSessionState})})}const $C=new Gr;function VH(t){const n=$C.get(t,MS).get();if(!n)throw new Error("Session state is not ready yet");return{document:t.getStoreSnapshot(),session:n}}function RC(t){const e=[],n=new Set;for(const r of t){if(n.has(r.type))throw new Error(`Binding type "${r.type}" is defined more than once`);e.push(r),n.add(r.type)}return e}function ci({children:t,className:e="",...n}){return u("svg",{...n,className:de("tl-svg-container",e),children:t})}function AS(t,e,n,r){const o=t.x-n.x,i=t.y-n.y,s=r.x-n.x,a=r.y-n.y,c=e.x-t.x,l=e.y-t.y,d=s*i-a*o,h=c*i-l*o,p=a*c-s*l;if(d===0||h===0||p===0)return null;if(p!==0){const f=d/p,g=h/p;if(0<=f&&f<=1&&0<=g&&g<=1)return b.AddXY(t,f*c,f*l)}return null}function nl(t,e,n,r){const o=(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y),i=2*((e.x-t.x)*(t.x-n.x)+(e.y-t.y)*(t.y-n.y)),s=n.x*n.x+n.y*n.y+t.x*t.x+t.y*t.y-2*(n.x*t.x+n.y*t.y)-r*r,a=i*i-4*o*s;if(a<0||a===0)return null;const c=Math.sqrt(a),l=(-i+c)/(2*o),d=(-i-c)/(2*o);if((l<0||l>1)&&(d<0||d>1))return null;const h=[];return 0<=l&&l<=1&&h.push(b.Lrp(t,e,l)),0<=d&&d<=1&&h.push(b.Lrp(t,e,d)),h.length===0?null:h}function YH(t,e,n){const r=[];let o;for(let i=0,s=n.length-1;i<s;i++)o=AS(t,e,n[i],n[i+1]),o&&r.push(o);return r.length===0?null:r}function OS(t,e,n){const r=[];let o;for(let i=1,s=n.length;i<s+1;i++)o=AS(t,e,n[i-1],n[i%n.length]),o&&r.push(o);return r.length===0?null:r}function XH(t,e,n,r){let o=n.x-t.x,i=n.y-t.y;const s=Math.sqrt(o*o+i*i),a=(s*s-r*r+e*e)/(2*s),c=Math.sqrt(e*e-a*a);return o/=s,i/=s,[new b(t.x+o*a-i*c,t.y+i*a+o*c),new b(t.x+o*a+i*c,t.y+i*a-o*c)]}function hm(t,e,n){const r=[];let o,i,s;for(let a=0,c=n.length;a<c;a++)o=n[a],i=n[(a+1)%n.length],s=nl(o,i,t,e),s&&r.push(...s);return r.length===0?null:r}function H0(t,e,n){const r=[];let o,i,s;for(let a=1,c=n.length;a<c;a++)o=n[a-1],i=n[a],s=nl(o,i,t,e),s&&r.push(...s);return r.length===0?null:r}function Ul(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function DS(t,e,n,r){return Ul(t,n,r)!==Ul(e,n,r)&&Ul(t,e,n)!==Ul(t,e,r)}function j0(t,e){const n=new Map;let r,o,i,s;for(let a=0,c=t.length;a<c;a++)if(r=t[a],Vn(r,e)){const l=vf(r);n.has(l)||n.set(l,r)}for(let a=0,c=e.length;a<c;a++)if(r=e[a],Vn(r,t)){const l=vf(r);n.has(l)||n.set(l,r)}for(let a=0,c=t.length;a<c;a++){r=t[a],o=t[(a+1)%t.length];for(let l=0,d=e.length;l<d;l++){i=e[l],s=e[(l+1)%e.length];const h=AS(r,o,i,s);if(h!==null){const p=vf(h);n.has(p)||n.set(p,h)}}}return n.size===0?null:qH([...n.values()])}function vf(t){return`${t.x},${t.y}`}function qH(t){const e=b.Average(t);return t.sort((n,r)=>b.Angle(e,n)-b.Angle(e,r))}function LC(t,e){let n,r,o,i;for(let s=0,a=t.length;s<a;s++){n=t[s],r=t[(s+1)%a];for(let c=0,l=e.length;c<l;c++)if(o=e[c],i=e[(c+1)%l],DS(n,r,o,i))return!0}return!1}function ZH(t,e){let n,r,o,i;for(let s=0,a=t.length;s<a;s++){n=t[s],r=t[(s+1)%a];for(let c=1,l=e.length;c<l;c++)if(o=e[c-1],i=e[c],DS(n,r,o,i))return!0}return!1}class So extends Si{constructor(n){super({...n,isClosed:!1,isFilled:!1});P(this,"start");P(this,"end");P(this,"d");P(this,"u");P(this,"ul");const{start:r,end:o}=n;this.start=r,this.end=o,this.d=r.clone().sub(o),this.u=this.d.clone().uni(),this.ul=this.u.len()}getLength(){return this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(n){const{start:r,end:o,d:i,u:s,ul:a}=this;if(i.len()===0||a===0)return r;const c=b.Sub(n,r).dpr(s)/a,l=r.x+s.x*c;if(l<Math.min(r.x,o.x))return r.x<o.x?r:o;if(l>Math.max(r.x,o.x))return r.x>o.x?r:o;const d=r.y+s.y*c;return d<Math.min(r.y,o.y)?r.y<o.y?r:o:d>Math.max(r.y,o.y)?r.y>o.y?r:o:new b(l,d)}hitTestLineSegment(n,r,o=0){return DS(n,r,this.start,this.end)||this.distanceToLineSegment(n,r)<=o}getSvgPathData(n=!0){const{start:r,end:o}=this;return`${n?`M${r.toFixed()}`:""} L${o.toFixed()}`}}class ba extends Si{constructor(n){super({isClosed:!1,isFilled:!1,...n});P(this,"points");P(this,"_segments");const{points:r}=n;this.points=r}get segments(){if(!this._segments){this._segments=[];const{vertices:n}=this;for(let r=0,o=n.length-1;r<o;r++){const i=n[r],s=n[r+1];this._segments.push(new So({start:i,end:s}))}this.isClosed&&this._segments.push(new So({start:n[n.length-1],end:n[0]}))}return this._segments}getLength(){return this.segments.reduce((n,r)=>n+r.length,0)}getVertices(){return this.points}nearestPoint(n){const{segments:r}=this;let o=this.points[0],i=1/0,s,a;for(let c=0;c<r.length;c++)s=r[c].nearestPoint(n),a=b.Dist2(s,n),a<i&&(o=s,i=a);if(!o)throw Error("nearest point not found");return o}hitTestLineSegment(n,r,o=0){const{segments:i}=this;for(let s=0,a=i.length;s<a;s++)if(i[s].hitTestLineSegment(n,r,o))return!0;return!1}getSvgPathData(){const{vertices:n}=this;return n.length<2?"":n.reduce((r,o,i)=>i===0?`M ${o.x} ${o.y}`:`${r} L ${o.x} ${o.y}`,"")}}class xt extends ba{constructor(e){super({...e}),this.isClosed=!0}}class Mo extends xt{constructor(n){const{x:r=0,y:o=0,width:i,height:s}=n;super({...n,points:[new b(r,o),new b(r+i,o),new b(r+i,o+s),new b(r,o+s)]});P(this,"x");P(this,"y");P(this,"w");P(this,"h");this.x=r,this.y=o,this.w=i,this.h=s}getBounds(){return new ee(this.x,this.y,this.w,this.h)}getSvgPathData(){const{x:n,y:r,w:o,h:i}=this;return`M${n},${r} h${o} v${i} h-${o}z`}}class _r{constructor(e){this.editor=e}canSnap(e){return!0}canScroll(e){return!1}canBind(e){return!0}canEdit(e){return!1}canResize(e){return!0}canEditInReadOnly(e){return!1}canCrop(e){return!1}canBeLaidOut(e){return!0}providesBackgroundForChildren(e){return!1}hideResizeHandles(e){return!1}hideRotateHandle(e){return!1}hideSelectionBoundsBg(e){return!1}hideSelectionBoundsFg(e){return!1}isAspectRatioLocked(e){return!1}canReceiveNewChildrenOfType(e,n){return!1}canDropShapes(e,n){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}getText(e){}}P(_r,"props"),P(_r,"migrations"),P(_r,"type");function Sr(t,e,n={}){const{closed:r=!1,snap:o=1,start:i="outset",end:s="outset",lengthRatio:a=2,style:c="dashed",forceSolid:l=!1}=n;let d=0,h=0,p=1,f=0,g=0;if(l)return{strokeDasharray:"none",strokeDashoffset:"none"};switch(c){case"dashed":{p=1,d=Math.min(e*a,t/4);break}case"dotted":{p=100,d=e/p;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(i==="outset"?(t+=d/2,g+=d/2):i==="skip"&&(t-=d,g-=d),s==="outset"?t+=d/2:s==="skip"&&(t-=d)),h=Math.floor(t/d/(2*p)),h-=h%o,h<3&&c==="dashed"?t/e<4?(d=t,h=1,f=0):(d=t*(1/3),f=t*(1/3)):(d=t/h/(2*p),r?(g=d/2,f=(t-h*d)/h):f=(t-h*d)/Math.max(1,h-1)),{strokeDasharray:[d,f].join(" "),strokeDashoffset:g.toString()}}function K0({bounds:t,className:e}){const n=F(),r=U("zoom level",()=>n.getZoomLevel(),[n]);return u("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:t.sides.map((o,i)=>{const{strokeDasharray:s,strokeDashoffset:a}=Sr(o[0].dist(o[1]),1/r,{style:"dashed",lengthRatio:4});return u("line",{x1:o[0].x,y1:o[0].y,x2:o[1].x,y2:o[1].y,strokeDasharray:s,strokeDashoffset:a},i)})})}class Id extends _r{hideSelectionBoundsFg(){return!0}canBind(){return!1}getDefaultProps(){return{}}getGeometry(e){const n=this.editor.getSortedChildIdsForParent(e.id);return n.length===0?new Mo({width:1,height:1,isFilled:!1}):new Ir({children:n.map(r=>{const o=this.editor.getShape(r),i=this.editor.getShapeGeometry(r),s=this.editor.getShapeLocalTransform(o).applyToPoints(i.vertices);return i.isClosed?new xt({points:s,isFilled:!0}):new ba({points:s})})})}component(e){const n=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:r}=this.editor.getCurrentPageState(),o=r.length>0&&r.some(a=>a!==e.id&&this.editor.isShapeOfType(this.editor.getShape(a),"group")),i=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!n&&(i||o))return null;const s=this.editor.getShapeGeometry(e).bounds;return u(ci,{id:e.id,children:u(K0,{className:"tl-group",bounds:s})})}indicator(e){const n=this.editor.getShapeGeometry(e).bounds;return u(K0,{className:"",bounds:n})}onChildrenChange(e){const n=this.editor.getSortedChildIdsForParent(e.id);if(n.length===0){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}else if(n.length===1){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(n,e.parentId),this.editor.deleteShapes([e.id]);return}}}P(Id,"type","group"),P(Id,"props",AI),P(Id,"migrations",OI);const NC=[Id],JH=new Set(NC.map(t=>t.type));function FC(t){const e=[...NC],n=new Set;for(const r of t){if(JH.has(r.type))throw new Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(n.has(r.type))throw new Error(`Shape type "${r.type}" is defined more than once`);e.push(r),n.add(r.type)}return e}function QH(t){return{render:function(e){iS(e,t)},unmount:function(){aS(t)}}}function zC(t,e){const n=new Map;return async function(o){const i=n.get(o);if(i)return i;const s=(async()=>{try{const a=await Pr(o,e);return He(a.ok),await t(a)}catch(a){return console.error(a),null}})();return n.set(o,s),s}}const kh=zC(async t=>await wo.blobToDataUrl(await t.blob())),ej=/@import\s+(?:"([^"]+)"|'([^']+)'|url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\))([^;]+);/gi,tj=/@font-face\s*{([^}]+)}/gi,BC=/url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\)/gi,nj=/(?:^|;)\s*font-family\s*:\s*(?:([^'"][^;\n]+)|"([^"]+)"|'([^']+)')\s*(?:;|$)/gi;function rj(t){return Array.from(t.matchAll(ej),e=>({url:e[1]||e[2]||e[3]||e[4]||e[5],extras:e[6]}))}function UC(t,e){return Array.from(t.matchAll(tj),n=>{const r=n[1],o=Array.from(r.matchAll(BC),s=>{var c;const a=s[1]||s[2]||s[3];return{original:a,resolved:((c=ye(a,e))==null?void 0:c.href)??null}}),i=new Set(Array.from(r.matchAll(nj),s=>(s[1]||s[2]||s[3]).toLowerCase()));return{fontFace:r,urls:o,fontFamilies:i}})}function oj(t){const e=/\s*(?:([^'"][^;\n\s,]+)|"([^"]+)"|'([^']+)')\s*/gi,n=/\s*,\s*/gi,r=new Set;for(;;){const o=e.exec(t);if(!o)break;const i=o[1]||o[2]||o[3];if(r.add(i.toLowerCase()),n.lastIndex=e.lastIndex,!n.exec(t))break;e.lastIndex=n.lastIndex}return r}function HC(t){return!(t.startsWith("-")||t.startsWith("animation")||t.startsWith("transition")||t==="cursor"||t==="pointer-events"||t==="user-select"||t==="touch-action")}function ij(t,e){return{imports:rj(t),fontFaces:UC(t,e)}}function sj(t){return Array.from(t.matchAll(BC),e=>({original:e[0],url:e[1]||e[2]||e[3]}))}const aj=new Set(["border-collapse","border-spacing","caption-side","color","cursor","direction","empty-cells","font-family","font-size","font-style","font-variant","font-weight","font-size-adjust","font-stretch","font","letter-spacing","line-height","list-style-image","list-style-position","list-style-type","list-style","orphans","quotes","tab-size","text-align","text-align-last","text-decoration-color","text-indent","text-justify","text-shadow","text-transform","visibility","white-space","widows","word-break","word-spacing","word-wrap"]);function jC(t){return aj.has(t)}var cj=Object.create,KC=Object.defineProperty,lj=Object.getOwnPropertyDescriptor,dj=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),WC=t=>{throw TypeError(t)},GC=(t,e,n)=>e in t?KC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,uj=t=>[,,,cj(null)],VC=["class","method","getter","setter","accessor","field","value","get","set"],YC=t=>t!==void 0&&typeof t!="function"?WC("Function expected"):t,hj=(t,e,n,r,o)=>({kind:VC[t],name:e,metadata:r,addInitializer:i=>n._?WC("Already initialized"):o.push(YC(i||null))}),pj=(t,e)=>GC(e,dj("metadata"),t[3]),fj=(t,e,n,r)=>{for(var o=0,i=t[e>>1],s=i&&i.length;o<s;o++)i[o].call(n);return r},gj=(t,e,n,r,o,i)=>{for(var s,a,c,l,d=e&7,h=!!(e&8),p=!!(e&16),f=2,g=VC[d+5],m=t[f]||(t[f]=[]),y=(o=o.prototype,lj(o,n)),S=r.length-1;S>=0;S--)c=hj(d,n,a={},t[3],m),c.static=h,c.private=p,l=c.access={has:v=>n in v},l.get=v=>v[n],s=(0,r[S])(y[g],c),a._=1,YC(s)&&(y[g]=s);return y&&KC(o,n,y),o},Hl=(t,e,n)=>GC(t,typeof e!="symbol"?e+"":e,n),XC,Mh;XC=[Tn];class $S{constructor(){fj(Mh,5,this),Hl(this,"fontFacesPromise",null),Hl(this,"foundFontNames",new Set),Hl(this,"fontFacesToEmbed",new Set),Hl(this,"pendingPromises",[])}startFindingCurrentDocumentFontFaces(){He(!this.fontFacesPromise,"FontEmbedder already started"),this.fontFacesPromise=mj()}onFontFamilyValue(e){He(this.fontFacesPromise,"FontEmbedder not started");const n=oj(e);for(const r of n){if(this.foundFontNames.has(r))return;this.foundFontNames.add(r),this.pendingPromises.push(this.fontFacesPromise.then(o=>{const i=o.filter(s=>s.fontFamilies.has(r));for(const s of i)if(!this.fontFacesToEmbed.has(s)){this.fontFacesToEmbed.add(s);for(const a of s.urls)!a.resolved||a.embedded||(a.embedded=kh(a.resolved))}}))}}async createCss(){await Promise.all(this.pendingPromises);let e="";for(const n of this.fontFacesToEmbed){let r=`@font-face {${n.fontFace}}`;for(const o of n.urls){if(!o.embedded)continue;const i=await o.embedded;i&&(r=r.replace(o.original,i))}e+=r}return e}}Mh=uj();gj(Mh,1,"onFontFamilyValue",XC,$S);pj(Mh,$S);async function mj(){const t=[];for(const e of document.styleSheets){let n;try{n=e.cssRules}catch{}if(n)for(const r of e.cssRules)r instanceof CSSFontFaceRule?t.push(UC(r.cssText,e.href??document.baseURI)):r instanceof CSSImportRule&&t.push(pm(r.href));else e.href&&t.push(pm(e.href))}return be(await Promise.all(t)).flat()}const pm=zC(async t=>{const e=ij(await t.text(),t.url),n=await Promise.all(e.imports.map(({url:r})=>pm(new URL(r,t.url).href)));return[...e.fontFaces,...be(n).flat()]});function qC(t){if(t.shadowRoot)return t.shadowRoot.childNodes;if(bj(t)){const e=t.assignedNodes();if(e!=null&&e.length)return e}return t.childNodes}function*fm(t){for(const e of qC(t))yj(e)&&(yield e)}function Ah(t){var e;return((e=t.ownerDocument)==null?void 0:e.defaultView)??globalThis}function yj(t){return t instanceof Ah(t).Element}function Sj(t){return t instanceof Ah(t).ShadowRoot}function vj(t){return"getRootNode"in t&&Sj(t.getRootNode())}function bj(t){return vj(t)&&t instanceof Ah(t).HTMLSlotElement}function wj(t){return t.style}function RS(t,e){return Ah(t).getComputedStyle(t,e)}const Fi={};class _j{constructor(e){P(this,"styles",new Map);P(this,"fonts",new $S);this.root=e}readRootElementStyles(e){this.readElementStyles(e,{shouldRespectDefaults:!1,shouldSkipInheritedParentStyles:!1});const n=Array.from(fm(e));for(;n.length;){const r=n.pop();n.push(...fm(r)),this.readElementStyles(r,{shouldRespectDefaults:!0,shouldSkipInheritedParentStyles:!0})}}readElementStyles(e,{shouldRespectDefaults:n=!0,shouldSkipInheritedParentStyles:r=!0}){var a;const o=n?Cj(e.tagName.toLowerCase()):Fi,i=r?((a=this.styles.get(e.parentElement))==null?void 0:a.self)??Fi:Fi,s={self:xj(e,{defaultStyles:o,parentStyles:i}),before:W0(e,"::before"),after:W0(e,"::after")};this.styles.set(e,s)}fetchResources(){const e=[];for(const n of this.styles.values())for(const r of gt(n))if(r)for(const[o,i]of Object.entries(r)){if(!i)continue;o==="font-family"&&this.fonts.onFontFamilyValue(i);const s=sj(i);s.length!==0&&e.push(...s.map(async({url:a,original:c})=>{const l=await kh(a)??"data:";r[o]=i.replace(c,`url("${l}")`)}))}return Promise.all(e)}unwrapCustomElements(){const e=new Set,n=(r,o)=>{if(e.has(r))return;e.add(r);const i=r.shadowRoot;if(i){const s=document.createElement("div");this.styles.set(s,this.styles.get(r)),s.setAttribute("data-tl-custom-element",r.tagName),(o??r.parentElement).appendChild(s);for(const a of i.childNodes)a instanceof Element?n(a,s):s.appendChild(a.cloneNode(!0));r.remove()}else if(o){if(r.tagName.toLowerCase()==="style")return;const s=r.cloneNode(!1);this.styles.set(s,this.styles.get(r)),o.appendChild(s);for(const a of qC(r))a instanceof Element?n(a,s):s.appendChild(a.cloneNode(!0))}};for(const r of this.styles.keys())n(r,null)}embedStyles(){let e="";for(const[n,r]of this.styles){if(r.after||r.before){const i=`pseudo-${Ye()}`;n.classList.add(i),r.before&&(e+=`.${i}::before {${G0(r.before)}}
`),r.after&&(e+=`.${i}::after {${G0(r.after)}}
`)}const o=wj(n);for(const[i,s]of Object.entries(r.self))s&&o.setProperty(i,s);o.fontKerning==="auto"&&(o.fontKerning="normal")}return e}async getFontFaceCss(){return await this.fonts.createCss()}dispose(){Ij()}}function xj(t,{defaultStyles:e,parentStyles:n}){return t.computedStyleMap?ZC(t.computedStyleMap(),{defaultStyles:e,parentStyles:n}):LS(RS(t),{defaultStyles:e,parentStyles:n})}function W0(t,e){const n=RS(t,e),r=n.getPropertyValue("content");if(!(r===""||r==="none"))return LS(n,{defaultStyles:Fi,parentStyles:Fi})}function ZC(t,{defaultStyles:e,parentStyles:n}){const r={};for(const o of t.keys()){if(!HC(o))continue;const i=t.get(o).toString();e[o]!==i&&(n[o]===i&&jC(o)||(r[o]=i))}return r}function LS(t,{defaultStyles:e,parentStyles:n}){const r={};for(const o of t){if(!HC(o))continue;const i=t.getPropertyValue(o);e[o]!==i&&(n[o]===i&&jC(o)||(r[o]=i))}return r}function G0(t){let e="";for(const[n,r]of Object.entries(t))e+=`${n}: ${r};`;return e}let Hs;const V0={};function Pj(){if(!Hs){const t=document.createElement("iframe");t.style.display="none",document.body.appendChild(t);const e=Hn(t.contentDocument,"frame must have a document"),n=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");n.appendChild(r),e.body.appendChild(n),Hs={iframe:t,foreignObject:r,document:e}}return Hs}function Ij(){Hs&&(document.body.removeChild(Hs.iframe),Hs=void 0)}const Y0={defaultStyles:Fi,parentStyles:Fi};function Cj(t){let e=V0[t];if(!e){const{foreignObject:n,document:r}=Pj(),o=r.createElement(t);n.appendChild(o),e=o.computedStyleMap?ZC(o.computedStyleMap(),Y0):LS(RS(o),Y0),n.removeChild(o),V0[t]=e}return e}function Ej(t,e){Array.from(t.attributes).forEach(r=>{e.setAttribute(r.name,r.value)})}function X0(t,e){return t.replaceWith(e),e}async function fc(t,e){const n=document.createElement("img");e&&Ej(e,n),n.setAttribute("src",t??"data:"),n.setAttribute("decoding","sync"),n.setAttribute("loading","eager");try{await n.decode()}catch{}return n}async function Tj(t){try{const e=t.toDataURL();return await fc(e,t)}catch{return await fc(null,t)}}async function kj(t){try{const e=await Kn.getVideoFrameAsDataUrl(t);return fc(e,t)}catch(e){console.error("Could not get video frame",e)}if(t.poster){const e=await kh(t.poster);return fc(e,t)}return fc(null,t)}async function JC(t){if(t instanceof HTMLCanvasElement)return X0(t,await Tj(t));if(t instanceof HTMLVideoElement)return X0(t,await kj(t));if(t instanceof HTMLImageElement){const e=t.currentSrc||t.src,n=await kh(e);t.setAttribute("src",n??"data:"),t.setAttribute("decoding","sync"),t.setAttribute("loading","eager");try{await t.decode()}catch{}return t}else t instanceof HTMLInputElement?t.setAttribute("value",t.value):t instanceof HTMLTextAreaElement&&(t.textContent=t.value);await Promise.all(Array.from(fm(t),e=>JC(e)))}function Oh(t){const e=B();return je(()=>{e.current=t}),yh(t),V((...n)=>{const r=e.current;return He(r,"fn does not exist"),r(...n)},[])}const NS=Ze(null);function Mj({context:t,editor:e,children:n}){return u(Xc.Provider,{value:e,children:u(NS.Provider,{value:t,children:n})})}function rl(){return tt(NS)}function Aj(){const t=tt(NS),[e]=Q(Iy);return q(()=>(t==null||t.waitUntil(e),()=>{e.resolve()}),[e,t]),Oh(()=>{e.resolve()})}var Oj=Object.create,QC=Object.defineProperty,Dj=Object.getOwnPropertyDescriptor,$j=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),eE=t=>{throw TypeError(t)},tE=(t,e,n)=>e in t?QC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Rj=t=>[,,,Oj(null)],nE=["class","method","getter","setter","accessor","field","value","get","set"],rE=t=>t!==void 0&&typeof t!="function"?eE("Function expected"):t,Lj=(t,e,n,r,o)=>({kind:nE[t],name:e,metadata:r,addInitializer:i=>n._?eE("Already initialized"):o.push(rE(i||null))}),Nj=(t,e)=>tE(e,$j("metadata"),t[3]),Fj=(t,e,n,r)=>{for(var o=0,i=t[e>>1],s=i&&i.length;o<s;o++)i[o].call(n);return r},zj=(t,e,n,r,o,i)=>{for(var s,a,c,l,d=e&7,h=!!(e&8),p=!!(e&16),f=2,g=nE[d+5],m=t[f]||(t[f]=[]),y=(o=o.prototype,Dj(o,n)),S=r.length-1;S>=0;S--)c=Lj(d,n,a={},t[3],m),c.static=h,c.private=p,l=c.access={has:v=>n in v},l.get=v=>v[n],s=(0,r[S])(y[g],c),a._=1,rE(s)&&(y[g]=s);return y&&QC(o,n,y),o},q0=(t,e,n)=>tE(t,typeof e!="symbol"?e+"":e,n),oE,Dh;oE=[Tn];class FS{constructor(e){this.maxDelayTimeMs=e,Fj(Dh,5,this),q0(this,"isResolved",!1),q0(this,"promisesToWaitFor",[])}waitUntil(e){if(this.isResolved)throw new Error("Cannot `waitUntil` - the export has already been resolved. Make sure to call `waitUntil` as soon as possible during an export - ie within the first react effect after rendering.");this.promisesToWaitFor.push(e.catch(n=>console.error("Error whilst waiting for export:",n)))}async resolvePromises(){let e=null;for(;this.promisesToWaitFor.length!==e;)e=this.promisesToWaitFor.length,await Promise.allSettled(this.promisesToWaitFor),await Og(0)}async resolve(){const e=Og(this.maxDelayTimeMs).then(()=>"timeout"),n=this.resolvePromises().then(()=>"resolved");await Promise.race([e,n])==="timeout"&&console.warn("[tldraw] Export delay timed out after ${this.maxDelayTimeMs}ms"),this.isResolved=!0}}Dh=Rj();zj(Dh,1,"waitUntil",oE,FS);Nj(Dh,FS);function Bj(t,e,n={}){var S,v;if(!window.document)throw Error("No document");const{scale:r=1,background:o=!1,padding:i=t.options.defaultSvgPadding,preserveAspectRatio:s}=n,a=n.darkMode??t.user.getIsDarkMode(),c=t.getShapeAndDescendantIds(e),l=t.getUnorderedRenderingShapes(!1).filter(({id:_})=>c.has(_));let d=null;if(n.bounds)d=n.bounds;else for(const{id:_}of l){const w=t.getShapeMaskedPageBounds(_);w&&(d?d.union(w):d=w.clone())}if(!d)return;const h=e.length===1&&t.isShapeOfType(t.getShape(e[0]),"frame")?e[0]:null;h||d.expandBy(i);const p=d.width*r,f=d.height*r;try{(v=(S=document.body).focus)==null||v.call(S)}catch{}const g=new FS(t.options.maxExportDelayMs),m=Iy();return g.waitUntil(m),{jsx:u(Uj,{editor:t,preserveAspectRatio:s,scale:r,bbox:d,background:o,singleFrameShapeId:h,isDarkMode:a,renderingShapes:l,onMount:m.resolve,waitUntil:g.waitUntil}),width:p,height:f,exportDelay:g}}function Uj({editor:t,preserveAspectRatio:e,scale:n,bbox:r,background:o,singleFrameShapeId:i,isDarkMode:s,renderingShapes:a,onMount:c,waitUntil:l}){const d=Lo({isDarkMode:s}),[h,p]=Q({}),f=Oh(v=>{wr(h,v.key)||l((async()=>{const _=await v.getElement();_&&Hi(()=>p(w=>({...w,[v.key]:_})))})())}),g=ce(()=>({isDarkMode:s,waitUntil:l,addExportDef:f}),[s,l,f]),[m,y]=Q(null),S=B(!1);return je(()=>{if(S.current)throw new Error("SvgExport should only render once - do not use with react strict mode");S.current=!0,(async()=>{const v={},_=a.map(async({id:x,opacity:C,index:E,backgroundIndex:I})=>{var A,O;if(x===i)return[];const T=t.getShape(x);if(t.isShapeOfType(T,"group"))return[];const k=[],D=t.getShapeUtil(T);if(D.toSvg||D.toBackgroundSvg){const[$,z]=await Promise.all([(A=D.toSvg)==null?void 0:A.call(D,T,g),(O=D.toBackgroundSvg)==null?void 0:O.call(D,T,g)]),R=t.getShapePageTransform(T);let W=R.toCssString();"scale"in T.props&&T.props.scale!==1&&(W=`${W} scale(${T.props.scale}, ${T.props.scale})`);const j=t.getShapeMask(T.id),G=j?J.From(J.Inverse(R)).applyToPoints(j):null,le=`mask_${va(T.id)}`;G&&(v[le]=u("clipPath",{id:le,children:u("path",{d:`M${G.map(({x:he,y:ve})=>`${he},${ve}`).join("L")}Z`})})),$&&k.push({zIndex:E,element:u("g",{transform:W,opacity:C,clipPath:j?`url(#${le})`:void 0,children:$},`fg_${T.id}`)}),z&&k.push({zIndex:I,element:u("g",{transform:W,opacity:C,clipPath:j?`url(#${le})`:void 0,children:z},`bg_${T.id}`)})}else k.push({zIndex:E,element:u(Z0,{shape:T,util:D,component:hC,className:"tl-shape",bbox:r,opacity:C},`fg_${T.id}`)}),D.backgroundComponent&&k.push({zIndex:I,element:u(Z0,{shape:T,util:D,component:pC,className:"tl-shape tl-shape-background",bbox:r,opacity:C},`bg_${T.id}`)});return k}),w=(await Promise.all(_)).flat();Hi(()=>{y(w.sort((x,C)=>x.zIndex-C.zIndex).map(({element:x})=>x)),p(x=>({...x,...v}))})})()},[r,t,g,a,i]),q(()=>{m!==null&&c()},[c,m]),u(Mj,{editor:t,context:g,children:u("svg",{preserveAspectRatio:e,direction:"ltr",width:r.width*n,height:r.height*n,viewBox:`${r.minX} ${r.minY} ${r.width} ${r.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:o?i?d.solid:d.background:"transparent"},"data-color-mode":s?"dark":"light",className:`tl-container tl-theme__force-sRGB ${s?"tl-theme__dark":"tl-theme__light"}`,children:[u("defs",{children:Object.entries(h).map(([v,_])=>u(Z,{children:_},v))}),m]})})}function Z0({shape:t,util:e,className:n,component:r,bbox:o,opacity:i}){const s=F(),a=J.Translate(-o.minX,-o.minY).multiply(s.getShapePageTransform(t.id)),c=s.getShapeGeometry(t.id).bounds,l=Math.max(c.width,1),d=Math.max(c.height,1);return u(_S,{fallback:()=>null,children:u("foreignObject",{x:o.minX,y:o.minY,width:o.w,height:o.h,className:"tl-shape-foreign-object",children:u("div",{className:n,"data-shape-type":t.type,style:{clipPath:s.getShapeClipPath(t.id),transform:a.toCssString(),width:l,height:d,opacity:i},children:u(r,{shape:t,util:e})})})})}async function Hj(t,e,n={}){const r=Bj(t,e,n);if(!r)return;const o=t.getContainer(),i=document.createElement("div");i.className="tldraw-svg-export",i.inert=!0,i.tabIndex=-1,Object.assign(i.style,{position:"absolute",top:"0px",left:"0px",width:r.width+"px",height:r.height+"px",pointerEvents:"none",opacity:0}),o.appendChild(i);const s=QH(i);try{Hi(()=>{s.render(r.jsx)}),await r.exportDelay.resolve();const a=i.firstElementChild;return He(a instanceof SVGSVGElement,"Expected an SVG element"),await jj(a),{svg:a,width:r.width,height:r.height}}finally{setTimeout(()=>{s.unmount(),o.removeChild(i)},0)}}async function jj(t){const e=[...t.querySelectorAll("foreignObject.tl-shape-foreign-object > *")];if(!e.length)return;const n=new _j(t);try{n.fonts.startFindingCurrentDocumentFontFaces(),await Promise.all(e.map(i=>JC(i)));for(const i of e)n.readRootElementStyles(i);await n.fetchResources();const r=await n.getFontFaceCss();n.unwrapCustomElements();const o=n.embedStyles();if(r||o){const i=document.createElementNS("http://www.w3.org/2000/svg","style");i.textContent=`${r}
${o}`,t.prepend(i)}}finally{n.dispose()}}const mr={menus:Tt("open menus",[]),getOpenMenus(t){return t?this.menus.get().filter(e=>e.endsWith("-"+t)):this.menus.get()},addOpenMenu(t,e=""){const n=e?`${t}-${e}`:t,r=new Set(this.menus.get());r.has(n)||(r.add(n),this.menus.set([...r]))},deleteOpenMenu(t,e=""){const n=e?`${t}-${e}`:t,r=new Set(this.menus.get());r.has(n)&&(r.delete(n),this.menus.set([...r]))},clearOpenMenus(t){this.menus.set(t?this.menus.get().filter(e=>!e.endsWith("-"+t)):[])},_hiddenMenus:[],hideOpenMenus(t){if(this._hiddenMenus=[...this.getOpenMenus(t)],this._hiddenMenus.length!==0)for(const e of this._hiddenMenus)this.deleteOpenMenu(e,t)},showOpenMenus(t){if(this._hiddenMenus.length!==0){for(const e of this._hiddenMenus)this.addOpenMenu(e,t);this._hiddenMenus=[]}},isMenuOpen(t,e){return this.getOpenMenus(e).includes(t)},hasOpenMenus(t){return this.getOpenMenus(t).length>0},hasAnyOpenMenus(){return this.getOpenMenus().length>0},forContext(t){return{getOpenMenus:()=>this.getOpenMenus(t),addOpenMenu:e=>this.addOpenMenu(e,t),deleteOpenMenu:e=>this.deleteOpenMenu(e,t),clearOpenMenus:()=>this.clearOpenMenus(t),isMenuOpen:e=>this.isMenuOpen(e,t),hasOpenMenus:()=>this.hasOpenMenus(t),hasAnyOpenMenus:()=>this.hasAnyOpenMenus()}}},gm=new l5,Kj={maxShapesPerPage:4e3,maxFilesAtOnce:100,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,maxPointsPerDrawShape:500,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16,laserDelayMs:1200,maxExportDelayMs:5e3,temporaryAssetPreviewLifetimeMs:18e4,actionShortcutsLocation:"swap"};function J0(t,e){if(!e)return!1;switch(t.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&t.value===e.value;default:throw $t(t)}}class Wj{constructor(e){P(this,"map");this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const n=this.get(e);if(n&&n.type!=="mixed")return n.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const n=new Set;for(const[r,o]of this){if(!J0(o,e.get(r)))return!1;n.add(r)}for(const[r,o]of e)if(!n.has(r)&&!J0(o,this.get(r)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class mm extends Wj{set(e,n){this.map.set(e,n)}applyValue(e,n){const r=this.get(e);if(!r){this.set(e,{type:"shared",value:n});return}switch(r.type){case"mixed":return;case"shared":r.value!==n&&this.set(e,{type:"mixed"});return;default:$t(r,"type")}}}function Gj(t,e,n){return Pr(t).then(function(r){return r.arrayBuffer()}).then(function(r){return new File([r],e,{type:n})})}const Vj="https://cdn.tldraw.com";function ti(){return`${Vj}/${GI}`}function Yj(t){switch(t.type){case"shapes":return`s${t.shapeIds.map(n=>bf(n.slice(6))).join(".")}`;case"page":return"p"+bf(Zn.parseId(t.pageId));case"viewport":{const{bounds:e,pageId:n}=t;let r=`v${Math.round(e.x)}.${Math.round(e.y)}.${Math.round(e.w)}.${Math.round(e.h)}`;return n&&(r+="."+bf(Zn.parseId(n))),r}default:$t(t)}}function Xj(t){switch(t[0]){case"s":return{type:"shapes",shapeIds:t.slice(1).split(".").filter(Boolean).map(r=>Xe(decodeURIComponent(r)))};case"p":return{type:"page",pageId:Zn.createId(decodeURIComponent(t.slice(1)))};case"v":{const[n,r,o,i,s]=t.slice(1).split(".");return{type:"viewport",bounds:new ee(Number(n),Number(r),Number(o),Number(i)),pageId:s?Zn.createId(decodeURIComponent(s)):void 0}}default:throw Error("Invalid deep link string")}}function bf(t){return encodeURIComponent(t).replace(/\./g,"%2E")}function qj(t,e){var o;let n=t;const r=new Set(e);for(;r.has(n);)n=(o=/^.*(\d+)$/.exec(n))!=null&&o[1]?n.replace(/(\d+)(?=\D?)$/,i=>(+i+1).toString()):`${n} 1`;return n}function jl(t,e,n){if(n.length===0)return[];const r=new Map;for(const i of be(n.map(s=>t.getShape(s)))){const{parentId:s}=i;r.has(s)||r.set(s,{children:be(t.getSortedChildIdsForParent(s).map(a=>t.getShape(a))),moving:new Set}),r.get(s).moving.add(i)}const o=[];switch(e){case"toBack":{r.forEach(({moving:i,children:s})=>Zj(i,s,o));break}case"toFront":{r.forEach(({moving:i,children:s})=>Jj(i,s,o));break}case"forward":{r.forEach(({moving:i,children:s})=>Qj(i,s,o));break}case"backward":{r.forEach(({moving:i,children:s})=>eK(i,s,o));break}}return o}function Zj(t,e,n){const r=e.length;if(t.size===r)return;let o,i;for(let s=0;s<r;s++){const a=e[s];if(t.has(a))o=a.index,t.delete(a);else{i=a.index;break}}if(t.size!==0){const s=Xs(o,i,t.size);n.push(...Array.from(t.values()).sort(nn).map((a,c)=>({...a,index:s[c]})))}}function Jj(t,e,n){const r=e.length;if(t.size===r)return;let o,i;for(let s=r-1;s>-1;s--){const a=e[s];if(t.has(a))i=a.index,t.delete(a);else{o=a.index;break}}if(t.size!==0){const s=Xs(o,i,t.size);n.push(...Array.from(t.values()).sort(nn).map((a,c)=>({...a,index:s[c]})))}}function Qj(t,e,n){var i;const r=e.length;if(t.size===r)return;let o={name:"skipping"};for(let s=0;s<r;s++){const a=t.has(e[s]);switch(o.name){case"skipping":{if(!a)continue;o={name:"selecting",selectIndex:s};break}case"selecting":{if(a)continue;const{selectIndex:c}=o;Xs(e[s].index,(i=e[s+1])==null?void 0:i.index,s-c).forEach((l,d)=>n.push({...e[c+d],index:l})),o={name:"skipping"};break}}}}function eK(t,e,n){var i;const r=e.length;if(t.size===r)return;let o={name:"skipping"};for(let s=r-1;s>-1;s--){const a=t.has(e[s]);switch(o.name){case"skipping":{if(!a)continue;o={name:"selecting",selectIndex:s};break}case"selecting":{if(a)continue;Xs((i=e[s-1])==null?void 0:i.index,e[s].index,o.selectIndex-s).forEach((c,l)=>{n.push({...e[s+l+1],index:c})}),o={name:"skipping"};break}}}}function iE({editor:t,ids:e}){const n=be(e.map(s=>t.getShape(s))),r=t.getShapesSharedRotation(e),o=t.getShapesRotatedPageBounds(e);if(!o)return null;const i=o.center.clone().rotWith(o.point,r);return{pageCenter:i,initialCursorAngle:i.angle(t.inputs.originPagePoint),initialShapesRotation:r,shapeSnapshots:n.map(s=>({shape:s,initialPagePoint:t.getShapePageTransform(s.id).point()}))}}function Cd({delta:t,editor:e,snapshot:n,stage:r,centerOverride:o}){const{pageCenter:i,shapeSnapshots:s}=n;e.updateShapes(s.map(({shape:c,initialPagePoint:l})=>{const d=In(c.parentId)?e.getShapePageTransform(c.parentId):J.Identity(),h=b.RotWith(l,o??i,t),p=J.applyToPoint(J.Inverse(d),h),f=ii(c.rotation+t);return{id:c.id,type:c.type,x:p.x,y:p.y,rotation:f}}));const a=[];s.forEach(({shape:c})=>{var p,f,g;const l=e.getShape(c.id);if(!l)return;const d=e.getShapeUtil(c);if(r==="start"||r==="one-off"){const m=(p=d.onRotateStart)==null?void 0:p.call(d,c);m&&a.push(m)}const h=(f=d.onRotate)==null?void 0:f.call(d,c,l);if(h&&a.push(h),r==="end"||r==="one-off"){const m=(g=d.onRotateEnd)==null?void 0:g.call(d,c,l);m&&a.push(m)}}),a.length>0&&e.updateShapes(a)}const tK=t=>{const{store:e}=t,n=e.query.filterHistory("binding"),r=e.query.records("binding");function o(){const i=r.get(),s=new Map;for(const a of i){const{fromId:c,toId:l}=a,d=s.get(c);d?d.push(a):s.set(c,[a]);const h=s.get(l);h?h.push(a):s.set(l,[a])}return s}return K("arrowBindingsIndex",(i,s)=>{if(Li(i))return o();const a=i,c=n.getDiffSince(s);if(c===Wn)return o();let l;function d(f){l??(l=new Map(a));const g=l.get(f.fromId),m=g==null?void 0:g.filter(v=>v.id!==f.id);m!=null&&m.length?l.set(f.fromId,m):l.delete(f.fromId);const y=l.get(f.toId),S=y==null?void 0:y.filter(v=>v.id!==f.id);S!=null&&S.length?l.set(f.toId,S):l.delete(f.toId)}function h(f){l??(l=new Map(a));let g=l.get(f);return g?g===a.get(f)&&(g=g.slice(0),l.set(f,g)):(g=[],l.set(f,g)),g}function p(f){h(f.fromId).push(f),h(f.toId).push(f)}for(const f of c){for(const g of gt(f.added))p(g);for(const[g,m]of gt(f.updated))d(g),p(m);for(const g of gt(f.removed))d(g)}return l??a})};function nK(t,e,n){const r=t.getShapeMaskedPageBounds(e);return r===void 0?!0:!n.includes(r)}const rK=t=>{function e(n){const r=n.getCurrentPageShapeIds(),o=n.getViewportPageBounds(),i=new Set;return r.forEach(s=>{nK(n,s,o)&&i.add(s)}),i}return K("getCulledShapes",n=>{if(Li(n))return e(t);const r=e(t);if(n.size!==r.size)return r;for(const o of n)if(!r.has(o))return r;return n})},oK=t=>{const e=t.query.ids("shape"),n=t.query.filterHistory("shape");function r(){const o={},i=e.get(),s=Array(i.size);return i.forEach(a=>s.push(t.get(a))),s.sort(nn),s.forEach(a=>{o[a.parentId]||(o[a.parentId]=[]),o[a.parentId].push(a.id)}),o}return K("parentsToChildrenWithIndexes",(o,i)=>{if(Li(o))return r();const s=n.getDiffSince(i);if(s===Wn)return r();if(s.length===0)return o;let a=null;const c=h=>{a||(a={...o}),a[h]?a[h]===o[h]&&(a[h]=[...a[h]]):a[h]=[]},l=new Set;let d;for(let h=0,p=s.length;h<p;h++){d=s[h];for(const f of Object.values(d.added))Os(f)&&(c(f.parentId),a[f.parentId].push(f.id),l.add(a[f.parentId]));for(const[f,g]of Object.values(d.updated))if(Os(g)&&Os(f)){if(f.parentId!==g.parentId)c(f.parentId),c(g.parentId),a[f.parentId].splice(a[f.parentId].indexOf(g.id),1),a[g.parentId].push(g.id),l.add(a[g.parentId]);else if(f.index!==g.index){c(g.parentId);const m=a[g.parentId].indexOf(g.id);a[g.parentId][m]=g.id,l.add(a[g.parentId])}}for(const f of Object.values(d.removed))Os(f)&&(c(f.parentId),a[f.parentId].splice(a[f.parentId].indexOf(f.id),1))}for(const h of l){const p=be(h.map(f=>t.get(f)));p.sort(nn),h.splice(0,h.length,...p.map(f=>f.id))}return a??o})},wf=(t,e,n)=>{for(;!_n(n.parentId);){const r=t.get(n.parentId);if(!r)return!1;n=r}return n.parentId===e},iK=(t,e)=>{const n=t.query.ids("shape");let r=null;function o(){const i=e();return r=i,new Set([...n.get()].filter(s=>wf(t,i,t.get(s))))}return K("_shapeIdsInCurrentPage",(i,s)=>{if(Li(i))return o();const a=e();if(a!==r)return o();const c=t.history.getDiffSince(s);if(c===Wn)return o();const l=new wd(i);for(const h of c){for(const p of Object.values(h.added))Os(p)&&wf(t,a,p)&&l.add(p.id);for(const[p,f]of Object.values(h.updated))Os(f)&&(wf(t,a,f)?l.add(f.id):l.remove(f.id));for(const p of Object.keys(h.removed))In(p)&&l.remove(p)}const d=l.get();return d?ec(d.value,d.diff):i})};var sK=Object.create,sE=Object.defineProperty,aK=Object.getOwnPropertyDescriptor,cK=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),aE=t=>{throw TypeError(t)},cE=(t,e,n)=>e in t?sE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,lK=t=>[,,,sK(null)],lE=["class","method","getter","setter","accessor","field","value","get","set"],dE=t=>t!==void 0&&typeof t!="function"?aE("Function expected"):t,dK=(t,e,n,r,o)=>({kind:lE[t],name:e,metadata:r,addInitializer:i=>n._?aE("Already initialized"):o.push(dE(i||null))}),uK=(t,e)=>cE(e,cK("metadata"),t[3]),hK=(t,e,n,r)=>{for(var o=0,i=t[e>>1],s=i&&i.length;o<s;o++)i[o].call(n);return r},uE=(t,e,n,r,o,i)=>{for(var s,a,c,l,d=e&7,h=!!(e&8),p=!!(e&16),f=2,g=lE[d+5],m=t[f]||(t[f]=[]),y=(o=o.prototype,aK(o,n)),S=r.length-1;S>=0;S--)c=dK(d,n,a={},t[3],m),c.static=h,c.private=p,l=c.access={has:v=>n in v},l.get=v=>v[n],s=(0,r[S])(y[g],c),a._=1,dE(s)&&(y[g]=s);return y&&sE(o,n,y),o},ys=(t,e,n)=>cE(t,typeof e!="symbol"?e+"":e,n),hE,pE,ol;const pK=40;pE=[Tn],hE=[Tn];class $h{constructor(e){this.editor=e,hK(ol,5,this),ys(this,"_clickId",""),ys(this,"_clickTimeout"),ys(this,"_clickScreenPoint"),ys(this,"_previousScreenPoint"),ys(this,"_clickState","idle"),ys(this,"lastPointerInfo",{})}_getClickTimeout(e,n=Ye()){this._clickId=n,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===e&&this._clickId===n){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)}get clickState(){return this._clickState}handlePointerEvent(e){switch(e.name){case"pointer_down":{if(!this._clickState)return e;switch(this._clickScreenPoint=b.From(e.point),this._previousScreenPoint&&b.Dist2(this._previousScreenPoint,this._clickScreenPoint)>pK**2&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":{this._clickState="pendingDouble";break}case"pendingOverflow":{this._clickState="overflow";break}}return this._clickTimeout=this._getClickTimeout(this._clickState),e}case"pointer_up":{if(!this._clickState)return e;switch(this._clickScreenPoint=b.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return e}case"pointer_move":return this._clickState!=="idle"&&this._clickScreenPoint&&b.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),e}return e}cancelDoubleClickTimeout(){this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}}ol=lK();uE(ol,1,"_getClickTimeout",pE,$h);uE(ol,1,"cancelDoubleClickTimeout",hE,$h);uK(ol,$h);class fK{constructor(e){P(this,"_isEdgeScrolling",!1);P(this,"_edgeScrollDuration",-1);this.editor=e}updateEdgeScrolling(e){const{editor:n}=this,r=this.getEdgeScroll();if(r.x===0&&r.y===0)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>n.options.edgeScrollDelay){const o=n.options.edgeScrollEaseDuration>0?Rt.easeInCubic(Math.min(1,this._edgeScrollDuration/(n.options.edgeScrollDelay+n.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:r.x*o,y:r.y*o})}}getEdgeProximityFactors(e,n,r,o,i){const{editor:s}=this,a=s.options.edgeScrollDistance,c=r?s.options.coarsePointerWidth:0,l=e-c,d=e+c,h=o?0:a,p=i?n:n-a;return l<h?Math.min(1,(h-l)/a):d>p?-Math.min(1,(d-p)/a):0}getEdgeScroll(){const{editor:e}=this,{inputs:{currentScreenPoint:{x:n,y:r}}}=e,o=e.getViewportScreenBounds(),{isCoarsePointer:i,insets:[s,a,c,l]}=e.getInstanceState(),d=this.getEdgeProximityFactors(n,o.w,i,l,a),h=this.getEdgeProximityFactors(r,o.h,i,s,c);return{x:d,y:h}}moveCameraWhenCloseToEdge(e){const{editor:n}=this;if(!n.inputs.isDragging||n.inputs.isPanning||n.getCameraOptions().isLocked||e.x===0&&e.y===0)return;const r=n.getViewportScreenBounds(),o=r.w<1e3?.612:1,i=r.h<1e3?.612:1,s=n.getZoomLevel(),a=n.user.getEdgeScrollSpeed()*n.options.edgeScrollSpeed,c=a*e.x*o/s,l=a*e.y*i/s,{x:d,y:h,z:p}=n.getCamera();n.setCamera(new b(d+c,h+l,p))}}class gK{constructor(e,n){P(this,"disposeSideEffectListener");this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",(o,i)=>{o.isFocused!==i.isFocused&&this.updateContainerClass()});const r=e.getInstanceState().isFocused;n!==r&&e.updateInstanceState({isFocused:!!n}),this.updateContainerClass()}updateContainerClass(){const e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){var e;(e=this.disposeSideEffectListener)==null||e.call(this)}}function ja(t){return yK}class mK{constructor(){P(this,"length",0);P(this,"head",null);P(this,"tail",this)}push(e){return new zS(e,this)}toArray(){return _o}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const yK=new mK;class zS{constructor(e,n){P(this,"length");this.head=e,this.tail=n,this.length=n.length+1}push(e){return new zS(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const n=e.head;return e=e.tail,{value:n,done:!1}}else return{value:void 0,done:!0}}}}}class SK{constructor(e){P(this,"store");P(this,"dispose");P(this,"state","recording");P(this,"pendingDiff",new bK);P(this,"stacks",Tt("HistoryManager.stacks",{undos:ja(),redos:ja()},{isEqual:(e,n)=>e.undos===n.undos&&e.redos===n.redos}));P(this,"annotateError");P(this,"_isInBatch",!1);this.store=e.store,this.annotateError=e.annotateError??_c,this.dispose=this.store.addHistoryInterceptor((n,r)=>{if(r==="user")switch(this.state){case"recording":this.pendingDiff.apply(n.changes),this.stacks.update(({undos:o})=>({undos:o,redos:ja()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(n.changes);break;case"paused":break;default:$t(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const e=this.pendingDiff.clear();this.stacks.update(({undos:n,redos:r})=>({undos:n.push({type:"diff",diff:e}),redos:r}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}batch(e,n){const r=this.state;r!=="paused"&&(n!=null&&n.history)&&(this.state=vK[n.history]);try{if(this._isInBatch)return Kr(e),this;this._isInBatch=!0;try{Kr(e)}catch(o){throw this.annotateError(o),o}finally{this._isInBatch=!1}return this}finally{this.state=r}}_undo({pushToRedoStack:e,toMark:n=void 0}){var o;const r=this.state;this.state="paused";try{let{undos:i,redos:s}=this.stacks.get();const a=this.pendingDiff.clear(),c=nI(a),l=tm(a);e&&!c&&(s=s.push({type:"diff",diff:a}));let d=!1;if(c)for(;((o=i.head)==null?void 0:o.type)==="stop";){const h=i.head;if(i=i.tail,e&&(s=s.push(h)),h.id===n){d=!0;break}}if(!d)e:for(;i.head;){const h=i.head;switch(i=i.tail,e&&(s=s.push(h)),h.type){case"diff":hc(l,[tm(h.diff)]);break;case"stop":if(!n)break e;if(h.id===n){d=!0;break e}break;default:$t(h)}}if(!d&&n)return this;this.store.applyDiff(l,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:i,redos:s})}finally{this.state=r}return this}undo(){return this._undo({pushToRedoStack:!0}),this}redo(){var n;const e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:r,redos:o}=this.stacks.get();if(o.length===0)return this;for(;((n=o.head)==null?void 0:n.type)==="stop";)r=r.push(o.head),o=o.tail;const i=Su();for(;o.head;){const s=o.head;if(r=r.push(s),o=o.tail,s.type==="diff")hc(i,[s.diff]);else break}this.store.applyDiff(i,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:r,redos:o})}finally{this.state=e}return this}bail(){return this._undo({pushToRedoStack:!1}),this}bailToMark(e){return this._undo({pushToRedoStack:!1,toMark:e}),this}squashToMark(e){var i;let n=this.stacks.get().undos;const r=[];for(;n.head&&!(n.head.type==="stop"&&n.head.id===e);)n.head.type==="diff"&&r.push(n.head.diff),n=n.tail;if(!n.head||((i=n.head)==null?void 0:i.id)!==e)return console.error("Could not find mark to squash to: ",e),this;if(r.length===0)return this;const o=Su();return hc(o,r.reverse()),this.stacks.update(({redos:s})=>({undos:n.push({type:"diff",diff:o}),redos:s})),this}_mark(e){Kr(()=>{this.flushPendingDiff(),this.stacks.update(({undos:n,redos:r})=>({undos:n.push({type:"stop",id:e}),redos:r}))})}clear(){this.stacks.set({undos:ja(),redos:ja()}),this.pendingDiff.clear()}getMarkIdMatching(e){let n=this.stacks.get().undos;for(;n.head;){if(n.head.type==="stop"&&n.head.id.includes(e))return n.head.id;n=n.tail}return null}debug(){const{undos:e,redos:n}=this.stacks.get();return{undos:e.toArray(),redos:n.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const vK={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class bK{constructor(){P(this,"diff",Su());P(this,"isEmptyAtom",Tt("PendingDiff.isEmpty",!0))}clear(){const e=this.diff;return this.diff=Su(),this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){hc(this.diff,[e]),this.isEmptyAtom.set(nI(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}class wK{constructor(e){P(this,"scribbleItems",new Map);P(this,"state","paused");this.editor=e}addScribble(e,n=Ye()){const r={id:n,scribble:{id:n,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(n,r),r}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}stop(e){const n=this.scribbleItems.get(e);if(!n)throw Error(`Scribble with id ${e} not found`);return n.delayRemaining=Math.min(n.delayRemaining,200),n.scribble.state="stopping",n}addPoint(e,n,r,o=.5){const i=this.scribbleItems.get(e);if(!i)throw Error(`Scribble with id ${e} not found`);const{prev:s}=i,a={x:n,y:r,z:o};return(!s||b.Dist(s,a)>=1)&&(i.next=a),i}tick(e){this.scribbleItems.size!==0&&this.editor.run(()=>{this.scribbleItems.forEach(n=>{if(n.scribble.state==="starting"){const{next:c,prev:l}=n;c&&c!==l&&(n.prev=c,n.scribble.points.push(c)),n.scribble.points.length>8&&(n.scribble.state="active");return}n.delayRemaining>0&&(n.delayRemaining=Math.max(0,n.delayRemaining-e)),n.timeoutMs+=e,n.timeoutMs>=16&&(n.timeoutMs=0);const{delayRemaining:r,timeoutMs:o,prev:i,next:s,scribble:a}=n;switch(a.state){case"active":{s&&s!==i?(n.prev=s,a.points.push(s),r===0&&a.points.length>8&&a.points.shift()):o===0&&(a.points.length>1?a.points.shift():n.delayRemaining=a.delay);break}case"stopping":{if(n.delayRemaining===0&&o===0){if(a.points.length===1){this.scribbleItems.delete(n.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:n})=>({...n,points:[...n.points]})).slice(-5)})})}}var _K=Object.create,fE=Object.defineProperty,xK=Object.getOwnPropertyDescriptor,PK=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),gE=t=>{throw TypeError(t)},mE=(t,e,n)=>e in t?fE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,IK=t=>[,,,_K(null)],yE=["class","method","getter","setter","accessor","field","value","get","set"],SE=t=>t!==void 0&&typeof t!="function"?gE("Function expected"):t,CK=(t,e,n,r,o)=>({kind:yE[t],name:e,metadata:r,addInitializer:i=>n._?gE("Already initialized"):o.push(SE(i||null))}),EK=(t,e)=>mE(e,PK("metadata"),t[3]),TK=(t,e,n,r)=>{for(var o=0,i=t[e>>1],s=i&&i.length;o<s;o++)i[o].call(n);return r},Rh=(t,e,n,r,o,i)=>{for(var s,a,c,l,d=e&7,h=!!(e&8),p=!!(e&16),f=2,g=yE[d+5],m=t[f]||(t[f]=[]),y=(o=o.prototype,xK(o,n)),S=r.length-1;S>=0;S--)c=CK(d,n,a={},t[3],m),c.static=h,c.private=p,l=c.access={has:v=>n in v},l.get=v=>v[n],s=(0,r[S])(y[g],c),a._=1,SE(s)&&(y[g]=s);return y&&fE(o,n,y),o},kK=(t,e,n)=>mE(t,e+"",n),vE,bE,wE,_E,ss;const fe=t=>Math.round(t*10**8)/10**8;function po(t,e,n,r,o){const i=t.filter(a=>(r==="forward"?a.startNode.id===e:a.endNode.id===e)&&fe(a.length)===fe(n)&&gr(a.breadthIntersection[0],a.breadthIntersection[1],o[0],o[1]));if(i.length===0)return[];const s=new Set;return i.forEach(a=>{const c=r==="forward"?a.endNode.id:a.startNode.id;if(!s.has(c)){s.add(c);const l=po(t,c,n,r,gr(a.breadthIntersection[0],a.breadthIntersection[1],o[0],o[1]));i.push(...l)}}),i}function MK(t){t.sort((e,n)=>n.gaps.length-e.gaps.length);for(let e=t.length-1;e>0;e--){const n=t[e];for(let r=e-1;r>=0;r--){const o=t[r];if(o.direction===n.direction&&n.gaps.every(i=>o.gaps.some(s=>fe(i.startEdge[0].x)===fe(s.startEdge[0].x)&&fe(i.startEdge[0].y)===fe(s.startEdge[0].y)&&fe(i.startEdge[1].x)===fe(s.startEdge[1].x)&&fe(i.startEdge[1].y)===fe(s.startEdge[1].y))&&o.gaps.some(s=>fe(i.endEdge[0].x)===fe(s.endEdge[0].x)&&fe(i.endEdge[0].y)===fe(s.endEdge[0].y)&&fe(i.endEdge[1].x)===fe(s.endEdge[1].x)&&fe(i.endEdge[1].y)===fe(s.endEdge[1].y)))){t.splice(e,1);break}}}}_E=[K],wE=[K],bE=[K],vE=[K];class wa{constructor(e){this.manager=e,TK(ss,5,this),kK(this,"editor"),this.editor=e.editor}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",n=>{const r=e.getShapePageTransform(n.id);if(!r)return;const i=e.getShapeUtil(n).getBoundsSnapGeometry(n).points??e.getShapeGeometry(n).bounds.cornersAndCenter;if(!(!r||!i))return i.map((s,a)=>{const{x:c,y:l}=J.applyToPoint(r,s);return{x:c,y:l,id:`${n.id}:${a}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){const e=this.getSnapPointsCache(),n=this.manager.getSnappableShapes(),r=[];for(const o of n){const i=e.get(o);i&&r.push(...i)}return r}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:Hn(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){const e=[],n=[];let r,o;const i=this.getSnappableGapNodes().sort((a,c)=>a.pageBounds.minX-c.pageBounds.minX);for(let a=0;a<i.length;a++){r=i[a];for(let c=a+1;c<i.length;c++)o=i[c],r.pageBounds.maxX<o.pageBounds.minX&&Ha(r.pageBounds.minY,r.pageBounds.maxY,o.pageBounds.minY,o.pageBounds.maxY)&&e.push({startNode:r,endNode:o,startEdge:[new b(r.pageBounds.maxX,r.pageBounds.minY),new b(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new b(o.pageBounds.minX,o.pageBounds.minY),new b(o.pageBounds.minX,o.pageBounds.maxY)],length:o.pageBounds.minX-r.pageBounds.maxX,breadthIntersection:gr(r.pageBounds.minY,r.pageBounds.maxY,o.pageBounds.minY,o.pageBounds.maxY)})}const s=i.sort((a,c)=>a.pageBounds.minY-c.pageBounds.minY);for(let a=0;a<s.length;a++){r=s[a];for(let c=a+1;c<s.length;c++)o=s[c],r.pageBounds.maxY<o.pageBounds.minY&&Ha(r.pageBounds.minX,r.pageBounds.maxX,o.pageBounds.minX,o.pageBounds.maxX)&&n.push({startNode:r,endNode:o,startEdge:[new b(r.pageBounds.minX,r.pageBounds.maxY),new b(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new b(o.pageBounds.minX,o.pageBounds.minY),new b(o.pageBounds.maxX,o.pageBounds.minY)],length:o.pageBounds.minY-r.pageBounds.maxY,breadthIntersection:gr(r.pageBounds.minX,r.pageBounds.maxX,o.pageBounds.minX,o.pageBounds.maxX)})}return{horizontal:e,vertical:n}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:n,initialSelectionSnapPoints:r,dragDelta:o}){var y,S;const i=this.manager.getSnapThreshold(),s=this.getSnappablePoints(),a=n.clone().translate(o),c=r.map(({x:v,y:_},w)=>({id:"selection:"+w,x:v+o.x,y:_+o.y})),l=s,d=[],h=[],p=new b(i,i);this.collectPointSnaps({minOffset:p,nearestSnapsX:d,nearestSnapsY:h,otherNodeSnapPoints:l,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:h,minOffset:p});const f=new b(e==="x"?0:((y=d[0])==null?void 0:y.nudge)??0,e==="y"?0:((S=h[0])==null?void 0:S.nudge)??0);p.x=0,p.y=0,d.length=0,h.length=0,c.forEach(v=>{v.x+=f.x,v.y+=f.y}),a.translate(f),this.collectPointSnaps({minOffset:p,nearestSnapsX:d,nearestSnapsY:h,otherNodeSnapPoints:l,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:h,minOffset:p});const g=this.getPointSnapLines({nearestSnapsX:d,nearestSnapsY:h}),m=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:h});return this.manager.setIndicators([...m,...g]),{nudge:f}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:n,handle:r,isAspectRatioLocked:o,isResizingFromCenter:i}){var E,I;const s=this.manager.getSnapThreshold(),{box:a,scaleX:c,scaleY:l}=ee.Resize(e,r,i?n.x*2:n.x,i?n.y*2:n.y,o);let d=r;c<0&&(d=BU(d)),l<0&&(d=zU(d)),i&&(a.center=e.center);const h=d==="top"||d==="bottom",p=d==="left"||d==="right",f=Q0(d,a),g=this.getSnappablePoints(),m=[],y=[],S=new b(s,s);this.collectPointSnaps({minOffset:S,nearestSnapsX:m,nearestSnapsY:y,otherNodeSnapPoints:g,selectionSnapPoints:f});const v=new b(h?0:((E=m[0])==null?void 0:E.nudge)??0,p?0:((I=y[0])==null?void 0:I.nudge)??0);if(o&&UU(d)&&v.len()!==0){const T=m.length&&y.length?Math.abs(v.x)<Math.abs(v.y)?"x":"y":m.length?"x":"y",k=e.aspectRatio;T==="x"?(y.length=0,v.y=v.x/k,(d==="bottom_left"||d==="top_right")&&(v.y=-v.y)):(m.length=0,v.x=v.y*k,(d==="bottom_left"||d==="top_right")&&(v.x=-v.x))}const _=b.Add(n,v),{box:w}=ee.Resize(e,r,i?_.x*2:_.x,i?_.y*2:_.y,o);i&&(w.center=e.center);const x=Q0("any",w);m.length=0,y.length=0,S.x=0,S.y=0,this.collectPointSnaps({minOffset:S,nearestSnapsX:m,nearestSnapsY:y,otherNodeSnapPoints:g,selectionSnapPoints:x});const C=this.getPointSnapLines({nearestSnapsX:m,nearestSnapsY:y});return this.manager.setIndicators([...C]),{nudge:v}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:n,minOffset:r,nearestSnapsX:o,nearestSnapsY:i}){for(const s of e)for(const a of n){const c=b.Sub(s,a),l=Math.abs(c.x),d=Math.abs(c.y);fe(l)<=fe(r.x)&&(fe(l)<fe(r.x)&&(o.length=0),o.push({type:"points",points:{thisPoint:s,otherPoint:a},nudge:a.x-s.x}),r.x=l),fe(d)<=fe(r.y)&&(fe(d)<fe(r.y)&&(i.length=0),i.push({type:"points",points:{thisPoint:s,otherPoint:a},nudge:a.y-s.y}),r.y=d)}}collectGapSnaps({selectionPageBounds:e,minOffset:n,nearestSnapsX:r,nearestSnapsY:o}){const{horizontal:i,vertical:s}=this.getVisibleGaps();for(const a of i){if(!Ha(a.breadthIntersection[0],a.breadthIntersection[1],e.minY,e.maxY))continue;const l=a.startEdge[0].x+a.length/2-e.center.x;if(a.length>e.width&&fe(Math.abs(l))<=fe(n.x)){fe(Math.abs(l))<fe(n.x)&&(r.length=0),n.x=Math.abs(l);const S={type:"gap_center",gap:a,nudge:l},v=r.find(({type:w})=>w==="gap_center"),_=v&&gr(a.breadthIntersection[0],a.breadthIntersection[1],v.gap.breadthIntersection[0],v.gap.breadthIntersection[1]);v&&v.gap.length>a.length&&_?r[r.indexOf(v)]=S:(!v||!_)&&r.push(S)}const h=a.startNode.pageBounds.minX-a.length,p=e.maxX,f=h-p;fe(Math.abs(f))<=fe(n.x)&&(fe(Math.abs(f))<fe(n.x)&&(r.length=0),n.x=Math.abs(f),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:f}));const g=a.endNode.pageBounds.maxX+a.length,m=e.minX,y=g-m;fe(Math.abs(y))<=fe(n.x)&&(fe(Math.abs(y))<fe(n.x)&&(r.length=0),n.x=Math.abs(y),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:y}))}for(const a of s){if(!Ha(a.breadthIntersection[0],a.breadthIntersection[1],e.minX,e.maxX))continue;const l=a.startEdge[0].y+a.length/2-e.center.y;if(a.length>e.height&&fe(Math.abs(l))<=fe(n.y)){fe(Math.abs(l))<fe(n.y)&&(o.length=0),n.y=Math.abs(l);const S={type:"gap_center",gap:a,nudge:l},v=o.find(({type:w})=>w==="gap_center"),_=v&&Ha(v.gap.breadthIntersection[0],v.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);v&&v.gap.length>a.length&&_?o[o.indexOf(v)]=S:(!v||!_)&&o.push(S);continue}const h=a.startNode.pageBounds.minY-a.length,p=e.maxY,f=h-p;fe(Math.abs(f))<=fe(n.y)&&(fe(Math.abs(f))<fe(n.y)&&(o.length=0),n.y=Math.abs(f),o.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:f}));const g=a.endNode.pageBounds.maxY+a.length,m=e.minY,y=g-m;fe(Math.abs(y))<=fe(n.y)&&(fe(Math.abs(y))<fe(n.y)&&(o.length=0),n.y=Math.abs(y),o.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:y}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:n}){const r={},o={};if(e.length>0){for(const i of e)if(i.type==="points"){const s=fe(i.points.otherPoint.x);r[s]||(r[s]=[]),r[s].push(i.points)}}if(n.length>0){for(const i of n)if(i.type==="points"){const s=fe(i.points.otherPoint.y);o[s]||(o[s]=[]),o[s].push(i.points)}}return Object.values(r).concat(Object.values(o)).map(i=>({id:Ye(),type:"points",points:Py(i.map(s=>b.From(s.otherPoint)).concat(i.map(s=>b.From(s.thisPoint))),(s,a)=>s.equals(a))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:n,nearestSnapsY:r}){const{vertical:o,horizontal:i}=this.getVisibleGaps(),s={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(n.length>0)for(const c of n){if(c.type==="points")continue;const{gap:{breadthIntersection:l,startEdge:d,startNode:h,endNode:p,length:f,endEdge:g}}=c;switch(c.type){case"gap_center":{const m=(f-e.width)/2,y=gr(l[0],l[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:Ye(),gaps:[...po(i,h.id,m,"backward",y),{startEdge:d,endEdge:s.left},{startEdge:s.right,endEdge:g},...po(i,p.id,m,"forward",y)]});break}case"gap_duplicate":{const m=gr(l[0],l[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:Ye(),gaps:c.protrusionDirection==="left"?[{startEdge:s.right,endEdge:d.map(y=>y.clone().addXY(-h.pageBounds.width,0))},{startEdge:d,endEdge:g},...po(i,p.id,f,"forward",m)]:[...po(i,h.id,f,"backward",m),{startEdge:d,endEdge:g},{startEdge:g.map(y=>y.clone().addXY(c.gap.endNode.pageBounds.width,0)),endEdge:s.left}]});break}}}if(r.length>0)for(const c of r){if(c.type==="points")continue;const{gap:{breadthIntersection:l,startEdge:d,startNode:h,endNode:p,length:f,endEdge:g}}=c;switch(c.type){case"gap_center":{const m=(f-e.height)/2,y=gr(l[0],l[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:Ye(),gaps:[...po(o,h.id,m,"backward",y),{startEdge:d,endEdge:s.top},{startEdge:s.bottom,endEdge:g},...po(o,c.gap.endNode.id,m,"forward",y)]});break}case"gap_duplicate":{const m=gr(l[0],l[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:Ye(),gaps:c.protrusionDirection==="top"?[{startEdge:s.bottom,endEdge:d.map(y=>y.clone().addXY(0,-h.pageBounds.height))},{startEdge:d,endEdge:g},...po(o,p.id,f,"forward",m)]:[...po(o,h.id,f,"backward",m),{startEdge:d,endEdge:g},{startEdge:g.map(y=>y.clone().addXY(0,p.pageBounds.height)),endEdge:s.top}]})}break}}return MK(a),a}}ss=IK();Rh(ss,1,"getSnapPointsCache",_E,wa);Rh(ss,1,"getSnappablePoints",wE,wa);Rh(ss,1,"getSnappableGapNodes",bE,wa);Rh(ss,1,"getVisibleGaps",vE,wa);EK(ss,wa);function Q0(t,e){const{minX:n,maxX:r,minY:o,maxY:i}=e,s=[];switch(t){case"top":case"left":case"top_left":case"any":s.push({id:"top_left",handle:"top_left",x:n,y:o})}switch(t){case"top":case"right":case"top_right":case"any":s.push({id:"top_right",handle:"top_right",x:r,y:o})}switch(t){case"bottom":case"right":case"bottom_right":case"any":s.push({id:"bottom_right",handle:"bottom_right",x:r,y:i})}switch(t){case"bottom":case"left":case"bottom_left":case"any":s.push({id:"bottom_left",handle:"bottom_left",x:n,y:i})}return s}var AK=Object.create,xE=Object.defineProperty,OK=Object.getOwnPropertyDescriptor,DK=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),PE=t=>{throw TypeError(t)},IE=(t,e,n)=>e in t?xE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$K=t=>[,,,AK(null)],CE=["class","method","getter","setter","accessor","field","value","get","set"],EE=t=>t!==void 0&&typeof t!="function"?PE("Function expected"):t,RK=(t,e,n,r,o)=>({kind:CE[t],name:e,metadata:r,addInitializer:i=>n._?PE("Already initialized"):o.push(EE(i||null))}),LK=(t,e)=>IE(e,DK("metadata"),t[3]),NK=(t,e,n,r)=>{for(var o=0,i=t[e>>1],s=i&&i.length;o<s;o++)i[o].call(n);return r},FK=(t,e,n,r,o,i)=>{for(var s,a,c,l,d=e&7,h=!!(e&8),p=!!(e&16),f=2,g=CE[d+5],m=t[f]||(t[f]=[]),y=(o=o.prototype,OK(o,n)),S=r.length-1;S>=0;S--)c=RK(d,n,a={},t[3],m),c.static=h,c.private=p,l=c.access={has:v=>n in v},l.get=v=>v[n],s=(0,r[S])(y[g],c),a._=1,EE(s)&&(y[g]=s);return y&&xE(o,n,y),o},zK=(t,e,n)=>IE(t,e+"",n),TE,Lh;const BK=()=>null,UK=()=>[];TE=[K];class BS{constructor(e){this.manager=e,NK(Lh,5,this),zK(this,"editor"),this.editor=e.editor}getSnapGeometryCache(){const{editor:e}=this;return e.store.createComputedCache("handle snap geometry",n=>{const r=e.getShapeUtil(n).getHandleSnapGeometry(n),o=r.getSelfSnapOutline?r.getSelfSnapOutline.bind(r):BK,i=r.getSelfSnapPoints?r.getSelfSnapPoints.bind(r):UK;return{outline:r.outline===void 0?e.getShapeGeometry(n):r.outline,points:r.points??[],getSelfSnapOutline:o,getSelfSnapPoints:i}})}*iterateSnapPointsInPageSpace(e,n){var o,i;const r=(o=this.getSnapGeometryCache().get(e))==null?void 0:o.getSelfSnapPoints(n);if(r&&r.length){const s=Hn(this.editor.getShapePageTransform(e));for(const a of r)yield s.applyToPoint(a)}for(const s of this.manager.getSnappableShapes()){if(s===e)continue;const a=(i=this.getSnapGeometryCache().get(s))==null?void 0:i.points;if(!a||!a.length)continue;const c=Hn(this.editor.getShapePageTransform(s));for(const l of a)yield c.applyToPoint(l)}}*iterateSnapOutlines(e,n){var o,i;const r=(o=this.getSnapGeometryCache().get(e))==null?void 0:o.getSelfSnapOutline(n);r&&(yield{shapeId:e,outline:r});for(const s of this.manager.getSnappableShapes()){if(s===e)continue;const a=(i=this.getSnapGeometryCache().get(s))==null?void 0:i.outline;a&&(yield{shapeId:s,outline:a})}}getHandleSnapPosition({currentShapeId:e,handle:n,handleInPageSpace:r}){const o=this.manager.getSnapThreshold();let i=o,s=null;for(const l of this.iterateSnapPointsInPageSpace(e,n))b.DistMin(r,l,i)&&(i=b.Dist(r,l),s=l);if(s)return s;let a=o,c=null;for(const{shapeId:l,outline:d}of this.iterateSnapOutlines(e,n)){const h=Hn(this.editor.getShapePageTransform(l)),p=this.editor.getPointInShapeSpace(l,r),f=d.nearestPoint(p),g=h.applyToPoint(f);b.DistMin(r,g,a)&&(a=b.Dist(r,g),c=g)}return c||null}snapHandle({currentShapeId:e,handle:n}){const o=Hn(this.editor.getShapePageTransform(e)).applyToPoint(n),i=this.getHandleSnapPosition({currentShapeId:e,handle:n,handleInPageSpace:o});return i?(this.manager.setIndicators([{id:Ye(),type:"points",points:[i]}]),{nudge:b.Sub(i,o)}):null}}Lh=$K();FK(Lh,1,"getSnapGeometryCache",TE,BS);LK(Lh,BS);var HK=Object.create,kE=Object.defineProperty,jK=Object.getOwnPropertyDescriptor,KK=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),ME=t=>{throw TypeError(t)},AE=(t,e,n)=>e in t?kE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,WK=t=>[,,,HK(null)],OE=["class","method","getter","setter","accessor","field","value","get","set"],DE=t=>t!==void 0&&typeof t!="function"?ME("Function expected"):t,GK=(t,e,n,r,o)=>({kind:OE[t],name:e,metadata:r,addInitializer:i=>n._?ME("Already initialized"):o.push(DE(i||null))}),VK=(t,e)=>AE(e,KK("metadata"),t[3]),YK=(t,e,n,r)=>{for(var o=0,i=t[e>>1],s=i&&i.length;o<s;o++)i[o].call(n);return r},US=(t,e,n,r,o,i)=>{for(var s,a,c,l,d=e&7,h=!!(e&8),p=!!(e&16),f=2,g=OE[d+5],m=t[f]||(t[f]=[]),y=(o=o.prototype,jK(o,n)),S=r.length-1;S>=0;S--)c=GK(d,n,a={},t[3],m),c.static=h,c.private=p,l=c.access={has:v=>n in v},l.get=v=>v[n],s=(0,r[S])(y[g],c),a._=1,DE(s)&&(y[g]=s);return y&&kE(o,n,y),o},_f=(t,e,n)=>AE(t,typeof e!="symbol"?e+"":e,n),$E,RE,LE,_a;LE=[K],RE=[K],$E=[K];class il{constructor(e){this.editor=e,YK(_a,5,this),_f(this,"shapeBounds"),_f(this,"handles"),_f(this,"_snapIndicators",Tt("snapLines",void 0)),this.shapeBounds=new wa(this),this.handles=new BS(this)}getIndicators(){return this._snapIndicators.get()??_o}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,n=e.getViewportPageBounds(),r=e.getSelectedShapeIds(),o=new Set,i=s=>{if(In(s)){const c=e.getShape(s);c&&e.isShapeOfType(c,"frame")&&o.add(s)}const a=e.getSortedChildIdsForParent(s);for(const c of a){if(r.includes(c))continue;const l=e.getShape(c);if(!l||!e.getShapeUtil(l).canSnap(l))continue;const h=e.getShapePageBounds(c);if(h&&n.includes(h)){if(e.isShapeOfType(l,"group")){i(c);continue}o.add(c)}}};return i(this.getCurrentCommonAncestor()??e.getCurrentPageId()),o}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}_a=WK();US(_a,1,"getSnapThreshold",LE,il);US(_a,1,"getSnappableShapes",RE,il);US(_a,1,"getCurrentCommonAncestor",$E,il);VK(_a,il);const XK=/\r?\n|\r/g;function e1(t){return t.replace(XK,`
`).split(`
`).map(e=>e||" ").join(`
`)}const qK={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},ZK=/\s/;class JK{constructor(e){P(this,"baseElm");this.editor=e;const n=this.editor.getContainer(),r=document.createElement("div");r.classList.add("tl-text"),r.classList.add("tl-text-measure"),r.tabIndex=-1,n.appendChild(r),this.baseElm=r,e.disposables.add(()=>{r.remove()})}measureText(e,n){var s;const r=(s=this.baseElm)==null?void 0:s.cloneNode();this.baseElm.insertAdjacentElement("afterend",r),r.setAttribute("dir","auto"),r.style.setProperty("unicode-bidi","plaintext"),r.style.setProperty("font-family",n.fontFamily),r.style.setProperty("font-style",n.fontStyle),r.style.setProperty("font-weight",n.fontWeight),r.style.setProperty("font-size",n.fontSize+"px"),r.style.setProperty("line-height",n.lineHeight*n.fontSize+"px"),r.style.setProperty("max-width",n.maxWidth===null?null:n.maxWidth+"px"),r.style.setProperty("min-width",n.minWidth===null?null:n.minWidth+"px"),r.style.setProperty("padding",n.padding),r.style.setProperty("overflow-wrap",n.disableOverflowWrapBreaking?"normal":"break-word"),r.textContent=e1(e);const o=r.scrollWidth,i=r.getBoundingClientRect();return r.remove(),{x:0,y:0,w:i.width,h:i.height,scrollWidth:o}}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:n=!1}={}){const r=[],o=e.getBoundingClientRect(),i=-o.left,s=-o.top,a=new Range,c=e.childNodes[0];let l=0,d=null,h=null,p=0,f=0,g=!1;for(const m of e.childNodes)if(m.nodeType===Node.TEXT_NODE)for(const y of m.textContent??""){a.setStart(c,l),a.setEnd(c,l+y.length);const S=a.getClientRects(),v=S[S.length-1],_=v.top+s,w=v.left+i,x=v.right+i,C=w<f,E=ZK.test(y);if(E!==h||_!==p||!d){if(d){if(n&&_!==p){g=!0;break}r.push(d)}d={box:{x:w,y:_,w:v.width,h:v.height},text:y},f=w}else C&&(d.box.x=w),d.box.w=C?d.box.w+v.width:x-d.box.x,d.text+=y;y===`
`&&(f=0),h=E,p=_,l+=y.length}return d&&r.push(d),{spans:r,didTruncate:g}}measureTextSpans(e,n){var l;if(e==="")return[];const r=(l=this.baseElm)==null?void 0:l.cloneNode();this.baseElm.insertAdjacentElement("afterend",r);const o=Math.ceil(n.width-n.padding*2);r.setAttribute("dir","auto"),r.style.setProperty("unicode-bidi","plaintext"),r.style.setProperty("width",`${o}px`),r.style.setProperty("height","min-content"),r.style.setProperty("font-size",`${n.fontSize}px`),r.style.setProperty("font-family",n.fontFamily),r.style.setProperty("font-weight",n.fontWeight),r.style.setProperty("line-height",`${n.lineHeight*n.fontSize}px`),r.style.setProperty("text-align",qK[n.textAlign]);const i=n.overflow==="truncate-ellipsis"||n.overflow==="truncate-clip";i&&(r.style.setProperty("overflow-wrap","anywhere"),r.style.setProperty("word-break","break-all"));const s=e1(e);r.textContent=s;const{spans:a,didTruncate:c}=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:i});if(n.overflow==="truncate-ellipsis"&&c){r.textContent="…";const d=Math.ceil(this.measureElementTextNodeSpans(r).spans[0].box.w);r.style.setProperty("width",`${o-d}px`),r.textContent=s;const h=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:!0}).spans,p=h[h.length-1];return h.push({text:"…",box:{x:Math.min(p.box.x+p.box.w,n.width-n.padding-d),y:p.box.y,w:d,h:p.box.h}}),h}return r.remove(),a}}var QK=Object.create,NE=Object.defineProperty,eW=Object.getOwnPropertyDescriptor,tW=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),FE=t=>{throw TypeError(t)},zE=(t,e,n)=>e in t?NE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,nW=t=>[,,,QK(null)],BE=["class","method","getter","setter","accessor","field","value","get","set"],UE=t=>t!==void 0&&typeof t!="function"?FE("Function expected"):t,rW=(t,e,n,r,o)=>({kind:BE[t],name:e,metadata:r,addInitializer:i=>n._?FE("Already initialized"):o.push(UE(i||null))}),oW=(t,e)=>zE(e,tW("metadata"),t[3]),iW=(t,e,n,r)=>{for(var o=0,i=t[e>>1],s=i&&i.length;o<s;o++)i[o].call(n);return r},HE=(t,e,n,r,o,i)=>{for(var s,a,c,l,d=e&7,h=!!(e&8),p=!!(e&16),f=2,g=BE[d+5],m=t[f]||(t[f]=[]),y=(o=o.prototype,eW(o,n)),S=r.length-1;S>=0;S--)c=rW(d,n,a={},t[3],m),c.static=h,c.private=p,l=c.access={has:v=>n in v},l.get=v=>v[n],s=(0,r[S])(y[g],c),a._=1,UE(s)&&(y[g]=s);return y&&NE(o,n,y),o},Kl=(t,e,n)=>zE(t,typeof e!="symbol"?e+"":e,n),jE,KE,sl;const t1=(typeof process<"u",Ox);KE=[Tn],jE=[Tn];class Nh{constructor(e){this.editor=e,iW(sl,5,this),Kl(this,"cancelRaf"),Kl(this,"isPaused",!0),Kl(this,"now",0),Kl(this,"prevPoint",new b),this.editor.disposables.add(this.dispose),this.start()}start(){var e;this.isPaused=!1,(e=this.cancelRaf)==null||e.call(this),this.cancelRaf=t1(this.tick),this.now=Date.now()}tick(){if(this.isPaused)return;const e=Date.now(),n=e-this.now;this.now=e,this.updatePointerVelocity(n),this.editor.emit("frame",n),this.editor.emit("tick",n),this.cancelRaf=t1(this.tick)}dispose(){var e;this.isPaused=!0,(e=this.cancelRaf)==null||e.call(this)}updatePointerVelocity(e){const{prevPoint:n,editor:{inputs:{currentScreenPoint:r,pointerVelocity:o}}}=this;if(e===0)return;const i=b.Sub(r,n);this.prevPoint=r.clone();const s=i.len(),a=s?i.div(s):new b(0,0),c=o.clone().lrp(a.mul(s/e),.5);Math.abs(c.x)<.01&&(c.x=0),Math.abs(c.y)<.01&&(c.y=0),o.equals(c)||(this.editor.inputs.pointerVelocity=c)}}sl=nW();HE(sl,1,"tick",KE,Nh);HE(sl,1,"dispose",jE,Nh);oW(sl,Nh);var sW=Object.create,WE=Object.defineProperty,aW=Object.getOwnPropertyDescriptor,cW=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),GE=t=>{throw TypeError(t)},VE=(t,e,n)=>e in t?WE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,lW=t=>[,,,sW(null)],YE=["class","method","getter","setter","accessor","field","value","get","set"],XE=t=>t!==void 0&&typeof t!="function"?GE("Function expected"):t,dW=(t,e,n,r,o)=>({kind:YE[t],name:e,metadata:r,addInitializer:i=>n._?GE("Already initialized"):o.push(XE(i||null))}),uW=(t,e)=>VE(e,cW("metadata"),t[3]),hW=(t,e,n,r)=>{for(var o=0,i=t[e>>1],s=i&&i.length;o<s;o++)i[o].call(n);return r},ur=(t,e,n,r,o,i)=>{for(var s,a,c,l,d=e&7,h=!!(e&8),p=!!(e&16),f=2,g=YE[d+5],m=t[f]||(t[f]=[]),y=(o=o.prototype,aW(o,n)),S=r.length-1;S>=0;S--)c=dW(d,n,a={},t[3],m),c.static=h,c.private=p,l=c.access={has:v=>n in v},l.get=v=>v[n],s=(0,r[S])(y[g],c),a._=1,XE(s)&&(y[g]=s);return y&&WE(o,n,y),o},pW=(t,e,n)=>VE(t,e+"",n),qE,ZE,JE,QE,eT,tT,nT,rT,oT,iT,sT,aT,yn;aT=[K],sT=[K],iT=[K],oT=[K],rT=[K],nT=[K],tT=[K],eT=[K],QE=[K],JE=[K],ZE=[K],qE=[K];class Ln{constructor(e,n){if(this.user=e,this.inferDarkMode=n,hW(yn,5,this),pW(this,"systemColorScheme",Tt("systemColorScheme","light")),typeof window>"u"||!("matchMedia"in window))return;const r=window.matchMedia("(prefers-color-scheme: dark)");r!=null&&r.matches&&this.systemColorScheme.set("dark"),r==null||r.addEventListener("change",o=>{o.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")})}updateUserPreferences(e){this.user.setUserPreferences({...this.user.userPreferences.get(),...e})}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return this.systemColorScheme.get()==="dark";default:return this.inferDarkMode?this.systemColorScheme.get()==="dark":!1}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??lo.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??lo.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??lo.name}getLocale(){return this.user.userPreferences.get().locale??lo.locale}getColor(){return this.user.userPreferences.get().color??lo.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??lo.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??lo.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??lo.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??lo.isPasteAtCursorMode}}yn=lW();ur(yn,1,"getUserPreferences",aT,Ln);ur(yn,1,"getIsDarkMode",sT,Ln);ur(yn,1,"getEdgeScrollSpeed",iT,Ln);ur(yn,1,"getAnimationSpeed",oT,Ln);ur(yn,1,"getId",rT,Ln);ur(yn,1,"getName",nT,Ln);ur(yn,1,"getLocale",tT,Ln);ur(yn,1,"getColor",eT,Ln);ur(yn,1,"getIsSnapMode",QE,Ln);ur(yn,1,"getIsWrapMode",JE,Ln);ur(yn,1,"getIsDynamicResizeMode",ZE,Ln);ur(yn,1,"getIsPasteAtCursorMode",qE,Ln);uW(yn,Ln);const fW={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},gW=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class ae{constructor(e,n){P(this,"performanceTracker");P(this,"id");P(this,"type");P(this,"shapeType");P(this,"initial");P(this,"children");P(this,"isLockable");P(this,"parent");P(this,"_path");P(this,"_current");P(this,"_isActive");P(this,"_currentToolIdMask",Tt("curent tool id mask",void 0));this.editor=e;const{id:r,children:o,initial:i,isLockable:s}=this.constructor;this.id=r,this._isActive=Tt("toolIsActive"+this.id,!1),this._current=Tt("toolState"+this.id,void 0),this._path=K("toolPath"+this.id,()=>{const a=this.getCurrent();return this.id+(a?`.${a.getPath()}`:"")}),this.parent=n??{},this.parent?o&&i?(this.type="branch",this.initial=i,this.children=Object.fromEntries(o().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",o&&i&&(this.initial=i,this.children=Object.fromEntries(o().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=s,this.performanceTracker=new dx}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}transition(e,n={}){var i;const r=e.split(".");let o=this;for(let s=0;s<r.length;s++){const a=r[s],c=o.getCurrent(),l=(i=o.children)==null?void 0:i[a];if(!l)throw Error(`${o.id} - no child state exists with the id ${a}.`);if((c==null?void 0:c.id)!==l.id&&(c==null||c.exit(n,a),o._current.set(l),l.enter(n,(c==null?void 0:c.id)||"initial"),!l.getIsActive()))break;o=l}return this}handleEvent(e){var o;const n=fW[e.name],r=this._current.__unsafe__getWithoutCapture();(o=this[n])==null||o.call(this,e),this._isActive.__unsafe__getWithoutCapture()&&r&&r===this._current.__unsafe__getWithoutCapture()&&r.handleEvent(e)}enter(e,n){var r;if(Pt.measurePerformance.get()&&gW.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),(r=this.onEnter)==null||r.call(this,e,n),this.children&&this.initial&&this.getIsActive()){const o=this.children[this.initial];this._current.set(o),o.enter(e,n)}}exit(e,n){var r,o;Pt.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),(r=this.onExit)==null||r.call(this,e,n),this.getIsActive()||(o=this.getCurrent())==null||o.exit(e,n)}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}}P(ae,"id"),P(ae,"initial"),P(ae,"children"),P(ae,"isLockable",!0);class ym extends ae{static children(){return[]}onKeyDown(e){var n;switch(e.code){case"KeyZ":{if(!(e.shiftKey||e.ctrlKey)){const r=this.getCurrent();r&&((n=r.getCurrent())==null?void 0:n.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:r.id})}break}}}}P(ym,"id","root"),P(ym,"initial","");var mW=Object.create,cT=Object.defineProperty,yW=Object.getOwnPropertyDescriptor,lT=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),dT=t=>{throw TypeError(t)},uT=(t,e,n)=>e in t?cT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,SW=t=>[,,,mW((t==null?void 0:t[lT("metadata")])??null)],hT=["class","method","getter","setter","accessor","field","value","get","set"],pT=t=>t!==void 0&&typeof t!="function"?dT("Function expected"):t,vW=(t,e,n,r,o)=>({kind:hT[t],name:e,metadata:r,addInitializer:i=>n._?dT("Already initialized"):o.push(pT(i||null))}),bW=(t,e)=>uT(e,lT("metadata"),t[3]),wW=(t,e,n,r)=>{for(var o=0,i=t[e>>1],s=i&&i.length;o<s;o++)i[o].call(n);return r},re=(t,e,n,r,o,i)=>{for(var s,a,c,l,d=e&7,h=!!(e&8),p=!!(e&16),f=2,g=hT[d+5],m=t[f]||(t[f]=[]),y=(o=o.prototype,yW(o,n)),S=r.length-1;S>=0;S--)c=vW(d,n,a={},t[3],m),c.static=h,c.private=p,l=c.access={has:v=>n in v},l.get=v=>v[n],s=(0,r[S])(y[g],c),a._=1,pT(s)&&(y[g]=s);return y&&cT(o,n,y),o},pe=(t,e,n)=>uT(t,typeof e!="symbol"?e+"":e,n),fT,gT,mT,yT,ST,vT,bT,wT,_T,xT,PT,IT,CT,ET,TT,kT,MT,AT,OT,DT,$T,RT,LT,NT,FT,zT,BT,UT,HT,jT,KT,WT,GT,VT,YT,XT,qT,ZT,JT,QT,e2,t2,n2,r2,o2,i2,s2,a2,c2,l2,d2,u2,h2,p2,f2,g2,m2,y2,S2,v2,b2,w2,_2,x2,P2,I2,C2,E2,T2,k2,M2,A2,Sm,ne;class te extends(Sm=HH,A2=[K],M2=[K],k2=[K],T2=[K],E2=[K],C2=[K],I2=[K],P2=[K],x2=[K],_2=[K],w2=[K],b2=[K],v2=[K],S2=[K],y2=[K],m2=[K],g2=[K],f2=[K],p2=[K],h2=[K],u2=[K],d2=[K],l2=[K],c2=[K],a2=[K],s2=[K],i2=[K],o2=[K],r2=[K],n2=[K],t2=[K],e2=[K],QT=[K],JT=[K],ZT=[K],qT=[K],XT=[K],YT=[K],VT=[K],GT=[K],WT=[K],KT=[K],jT=[K],HT=[K],UT=[K],BT=[K],zT=[K],FT=[K],NT=[K],LT=[K],RT=[K],$T=[K],DT=[K],OT=[K],AT=[K],MT=[K],kT=[K],TT=[K],ET=[K],CT=[K],IT=[K],PT=[K],xT=[K],_T=[K],wT=[K({isEqual:(e,n)=>e.equals(n)})],bT=[K],vT=[K],ST=[K],yT=[Tn],mT=[Tn],gT=[Tn],fT=[Tn],Sm){constructor({store:e,user:n,shapeUtils:r,bindingUtils:o,tools:i,getContainer:s,cameraOptions:a,initialState:c,autoFocus:l,inferDarkMode:d,options:h,isShapeHidden:p}){var T;super(),wW(ne,5,this),pe(this,"_isShapeHiddenPredicate"),pe(this,"options"),pe(this,"contextId",Ye()),pe(this,"store"),pe(this,"root"),pe(this,"disposables",new Set),pe(this,"isDisposed",!1),pe(this,"_tickManager"),pe(this,"snaps"),pe(this,"timers",gm.forContext(this.contextId)),pe(this,"user"),pe(this,"textMeasure"),pe(this,"environment",et),pe(this,"scribbles"),pe(this,"sideEffects"),pe(this,"edgeScrollManager"),pe(this,"focusManager"),pe(this,"getContainer"),pe(this,"shapeUtils"),pe(this,"styleProps"),pe(this,"bindingUtils"),pe(this,"history"),pe(this,"_shouldIgnoreShapeLock",!1),pe(this,"_crashingError",null),pe(this,"_isChangingStyleTimeout",-1),pe(this,"menus",mr.forContext(this.contextId)),pe(this,"_cameraOptions",Tt("camera options",_0)),pe(this,"_viewportAnimation",null),pe(this,"_willSetInitialBounds",!0),pe(this,"_isLockedOnFollowingUser",Tt("isLockedOnFollowingUser",!1)),pe(this,"_cameraState",Tt("camera state","idle")),pe(this,"_cameraStateTimeoutRemaining",0),pe(this,"_currentPageShapeIds"),pe(this,"_parentIdsToChildIds"),pe(this,"animatingShapes",new Map),pe(this,"externalAssetContentHandlers",{file:null,url:null}),pe(this,"temporaryAssetPreview",new Map),pe(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null}),pe(this,"inputs",{originPagePoint:new b,originScreenPoint:new b,previousPagePoint:new b,previousScreenPoint:new b,currentPagePoint:new b,currentScreenPoint:new b,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,isSpacebarPanning:!1,pointerVelocity:new b}),pe(this,"_clickManager",new $h(this)),pe(this,"_prevCursor","default"),pe(this,"_shiftKeyTimeout",-1),pe(this,"_altKeyTimeout",-1),pe(this,"_ctrlKeyTimeout",-1),pe(this,"_metaKeyTimeout",-1),pe(this,"_restoreToolId","select"),pe(this,"_pinchStart",1),pe(this,"_didPinch",!1),pe(this,"_selectedShapeIdsAtPointerDown",[]),pe(this,"_longPressTimeout",-1),pe(this,"capturedPointerId",null),pe(this,"performanceTracker"),pe(this,"performanceTrackerTimeout",-1),pe(this,"_pendingEventsForNextTick",[]),this._isShapeHiddenPredicate=p,this.options={...Kj,...h},this.store=e,this.disposables.add(this.store.dispose.bind(this.store)),this.history=new SK({store:e,annotateError:k=>{this.annotateError(k,{origin:"history.batch",willCrashApp:!0}),this.crash(k)}}),this.snaps=new il(this),this.disposables.add(this.timers.dispose),this._cameraOptions.set({..._0,...a}),this.user=new Ln(n??kC(),d??!1),this.getContainer=s,this.textMeasure=new JK(this),this._tickManager=new Nh(this);class f extends ym{}P(f,"initial",c??""),this.root=new f(this),this.root.children={};const g=FC(r),m={},y={},S=new Map;for(const k of g){const D=new k(this);m[k.type]=D;const A=aI(k.props??{});y[k.type]=A;for(const O of A.keys())if(!S.has(O.id))S.set(O.id,O);else if(S.get(O.id)!==O)throw Error(`Multiple style props with id "${O.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=m,this.styleProps=y;const v=RC(o),_={};for(const k of v){const D=new k(this);_[k.type]=D}this.bindingUtils=_;for(const k of[...i]){if(wr(this.root.children,k.id))throw Error(`Can't override tool with id "${k.id}"`);this.root.children[k.id]=new k(this,this.root)}this.scribbles=new wK(this);const w=(k,D)=>{let A=null;const O=k.selectedShapeIds.filter(R=>!D.has(R));O.length!==k.selectedShapeIds.length&&(A||(A={...k}),A.selectedShapeIds=O);const $=k.erasingShapeIds.filter(R=>!D.has(R));$.length!==k.erasingShapeIds.length&&(A||(A={...k}),A.erasingShapeIds=$),k.hoveredShapeId&&D.has(k.hoveredShapeId)&&(A||(A={...k}),A.hoveredShapeId=null),k.editingShapeId&&D.has(k.editingShapeId)&&(A||(A={...k}),A.editingShapeId=null);const z=k.hintingShapeIds.filter(R=>!D.has(R));return z.length!==k.hintingShapeIds.length&&(A||(A={...k}),A.hintingShapeIds=z),k.focusedGroupId&&D.has(k.focusedGroupId)&&(A||(A={...k}),A.focusedGroupId=null),A};this.sideEffects=this.store.sideEffects;let x=new Map;const C=new Set,E=new Set;let I=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{var k,D,A,O;C.clear();for(const $ of E){E.delete($);const z=this.getShape($);if(!z)continue;const R=this.getShapeUtil(z),W=(k=R.onChildrenChange)==null?void 0:k.call(R,z);W!=null&&W.length&&this.updateShapes(W)}if(I.size){const $=I;I=new Set;for(const z of $){const R=this.getBindingUtil(z);(D=R.onOperationComplete)==null||D.call(R)}}if(x.size){const $=x;x=new Map;for(const z of $.values())(O=(A=this.getBindingUtil(z.binding)).onAfterDelete)==null||O.call(A,z)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(k,D)=>{var A,O,$,z;for(const R of this.getBindingsInvolvingShape(D))I.add(R.type),R.fromId===D.id&&((O=(A=this.getBindingUtil(R)).onAfterChangeFromShape)==null||O.call(A,{binding:R,shapeBefore:k,shapeAfter:D})),R.toId===D.id&&((z=($=this.getBindingUtil(R)).onAfterChangeToShape)==null||z.call($,{binding:R,shapeBefore:k,shapeAfter:D}));if(k.parentId!==D.parentId){const R=W=>{var G,le,he,ve;const j=this.getShape(W);if(j)for(const me of this.getBindingsInvolvingShape(j))I.add(me.type),me.fromId===j.id&&((le=(G=this.getBindingUtil(me)).onAfterChangeFromShape)==null||le.call(G,{binding:me,shapeBefore:j,shapeAfter:j})),me.toId===j.id&&((ve=(he=this.getBindingUtil(me)).onAfterChangeToShape)==null||ve.call(he,{binding:me,shapeBefore:j,shapeAfter:j}))};R(D.id),this.visitDescendants(D.id,R)}if(k.parentId!==D.parentId&&_n(D.parentId)){const R=new Set([k.id]);this.visitDescendants(k.id,W=>{R.add(W)});for(const W of this.getPageStates()){if(W.pageId===D.parentId)continue;const j=w(W,R);j&&this.store.put([j])}}k.parentId&&In(k.parentId)&&E.add(k.parentId),D.parentId!==k.parentId&&In(D.parentId)&&E.add(D.parentId)},beforeDelete:k=>{var $,z,R,W;if(C.has(k.id))return;k.parentId&&In(k.parentId)&&E.add(k.parentId),C.add(k.id);const D=[];for(const j of this.getBindingsInvolvingShape(k)){I.add(j.type),D.push(j.id);const G=this.getBindingUtil(j);j.fromId===k.id?(($=G.onBeforeIsolateToShape)==null||$.call(G,{binding:j,removedShape:k}),(z=G.onBeforeDeleteFromShape)==null||z.call(G,{binding:j,shape:k})):((R=G.onBeforeIsolateFromShape)==null||R.call(G,{binding:j,removedShape:k}),(W=G.onBeforeDeleteToShape)==null||W.call(G,{binding:j,shape:k}))}D.length&&this.deleteBindings(D);const A=new Set([k.id]),O=be(this.getPageStates().map(j=>w(j,A)));O.length&&this.store.put(O)}},binding:{beforeCreate:k=>{var A,O;const D=(O=(A=this.getBindingUtil(k)).onBeforeCreate)==null?void 0:O.call(A,{binding:k});return D||k},afterCreate:k=>{var D,A;I.add(k.type),(A=(D=this.getBindingUtil(k)).onAfterCreate)==null||A.call(D,{binding:k})},beforeChange:(k,D)=>{var O,$;const A=($=(O=this.getBindingUtil(D)).onBeforeChange)==null?void 0:$.call(O,{bindingBefore:k,bindingAfter:D});return A||D},afterChange:(k,D)=>{var A,O;I.add(D.type),(O=(A=this.getBindingUtil(D)).onAfterChange)==null||O.call(A,{bindingBefore:k,bindingAfter:D})},beforeDelete:k=>{var D,A;(A=(D=this.getBindingUtil(k)).onBeforeDelete)==null||A.call(D,{binding:k})},afterDelete:k=>{var D,A;(A=(D=this.getBindingUtil(k)).onAfterDelete)==null||A.call(D,{binding:k}),I.add(k.type)}},page:{afterCreate:k=>{const D=Ur.createId(k.id),A=vr.createId(k.id);this.store.has(D)||this.store.put([Ur.create({id:D})]),this.store.has(A)||this.store.put([vr.create({id:A,pageId:k.id})])},afterDelete:(k,D)=>{var $,z;if((($=this.getInstanceState())==null?void 0:$.currentPageId)===k.id){const R=(z=this.getPages().find(W=>W.id!==k.id))==null?void 0:z.id;R?this.store.put([{...this.getInstanceState(),currentPageId:R}]):D==="user"&&this.store.ensureStoreIsUsable()}const A=Ur.createId(k.id),O=vr.createId(k.id);this.store.remove([A,O])}},instance:{afterChange:(k,D,A)=>{var O;if(!this.store.has(D.currentPageId)){const $=this.store.has(k.currentPageId)?k.currentPageId:(O=this.getPages()[0])==null?void 0:O.id;$?this.store.update(D.id,z=>({...z,currentPageId:$})):A==="user"&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(k,D)=>{if((k==null?void 0:k.selectedShapeIds)!==(D==null?void 0:D.selectedShapeIds)){const A=D.selectedShapeIds.filter($=>{var R,W;let z=(R=this.getShape($))==null?void 0:R.parentId;for(;In(z);){if(D.selectedShapeIds.includes(z))return!1;z=(W=this.getShape(z))==null?void 0:W.parentId}return!0});let O=null;if(A.length>0){const $=this.findCommonAncestor(be(A.map(z=>this.getShape(z))),z=>this.isShapeOfType(z,"group"));$&&(O=$)}else D!=null&&D.focusedGroupId&&(O=D.focusedGroupId);(A.length!==D.selectedShapeIds.length||O!==D.focusedGroupId)&&this.store.put([{...D,selectedShapeIds:A,focusedGroupId:O??null}])}}}})),this._currentPageShapeIds=iK(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=oK(this.store),this.disposables.add(this.store.listen(k=>{this.emit("change",k)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),c&&this.root.children[c]===void 0)throw Error(`No state found for initialState "${c}".`);if(this.root.enter(void 0,"initial"),this.edgeScrollManager=new fK(this),this.focusManager=new gK(this,l),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new dx,(T=this.store.props.collaboration)!=null&&T.mode){const k=this.store.props.collaboration.mode;this.disposables.add(xo("update collaboration mode",()=>{this.store.put([{...this.getInstanceState(),isReadonly:k.get()==="readonly"}])}))}}getIsShapeHiddenCache(){return this._isShapeHiddenPredicate?this.store.createComputedCache("isShapeHidden",e=>this.findShapeAncestor(e,r=>this.isShapeHidden(r))?!0:this._isShapeHiddenPredicate(e,this)??!1):null}isShapeHidden(e){return this._isShapeHiddenPredicate?!!this.getIsShapeHiddenCache().get(typeof e=="string"?e:e.id):!1}dispose(){this.disposables.forEach(e=>e()),this.disposables.clear(),this.isDisposed=!0}getShapeUtil(e){const n=typeof e=="string"?e:e.type,r=kn(this.shapeUtils,n);return He(r,`No shape util found for type "${n}"`),r}getBindingUtil(e){const n=typeof e=="string"?e:e.type,r=kn(this.bindingUtils,n);return He(r,`No binding util found for type "${n}"`),r}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(e){return console.warn(typeof e=="string"?`[tldraw] \`editor.history.mark("${e}")\` is deprecated. Please use \`const myMarkId = editor.markHistoryStoppingPoint()\` instead.`:"[tldraw] `editor.mark()` is deprecated. Use `editor.markHistoryStoppingPoint()` instead."),this.history._mark(e??Ye()),this}markHistoryStoppingPoint(e){const n=`[${e??"stop"}]_${Ye()}`;return this.history._mark(n),n}getMarkIdMatching(e){return this.history.getMarkIdMatching(e)}squashToMark(e){return this.history.squashToMark(e),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}run(e,n){const r=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=(n==null?void 0:n.ignoreShapeLock)??r;try{this.history.batch(e,n)}finally{this._shouldIgnoreShapeLock=r}return this}batch(e,n){return this.run(e,n)}annotateError(e,{origin:n,willCrashApp:r,tags:o,extras:i}){const s=this.createErrorAnnotations(n,r);return Ey(e,{tags:{...s.tags,...o},extras:{...s.extras,...i}}),r&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,n){try{const r=this.getEditingShapeId();return{tags:{origin:e,willCrashApp:n},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:r?this.getShape(r):void 0,inputs:this.inputs}}}catch{return{tags:{origin:e,willCrashApp:n},extras:{}}}}getCrashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(e){const n=e.split(".").reverse();let r=this.root;for(;n.length>0;){const o=n.pop();if(!o)return!0;const i=r.getCurrent();if((i==null?void 0:i.id)===o){if(n.length===0)return!0;r=i;continue}else return!1}return!1}isInAny(...e){return e.some(n=>this.isIn(n))}setCurrentTool(e,n={}){return this.root.transition(e,n),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const e=this.getCurrentTool();return e?e.getCurrentToolIdMask()??e.id:""}getStateDescendant(e){var o;const n=e.split(".").reverse();let r=this.root;for(;n.length>0;){const i=n.pop();if(!i)return r;const s=(o=r.children)==null?void 0:o[i];if(!s)return;r=s}return r}getDocumentSettings(){return this.store.get(om)}updateDocumentSettings(e){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...e}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(hn)}updateInstanceState(e,n){return this._updateInstanceState(e,{history:"ignore",...n}),e.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),e.isChangingStyle===!0&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},2e3))),this}_updateInstanceState(e,n){this.run(()=>{this.store.put([{...this.getInstanceState(),...e}])},n)}getOpenMenus(){return this.menus.getOpenMenus()}addOpenMenu(e){return this.menus.addOpenMenu(e),this}deleteOpenMenu(e){return this.menus.deleteOpenMenu(e),this}clearOpenMenus(){return this.menus.clearOpenMenus(),this}getIsMenuOpen(){return this.menus.hasAnyOpenMenus()}setCursor(e){return this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...e}}),this}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return vr.createId(this.getCurrentPageId())}updateCurrentPageState(e){return this._updateCurrentPageState(e),this}_updateCurrentPageState(e){this.store.update(e.id??this.getCurrentPageState().id,n=>({...n,...e}))}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:e}=this.getCurrentPageState();return be(e.map(n=>this.store.get(n)))}setSelectedShapes(e){return this.run(()=>{const n=e.map(i=>typeof i=="string"?i:i.id),{selectedShapeIds:r}=this.getCurrentPageState(),o=new Set(r);if(n.length===o.size&&n.every(i=>o.has(i)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:n}])},{history:"record-preserveRedoStack"})}isAncestorSelected(e){const n=typeof e=="string"?e:(e==null?void 0:e.id)??null,r=this.getShape(n);if(!r)return!1;const o=this.getSelectedShapeIds();return!!this.findShapeAncestor(r,i=>o.includes(i.id))}select(...e){const n=typeof e[0]=="string"?e:e.map(r=>r.id);return this.setSelectedShapes(n),this}deselect(...e){const n=typeof e[0]=="string"?e:e.map(o=>o.id),r=this.getSelectedShapeIds();return r.length>0&&n.length>0&&this.setSelectedShapes(r.filter(o=>!n.includes(o))),this}selectAll(){const e=this.getSortedChildIdsForParent(this.getCurrentPageId());return e.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(e)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){var e;return((e=this.getOnlySelectedShape())==null?void 0:e.id)??null}getOnlySelectedShape(){const e=this.getSelectedShapes();return e.length===1?e[0]:null}getShapesPageBounds(e){const n=be(e.map(r=>this.getShapePageBounds(r)));return n.length===0?null:ee.Common(n)}getSelectionPageBounds(){return this.getShapesPageBounds(this.getSelectedShapeIds())}getShapesSharedRotation(e){let n=!1,r=0;for(let o=0,i=e.length;o<i;o++){const s=this.getShapePageTransform(e[o]);if(s)if(n){if(s.rotation()!==r)return 0}else n=!0,r=s.rotation()}return r}getSelectionRotation(){return this.getShapesSharedRotation(this.getSelectedShapeIds())}getShapesRotatedPageBounds(e){if(e.length===0)return;const n=this.getShapesSharedRotation(e);if(n===0)return this.getShapesPageBounds(e)??void 0;if(e.length===1){const o=this.getShapeGeometry(e[0]).bounds.clone(),i=this.getShapePageTransform(e[0]);return o.point=i.applyToPoint(o.point),o}const r=ee.FromPoints(e.flatMap(o=>{const i=this.getShapePageTransform(o);return i?i.applyToPoints(this.getShapeGeometry(o).bounds.corners):[]}).map(o=>o.rot(-n)));return r.point=r.point.rot(n),r}getSelectionRotatedPageBounds(){return this.getShapesRotatedPageBounds(this.getSelectedShapeIds())}getSelectionRotatedScreenBounds(){const e=this.getSelectionRotatedPageBounds();if(!e)return;const{x:n,y:r}=this.pageToScreen(e.point),o=this.getZoomLevel();return new ee(n,r,e.width*o,e.height*o)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const e=this.getFocusedGroupId();return e?this.getShape(e):void 0}setFocusedGroup(e){const n=typeof e=="string"?e:(e==null?void 0:e.id)??null;if(n!==null){const r=this.getShape(n);if(!r)throw Error(`Editor.setFocusedGroup: Shape with id ${n} does not exist`);if(!this.isShapeOfType(r,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${r.type}`)}return n===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:n}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){const e=this.getFocusedGroup();if(e){const n=this.findShapeAncestor(e,r=>this.isShapeOfType(r,"group"));this.setFocusedGroup((n==null?void 0:n.id)??null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const e=this.getEditingShapeId();return e?this.getShape(e):void 0}setEditingShape(e){const n=typeof e=="string"?e:(e==null?void 0:e.id)??null;if(n!==this.getEditingShapeId()){if(n){const r=this.getShape(n);if(r&&this.getShapeUtil(r).canEdit(r))return this.run(()=>{this._updateCurrentPageState({editingShapeId:n})},{history:"ignore"}),this}this.run(()=>{this._updateCurrentPageState({editingShapeId:null})},{history:"ignore"})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const e=this.getHoveredShapeId();return e?this.getShape(e):void 0}setHoveredShape(e){const n=typeof e=="string"?e:(e==null?void 0:e.id)??null;return n===this.getHoveredShapeId()?this:(this.run(()=>{this.updateCurrentPageState({hoveredShapeId:n})},{history:"ignore"}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const e=this.getHintingShapeIds();return be(e.map(n=>this.getShape(n)))}setHintingShapes(e){const n=typeof e[0]=="string"?e:e.map(r=>r.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:Py(n)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const e=this.getErasingShapeIds();return be(e.map(n=>this.getShape(n)))}setErasingShapes(e){const n=typeof e[0]=="string"?e:e.map(o=>o.id);n.sort();const r=this.getErasingShapeIds();return this.run(()=>{if(n.length===r.length){for(let o=0;o<n.length;o++)if(n[o]!==r[o]){this._updateCurrentPageState({erasingShapeIds:n});break}}else this._updateCurrentPageState({erasingShapeIds:n})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(e){const n=typeof e=="string"?e:(e==null?void 0:e.id)??null;return n!==this.getCroppingShapeId()&&this.run(()=>{if(!n)this.updateCurrentPageState({croppingShapeId:null});else{const r=this.getShape(n),o=this.getShapeUtil(r);r&&o.canCrop(r)&&this.updateCurrentPageState({croppingShapeId:n})}},{history:"ignore"}),this}_unsafe_getCameraId(){return Ur.createId(this.getCurrentPageId())}getCamera(){const e=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){const n=this.getCameraForFollowing();if(n)return{...e,...n}}return e}getViewportPageBoundsForFollowing(){const e=this.getInstanceState().followingUserId;if(!e)return null;const n=this.getCollaborators().find(h=>h.userId===e);if(!n)return null;const{w:r,h:o}=n.screenBounds,{x:i,y:s,z:a}=n.camera,c=new ee(-i,-s,r/a,o/a),l=this.getViewportScreenBounds().clone(),d=l.width/l.height;return l.width=c.width,l.height=l.width/d,l.height<c.height&&(l.height=c.height,l.width=l.height*d),l.center=c.center,l}getCameraForFollowing(){const e=this.getViewportPageBoundsForFollowing();return e?{x:-e.x,y:-e.y,z:this.getViewportScreenBounds().w/e.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.initialZoom==="default")return 1;const{zx:n,zy:r}=r1(this,e);switch(e.constraints.initialZoom){case"fit-min":return Math.max(n,r);case"fit-max":return Math.min(n,r);case"fit-x":return n;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(n,r));case"fit-max-100":return Math.min(1,Math.min(n,r));case"fit-x-100":return Math.min(1,n);case"fit-y-100":return Math.min(1,r);default:throw $t(e.constraints.initialZoom)}}getBaseZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.baseZoom==="default")return 1;const{zx:n,zy:r}=r1(this,e);switch(e.constraints.baseZoom){case"fit-min":return Math.max(n,r);case"fit-max":return Math.min(n,r);case"fit-x":return n;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(n,r));case"fit-max-100":return Math.min(1,Math.min(n,r));case"fit-x-100":return Math.min(1,n);case"fit-y-100":return Math.min(1,r);default:throw $t(e.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(e){var r;const n=ut({...this._cameraOptions.__unsafe__getWithoutCapture(),...e});return((r=n.zoomSteps)==null?void 0:r.length)<1&&(n.zoomSteps=[1]),this._cameraOptions.set(n),this.setCamera(this.getCamera()),this}getConstrainedCamera(e,n){const r=this.getCamera();let{x:o,y:i,z:s=r.z}=e;if(!(n!=null&&n.force)){const a=this.getCameraOptions(),c=a.zoomSteps[0],l=Ht(a.zoomSteps),d=this.getViewportScreenBounds();if(a.constraints){const{constraints:h}=a,p=Math.min(h.padding.y,d.w/2),f=Math.min(h.padding.x,d.h/2),g=ee.From(a.constraints.bounds),m=(d.w-f*2)/g.w,y=(d.h-p*2)/g.h,S=this.getBaseZoom(),v=l*S,_=c*S;if(n!=null&&n.reset&&(s=this.getInitialZoom()),s<_||s>v){const{x:A,y:O,z:$}=r,z=-A+d.w/$/2,R=-O+d.h/$/2;s=Bt(s,_,v);const W=-A+d.w/s/2,j=-O+d.h/s/2;o=A+W-z,i=O+j-R}const w=f/s-g.x,x=p/s-g.y,C=(d.w-f*2)/s-g.w,E=(d.h-p*2)/s-g.h,I=w+C*h.origin.x,T=x+E*h.origin.y,k=typeof h.behavior=="string"?h.behavior:h.behavior.x,D=typeof h.behavior=="string"?h.behavior:h.behavior.y;if(n!=null&&n.reset)o=I,i=T;else{switch(k){case"fixed":{o=I;break}case"contain":{s<m?o=I:o=Bt(o,w+C,w);break}case"inside":{s<m?o=Bt(o,w,(d.w-f)/s-g.w):o=Bt(o,w+C,w);break}case"outside":{o=Bt(o,f/s-g.w,(d.w-f)/s);break}case"free":break;default:throw $t(k)}switch(D){case"fixed":{i=T;break}case"contain":{s<y?i=T:i=Bt(i,x+E,x);break}case"inside":{s<y?i=Bt(i,x,(d.h-p)/s-g.h):i=Bt(i,x+E,x);break}case"outside":{i=Bt(i,p/s-g.h,(d.h-p)/s);break}case"free":break;default:throw $t(D)}}}else if(s>l||s<c){const{x:h,y:p,z:f}=r;s=Bt(s,c,l),o=h+(-h+d.w/s/2)-(-h+d.w/f/2),i=p+(-p+d.h/s/2)-(-p+d.h/f/2)}}return{x:o,y:i,z:s}}_setCamera(e,n){const r=this.getCamera(),{x:o,y:i,z:s}=this.getConstrainedCamera(e,n);return r.x===o&&r.y===i&&r.z===s?this:(Kr(()=>{const a={...r,x:o,y:i,z:s};this.run(()=>{this.store.put([a])},{history:"ignore"});const{currentScreenPoint:c,currentPagePoint:l}=this.inputs,{screenBounds:d}=this.store.unsafeGetWithoutCapture(hn);if(c.x/s-o!==l.x||c.y/s-i!==l.y){const h={type:"pointer",target:"canvas",name:"pointer_move",point:b.AddXY(c,d.x,d.y),pointerId:x0.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,metaKey:this.inputs.metaKey,accelKey:rn(this.inputs),button:0,isPen:this.getInstanceState().isPenMode??!1};n!=null&&n.immediate?this._flushEventForTick(h):this.dispatch(h)}this._tickCameraState()}),this)}setCamera(e,n){const{isLocked:r}=this._cameraOptions.__unsafe__getWithoutCapture();if(r&&!(n!=null&&n.force))return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const o=b.Cast(e);Number.isFinite(o.x)||(o.x=0),Number.isFinite(o.y)||(o.y=0),(o.z===void 0||!Number.isFinite(o.z))&&(e.z=this.getZoomLevel());const i=this.getConstrainedCamera(o,n);if(n!=null&&n.animation){const{width:s,height:a}=this.getViewportScreenBounds();this._animateToViewport(new ee(-i.x,-i.y,s/i.z,a/i.z),n)}else this._setCamera(i,{...n,force:!0});return this}centerOnPoint(e,n){const{isLocked:r}=this.getCameraOptions();if(r&&!(n!=null&&n.force))return this;const{width:o,height:i}=this.getViewportPageBounds();return this.setCamera(new b(-(e.x-o/2),-(e.y-i/2),this.getCamera().z),n),this}zoomToFit(e){const n=[...this.getCurrentPageShapeIds()];if(n.length<=0)return this;const r=ee.Common(be(n.map(o=>this.getShapePageBounds(o))));return this.zoomToBounds(r,e),this}resetZoom(e=this.getViewportScreenCenter(),n){const{isLocked:r,constraints:o}=this.getCameraOptions();if(r&&!(n!=null&&n.force))return this;const i=this.getCamera(),{x:s,y:a,z:c}=i,{x:l,y:d}=e;let h=1;if(o){const p=this.getInitialZoom();c!==p&&(h=p)}return this.setCamera(new b(s+(l/h-l)-(l/c-l),a+(d/h-d)-(d/c-d),h),n),this}zoomIn(e=this.getViewportScreenCenter(),n){const{isLocked:r}=this.getCameraOptions();if(r&&!(n!=null&&n.force))return this;const{x:o,y:i,z:s}=this.getCamera(),{zoomSteps:a}=this.getCameraOptions();if(a!==null&&a.length>1){const c=this.getBaseZoom();let l=Ht(a)*c;for(let d=1;d<a.length;d++){const h=a[d-1]*c,p=a[d]*c;if(!(p-s<=(p-h)/2)){l=p;break}}this.setCamera(new b(o+(e.x/l-e.x)-(e.x/s-e.x),i+(e.y/l-e.y)-(e.y/s-e.y),l),n)}return this}zoomOut(e=this.getViewportScreenCenter(),n){const{isLocked:r}=this.getCameraOptions();if(r&&!(n!=null&&n.force))return this;const{zoomSteps:o}=this.getCameraOptions();if(o!==null&&o.length>1){const i=this.getBaseZoom(),{x:s,y:a,z:c}=this.getCamera();let l=o[0]*i;for(let d=o.length-1;d>0;d--){const h=o[d-1]*i,p=o[d]*i;if(!(p-c>=(p-h)/2)){l=h;break}}this.setCamera(new b(s+(e.x/l-e.x)-(e.x/c-e.x),a+(e.y/l-e.y)-(e.y/c-e.y),l),n)}return this}zoomToSelection(e){const{isLocked:n}=this.getCameraOptions();if(n&&!(e!=null&&e.force))return this;const r=this.getSelectionPageBounds();return r&&this.zoomToBounds(r,{targetZoom:Math.max(1,this.getZoomLevel()),...e}),this}zoomToBounds(e,n){const r=this._cameraOptions.__unsafe__getWithoutCapture();if(r.isLocked&&!(n!=null&&n.force))return this;const o=this.getViewportScreenBounds(),i=(n==null?void 0:n.inset)??Math.min(_7,o.width*.28),s=this.getBaseZoom(),a=r.zoomSteps[0],c=Ht(r.zoomSteps);let l=Bt(Math.min((o.width-i)/e.w,(o.height-i)/e.h),a*s,c*s);return(n==null?void 0:n.targetZoom)!==void 0&&(l=Math.min(n.targetZoom,l)),this.setCamera(new b(-e.x+(o.width-e.w*l)/2/l,-e.y+(o.height-e.h*l)/2/l,l),n),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(e){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=e;const{elapsed:n,easing:r,duration:o,start:i,end:s}=this._viewportAnimation;if(n>o){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new b(-s.x,-s.y,this.getViewportScreenBounds().width/s.width));return}const a=o-n,c=r(1-a/o),l=i.minX+(s.minX-i.minX)*c,d=i.minY+(s.minY-i.minY)*c,h=i.maxX+(s.maxX-i.maxX)*c;this._setCamera(new b(-l,-d,this.getViewportScreenBounds().width/(h-l)),{force:!0})}_animateToViewport(e,n={animation:pf}){const{animation:r,...o}=n;if(!r)return;const{duration:i=0,easing:s=Rt.easeInOutCubic}=r,a=this.user.getAnimationSpeed(),c=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),i===0||a===0?this._setCamera(new b(-e.x,-e.y,this.getViewportScreenBounds().width/e.width),{...o}):(this._viewportAnimation={elapsed:0,duration:i/a,easing:s,start:c.clone(),end:e.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(e={}){const{isLocked:n}=this.getCameraOptions();if(n&&!(e!=null&&e.force))return this;if(this.user.getAnimationSpeed()===0)return this;this.stopCameraAnimation();const{speed:o,friction:i=this.options.cameraSlideFriction,direction:s,speedThreshold:a=.01}=e;let c=Math.min(o,1);const l=()=>{this.off("tick",d),this.off("stop-camera-animation",l)};this.once("stop-camera-animation",l);const d=h=>{const{x:p,y:f,z:g}=this.getCamera(),m=b.Mul(s,c*h/g);c*=1-i,c<a?l():this._setCamera(new b(p+m.x,f+m.y,g))};return this.on("tick",d),this}zoomToUser(e,n={animation:{duration:500}}){const r=this.getCollaborators().find(o=>o.userId===e);return r?(this.run(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const o=r.currentPageId===this.getCurrentPageId();o||this.setCurrentPage(r.currentPageId),n&&n.animation&&!o&&(n.animation=void 0),this.centerOnPoint(r.cursor,n);const{highlightedUserIds:i}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...i,e]}),this.timers.setTimeout(()=>{const s=[...this.getInstanceState().highlightedUserIds],a=s.indexOf(e);a<0||(s.splice(a,1),this.updateInstanceState({highlightedUserIds:s}))},this.options.collaboratorIdleTimeoutMs)}),this):this}updateViewportScreenBounds(e,n=!1){if(e instanceof HTMLElement){const a=e.getBoundingClientRect();e=new ee(a.left||a.x,a.top||a.y,Math.max(a.width,1),Math.max(a.height,1))}else e.width=Math.max(e.width,1),e.height=Math.max(e.height,1);const r=[e.minY!==0,!oi(document.body.scrollWidth,e.maxX,1),!oi(document.body.scrollHeight,e.maxY,1),e.minX!==0],{_willSetInitialBounds:o}=this;this._willSetInitialBounds=!1;const{screenBounds:i,insets:s}=this.getInstanceState();if(e.equals(i)&&r.every((a,c)=>a===s[c]))return this;if(o)this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.setCamera(this.getCamera());else if(n&&!this.getInstanceState().followingUserId){const a=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.centerOnPoint(a)}else this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this._setCamera(b.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:e,y:n,w:r,h:o}=this.getInstanceState().screenBounds;return new ee(e,n,r,o)}getViewportScreenCenter(){const e=this.getViewportScreenBounds();return new b(e.midX-e.minX,e.midY-e.minY)}getViewportPageBounds(){const{w:e,h:n}=this.getViewportScreenBounds(),{x:r,y:o,z:i}=this.getCamera();return new ee(-r,-o,e/i,n/i)}screenToPage(e){const{screenBounds:n}=this.store.unsafeGetWithoutCapture(hn),{x:r,y:o,z:i=1}=this.getCamera();return new b((e.x-n.x)/i-r,(e.y-n.y)/i-o,e.z??.5)}pageToScreen(e){const{screenBounds:n}=this.store.unsafeGetWithoutCapture(hn),{x:r,y:o,z:i=1}=this.getCamera();return new b((e.x+r)*i+n.x,(e.y+o)*i+n.y,e.z??.5)}pageToViewport(e){const{x:n,y:r,z:o=1}=this.getCamera();return new b((e.x+n)*o,(e.y+r)*o,e.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){const e=this._getCollaboratorsQuery().get();return e.length?[...new Set(e.map(r=>r.userId))].sort().map(r=>e.filter(i=>i.userId===r).sort((i,s)=>s.lastActivityTimestamp-i.lastActivityTimestamp)[0]):_o}getCollaboratorsOnCurrentPage(){const e=this.getCurrentPageId();return this.getCollaborators().filter(n=>n.currentPageId===e)}startFollowingUser(e){this.stopFollowingUser();const n=this._getCollaboratorsQuery().get().filter(i=>i.userId===e);if(!n.length)return console.warn("User not found"),this;const r=this.user.getId();if(r||console.warn("You should set the userId for the current instance before following a user"),n.some(i=>i.followingUserId===r))return this;const o=K("latestLeaderPresence",()=>this.getCollaborators().find(i=>i.userId===e));return Kr(()=>{this.updateInstanceState({followingUserId:e},{history:"ignore"});const i=xo("update current page",()=>{const c=o.get();if(!c){this.stopFollowingUser();return}c.currentPageId!==this.getCurrentPageId()&&this.getPage(c.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:c.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"})}),s=()=>{i(),this._isLockedOnFollowingUser.set(!1),this.off("frame",a),this.off("stop-following",s)},a=()=>{if(!o.get()){this.stopFollowingUser();return}if(this._isLockedOnFollowingUser.get())return;const l=this.user.getAnimationSpeed();if(l===0){this._isLockedOnFollowingUser.set(!0);return}const d=this.getViewportPageBoundsForFollowing();if(!d){this.stopFollowingUser();return}const h=this.getViewportPageBounds(),p=Math.abs(d.minX-h.minX)+Math.abs(d.maxX-h.maxX),f=Math.abs(d.minY-h.minY)+Math.abs(d.maxY-h.maxY);if(p<this.options.followChaseViewportSnap&&f<this.options.followChaseViewportSnap){this._isLockedOnFollowingUser.set(!0);return}const g=Bt(l*.5,.1,.8),m=new ee(De(h.minX,d.minX,g),De(h.minY,d.minY,g),De(h.width,d.width,g),De(h.height,d.height,g)),y=new b(-m.x,-m.y,this.getViewportScreenBounds().width/m.width);this.stopCameraAnimation(),this._setCamera(y)};this.once("stop-following",s),this.addListener("frame",a),a()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(e){const n=[];let r=this.options.maxShapesPerPage*2,o=this.options.maxShapesPerPage;const i=this.getErasingShapeIds(),s=(c,l,d)=>{const h=this.getShape(c);if(!h||this.isShapeHidden(h))return;l*=h.opacity;let p=!1;const f=this.getShapeUtil(h);e&&(p=!d&&i.includes(c),p&&(l*=.32)),n.push({id:c,shape:h,util:f,index:r,backgroundIndex:o,opacity:l}),r+=1,o+=1;const g=this.getSortedChildIdsForParent(c);if(!g.length)return;let m=null;f.providesBackgroundForChildren(h)&&(m=o,o=r,r+=this.options.maxShapesPerPage);for(const y of g)s(y,l,d||p);m!==null&&(o=m)},a=e?[this.getCurrentPage()]:this.getPages();for(const c of a)for(const l of this.getSortedChildIdsForParent(c.id))s(l,1,!1);return n}_decayCameraStateTimeout(e){this._cameraStateTimeoutRemaining-=e,!(this._cameraStateTimeoutRemaining>0)&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))}_tickCameraState(){this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,this._cameraState.__unsafe__getWithoutCapture()==="idle"&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(r5)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(nn)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(e){return this.store.get(typeof e=="string"?e:e.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(e){const n=typeof e=="string"?e:e.id,r=this.store.query.exec("shape",{parentId:{eq:n}});return this.getShapeAndDescendantIds(r.map(o=>o.id))}setCurrentPage(e){const n=typeof e=="string"?e:e.id;return this.store.has(n)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:n}]),this.setCamera(this.getCamera())},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(e){return this.getIsReadonly()?this:this.getPage(e.id)?this.run(()=>this.store.update(e.id,r=>({...r,...e}))):this}createPage(e){return this.run(()=>{if(this.getIsReadonly()||this.getPages().length>=this.options.maxPages)return;const n=this.getPages(),r=qj(e.name??"Page 1",n.map(s=>s.name));let o=e.index;(!o||n.some(s=>s.index===o))&&(o=Br(n[n.length-1].index));const i=Zn.create({meta:{},...e,name:r,index:o});this.store.put([i])}),this}deletePage(e){const n=typeof e=="string"?e:e.id;return this.run(()=>{if(this.getIsReadonly())return;const r=this.getPages();if(r.length===1)return;const o=this.getPage(n);if(o){if(n===this.getCurrentPageId()){const i=r.findIndex(a=>a.id===n),s=r[i-1]??r[i+1];this.setCurrentPage(s.id)}this.store.remove([o.id])}}),this}duplicatePage(e,n=Zn.createId()){if(this.getPages().length>=this.options.maxPages)return this;const r=typeof e=="string"?e:e.id,o=this.getPage(r);if(!o)return this;const i={...this.getCamera()},s=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(o.id));return this.run(()=>{var l;const a=this.getPages(),c=Pc(o.index,(l=a[a.indexOf(o)+1])==null?void 0:l.index);if(this.createPage({name:o.name+" Copy",id:n,index:c}),this.setCurrentPage(n),this.setCamera(i),s)return this.putContentOntoCurrentPage(s)}),this}renamePage(e,n){const r=typeof e=="string"?e:e.id;return this.getIsReadonly()?this:(this.updatePage({id:r,name:n}),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>this.store.put(e),{history:"ignore"}),this)}updateAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>{this.store.put(e.map(n=>({...this.store.get(n.id),...n})))},{history:"ignore"}),this)}deleteAssets(e){if(this.getIsReadonly())return this;const n=typeof e[0]=="string"?e:e.map(r=>r.id);return n.length<=0?this:(this.run(()=>this.store.remove(n),{history:"ignore"}),this)}getAsset(e){return this.store.get(typeof e=="string"?e:e.id)}async resolveAssetUrl(e,n){if(!e)return null;const r=this.getAsset(e);if(!r)return null;const{screenScale:o=1,shouldResolveToOriginal:i=!1}=n,a=Math.max(.125,(d=>Math.pow(2,Math.ceil(Math.log2(d))))(o)),c="connection"in navigator?navigator.connection.effectiveType:null,l=this.getInstanceState().devicePixelRatio;return await this.store.props.assets.resolve(r,{screenScale:o||1,steppedScreenScale:a,dpr:l,networkEffectiveType:c,shouldResolveToOriginal:i})}async uploadAsset(e,n){return await this.store.props.assets.upload(e,n)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",e=>this.getShapeUtil(e).getGeometry(e),(e,n)=>e.props===n.props)}getShapeGeometry(e){return this._getShapeGeometryCache().get(typeof e=="string"?e:e.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",e=>{var n,r;return(r=(n=this.getShapeUtil(e)).getHandles)==null?void 0:r.call(n,e)})}getShapeHandles(e){return this._getShapeHandlesCache().get(typeof e=="string"?e:e.id)}getShapeLocalTransform(e){const n=typeof e=="string"?e:e.id,r=this.getShape(n);if(!r)throw Error("Editor.getTransform: shape not found");return J.Identity().translate(r.x,r.y).rotate(r.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",e=>{if(_n(e.parentId))return this.getShapeLocalTransform(e);const n=this._getShapePageTransformCache().get(e.parentId)??J.Identity();return J.Compose(n,this.getShapeLocalTransform(e))})}getShapeParentTransform(e){const n=typeof e=="string"?e:e.id,r=this.getShape(n);return!r||_n(r.parentId)?J.Identity():this._getShapePageTransformCache().get(r.parentId)??J.Identity()}getShapePageTransform(e){const n=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(n)??J.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",e=>{const n=this._getShapePageTransformCache().get(e.id);return n?ee.FromPoints(J.applyToPoints(n,this.getShapeGeometry(e).vertices)):new ee})}getShapePageBounds(e){return this._getShapePageBoundsCache().get(typeof e=="string"?e:e.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",e=>{const n=this._getShapeMaskCache().get(e.id);if(!n)return;if(n.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const r=this._getShapePageTransformCache().get(e.id);return r?`polygon(${J.applyToPoints(J.Inverse(r),n).map(i=>`${i.x}px ${i.y}px`).join(",")})`:void 0})}getShapeClipPath(e){return this._getShapeClipPathCache().get(typeof e=="string"?e:e.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",e=>{if(_n(e.parentId))return;const n=this.getShapeAncestors(e.id).filter(o=>this.isShapeOfType(o,"frame"));return n.length===0?void 0:n.map(o=>this._getShapePageTransformCache().get(o.id).applyToPoints(this.getShapeGeometry(o).vertices)).reduce((o,i)=>{if(!(i&&o))return;const s=j0(o,i);return s?s.map(b.Cast):[]})})}getShapeMask(e){return this._getShapeMaskCache().get(typeof e=="string"?e:e.id)}getShapeMaskedPageBounds(e){return typeof e!="string"&&(e=e.id),this._getShapeMaskedPageBoundsCache().get(e)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",e=>{const n=this._getShapePageBoundsCache().get(e.id);if(!n)return;const r=this._getShapeMaskCache().get(e.id);if(r){if(r.length===0)return;const{corners:o}=n;if(o.every((s,a)=>s&&b.Equals(s,r[a])))return n.clone();const i=j0(r,o);return i?ee.FromPoints(i):void 0}return n})}getShapeAncestors(e,n=[]){const r=typeof e=="string"?e:e.id,o=this.getShape(r);if(!o)return n;const i=o.parentId;if(_n(i))return n.reverse(),n;const s=this.store.get(i);return s?(n.push(s),this.getShapeAncestors(s,n)):n}findShapeAncestor(e,n){const r=typeof e=="string"?e:e.id,o=this.getShape(r);if(!o)return;const i=o.parentId;if(_n(i))return;const s=this.getShape(i);if(s)return n(s)?s:this.findShapeAncestor(s,n)}hasAncestor(e,n){const r=typeof e=="string"?e:e==null?void 0:e.id,o=r&&this.getShape(r);return o?o.parentId===n?!0:this.hasAncestor(this.getShapeParent(o),n):!1}findCommonAncestor(e,n){var c;if(e.length===0)return;const r=typeof e[0]=="string"?e:e.map(l=>l.id),o=be(r.map(l=>this.getShape(l)));if(o.length===1){const l=o[0].parentId;return _n(l)?void 0:n?(c=this.findShapeAncestor(o[0],n))==null?void 0:c.id:l}const[i,...s]=o;let a=this.getShapeParent(i);for(;a;){if(n&&!n(a)){a=this.getShapeParent(a);continue}if(s.every(l=>this.hasAncestor(l,a.id)))return a.id;a=this.getShapeParent(a)}}isShapeOrAncestorLocked(e){const n=typeof e=="string"?this.getShape(e):e;return n===void 0?!1:n.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(n))}_notVisibleShapes(){return rK(this)}getCulledShapes(){const e=this._notVisibleShapes().get(),n=this.getSelectedShapeIds(),r=this.getEditingShapeId(),o=new Set(e);return r&&o.delete(r),n.forEach(i=>{o.delete(i)}),o}getCurrentPageBounds(){let e;return this.getCurrentPageShapeIdsSorted().forEach(n=>{const r=this.getShapeMaskedPageBounds(n);r&&(e?e=e.expand(r):e=r.clone())}),e}getSelectedShapeAtPoint(e){const n=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(r=>r.type!=="group"&&n.includes(r.id)).reverse().find(r=>this.isPointInShape(r,e,{hitInside:!0,margin:0}))}getShapeAtPoint(e,n={}){const r=this.getZoomLevel(),o=this.getViewportPageBounds(),{filter:i,margin:s=0,hitLocked:a=!1,hitLabels:c=!1,hitInside:l=!1,hitFrameInside:d=!1}=n;let h=1/0,p=null,f=1/0,g=null;const m=(n.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(y=>{if(y.isLocked&&!a||this.isShapeHidden(y)||this.isShapeOfType(y,"group"))return!1;const S=this.getShapeMask(y);return S&&!Vn(e,S)?!1:i?i(y):!0});for(let y=m.length-1;y>=0;y--){const S=m[y],v=this.getShapeGeometry(S),_=v instanceof Ir,w=this.getPointInShapeSpace(S,e);if((this.isShapeOfType(S,"arrow")||this.isShapeOfType(S,"geo")&&S.props.fill==="none")&&S.props.text.trim()){for(const C of v.children)if(C.isLabel&&C.isPointInBounds(w))return S}if(this.isShapeOfType(S,"frame")){const C=v.distanceToPoint(w,l);if(Math.abs(C)<=s)return g||S;if(v.hitTestPoint(w,0,!0))return g||p||(d?S:void 0);continue}let x;if(_){let C=1/0;for(const E of v.children){if(E.isLabel&&!c)continue;const I=E.distanceToPoint(w,l);I<C&&(C=I)}x=C}else s===0&&(v.bounds.w<1||v.bounds.h<1)||v.bounds.containsPoint(w,s)?x=v.distanceToPoint(w,l):x=1/0;if(v.isClosed){if(x<=s){if(v.isFilled||_&&v.children[0].isFilled)return g||S;if(this.getShapePageBounds(S).contains(o))continue;if(Math.abs(x)<s)Math.abs(x)<f&&(f=Math.abs(x),g=S);else if(!g){const{area:C}=v;C<h&&(h=C,p=S)}}}else if(x<this.options.hitTestMargin/r)return S}return g||p||void 0}getShapesAtPoint(e,n={}){return this.getCurrentPageShapes().filter(r=>!this.isShapeHidden(r)&&this.isPointInShape(r,e,n))}isPointInShape(e,n,r={}){const{hitInside:o=!1,margin:i=0}=r,s=typeof e=="string"?e:e.id,a=this.getShapeMask(s);return a&&!Vn(n,a)?!1:this.getShapeGeometry(s).hitTestPoint(this.getPointInShapeSpace(e,n),i,o)}getPointInShapeSpace(e,n){const r=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(r).clone().invert().applyToPoint(n)}getPointInParentSpace(e,n){const r=typeof e=="string"?e:e.id,o=this.getShape(r);if(!o)return new b(0,0);if(_n(o.parentId))return b.From(n);const i=this.getShapePageTransform(o.parentId);return i?i.clone().invert().applyToPoint(n):b.From(n)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),e=>this.store.get(e))}getCurrentPageShapesSorted(){const e=[],n=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let r=0,o=n.length;r<o;r++)O2(this,n[r],e);return e}getCurrentPageRenderingShapesSorted(){const e=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:n})=>!e.has(n)&&!this.isShapeHidden(n))}isShapeOfType(e,n){const r=typeof e=="string"?this.getShape(e):e;return r?r.type===n:!1}getShape(e){const n=typeof e=="string"?e:e.id;if(In(n))return this.store.get(n)}getShapeParent(e){const n=typeof e=="string"?e:e==null?void 0:e.id;if(!n)return;const r=this.getShape(n);if(!(r===void 0||!In(r.parentId)))return this.store.get(r.parentId)}getShapeNearestSibling(e,n){return n?n.parentId===e.parentId?n:this.findShapeAncestor(n,o=>o.parentId===e.parentId):void 0}isShapeInPage(e,n=this.getCurrentPageId()){const r=typeof e=="string"?e:e.id,o=this.getShape(r);if(!o)return!1;let i=!1;if(o.parentId===n)i=!0;else{let s=this.getShape(o.parentId);e:for(;s;){if(s.parentId===n){i=!0;break e}s=this.getShape(s.parentId)}}return i}getAncestorPageId(e){const n=typeof e=="string"?e:e==null?void 0:e.id,r=n&&this.getShape(n);if(r)return _n(r.parentId)?r.parentId:this.getAncestorPageId(this.getShape(r.parentId))}reparentShapes(e,n,r){const o=typeof e[0]=="string"?e:e.map(p=>p.id);if(o.length===0)return this;const i=[],s=_n(n)?J.Identity():this.getShapePageTransform(n),a=s.rotation();let c=[];const l=be(this.getSortedChildIdsForParent(n).map(p=>this.getShape(p)));if(r){const p=l.find(f=>f.index===r);if(p){const f=l[l.indexOf(p)+1];f?c=Xs(r,f.index,o.length):c=Fp(r,o.length)}else{const f=l.sort(nn).find(g=>g.index>r);f?c=Xs(r,f.index,o.length):c=Fp(r,o.length)}}else{const p=l.length&&l[l.length-1];c=p?Fp(p.index,o.length):Ic(o.length)}const d=s.clone().invert(),h=be(o.map(p=>this.getShape(p)));return this.run(()=>{for(let p=0;p<h.length;p++){const f=h[p],g=this.getShapePageTransform(f);if(!g)continue;const m=g.point();if(!m)continue;const y=d.applyToPoint(m),S=g.rotation()-a;i.push({id:f.id,type:f.type,parentId:n,x:y.x,y:y.y,rotation:S,index:c[p]})}this.updateShapes(i)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(e){const n=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[n];if(!r||r.length===0)return"a1";const o=this.getShape(r[r.length-1]);return Br(o.index)}getSortedChildIdsForParent(e){const n=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[n];return r||_o}visitDescendants(e,n){const r=typeof e=="string"?e:e.id,o=this.getSortedChildIdsForParent(r);for(const i of o)n(i)!==!1&&this.visitDescendants(i,n);return this}getShapeAndDescendantIds(e){const n=new Set;for(const r of e.map(o=>this.getShape(o)).sort(nn))n.add(r.id),this.visitDescendants(r,o=>{n.add(o)});return n}getDroppingOverShape(e,n=[]){const r=this.getCurrentPageShapesSorted();for(let o=r.length-1;o>=0;o--){const i=r[o];if(this.isShapeHidden(i)||this.getSelectedShapeIds().includes(i.id)||!this.getShapeUtil(i).canDropShapes(i,n)||n.find(a=>a.id===i.id||this.hasAncestor(i,a.id)))continue;const s=this.getShapeMaskedPageBounds(i.id);if(s&&s.containsPoint(e)&&this.getShapeGeometry(i).hitTestPoint(this.getPointInShapeSpace(i,e),0,!0))return i}}getOutermostSelectableShape(e,n){const r=typeof e=="string"?e:e.id,o=this.getShape(r);let i=o,s=o;const a=this.getFocusedGroup();for(;s;){if(this.isShapeOfType(s,"group")&&(a==null?void 0:a.id)!==s.id&&!this.hasAncestor(a,s.id)&&((n==null?void 0:n(s))??!0))i=s;else if((a==null?void 0:a.id)===s.id)break;s=this.getShapeParent(s)}return i}_getBindingsIndexCache(){const e=tK(this);return this.store.createComputedCache("bindingsIndex",n=>e.get().get(n.id))}getBinding(e){return this.store.get(e)}getBindingsFromShape(e,n){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(o=>o.fromId===r&&o.type===n)}getBindingsToShape(e,n){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(o=>o.toId===r&&o.type===n)}getBindingsInvolvingShape(e,n){const r=typeof e=="string"?e:e.id,o=this._getBindingsIndexCache().get(r)??_o;return n?o.filter(i=>i.type===n):o}createBindings(e){const n=[];for(const r of e){const o=this.getShape(r.fromId),i=this.getShape(r.toId);if(!o||!i||!this.canBindShapes({fromShape:o,toShape:i,binding:r}))continue;const a=this.getBindingUtil(r.type).getDefaultProps(),c=this.store.schema.types.binding.create({...r,id:r.id??Ni(),props:{...a,...r.props}});n.push(c)}return this.store.put(n),this}createBinding(e){return this.createBindings([e])}updateBindings(e){const n=[];for(const r of e){if(!r)continue;const o=this.getBinding(r.id);if(!o)continue;const i=Rr(o,r);if(i===o)continue;const s=this.getShape(i.fromId),a=this.getShape(i.toId);!s||!a||this.canBindShapes({fromShape:s,toShape:a,binding:i})&&n.push(i)}return this.store.put(n),this}updateBinding(e){return this.updateBindings([e])}deleteBindings(e,{isolateShapes:n=!1}={}){const r=e.map(o=>typeof o=="string"?o:o.id);return n?this.store.atomic(()=>{var o,i;for(const s of r){const a=this.getBinding(s);if(!a)continue;const c=this.getBindingUtil(a);(o=c.onBeforeIsolateFromShape)==null||o.call(c,{binding:a,removedShape:this.getShape(a.toId)}),(i=c.onBeforeIsolateToShape)==null||i.call(c,{binding:a,removedShape:this.getShape(a.fromId)}),this.store.remove([s])}}):this.store.remove(r),this}deleteBinding(e,n){return this.deleteBindings([e],n)}canBindShapes({fromShape:e,toShape:n,binding:r}){const o=typeof e=="string"?e:e.type,i=typeof n=="string"?n:n.type,s=typeof r=="string"?r:r.type,a={fromShapeType:o,toShapeType:i,bindingType:s};return o===i?this.getShapeUtil(o).canBind(a):this.getShapeUtil(o).canBind(a)&&this.getShapeUtil(i).canBind(a)}rotateShapesBy(e,n,r){const o=typeof e[0]=="string"?e:e.map(s=>s.id);if(o.length<=0)return this;const i=iE({editor:this,ids:o});return i?(Cd({delta:n,snapshot:i,editor:this,stage:"one-off",centerOverride:r==null?void 0:r.center}),this):this}getChangesToTranslateShape(e,n){var i,s,a;let r=e;const o=this.getShapeUtil(e);return r=Rr(r,((i=o.onTranslateStart)==null?void 0:i.call(o,r))??void 0),r=Rr(r,{id:e.id,type:e.type,x:n.x,y:n.y}),r=Rr(r,((s=o.onTranslate)==null?void 0:s.call(o,e,r))??void 0),r=Rr(r,((a=o.onTranslateEnd)==null?void 0:a.call(o,e,r))??void 0),r}nudgeShapes(e,n){const r=typeof e[0]=="string"?e:e.map(i=>i.id);if(r.length<=0)return this;const o=[];for(const i of r){const s=this.getShape(i),a=b.From(n),c=this.getShapeParentTransform(s);c&&a.rot(-c.rotation()),o.push(this.getChangesToTranslateShape(s,a.add(s)))}return this.updateShapes(o),this}duplicateShapes(e,n){return this.run(()=>{const r=typeof e[0]=="string"?e:e.map(p=>p.id);if(r.length<=0)return this;const o=new Set(r),i=this.getShapeAndDescendantIds(r),s=[...i].reverse(),a=new Map;for(const p of i)a.set(p,Xe());const{shapesToCreateWithOriginals:c,bindingsToCreate:l}=n1(this,i,p=>{const f=[];for(const m of p){const y=this.getBinding(m);if(!y)continue;const S=Ni();f.push({...y,id:S,fromId:Hn(a.get(y.fromId)),toId:Hn(a.get(y.toId))})}const g=[];for(const m of s){const y=Hn(a.get(m)),S=this.getShape(m);if(!S)continue;let v=0,_=0;if(n&&o.has(m)){const w=this.getShapeParentTransform(S),x=new b(n.x,n.y).rot(-w.rotation());v=x.x,_=x.y}g.push({shape:{...S,id:y,x:S.x+v,y:S.y+_,index:"a1",parentId:a.get(S.parentId)??S.parentId},originalShape:S})}return{shapesToCreateWithOriginals:g,bindingsToCreate:f}});c.forEach(({shape:p,originalShape:f})=>{const g=f.parentId,m=this.getSortedChildIdsForParent(g),y=m.indexOf(f.id),S=m[y+1],v=S?this.getShape(S):void 0,_=Pc(f.index,v==null?void 0:v.index);p.index=_});const d=c.map(({shape:p})=>p);if(d.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage){Wl(this);return}if(this.createShapes(d),this.createBindings(l),this.setSelectedShapes(be(r.map(p=>a.get(p)))),n!==void 0){const p=this.getSelectionPageBounds(),f=this.getViewportPageBounds();p&&!f.contains(p)&&this.centerOnPoint(p.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(e,n){const r=typeof e[0]=="string"?e:e.map(a=>a.id);if(r.length===0)return this;if(this.getIsReadonly())return this;const o=this.getCurrentPageId();if(n===o)return this;if(!this.store.has(n))return this;const i=this.getContentFromCurrentPage(r);if(!i)return this;if(this.getPageShapeIds(n).size+i.shapes.length>this.options.maxShapesPerPage)return Wl(this,n),this;const s=this.getCamera().z;return this.run(()=>{this.deleteShapes(r),this.setCurrentPage(n),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(i,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:s}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(e){const n=typeof e[0]=="string"?e:e.map(s=>s.id);if(this.getIsReadonly()||n.length===0)return this;let r=!0,o=!0;const i=[];for(const s of n){const a=this.getShape(s);a&&(i.push(a),a.isLocked?o=!1:r=!1)}return this.run(()=>{o?(this.updateShapes(i.map(s=>({id:s.id,type:s.type,isLocked:!0}))),this.setSelectedShapes([])):r?this.updateShapes(i.map(s=>({id:s.id,type:s.type,isLocked:!1}))):this.updateShapes(i.map(s=>({id:s.id,type:s.type,isLocked:!0})))}),this}sendToBack(e){const n=typeof e[0]=="string"?e:e.map(o=>o.id),r=jl(this,"toBack",n);return r&&this.updateShapes(r),this}sendBackward(e){const n=typeof e[0]=="string"?e:e.map(o=>o.id),r=jl(this,"backward",n);return r&&this.updateShapes(r),this}bringForward(e){const n=typeof e[0]=="string"?e:e.map(o=>o.id),r=jl(this,"forward",n);return r&&this.updateShapes(r),this}bringToFront(e){const n=typeof e[0]=="string"?e:e.map(o=>o.id),r=jl(this,"toFront",n);return r&&this.updateShapes(r),this}flipShapes(e,n){const r=typeof e[0]=="string"?e:e.map(s=>s.id);if(this.getIsReadonly())return this;let o=be(r.map(s=>this.getShape(s)));if(!o.length)return this;o=be(o.map(s=>this.isShapeOfType(s,"group")?this.getSortedChildIdsForParent(s.id).map(a=>this.getShape(a)):s).flat());const i=ee.Common(be(o.map(s=>this.getShapePageBounds(s)))).center;return this.run(()=>{for(const s of o){const a=this.getShapeGeometry(s).bounds,c=this.getShapePageTransform(s.id);c&&this.resizeShape(s.id,{x:n==="horizontal"?-1:1,y:n==="vertical"?-1:1},{initialBounds:a,initialPageTransform:c,initialShape:s,mode:"scale_shape",isAspectRatioLocked:this.getShapeUtil(s).isAspectRatioLocked(s),scaleOrigin:i,scaleAxisRotation:0})}}),this}stackShapes(e,n,r){const o=typeof e[0]=="string"?e:e.map(m=>m.id);if(this.getIsReadonly())return this;const i=o.map(m=>this.getShape(m)).filter(m=>m?this.getShapeUtil(m).canBeLaidOut(m):!1),s=i.length;if(r===0&&s<3||s<2)return this;const a=Object.fromEntries(i.map(m=>[m.id,this.getShapePageBounds(m)]));let c,l,d,h;n==="horizontal"?(c="x",l="minX",d="maxX",h="width"):(c="y",l="minY",d="maxY",h="height");let p;if(r===0){const m=[];i.sort((S,v)=>a[S.id][l]-a[v.id][l]);for(let S=0;S<s-1;S++){const v=i[S],_=i[S+1],w=a[v.id],C=a[_.id][l]-w[d],E=m.find(I=>I.gap===C);E?E.count++:m.push({gap:C,count:1})}let y=0;m.forEach(S=>{S.count>y&&(y=S.count,p=S.gap)}),y===1&&(p=Math.max(0,m.reduce((S,v)=>S+v.gap*v.count,0)/(s-1)))}else p=r;const f=[];let g=a[i[0].id][d];return i.forEach((m,y)=>{var x,C;if(y===0)return;const S={x:0,y:0};S[c]=g+p-a[m.id][c];const v=this.getShapeParent(m),_=v?b.Rot(S,-this.getShapePageTransform(v).decompose().rotation):S,w=(C=(x=this.getShapeUtil(m)).onTranslateStart)==null?void 0:C.call(x,m);f.push(w?{...w,[c]:m[c]+_[c]}:{id:m.id,type:m.type,[c]:m[c]+_[c]}),g+=a[m.id][h]+p}),this.updateShapes(f),this}packShapes(e,n){var C,E;const r=typeof e[0]=="string"?e:e.map(I=>I.id);if(this.getIsReadonly())return this;if(r.length<2)return this;const o=r.map(I=>this.getShape(I)).filter(I=>I?this.getShapeUtil(I).canBeLaidOut(I):!1),i={},s={};let a,c,l=0;for(let I=0;I<o.length;I++)a=o[I],c=this.getShapePageBounds(a),i[a.id]=c,s[a.id]=c.clone(),l+=c.width*c.height;const d=ee.Common(be(Object.values(i))),h=d.width;o.sort((I,T)=>i[T.id].height-i[I.id].height);const p=Math.max(Math.ceil(Math.sqrt(l/.95)),h),f=[new ee(d.x,d.y,p,1/0)];let g=0,m=0,y,S;for(let I=0;I<o.length;I++){a=o[I],c=s[a.id];for(let T=f.length-1;T>=0;T--)if(y=f[T],!(c.width>y.width||c.height>y.height)){c.x=y.x,c.y=y.y,m=Math.max(m,c.maxY),g=Math.max(g,c.maxX),c.width===y.width&&c.height===y.height?(S=f.pop(),T<f.length&&(f[T]=S)):c.height===y.height?(y.x+=c.width+n,y.width-=c.width+n):c.width===y.width?(y.y+=c.height+n,y.height-=c.height+n):(f.push(new ee(y.x+(c.width+n),y.y,y.width-(c.width+n),c.height)),y.y+=c.height+n,y.height-=c.height+n);break}}const v=ee.Common(Object.values(s)),_=b.Sub(d.center,v.center);let w;const x=[];for(let I=0;I<o.length;I++){a=o[I],c=i[a.id],w=s[a.id];const T=b.Sub(w.point,c.point).add(_),k=this.getShapeParentTransform(a);k&&T.rot(-k.rotation());const D={id:a.id,type:a.type,x:a.x+T.x,y:a.y+T.y},A=(E=(C=this.getShapeUtil(a)).onTranslateStart)==null?void 0:E.call(C,{...a,...D});A?x.push({...D,...A}):x.push(D)}return x.length&&this.updateShapes(x),this}alignShapes(e,n){const r=typeof e[0]=="string"?e:e.map(c=>c.id);if(this.getIsReadonly())return this;if(r.length<2)return this;const o=be(r.map(c=>this.getShape(c))),i=Object.fromEntries(o.map(c=>[c.id,this.getShapePageBounds(c)])),s=ee.Common(be(Object.values(i))),a=[];return o.forEach(c=>{const l=i[c.id];if(!l)return;const d={x:0,y:0};switch(n){case"top":{d.y=s.minY-l.minY;break}case"center-vertical":{d.y=s.midY-l.minY-l.height/2;break}case"bottom":{d.y=s.maxY-l.minY-l.height;break}case"left":{d.x=s.minX-l.minX;break}case"center-horizontal":{d.x=s.midX-l.minX-l.width/2;break}case"right":{d.x=s.maxX-l.minX-l.width;break}}const h=this.getShapeParent(c),p=h?b.Rot(d,-this.getShapePageTransform(h).decompose().rotation):d;a.push(this.getChangesToTranslateShape(c,b.Add(c,p)))}),this.updateShapes(a),this}distributeShapes(e,n){const r=typeof e[0]=="string"?e:e.map(v=>v.id);if(this.getIsReadonly())return this;if(r.length<3)return this;const o=r.length,i=be(r.map(v=>this.getShape(v))),s=Object.fromEntries(i.map(v=>[v.id,this.getShapePageBounds(v)]));let a,c,l,d,h;n==="horizontal"?(a="x",c="minX",l="maxX",d="midX",h="width"):(a="y",c="minY",l="maxY",d="midY",h="height");const p=[],f=i.sort((v,_)=>s[v.id][c]-s[_.id][c])[0],g=i.sort((v,_)=>s[_.id][l]-s[v.id][l])[0],m=s[f.id][d],y=(s[g.id][d]-m)/(o-1),S=m+y;return i.filter(v=>v!==f&&v!==g).sort((v,_)=>s[v.id][d]-s[_.id][d]).forEach((v,_)=>{const w={x:0,y:0};w[a]=S+y*_-s[v.id][h]/2-s[v.id][a];const x=this.getShapeParent(v),C=x?b.Rot(w,-this.getShapePageTransform(x).rotation()):w;p.push(this.getChangesToTranslateShape(v,b.Add(v,C)))}),this.updateShapes(p),this}stretchShapes(e,n){const r=typeof e[0]=="string"?e:e.map(c=>c.id);if(this.getIsReadonly())return this;if(r.length<2)return this;const o=be(r.map(c=>this.getShape(c))),i=Object.fromEntries(r.map(c=>[c,this.getShapeGeometry(c).bounds])),s=Object.fromEntries(r.map(c=>[c,this.getShapePageBounds(c)])),a=ee.Common(be(Object.values(s)));switch(n){case"vertical":{this.run(()=>{for(const c of o){if(this.getShapePageTransform(c).rotation()%Ve)continue;const d=i[c.id],h=s[c.id],p=new b(0,a.minY-h.minY),f=this.getShapeParentTransform(c);f&&p.rot(-f.rotation());const{x:g,y:m}=b.Add(p,c);this.updateShapes([{id:c.id,type:c.type,x:g,y:m}]);const y=new b(1,a.height/h.height);this.resizeShape(c.id,y,{initialBounds:d,scaleOrigin:new b(h.center.x,a.minY),isAspectRatioLocked:this.getShapeUtil(c).isAspectRatioLocked(c),scaleAxisRotation:0})}});break}case"horizontal":{this.run(()=>{for(const c of o){const l=i[c.id],d=s[c.id];if(this.getShapePageTransform(c).rotation()%Ve)continue;const p=new b(a.minX-d.minX,0),f=this.getShapeParentTransform(c);f&&p.rot(-f.rotation());const{x:g,y:m}=b.Add(p,c);this.updateShapes([{id:c.id,type:c.type,x:g,y:m}]);const y=new b(a.width/d.width,1);this.resizeShape(c.id,y,{initialBounds:l,scaleOrigin:new b(a.minX,d.center.y),isAspectRatioLocked:this.getShapeUtil(c).isAspectRatioLocked(c),scaleAxisRotation:0})}});break}}return this}resizeShape(e,n,r={}){var f,g,m;const o=typeof e=="string"?e:e.id;if(this.getIsReadonly())return this;Number.isFinite(n.x)||(n=new b(1,n.y)),Number.isFinite(n.y)||(n=new b(n.x,1));const i=r.initialShape??this.getShape(o);if(!i)return this;const s=r.scaleOrigin??((f=this.getShapePageBounds(o))==null?void 0:f.center);if(!s)return this;const a=r.initialPageTransform?J.Cast(r.initialPageTransform):this.getShapePageTransform(o);if(!a)return this;const c=a.rotation();if(c==null)return this;const l=r.scaleAxisRotation??c,d=r.initialBounds??this.getShapeGeometry(o).bounds;if(!d)return this;const h=r.isAspectRatioLocked??this.getShapeUtil(i).isAspectRatioLocked(i);if(!XI(c,l))return this._resizeUnalignedShape(o,n,{...r,initialBounds:d,scaleOrigin:s,scaleAxisRotation:l,initialPageTransform:a,isAspectRatioLocked:h,initialShape:i});const p=this.getShapeUtil(i);if(h&&(Math.abs(n.x)>Math.abs(n.y)?n=new b(n.x,Math.sign(n.y)*Math.abs(n.x)):n=new b(Math.sign(n.x)*Math.abs(n.y),n.y)),p.onResize&&p.canResize(i)){const y=this._scalePagePoint(J.applyToPoint(a,new b(0,0)),s,n,l),S=this.getPointInParentSpace(i.id,y),v=new b(n.x,n.y),_=oi((c-l)%Math.PI,0);v.x=_?n.x:n.y,v.y=_?n.y:n.x;const w=J.applyToPoint(a,new b),{x,y:C}=this.getPointInParentSpace(i.id,w);let E=i;r.skipStartAndEndCallbacks||(E=Rr(i,((g=p.onResizeStart)==null?void 0:g.call(p,i))??void 0)),E=Rr(E,{id:o,type:i.type,x:S.x,y:S.y,...p.onResize({...i,x,y:C},{newPoint:S,handle:r.dragHandle??"bottom_right",mode:r.mode??"scale_shape",scaleX:v.x,scaleY:v.y,initialBounds:d,initialShape:i})}),r.skipStartAndEndCallbacks||(E=Rr(E,((m=p.onResizeEnd)==null?void 0:m.call(p,i,E))??void 0)),this.updateShapes([E])}else{const y=J.applyToPoint(a,d.center),S=this._scalePagePoint(y,s,n,l),v=this.getPointInParentSpace(i.id,y),_=this.getPointInParentSpace(i.id,S),w=b.Sub(_,v);this.updateShapes([{id:o,type:i.type,x:i.x+w.x,y:i.y+w.y}])}return this}_scalePagePoint(e,n,r,o){const i=b.RotWith(e,n,-o).sub(n),s=b.MulV(i,r);return b.Add(s,n).rotWith(n,o)}_resizeUnalignedShape(e,n,r){const{type:o}=r.initialShape,i=new b(n.x,n.y);if(Math.abs(n.x)>Math.abs(n.y)?i.x=Math.sign(n.x)*Math.abs(n.y):i.y=Math.sign(n.y)*Math.abs(n.x),this.resizeShape(e,i,{initialShape:r.initialShape,initialBounds:r.initialBounds,isAspectRatioLocked:r.isAspectRatioLocked}),Math.sign(n.x)*Math.sign(n.y)<0){let{rotation:y}=J.Decompose(r.initialPageTransform);y-=2*y,this.updateShapes([{id:e,type:o,rotation:y}])}const s=J.applyToPoint(r.initialPageTransform,r.initialBounds.center),a=this._scalePagePoint(s,r.scaleOrigin,n,r.scaleAxisRotation),c=this.getShapePageBounds(e),l=this.getShapePageTransform(e),d=c.center,h=l.point();if(!d||!h)return this;const p=b.Sub(a,d),f=b.Add(h,p),{x:g,y:m}=this.getPointInParentSpace(e,f);return this.updateShapes([{id:e,type:o,x:g,y:m}]),this}getInitialMetaForShape(e){return{}}createShape(e){return this.createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getIsReadonly())return this;if(e.length<=0)return this;const n=this.getCurrentPageShapeIds();if(e.length+n.size>this.options.maxShapesPerPage)return Wl(this),this;const o=this.getFocusedGroupId();return this.run(()=>{var d,h;const i=this.getCurrentPageShapesSorted(),s=e.map(p=>{if(p.id||(p={id:Xe(),...p}),!p.parentId||!(this.store.has(p.parentId)||e.some(f=>f.id===p.parentId))){let f=this.getFocusedGroupId();for(let m=i.length-1;m>=0;m--){const y=i[m];if(!this.isShapeHidden(y)&&this.getShapeUtil(y).canReceiveNewChildrenOfType(y,p.type)&&this.isPointInShape(y,{x:p.x??0,y:p.y??0},{margin:0,hitInside:!0})){f=y.id;break}}const g=p.parentId;if(f===p.id&&(f=o),f!==g&&(p={...p},p.parentId=f,In(f))){const m=this.getPointInShapeSpace(this.getShape(f),{x:p.x??0,y:p.y??0});p.x=m.x,p.y=m.y,p.rotation=-this.getShapePageTransform(f).rotation()+(p.rotation??0)}}return p}),a=new Map,c=[],{opacityForNextShape:l}=this.getInstanceState();for(const p of s){const f=this.getShapeUtil(p);let g=p.index;if(!g){const v=p.parentId??o;a.has(v)||a.set(v,this.getHighestIndexForParent(v)),g=a.get(v),a.set(v,Br(g))}const m=f.getDefaultProps();for(const[v,_]of this.styleProps[p.type])m[_]=this.getStyleForNextShape(v);let y=this.store.schema.types.shape.create({...p,index:g,opacity:p.opacity??l,parentId:p.parentId??o,props:"props"in p?{...m,...p.props}:m});if(y.index===void 0)throw Error("no index!");const S=(h=(d=this.getShapeUtil(y)).onBeforeCreate)==null?void 0:h.call(d,y);S&&(y=S),c.push(y)}c.forEach(p=>{p.meta={...this.getInitialMetaForShape(p),...p.meta}}),this.store.put(c)}),this}animateShape(e,n={animation:pf}){return this.animateShapes([e],n)}animateShapes(e,n={animation:pf}){if(!n.animation)return this;const{duration:r=500,easing:o=Rt.linear}=n.animation,i=Ye();let s=r,a;const c=[];let l,d;for(let p=0,f=e.length;p<f;p++){if(l=e[p],!l)continue;const g=this.getShape(l.id);g&&(d={start:ut(g),end:Rr(ut(g),l)},c.push(d),this.animatingShapes.set(g.id,i))}const h=p=>{var y,S;if(s-=p,s<0){const{animatingShapes:v}=this,_=e.filter(w=>w&&v.get(w.id)===i);_.length&&this.updateShapes(_),this.off("tick",h);return}a=o(1-s/r);const{animatingShapes:f}=this,g=[];let m;for(let v=0,_=c.length;v<_;v++){const{start:w,end:x}=c[v];m=f.get(w.id),m===i&&g.push({...x,x:w.x+(x.x-w.x)*a,y:w.y+(x.y-w.y)*a,opacity:w.opacity+(x.opacity-w.opacity)*a,rotation:w.rotation+(x.rotation-w.rotation)*a,props:((S=(y=this.getShapeUtil(x)).getInterpolatedProps)==null?void 0:S.call(y,w,x,a))??x.props})}this._updateShapes(g)};return this.on("tick",h),this}groupShapes(e,n={}){var g;const{groupId:r=Xe(),select:o=!0}=n;if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getIsReadonly())return this;const i=typeof e[0]=="string"?e:e.map(m=>m.id);if(i.length<=1)return this;const s=be((this._shouldIgnoreShapeLock?i:this._getUnlockedShapeIds(i)).map(m=>this.getShape(m))),a=s.sort(nn).map(m=>m.id),c=ee.Common(be(s.map(m=>this.getShapePageBounds(m)))),{x:l,y:d}=c.point,h=this.findCommonAncestor(s)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const p=s.filter(m=>m.parentId===h).sort(nn),f=(g=p[p.length-1])==null?void 0:g.index;return this.run(()=>{this.createShapes([{id:r,type:"group",parentId:h,index:f,x:l,y:d,opacity:1,props:{}}]),this.reparentShapes(a,r),o&&this.select(r)}),this}ungroupShapes(e,n={}){if(this.getIsReadonly())return this;const{select:r=!0}=n,o=typeof e[0]=="string"?e:e.map(c=>c.id),i=be((this._shouldIgnoreShapeLock?o:this._getUnlockedShapeIds(o)).map(c=>this.getShape(c)));if(i.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const s=new Set,a=[];return i.forEach(c=>{this.isShapeOfType(c,"group")?a.push(c):s.add(c.id)}),a.length===0?this:(this.run(()=>{let c;for(let l=0,d=a.length;l<d;l++){c=a[l];const h=this.getSortedChildIdsForParent(c.id);for(let p=0,f=h.length;p<f;p++)s.add(h[p]);this.reparentShapes(h,c.parentId,c.index)}this.deleteShapes(a.map(l=>l.id)),r&&this.select(...s)}),this)}updateShape(e){return this.updateShapes([e]),this}updateShapes(e){const n=Array(e.length);for(let r=0,o=e.length;r<o;r++){const i=e[r];if(!i)continue;const s=this.getShape(i.id);if(s){if(!this._shouldIgnoreShapeLock){if(s.isLocked){if(!(Object.hasOwn(i,"isLocked")&&!i.isLocked))continue}else if(this.isShapeOrAncestorLocked(s))continue}this.animatingShapes.delete(i.id),n.push(i)}}return this._updateShapes(n),this}_updateShapes(e){this.getIsReadonly()||this.run(()=>{var i,s;const n=[];let r,o;for(let a=0,c=e.length;a<c;a++){const l=e[a];l&&(r=this.getShape(l.id),r&&(o=Rr(r,l),o!==r&&(o=((s=(i=this.getShapeUtil(r)).onBeforeUpdate)==null?void 0:s.call(i,r,o))??o,n.push(o))))}this.store.put(n)})}_getUnlockedShapeIds(e){return e.filter(n=>{var r;return!((r=this.getShape(n))!=null&&r.isLocked)})}deleteShapes(e){if(this.getIsReadonly())return this;if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const n=typeof e[0]=="string"?e:e.map(i=>i.id),r=this._shouldIgnoreShapeLock?n:this._getUnlockedShapeIds(n);if(r.length===0)return this;const o=new Set(r);for(const i of r)this.visitDescendants(i,s=>{o.add(s)});return this.run(()=>this.store.remove([...o]))}deleteShape(e){return this.deleteShapes([typeof e=="string"?e:e.id]),this}_extractSharedStyles(e,n){if(this.isShapeOfType(e,"group")){const r=this._parentIdsToChildIds.get()[e.id];if(!r)return;for(let o=0,i=r.length;o<i;o++)this._extractSharedStyles(this.getShape(r[o]),n)}else for(const[r,o]of this.styleProps[e.type])n.applyValue(r,kn(e.props,o))}_getSelectionSharedStyles(){const e=this.getSelectedShapes(),n=new mm;for(const r of e)this._extractSharedStyles(r,n);return n}getStyleForNextShape(e){const n=this.getInstanceState().stylesForNextShape[e.id];return n===void 0?e.defaultValue:n}getShapeStyleIfExists(e,n){const r=this.styleProps[e.type].get(n);if(r!==void 0)return kn(e.props,r)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const e=this.root.getCurrent(),n=new mm;if(!e)return n;if(e.shapeType)for(const r of this.styleProps[e.shapeType].keys())n.applyValue(r,this.getStyleForNextShape(r));return n}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const e=[],n=o=>{const i=this.getShape(o);if(i)if(this.isShapeOfType(i,"group"))for(const s of this.getSortedChildIdsForParent(i.id))n(s);else e.push(i)};for(const o of this.getSelectedShapeIds())n(o);let r=null;for(const o of e)if(r===null)r=o.opacity;else if(r!==o.opacity)return{type:"mixed"};if(r!==null)return{type:"shared",value:r}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(e,n){return this.updateInstanceState({opacityForNextShape:e},n),this}setOpacityForSelectedShapes(e){const n=this.getSelectedShapes();if(n.length>0){const r=[],o=i=>{if(this.isShapeOfType(i,"group")){const s=this.getSortedChildIdsForParent(i);for(const a of s)o(this.getShape(a))}else r.push(i)};for(const i of n)o(i);this.updateShapes(r.map(i=>({id:i.id,type:i.type,opacity:e})))}return this}setStyleForNextShapes(e,n,r){const o=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...o,[e.id]:n}},r),this}setStyleForSelectedShapes(e,n){const r=this.getSelectedShapes();if(r.length>0){const o=[],i=s=>{if(this.isShapeOfType(s,"group")){const a=this.getSortedChildIdsForParent(s.id);for(const c of a)i(this.getShape(c))}else{const a=this.getShapeUtil(s),c=this.styleProps[s.type].get(e);if(c){const l={id:s.id,type:s.type,props:{[c]:n}};o.push({util:a,originalShape:s,updatePartial:l})}}};for(const s of r)i(s);this.updateShapes(o.map(({updatePartial:s})=>s))}return this}registerExternalAssetHandler(e,n){return this.externalAssetContentHandlers[e]=n,this}createTemporaryAssetPreview(e,n){if(this.temporaryAssetPreview.has(e))return this.temporaryAssetPreview.get(e);const r=URL.createObjectURL(n);return this.temporaryAssetPreview.set(e,r),setTimeout(()=>{this.temporaryAssetPreview.delete(e),URL.revokeObjectURL(r)},this.options.temporaryAssetPreviewLifetimeMs),r}getTemporaryAssetPreview(e){return this.temporaryAssetPreview.get(e)}async getAssetForExternalContent(e){var n,r;return await((r=(n=this.externalAssetContentHandlers)[e.type])==null?void 0:r.call(n,e))}hasExternalAssetHandler(e){return!!this.externalAssetContentHandlers[e]}registerExternalContentHandler(e,n){return this.externalContentHandlers[e]=n,this}async putExternalContent(e){var n,r;return(r=(n=this.externalContentHandlers)[e.type])==null?void 0:r.call(n,e)}getContentFromCurrentPage(e){const n=typeof e[0]=="string"?e:e.map(o=>o.id);if(!n||n.length===0)return;const r=this.getShapeAndDescendantIds(n);return n1(this,r,o=>{const i=[];for(const d of o){const h=this.getBinding(d);h&&i.push(h)}const s=[],a=[];for(const d of r){const h=this.getShape(d);if(!h)continue;if(!r.has(h.parentId)){const f=this.getShapePageTransform(h.id),g=f.point();a.push({...h,x:g.x,y:g.y,rotation:f.rotation(),parentId:this.getCurrentPageId()}),s.push(h.id)}else a.push(h)}const c=[],l=new Set;for(const d of a){if(!("assetId"in d.props))continue;const h=d.props.assetId;if(!h||l.has(h))continue;l.add(h);const p=this.getAsset(h);p&&c.push(p)}return{schema:this.store.schema.serialize(),shapes:a,rootShapeIds:s,bindings:i,assets:c}})}async resolveAssetsInContent(e){if(!e)return;const n=[];return await Promise.allSettled(e.assets.map(async r=>{var o,i;if((r.type==="image"||r.type==="video")&&!((o=r.props.src)!=null&&o.startsWith("data:image"))&&!((i=r.props.src)!=null&&i.startsWith("http"))){const s=ut(r),a=await this.store.props.assets.resolve(r,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});s.props.src=await wo.blobToDataUrl(await Pr(a).then(c=>c.blob())),n.push(s)}else n.push(r)})),e.assets=n,e}putContentOntoCurrentPage(e,n={}){var k,D;if(this.getIsReadonly())return this;if(!e.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:r=!1,preserveIds:o=!1,preservePosition:i=!1}=n;let{point:s=void 0}=n;const a=this.getCurrentPageId(),{rootShapeIds:c}=e,l=[],d=[],h=[],p={store:{...Object.fromEntries(e.assets.map(A=>[A.id,A])),...Object.fromEntries(e.shapes.map(A=>[A.id,A])),...Object.fromEntries(((k=e.bindings)==null?void 0:k.map(A=>[A.id,A]))??[])},schema:e.schema},f=this.store.schema.migrateStoreSnapshot(p);if(f.type==="error")throw Error("Could not put content: could not migrate content");for(const A of Object.values(f.value))switch(A.typeName){case"asset":{l.push(A);break}case"shape":{d.push(A);break}case"binding":{h.push(A);break}}const g=new Map(o?d.map(A=>[A.id,A.id]):d.map(A=>[A.id,Xe()])),m=new Map(o?h.map(A=>[A.id,A.id]):h.map(A=>[A.id,Ni()]));let y=this.getCurrentPageId(),S=1/0,v=[];for(const A of this.getSelectedShapes()){if(S===0)break;const O=this.isShapeOfType(A,"frame"),$=this.getShapeAncestors(A);O&&$.push(A);const z=O?$.length+1:$.length;if(z<S)S=z,v=$,y=O?A.id:A.parentId;else if(z===S){if(v.length!==$.length)throw Error(`Ancestors: ${v.length} !== ${$.length}`);if(v.length===0){y=a;break}else{y=a;for(let R=0;R<v.length&&$[R]===v[R];R++)y=$[R].id}}}let _=!1;if(!_n(y)){const A=this.getShape(y);if(A){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(A)))y=a;else if(c.length===1){const O=d.find($=>$.id===c[0]);this.isShapeOfType(A,"frame")&&this.isShapeOfType(O,"frame")&&O.props.w===(A==null?void 0:A.props.w)&&O.props.h===(A==null?void 0:A.props.h)&&(_=!0)}}else y=a}_||(_=g.has(y)),_&&(y=this.getShape(y).parentId);let w=this.getHighestIndexForParent(y);const x=[],C=d.map(A=>{const O=g.get(A.id),$={...A,id:O};return c.includes(A.id)&&($.parentId=a,x.push($)),g.has($.parentId)?$.parentId=g.get(A.parentId):(c.push($.id),$.index=w,w=Br(w)),$});if(C.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return Wl(this),this;const E=h.map(A=>({...A,id:Hn(m.get(A.id)),fromId:Hn(g.get(A.fromId)),toId:Hn(g.get(A.toId))})),I=[],T=[];for(const A of l)this.store.has(A.id)||((A.type==="image"||A.type==="video")&&((D=A.props.src)!=null&&D.startsWith("data:image"))&&(T.push(ut(A)),A.props.src=null),I.push(A));return Promise.allSettled(T.map(async A=>{const O=await Gj(A.props.src,A.props.name,A.props.mimeType??"image/png"),$=await this.getAssetForExternalContent({type:"file",file:O,assetId:A.id});if(!$){this.deleteAssets([A.id]);return}this.updateAssets([{...$,id:A.id}])})),this.run(()=>{I.length>0&&this.createAssets(I),this.createShapes(C),this.createBindings(E),r&&this.select(...x.map(R=>R.id)),y!==a&&this.reparentShapes(x.map(R=>R.id),y);const A=C.map(R=>this.getShape(R.id)),O=ee.Common(A.map(R=>this.getShapePageBounds(R)));if(s===void 0)if(_n(y)){const R=this.getViewportPageBounds();i||R.includes(ee.From(O))?s=O.center:s=R.center}else{const R=this.getShape(y);s=J.applyToPoint(this.getShapePageTransform(R),this.getShapeGeometry(R).bounds.center)}if(x.length===1){const R=x[0];if(this.isShapeOfType(R,"frame"))for(;this.getShapesAtPoint(s).some(W=>this.isShapeOfType(W,"frame")&&W.props.w===R.props.w&&W.props.h===R.props.h);)s.x+=O.w+16}const $=ee.Common(be(x.map(({id:R})=>this.getShapePageBounds(R)))).center,z=b.Sub(s,$);this.updateShapes(x.map(({id:R})=>{const W=this.getShape(R),j=this.getShapeParentTransform(R).decompose().rotation,G=b.Rot(z,-j);return{id:W.id,type:W.type,x:W.x+G.x,y:W.y+G.y}}))}),this}async getSvgElement(e,n={}){const r=typeof e[0]=="string"?e:e.map(o=>o.id);if(r.length!==0)return Hj(this,r,n)}async getSvgString(e,n={}){const r=await this.getSvgElement(e,n);return r?{svg:new XMLSerializer().serializeToString(r.svg),width:r.width,height:r.height}:void 0}async getSvg(e,n={}){const r=await this.getSvgElement(e,n);if(r)return r.svg}_updateInputsFromEvent(e){const{pointerVelocity:n,previousScreenPoint:r,previousPagePoint:o,currentScreenPoint:i,currentPagePoint:s}=this.inputs,{screenBounds:a}=this.store.unsafeGetWithoutCapture(hn),{x:c,y:l,z:d}=Ol(()=>this.getCamera()),h=e.point.x-a.x,p=e.point.y-a.y,f=e.point.z??.5;r.setTo(i),o.setTo(s),i.set(h,p);const g=h/d-c,m=p/d-l;isFinite(g)&&isFinite(m)&&s.set(g,m,f),this.inputs.isPen=e.type==="pointer"&&e.isPen,(e.name==="pointer_down"||this.inputs.isPinching)&&(n.set(0,0),this.inputs.originScreenPoint.setTo(i),this.inputs.originPagePoint.setTo(s)),this.run(()=>{var y;this.store.put([{id:Eu,typeName:"pointer",x:s.x,y:s.y,lastActivityTimestamp:e.type==="pointer"&&e.pointerId===x0.CAMERA_MOVE?((y=this.store.unsafeGetWithoutCapture(Eu))==null?void 0:y.lastActivityTimestamp)??this._tickManager.now:this._tickManager.now,meta:{}}])},{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus({focusContainer:e=!0}={}){return this.getIsFocused()?this:(e&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0}),this)}blur({blurContainer:e=!0}={}){return this.getIsFocused()?(e?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getIsReadonly(){return this.getInstanceState().isReadonly}getSnapshot(){return VH(this.store)}loadSnapshot(e,n){return DC(this.store,e,n),this}_zoomToFitPageContentAt100Percent(){const e=this.getCurrentPageBounds();e&&this.zoomToBounds(e,{immediate:!0,targetZoom:this.getBaseZoom()})}_navigateToDeepLink(e){this.run(()=>{switch(e.type){case"page":{const n=this.getPage(e.pageId);n&&this.setCurrentPage(n),this._zoomToFitPageContentAt100Percent();return}case"shapes":{const n=be(e.shapeIds.map(s=>this.getShape(s))),r={};for(const s of n){const a=this.getAncestorPageId(s);a&&(r[a]??(r[a]=[]),r[a].push(s))}const[o,i]=Object.entries(r).sort(([s,a],[c,l])=>l.length-a.length)[0]??["",[]];if(!o||!i.length)this._zoomToFitPageContentAt100Percent();else{this.setCurrentPage(o);const s=ee.Common(i.map(a=>this.getShapePageBounds(a)));this.zoomToBounds(s,{immediate:!0,targetZoom:this.getBaseZoom()})}return}case"viewport":{if(e.pageId){if(!this.getPage(e.pageId)){this._zoomToFitPageContentAt100Percent();return}this.setCurrentPage(e.pageId)}this.zoomToBounds(e.bounds,{immediate:!0,inset:0});return}default:$t(e)}})}navigateToDeepLink(e){if(e&&"type"in e)return this._navigateToDeepLink(e),this;const r=new URL((e==null?void 0:e.url)??window.location.href).searchParams.get((e==null?void 0:e.param)??"d");if(!r)return this._zoomToFitPageContentAt100Percent(),this;try{this._navigateToDeepLink(Xj(r))}catch(o){console.warn(o),this._zoomToFitPageContentAt100Percent()}return this}createDeepLink(e){const n=new URL((e==null?void 0:e.url)??window.location.href);return n.searchParams.set((e==null?void 0:e.param)??"d",Yj((e==null?void 0:e.to)??{type:"viewport",pageId:this.options.maxPages===1?void 0:this.getCurrentPageId(),bounds:this.getViewportPageBounds()})),n}registerDeepLinkListener(e){if(e!=null&&e.getUrl&&!(e!=null&&e.onChange))throw Error("[tldraw:urlStateSync] If you specify getUrl, you must also specify the onChange callback.");const n=K("url with state",()=>{var c,l;const s=((c=e==null?void 0:e.getUrl)==null?void 0:c.call(e,this))??window.location.href;return this.createDeepLink({param:e==null?void 0:e.param,url:s,to:(l=e==null?void 0:e.getTarget)==null?void 0:l.call(e,this)}).toString()}),r=(e==null?void 0:e.onChange)??(()=>{var a;const s=this.createDeepLink({param:e==null?void 0:e.param,to:(a=e==null?void 0:e.getTarget)==null?void 0:a.call(e,this)});window.history.replaceState({},document.title,s.toString())}),o=Cy(s=>s(),(e==null?void 0:e.debounceMs)??500),i=xo("update url on state change",()=>r(new URL(n.get()),this),{scheduleEffect:o});return()=>{i(),o.cancel()}}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_setShiftKeyTimeout(){this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:rn(this.inputs),code:"ShiftLeft"})}_setAltKeyTimeout(){this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:rn(this.inputs),code:"AltLeft"})}_setCtrlKeyTimeout(){this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:rn(this.inputs),code:"ControlLeft"})}_setMetaKeyTimeout(){this.inputs.metaKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Meta",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:rn(this.inputs),code:"MetaLeft"})}dispatch(e){return this._pendingEventsForNextTick.push(e),e.type==="pointer"&&e.name==="pointer_move"||e.type==="wheel"||e.type==="pinch"||this._flushEventsForTick(0),this}_flushEventsForTick(e){this.run(()=>{if(this._pendingEventsForNextTick.length>0){const n=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const r of n)this._flushEventForTick(r)}e>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:e}),this.scribbles.tick(e)})}_flushEventForTick(e){if(this.getCrashingError())return this;const{inputs:n}=this,{type:r}=e;if(e.type==="misc"){(e.name==="cancel"||e.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(e);return}e.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,n.shiftKey=!0):!e.shiftKey&&n.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,n.altKey=!0):!e.altKey&&n.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,n.ctrlKey=!0):!e.ctrlKey&&n.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150)),e.metaKey?(clearTimeout(this._metaKeyTimeout),this._metaKeyTimeout=-1,n.metaKey=!0):!e.metaKey&&n.metaKey&&this._metaKeyTimeout===-1&&(this._metaKeyTimeout=this.timers.setTimeout(this._setMetaKeyTimeout,150));const{originPagePoint:o,currentPagePoint:i}=n;n.isPointing||(n.isDragging=!1);const s=this.store.unsafeGetWithoutCapture(hn),a=this.store.get(this._getCurrentPageStateId()),c=this._cameraOptions.__unsafe__getWithoutCapture();switch(r){case"pinch":{if(c.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(e),e.name){case"pinch_start":{if(n.isPinching)return;n.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...a.selectedShapeIds]),this._didPinch=!0,n.isPinching=!0,this.interrupt());return}case"pinch":{if(!n.isPinching)return;const{point:{z:l=1},delta:{x:d,y:h}}=e,{x:p,y:f}=b.SubXY(e.point,s.screenBounds.x,s.screenBounds.y);this.stopCameraAnimation(),s.followingUserId&&this.stopFollowingUser();const{x:g,y:m,z:y}=Ol(()=>this.getCamera()),{panSpeed:S,zoomSpeed:v}=c;this._setCamera(new b(g+d*S/y-p/y+p/(l*v),m+h*S/y-f/y+f/(l*v),l*v),{immediate:!0});return}case"pinch_end":{if(!n.isPinching)return this;n.isPinching=!1;const{_selectedShapeIdsAtPointerDown:l}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,l.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(l)}));return}}}case"wheel":{if(c.isLocked)return;if(this._updateInputsFromEvent(e),!this.menus.hasAnyOpenMenus()){const{panSpeed:l,zoomSpeed:d,wheelBehavior:h}=c;if(h!=="none"){this.stopCameraAnimation(),s.followingUserId&&this.stopFollowingUser();const{x:p,y:f,z:g}=Ol(()=>this.getCamera()),{x:m,y,z:S=0}=e.delta;let v=h;switch(n.ctrlKey&&(v=h==="pan"?"zoom":"pan"),v){case"zoom":{const{x:_,y:w}=this.inputs.currentScreenPoint;let x=S;h==="zoom"&&(Math.abs(y)>10?x=10*Math.sign(y)/100:x=y/100);const C=g+(x??0)*d*g;this._setCamera(new b(p+(_/C-_)-(_/g-_),f+(w/C-w)-(w/g-w),C),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":{this._setCamera(new b(p+m*l/g,f+y*l/g,g),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}}}break}case"pointer":{if(n.isPinching)return;this._updateInputsFromEvent(e);const{isPen:l}=e,{isPenMode:d}=s;switch(e.name){case"pointer_down":{if(d&&!l)return;if(this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{this.dispatch({...e,point:this.inputs.currentScreenPoint,name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),e.button===P0&&(this.capturedPointerId=e.pointerId),n.buttons.add(e.button),n.isPointing=!0,n.isDragging=!1,!d&&l&&this.updateInstanceState({isPenMode:!0}),e.button===I0?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):e.button===zl&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break}case"pointer_move":{if(!l&&d)return;const{x:h,y:p,z:f}=Ol(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:g,previousScreenPoint:m}=this.inputs,{panSpeed:y}=c,S=b.Sub(g,m);this.setCamera(new b(h+S.x*y/f,p+S.y*y/f,f),{immediate:!0}),this.maybeTrackPerformance("Panning");return}n.isPointing&&!n.isDragging&&b.Dist2(o,i)*this.getZoomLevel()>(s.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/f&&(n.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":{if(n.isDragging=!1,n.isPointing=!1,clearTimeout(this._longPressTimeout),n.buttons.delete(e.button),this.menus.hasAnyOpenMenus()||s.isPenMode&&!l)return;if(this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),n.isPanning){n.keys.has("Space")||(n.isPanning=!1,n.isSpacebarPanning=!1);const h=this.inputs.pointerVelocity,p=Math.min(2,h.len());switch(e.button){case P0:{this.setCursor({type:"grab",rotation:0});break}case zl:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}p>0&&this.slideCamera({speed:p,direction:h})}else e.button===I0&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(e.key==="ShiftRight"&&(e.key="ShiftLeft"),e.key==="AltRight"&&(e.key="AltLeft"),e.code==="ControlRight"&&(e.code="ControlLeft"),e.code==="MetaRight"&&(e.code="MetaLeft"),e.name){case"key_down":{if(n.keys.add(e.code),e.code==="Space"&&!e.ctrlKey&&(this.inputs.isPanning||(this._prevCursor=s.cursor.type),this.inputs.isPanning=!0,this.inputs.isSpacebarPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0})),this.inputs.isSpacebarPanning){let l;switch(e.code){case"ArrowUp":{l=new b(0,-1);break}case"ArrowRight":{l=new b(1,0);break}case"ArrowDown":{l=new b(0,1);break}case"ArrowLeft":{l=new b(-1,0);break}}if(l){const d=this.getViewportPageBounds(),h=d.clone().translate(l.mulV({x:d.w,y:d.h}));this._animateToViewport(h,{animation:{duration:320}})}}break}case"key_up":{n.keys.delete(e.code),e.code==="Space"&&(this.inputs.buttons.has(zl)||(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})));break}}break}}if(e.type==="pointer"){e.button===zl?e.name="middle_click":e.button===IS&&(e.name="right_click");const{isPenMode:l}=this.store.unsafeGetWithoutCapture(hn);if(e.isPen===l){const d=this._clickManager.handlePointerEvent(e);if(e.name!==d.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(d),this.emit("event",d);return}}}return this.root.handleEvent(e),this.emit("event",e),e.type==="pointer"&&e.name==="pointer_down"&&this.menus.clearOpenMenus(),this}maybeTrackPerformance(e){Pt.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(e),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}}ne=SW(Sm);re(ne,1,"getIsShapeHiddenCache",A2,te);re(ne,1,"getCanUndo",M2,te);re(ne,1,"getCanRedo",k2,te);re(ne,1,"getPath",T2,te);re(ne,1,"getCurrentTool",E2,te);re(ne,1,"getCurrentToolId",C2,te);re(ne,1,"getDocumentSettings",I2,te);re(ne,1,"getInstanceState",P2,te);re(ne,1,"getOpenMenus",x2,te);re(ne,1,"getIsMenuOpen",_2,te);re(ne,1,"getPageStates",w2,te);re(ne,1,"_getPageStatesQuery",b2,te);re(ne,1,"getCurrentPageState",v2,te);re(ne,1,"_getCurrentPageStateId",S2,te);re(ne,1,"getSelectedShapeIds",y2,te);re(ne,1,"getSelectedShapes",m2,te);re(ne,1,"getOnlySelectedShapeId",g2,te);re(ne,1,"getOnlySelectedShape",f2,te);re(ne,1,"getSelectionPageBounds",p2,te);re(ne,1,"getSelectionRotation",h2,te);re(ne,1,"getSelectionRotatedPageBounds",u2,te);re(ne,1,"getSelectionRotatedScreenBounds",d2,te);re(ne,1,"getFocusedGroupId",l2,te);re(ne,1,"getFocusedGroup",c2,te);re(ne,1,"getEditingShapeId",a2,te);re(ne,1,"getEditingShape",s2,te);re(ne,1,"getHoveredShapeId",i2,te);re(ne,1,"getHoveredShape",o2,te);re(ne,1,"getHintingShapeIds",r2,te);re(ne,1,"getHintingShape",n2,te);re(ne,1,"getErasingShapeIds",t2,te);re(ne,1,"getErasingShapes",e2,te);re(ne,1,"_unsafe_getCameraId",QT,te);re(ne,1,"getCamera",JT,te);re(ne,1,"getViewportPageBoundsForFollowing",ZT,te);re(ne,1,"getCameraForFollowing",qT,te);re(ne,1,"getZoomLevel",XT,te);re(ne,1,"getViewportScreenBounds",YT,te);re(ne,1,"getViewportScreenCenter",VT,te);re(ne,1,"getViewportPageBounds",GT,te);re(ne,1,"_getCollaboratorsQuery",WT,te);re(ne,1,"getCollaborators",KT,te);re(ne,1,"getCollaboratorsOnCurrentPage",jT,te);re(ne,1,"getRenderingShapes",HT,te);re(ne,1,"_getAllPagesQuery",UT,te);re(ne,1,"getPages",BT,te);re(ne,1,"getCurrentPageId",zT,te);re(ne,1,"getCurrentPageShapeIdsSorted",FT,te);re(ne,1,"_getAllAssetsQuery",NT,te);re(ne,1,"_getShapeGeometryCache",LT,te);re(ne,1,"_getShapeHandlesCache",RT,te);re(ne,1,"_getShapePageTransformCache",$T,te);re(ne,1,"_getShapePageBoundsCache",DT,te);re(ne,1,"_getShapeClipPathCache",OT,te);re(ne,1,"_getShapeMaskCache",AT,te);re(ne,1,"_getShapeMaskedPageBoundsCache",MT,te);re(ne,1,"_notVisibleShapes",kT,te);re(ne,1,"getCulledShapes",TT,te);re(ne,1,"getCurrentPageBounds",ET,te);re(ne,1,"getCurrentPageShapes",CT,te);re(ne,1,"getCurrentPageShapesSorted",IT,te);re(ne,1,"getCurrentPageRenderingShapesSorted",PT,te);re(ne,1,"_getBindingsIndexCache",xT,te);re(ne,1,"_getSelectionSharedStyles",_T,te);re(ne,1,"getSharedStyles",wT,te);re(ne,1,"getSharedOpacity",bT,te);re(ne,1,"getIsFocused",vT,te);re(ne,1,"getIsReadonly",ST,te);re(ne,1,"_setShiftKeyTimeout",yT,te);re(ne,1,"_setAltKeyTimeout",mT,te);re(ne,1,"_setCtrlKeyTimeout",gT,te);re(ne,1,"_setMetaKeyTimeout",fT,te);bW(ne,te);function Wl(t,e=t.getCurrentPageId()){const n=t.getPage(e).name;t.emit("max-shapes",{name:n,pageId:e,count:t.options.maxShapesPerPage})}function Rr(t,e){if(!e)return t;let n=null;const r=Object.entries(e);for(let o=0,i=r.length;o<i;o++){const[s,a]=r[o];if(a!==void 0&&!(s==="id"||s==="type"||s==="typeName")&&a!==t[s]){if(n||(n={...t}),s==="props"||s==="meta"){n[s]={...t[s]};for(const[c,l]of Object.entries(a))l!==void 0&&(n[s][c]=l);continue}n[s]=a}}return n||t}function O2(t,e,n){const r=t.getShape(e);if(!r)return;n.push(r);const o=t.getSortedChildIdsForParent(e);for(let i=0,s=o.length;i<s;i++)O2(t,o[i],n)}function n1(t,e,n){let r;if(t.run(()=>{const o=t.store.extractingChanges(()=>{const i=new Set,s=new Set;for(const a of e)if(t.getShape(a))for(const l of t.getBindingsInvolvingShape(a)){const d=e.has(l.fromId),h=e.has(l.toId);if(d&&h){i.add(l.id);continue}(!d||!h)&&s.add(l.id)}t.deleteBindings([...s],{isolateShapes:!0});try{r=ni.ok(n(i))}catch(a){r=ni.err(a)}});t.store.applyDiff(tm(o))},{history:"ignore"}),r.ok)return r.value;throw r.error}function r1(t,e){if(!e.constraints)throw Error("Should have constraints here");const{padding:{x:n,y:r}}=e.constraints,o=t.getViewportScreenBounds(),i=ee.From(e.constraints.bounds),s=(o.w-n*2)/i.w,a=(o.h-r*2)/i.h;return{zx:s,zy:a}}function al(){const t=F(),e=rl();return U("isDarkMode",()=>(e==null?void 0:e.isDarkMode)??t.user.getIsDarkMode(),[e,t])}const o1="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",i1="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",Gl='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function Ko(t,e,n,r,o,i=16,s=16){const a=(-n-e)*(ze/180),c=Math.sin(a),l=Math.cos(a),d=1*l-1*c,h=1*c+1*l;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${o};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${d}' dy='${h}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+n} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+t.replaceAll('"',"'")+`</g></svg>") ${i} ${s}, pointer`}const _W=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],xW={none:()=>"none","ew-resize":(t,e,n)=>Ko(i1,t,0,e,n),"ns-resize":(t,e,n)=>Ko(i1,t,90,e,n),"nesw-resize":(t,e,n)=>Ko(o1,t,0,e,n),"nwse-resize":(t,e,n)=>Ko(o1,t,90,e,n),"nwse-rotate":(t,e,n)=>Ko(Gl,t,0,e,n),"nesw-rotate":(t,e,n)=>Ko(Gl,t,90,e,n),"senw-rotate":(t,e,n)=>Ko(Gl,t,180,e,n),"swne-rotate":(t,e,n)=>Ko(Gl,t,270,e,n)};function zn(t,e=0,n="black"){return xW[t](S7(e),!1,n)}function PW(){const t=F(),e=At(),n=al();ri("useCursor",()=>{const{type:r,rotation:o}=t.getInstanceState().cursor;if(_W.includes(r)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}e.style.setProperty("--tl-cursor",zn(r,o,n?"white":"black"))},[t,e,n])}function IW(){const t=F(),e=At(),n=al(),r=U(Pt.forceSrgb);we.useEffect(()=>{n?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),r?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[t,e,r,n])}function CW(){const[t,e]=Q(0);q(()=>e(n=>n+1),[])}const EW=t=>t.props.src,TW={upload:(t,e)=>wo.blobToDataUrl(e)};function kW(t){return"schema"in t&&t.schema?t.schema:c7({shapes:"shapeUtils"in t&&t.shapeUtils?s1(FC(t.shapeUtils)):void 0,bindings:"bindingUtils"in t&&t.bindingUtils?s1(RC(t.bindingUtils)):void 0,migrations:"migrations"in t?t.migrations:void 0})}function Ru({initialData:t,defaultName:e="",id:n,assets:r=TW,onMount:o,collaboration:i,...s}={}){const a=kW(s),c=new pS({id:n,schema:a,initialData:t,props:{defaultName:e,assets:{upload:r.upload,resolve:r.resolve??EW},onMount:l=>{He(l instanceof te),o==null||o(l)},collaboration:i}});if(s.snapshot){if(t)throw new Error("Cannot provide both initialData and snapshot");DC(c,s.snapshot)}return c}function s1(t){return Object.fromEntries(t.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}const MW=(t,e)=>e.some(n=>t instanceof n);let a1,c1;function AW(){return a1||(a1=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function OW(){return c1||(c1=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const D2=new WeakMap,vm=new WeakMap,$2=new WeakMap,xf=new WeakMap,HS=new WeakMap;function DW(t){const e=new Promise((n,r)=>{const o=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{n(Io(t.result)),o()},s=()=>{r(t.error),o()};t.addEventListener("success",i),t.addEventListener("error",s)});return e.then(n=>{n instanceof IDBCursor&&D2.set(n,t)}).catch(()=>{}),HS.set(e,t),e}function $W(t){if(vm.has(t))return;const e=new Promise((n,r)=>{const o=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{n(),o()},s=()=>{r(t.error||new DOMException("AbortError","AbortError")),o()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)});vm.set(t,e)}let bm={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return vm.get(t);if(e==="objectStoreNames")return t.objectStoreNames||$2.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Io(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function RW(t){bm=t(bm)}function LW(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Pf(this),e,...n);return $2.set(r,e.sort?e.sort():[e]),Io(r)}:OW().includes(t)?function(...e){return t.apply(Pf(this),e),Io(D2.get(this))}:function(...e){return Io(t.apply(Pf(this),e))}}function NW(t){return typeof t=="function"?LW(t):(t instanceof IDBTransaction&&$W(t),MW(t,AW())?new Proxy(t,bm):t)}function Io(t){if(t instanceof IDBRequest)return DW(t);if(xf.has(t))return xf.get(t);const e=NW(t);return e!==t&&(xf.set(t,e),HS.set(e,t)),e}const Pf=t=>HS.get(t);function R2(t,e,{blocked:n,upgrade:r,blocking:o,terminated:i}={}){const s=indexedDB.open(t,e),a=Io(s);return r&&s.addEventListener("upgradeneeded",c=>{r(Io(s.result),c.oldVersion,c.newVersion,Io(s.transaction),c)}),n&&s.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),o&&c.addEventListener("versionchange",l=>o(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}function L2(t,{blocked:e}={}){const n=indexedDB.deleteDatabase(t);return e&&n.addEventListener("blocked",r=>e(r.oldVersion,r)),Io(n).then(()=>{})}const FW=["get","getKey","getAll","getAllKeys","count"],zW=["put","add","delete","clear"],If=new Map;function l1(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(If.get(e))return If.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,o=zW.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(o||FW.includes(n)))return;const i=async function(s,...a){const c=this.transaction(s,o?"readwrite":"readonly");let l=c.store;return r&&(l=l.index(a.shift())),(await Promise.all([l[n](...a),o&&c.done]))[0]};return If.set(e,i),i}RW(t=>({...t,get:(e,n,r)=>l1(e,n)||t.get(e,n,r),has:(e,n)=>!!l1(e,n)||t.has(e,n)}));const BW="TLDRAW_DOCUMENT_v2",UW="TLDRAW_ASSET_STORE_v1",N2="TLDRAW_DB_NAME_INDEX_v2",Oe={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function F2(t){const e=BW+t;return jW(e),await R2(e,4,{upgrade(n){n.objectStoreNames.contains(Oe.Records)||n.createObjectStore(Oe.Records),n.objectStoreNames.contains(Oe.Schema)||n.createObjectStore(Oe.Schema),n.objectStoreNames.contains(Oe.SessionState)||n.createObjectStore(Oe.SessionState),n.objectStoreNames.contains(Oe.Assets)||n.createObjectStore(Oe.Assets)}})}async function HW(t){const e=window.indexedDB.databases?(await window.indexedDB.databases()).map(p=>p.name):jS(),n=UW+t;if(!e.find(p=>p===n))return;const o=await R2(n,1,{upgrade(p){p.objectStoreNames.contains("assets")||p.createObjectStore("assets")}});if(!o.objectStoreNames.contains("assets"))return;const i=o.transaction(["assets"],"readonly"),s=i.objectStore("assets"),a=await s.getAllKeys(),c=await Promise.all(a.map(async p=>[p,await s.get(p)]));await i.done;const l=await F2(t),d=l.transaction([Oe.Assets],"readwrite"),h=d.objectStore(Oe.Assets);for(const[p,f]of c)h.put(f,p);await d.done,o.close(),l.close(),await L2(n)}const vc=class vc{constructor(e){P(this,"getDbPromise");P(this,"isClosed",!1);P(this,"pendingTransactionSet",new Set);vc.connectedInstances.add(this),this.getDbPromise=(async()=>(await HW(e),await F2(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(_c)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),vc.connectedInstances.delete(this))}tx(e,n,r){const o=(async()=>{He(!this.isClosed,"db is closed");const s=(await this.getDb()).transaction(n,e),a=s.done.catch(c=>{if(!this.isClosed)throw c});try{return await r(s)}finally{this.isClosed?s.abort():await a}})();return this.pendingTransactionSet.add(o),o.finally(()=>this.pendingTransactionSet.delete(o)),o}async load({sessionId:e}={}){return await this.tx("readonly",[Oe.Records,Oe.Schema,Oe.SessionState],async n=>{var c,l;const r=n.objectStore(Oe.Records),o=n.objectStore(Oe.Schema),i=n.objectStore(Oe.SessionState);let s=e?(c=await i.get(e))==null?void 0:c.snapshot:null;return s||(s=(l=(await i.getAll()).sort((h,p)=>h.updatedAt-p.updatedAt).pop())==null?void 0:l.snapshot),{records:await r.getAll(),schema:await o.get(Oe.Schema),sessionStateSnapshot:s}})}async storeChanges({schema:e,changes:n,sessionId:r,sessionStateSnapshot:o}){await this.tx("readwrite",[Oe.Records,Oe.Schema,Oe.SessionState],async i=>{const s=i.objectStore(Oe.Records),a=i.objectStore(Oe.Schema),c=i.objectStore(Oe.SessionState);for(const[l,d]of Object.entries(n.added))await s.put(d,l);for(const[l,d]of Object.values(n.updated))await s.put(d,d.id);for(const l of Object.keys(n.removed))await s.delete(l);a.put(e.serialize(),Oe.Schema),o&&r?c.put({snapshot:o,updatedAt:Date.now(),id:r},r):(o||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:e,snapshot:n,sessionId:r,sessionStateSnapshot:o}){await this.tx("readwrite",[Oe.Records,Oe.Schema,Oe.SessionState],async i=>{const s=i.objectStore(Oe.Records),a=i.objectStore(Oe.Schema),c=i.objectStore(Oe.SessionState);await s.clear();for(const[l,d]of Object.entries(n))await s.put(d,l);a.put(e.serialize(),Oe.Schema),o&&r?c.put({snapshot:o,updatedAt:Date.now(),id:r},r):(o||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[Oe.SessionState],async e=>{const n=e.objectStore(Oe.SessionState),r=(await n.getAll()).sort((i,s)=>i.updatedAt-s.updatedAt);if(r.length<10){await e.done;return}const o=r.slice(0,r.length-10);for(const{id:i}of o)await n.delete(i)})}async getAsset(e){return await this.tx("readonly",[Oe.Assets],async n=>await n.objectStore(Oe.Assets).get(e))}async storeAsset(e,n){await this.tx("readwrite",[Oe.Assets],async r=>{await r.objectStore(Oe.Assets).put(n,e)})}};P(vc,"connectedInstances",new Set);let Lu=vc;function jS(){const t=JSON.parse(Oy(N2)||"[]")??[];return Array.isArray(t)?t:[]}function jW(t){const e=new Set(jS());e.add(t),Dy(N2,JSON.stringify([...e]))}function KW(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
• If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
• If your hard disk is full, try clearing up some space and then reload the page.`)}function WW(){window.alert(`Oops! We could not access your browser's storage—and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
• If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const GW=350,VW=1e4,d1=Symbol("UPDATE_INSTANCE_STATE"),YW=t=>t;class XW{constructor(e){P(this,"onmessage")}postMessage(e){}close(){}}const qW=typeof BroadcastChannel>"u"?XW:BroadcastChannel;class ZW{constructor(e,{persistenceKey:n,sessionId:r=$u,onLoad:o,onLoadError:i},s=new qW(`tldraw-tab-sync-${n}`)){P(this,"disposables",new Set);P(this,"diffQueue",[]);P(this,"didDispose",!1);P(this,"shouldDoFullDBWrite",!0);P(this,"isReloading",!1);P(this,"persistenceKey");P(this,"sessionId");P(this,"serializedSchema");P(this,"isDebugging",!1);P(this,"documentTypes");P(this,"$sessionStateSnapshot");P(this,"db");P(this,"initTime",Date.now());P(this,"isPersisting",!1);P(this,"didLastWriteError",!1);P(this,"scheduledPersistTimeout",null);this.store=e,this.channel=s,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=n,this.sessionId=r,this.db=new Lu(n),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=MS(this.store),this.disposables.add(e.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage(YW({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(d1),this.schedulePersist()},{scope:"session"})),this.connect(o,i),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,n){this.debug("connecting");let r;try{r=await this.db.load({sessionId:this.sessionId})}catch(o){n(o),WW();return}if(this.debug("loaded data from store",r,"didDispose",this.didDispose),!this.didDispose)try{if(r){const o=Object.fromEntries(r.records.map(a=>[a.id,a])),i=r.sessionStateSnapshot??GH(o),s=this.store.schema.migrateStoreSnapshot({store:o,schema:r.schema??this.store.schema.serializeEarliestVersion()});if(s.type==="error"){console.error("failed to migrate store",s),n(new Error(`Failed to migrate store: ${s.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(s.value).filter(a=>this.documentTypes.has(a.typeName)),"initialize")}),i&&um(this.store,i)}this.channel.onmessage=({data:o})=>{var a,c;this.debug("got message",o);const i=o,s=this.store.schema.getMigrationsSince(i.schema);if(s.ok){if(s.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{if(Date.now()-this.initTime<5e3){n(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(c=(a=window==null?void 0:window.location)==null?void 0:a.reload)==null||c.call(a);return}i.type==="diff"&&(this.debug("applying diff"),Kr(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(i.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(o){if(this.debug("error loading data from store",o),this.didDispose)return;n(o);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?VW:GW))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){if(He(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const n=hS(e.filter(r=>r!==d1));await this.db.storeChanges({changes:n,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(n){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",n),KW(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function z2(t){const e=B(t),[n,r]=Q(t);n!==e.current&&r(e.current);const o=V(i=>{typeof i=="function"?e.current=i(e.current):e.current=i,r(e.current)},[]);return[n,o]}function JW(t){const[e,n]=z2({status:"loading"});return t=tl(t),q(()=>{const{persistenceKey:r,sessionId:o,...i}=t;if(!r){n({status:"not-synced",store:Ru(i)});return}n({status:"loading"});const s=new Gr,a={upload:async(h,p)=>(await d.db.storeAsset(h.id,p),h.id),resolve:async h=>h.props.src?h.props.src.startsWith("asset:")?await s.get(h,async()=>{const p=await d.db.getAsset(h.id);return p?URL.createObjectURL(p):null}):h.props.src:null,...i.assets},c=Ru({...i,assets:a});let l=!1;const d=new ZW(c,{sessionId:o,persistenceKey:r,onLoad(){l||n({store:c,status:"synced-local"})},onLoadError(h){l||n({status:"error",error:h})}});return()=>{l=!0,d.close()}},[t,n]),e}function QW(){const t=F(),e=At();q(()=>{const n=i=>e.style.setProperty("--tl-zoom",i.toString()),r=Cy(n,100),o=new ma("useZoomCss",()=>{t.getCurrentPageShapeIds().size<300?n(t.getZoomLevel()):r(t.getZoomLevel())});return o.attach(),o.execute(),()=>{o.detach(),r.cancel()}},[t,e])}function wm(t){const e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let r=0,o=t.length;r<o;r++)n[r]=t.charCodeAt(r);return e}function eG(t){const e=atob(t),n=wm(e);return crypto.subtle.importKey("spki",new Uint8Array(n),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}const tG=5,tc={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4,WITH_WATERMARK:8},nG=Math.max(...Object.values(tc)),nc={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},rG=Object.keys(nc).length,Cf="sales@tldraw.com",oG=`${ti()}/watermarks/watermark-track.svg`;class Fh{constructor(e,n,r){P(this,"publicKey","MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ");P(this,"isDevelopment");P(this,"isTest");P(this,"isCryptoAvailable");P(this,"state",Tt("license state","pending"));P(this,"verbose",!0);this.isTest=!1,this.isDevelopment=this.getIsDevelopment(r),this.publicKey=n||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,this.getLicenseFromKey(e).then(o=>{const i=iG(o);!this.isDevelopment&&i&&Pr(oG),i?this.state.set("unlicensed"):o.isLicensedWithWatermark?this.state.set("licensed-with-watermark"):this.state.set("licensed")})}getIsDevelopment(e){return e==="development"?!0:e==="production"?!1:window.location.protocol!=="https:"}async extractLicenseKey(e){const[n,r]=e.split("."),[o,i]=n.split("/");if(!o.startsWith("tldraw-"))throw new Error(`Unsupported prefix '${o}'`);const s=await eG(this.publicKey);let a;try{a=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},s,new Uint8Array(wm(atob(r))),new Uint8Array(wm(atob(i))))}catch(l){throw console.error(l),new Error("Could not perform signature validation")}if(!a)throw new Error("Invalid signature");let c;try{c=JSON.parse(atob(i))}catch{throw new Error("Could not parse object")}return c.length>rG&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:c[nc.ID],hosts:c[nc.HOSTS],flags:c[nc.FLAGS],expiryDate:c[nc.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return this.verbose&&(console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately.")),{isLicenseParseable:!1,reason:"has-key-development-mode"};let n=e.replace(/[\u200B-\u200D\uFEFF]/g,"");n=n.replace(/\r?\n|\r/g,"");try{const r=await this.extractLicenseKey(n),o=new Date(r.expiryDate),i=this.isFlagEnabled(r.flags,tc.ANNUAL_LICENSE),s=this.isFlagEnabled(r.flags,tc.PERPETUAL_LICENSE),a={license:r,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(r),expiryDate:o,isAnnualLicense:i,isAnnualLicenseExpired:i&&this.isAnnualLicenseExpired(o),isPerpetualLicense:s,isPerpetualLicenseExpired:s&&this.isPerpetualLicenseExpired(o),isInternalLicense:this.isFlagEnabled(r.flags,tc.INTERNAL_LICENSE),isLicensedWithWatermark:this.isFlagEnabled(r.flags,tc.WITH_WATERMARK)};return this.outputLicenseInfoIfNeeded(a),a}catch(r){return this.outputInvalidLicenseKey(r.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){const n=window.location.hostname.toLowerCase();return e.hosts.some(r=>{const o=r.toLowerCase().trim();if(o===n||`www.${o}`===n||o===`www.${n}`||r==="*")return!0;if(r.includes("*")){const i=new RegExp(r.replace(/\*/g,".*?"));return i.test(n)||i.test(`www.${n}`)}return!1})}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+tG+1)}isAnnualLicenseExpired(e){const n=this.getExpirationDateWithGracePeriod(e),r=new Date>=n;return!r&&new Date>=this.getExpirationDateWithoutGracePeriod(e)&&this.outputMessages(["tldraw license is about to expire, you are in a grace period.",`Please reach out to ${Cf} if you would like to renew your license.`]),r}isPerpetualLicenseExpired(e){const n=this.getExpirationDateWithGracePeriod(e),r={major:new Date(v0.major),minor:new Date(v0.minor)};return r.major>=n||r.minor>=n}isFlagEnabled(e,n){return(e&n)===n}outputNoLicenseKeyProvided(){}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key",`Reason: ${e}`])}outputLicenseInfoIfNeeded(e){e.isAnnualLicenseExpired&&this.outputMessages(["Your tldraw license has expired!",`Please reach out to ${Cf} to renew.`]),!e.isDomainValid&&!e.isDevelopment&&this.outputMessages(["This tldraw license key is not valid for this domain!",`Please reach out to ${Cf} if you would like to use tldraw on other domains.`]),e.license.flags>=nG*2&&this.outputMessages(["This tldraw license contains some unknown flags.","You may want to update tldraw packages to a newer version to get access to new functionality."])}outputMessages(e){if(!this.isTest&&this.verbose){this.outputDelimiter();for(const n of e)console.log(`%c${n}`,"color: white; background: crimson; padding: 2px; border-radius: 3px;");this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}}P(Fh,"className","tl-watermark_SEE-LICENSE");function iG(t){if(!t.isLicenseParseable||!t.isDomainValid&&!t.isDevelopment)return!0;if(t.isPerpetualLicenseExpired||t.isAnnualLicenseExpired){if(t.isInternalLicense)throw new Error("License: Internal license expired.");return!0}return!1}const B2=Ze({}),sG=()=>tt(B2);function aG({licenseKey:t,children:e}){const[n]=Q(()=>new Fh(t));return u(B2.Provider,{value:n,children:e})}function vi(t){if(!t)throw Error("usePassThroughWheelEvents must be passed a ref");const e=At();q(()=>{function n(o){if(o.isSpecialRedispatchedEvent)return;Ce(o);const i=e.querySelector(".tl-canvas");if(!i)return;const s=new WheelEvent("wheel",o);s.isSpecialRedispatchedEvent=!0,i.dispatchEvent(s)}const r=t.current;if(r)return r.addEventListener("wheel",n,{passive:!1}),()=>{r.removeEventListener("wheel",n)}},[e,t])}const cG='<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>',lG='<svg xmlns="http://www.w3.org/2000/svg" width="400" height="1601" fill="none"><path fill="#000" d="M72 1319.8c0-10.73 7.071-20.18 17.372-23.22l215.823-63.62c15.519-4.57 31.078 7.05 31.078 23.22v28.26c0 11.31-7.824 21.1-18.85 23.61l-109.636 24.94c-9.254 2.1-9.487 15.2-.313 17.63l110.784 29.37a24.21 24.21 0 0 1 18.015 23.4v25.64c0 11-7.423 20.62-18.071 23.41l-109.659 28.79c-9.162 2.41-8.986 15.47.236 17.63l108.792 25.46c10.955 2.56 18.702 12.33 18.702 23.57v28.39c0 16.17-15.559 27.79-31.078 23.22l-215.823-63.62c-10.3-3.04-17.372-12.49-17.372-23.22v-32.72c0-10.59 6.883-19.95 16.994-23.11l104.523-32.67c8.547-2.67 8.479-14.79-.096-17.36l-104.17-31.3C79.01 1372.42 72 1363 72 1352.31zM72 572.638V495.43c0-13.336 10.846-24.147 24.225-24.147h215.823c13.379 0 24.225 10.811 24.225 24.147v76.179q0 40.645-15.872 70.228-15.743 29.712-45.422 45.79-29.55 16.206-70.843 16.206-41.292 0-70.971-16.078-29.55-16.077-45.422-45.532Q72 612.767 72 572.638m85.132-29.84c-13.379 0-24.225 10.81-24.225 24.146v3.122q0 19.55 6.323 33.313 6.323 13.89 21.807 21.094 15.485 7.332 43.099 7.331t43.1-7.46q15.484-7.33 21.807-21.608 6.323-14.15 6.323-34.728v-1.064c0-13.336-10.846-24.146-24.225-24.146zM72 285.858c0-13.363 10.846-24.197 24.225-24.197h215.823c13.379 0 24.225 10.834 24.225 24.197v23.27c0 13.364-10.846 24.197-24.225 24.197H154.035c-13.379 0-24.225 10.834-24.225 24.197v58.328c0 13.364-10.846 24.197-24.225 24.197h-9.36C82.845 440.047 72 429.214 72 415.85zM278.463 24.72c0-13.374 10.846-24.216 24.225-24.216h9.36c13.379 0 24.225 10.842 24.225 24.216v181.174c0 13.374-10.846 24.216-24.225 24.216h-9.36c-13.379 0-24.225-10.842-24.225-24.216v-40.108c0-8.359-6.779-15.135-15.141-15.135H96.225c-13.38 0-24.225-10.842-24.225-24.216v-22.256c0-13.374 10.846-24.216 24.225-24.216h167.097c8.362 0 15.141-6.776 15.141-15.135z"/><path fill="#000" fill-rule="evenodd" d="M89.224 1062.13C78.997 1059.04 72 1049.63 72 1038.96v-25.9c0-16.486 16.145-28.147 31.818-22.979l215.823 71.169a24.19 24.19 0 0 1 16.632 22.98v62.97c0 10.45-6.706 19.71-16.632 22.98l-215.823 71.17C88.145 1246.51 72 1234.86 72 1218.37v-25.9c0-10.67 6.997-20.08 17.224-23.17l22.595-6.81a15.13 15.13 0 0 0 10.765-14.48v-64.59a15.13 15.13 0 0 0-10.765-14.48zm98.672 77.53 49.299-14.39c8.601-2.51 8.755-14.62.22-17.35l-49.299-15.75c-5.861-1.88-11.852 2.49-11.852 8.64v30.14c0 6.05 5.817 10.41 11.632 8.71" clip-rule="evenodd"/><path fill="#000" d="M72 773.439c0-13.367 10.846-24.203 24.225-24.203h215.823c13.379 0 24.225 10.836 24.225 24.203v89.762q0 29.395-10.711 51.439-10.71 22.046-30.84 34.293t-48.261 12.248q-28.388 0-47.873-12.635-18.187-11.672-28.056-32.218c-8.303-17.289-11.301-36.661-11.301-55.705v-43.867c0-77.976 138.26 4.16 86.215 4.16h-8.138c-12.334 0-22.332 9.989-22.332 22.311 0 8.269.351 16.6 3.097 24.487q3.225 9.024 10.194 13.794 6.968 4.899 18.194 4.899 11.356 0 18.453-4.899 7.226-4.77 10.581-13.794c2.815-7.188 3.484-14.944 3.484-22.596 0-13.366-10.846-24.202-24.225-24.202h-48.56c-12.036 0-16.288 11.345-21.122 20.272-6.79 12.539-25.841 7.72-25.841-6.536 0-7.586-6.156-13.736-13.749-13.736H96.225C82.845 820.916 72 810.08 72 796.714zm108.66 137.378-10.128 5.511-62.72 34.131C91.67 959.243 72 947.569 72 929.205V906.52a24.2 24.2 0 0 1 12.719-21.299l66.199-35.696a15.82 15.82 0 0 0 8.313-13.921c0-43.012 83.618 41.371 21.429 75.213"/></svg>';function dG(t){return U("watermarkState",()=>t.state.get(),[t])}const uG=`data:image/svg+xml;utf8,${encodeURIComponent(cG)}`,hG=`data:image/svg+xml;utf8,${encodeURIComponent(lG)}`,pG=$e(function(){const e=sG(),n=F(),r=U("is mobile",()=>n.getViewportScreenBounds().width<700,[n]),o=dG(e);return["licensed-with-watermark","unlicensed"].includes(o)?u(Z,{children:[u(gG,{}),u(fG,{src:r?hG:uG})]}):null}),fG=$e(function({src:e}){const n=F(),r=U("debug mode",()=>n.getInstanceState().isDebugMode,[n]),o=U("is menu open",()=>n.menus.hasAnyOpenMenus(),[n]),i=U("is mobile",()=>n.getViewportScreenBounds().width<700,[n]),s=ZI(),a=B(null);vi(a);const c=`url('${e}') center 100% / 100% no-repeat`,l="https://tldraw.dev";return u("div",{ref:a,className:Fh.className,"data-debug":r,"data-menu":o,"data-mobile":i,draggable:!1,...s,children:et.isWebview?u("a",{draggable:!1,role:"button",onPointerDown:d=>{Mt(d),Ce(d)},onClick:()=>Ch.openWindow(l,"_blank"),style:{mask:c,WebkitMask:c}}):u("a",{href:l,target:"_blank",rel:"noreferrer",draggable:!1,onPointerDown:d=>{Mt(d)},style:{mask:c,WebkitMask:c}})})}),gG=$e(function(){const e=Fh.className,n=`/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
or "licensed-with-watermark" users. By using this library, you agree to
preserve the watermark's behavior, keeping it visible, unobscured, and
available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

	.${e} {
		position: absolute;
		bottom: var(--space-2);
		right: var(--space-2);
		width: 96px;
		height: 32px;
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: var(--layer-watermark) !important;
		background-color: color-mix(in srgb, var(--color-background) 62%, transparent);
		opacity: 1;
		border-radius: 5px;
		pointer-events: all;
		padding: 2px;
		box-sizing: content-box;
	}
	
	.${e} > a {
		position: absolute;
		width: 96px;
		height: 32px;
		pointer-events: all;
		cursor: inherit;
		color: var(--color-text);
		opacity: .38;
		background-color: currentColor;
	}

	
	.${e}[data-menu='true'] {
		pointer-events: none;
	}

	.${e}[data-debug='true'] {
		bottom: 46px;
	}
	
	.${e}[data-mobile='true'] {
		border-radius: 4px 0px 0px 4px;
		right: -2px;
		width: 8px;
		height: 48px;
	}

	.${e}[data-mobile='true'] > a {
		width: 8px;
		height: 32px;
	}
	
	@media (hover: hover) {
		.${e} > a {
			pointer-events: none;
		}

		.${e}:hover {
			background-color: var(--color-background);
			transition: background-color 0.2s ease-in-out;
			transition-delay: 0.32s;
		}
			
		.${e}:hover > a {
			animation: delayed_link 0.2s forwards ease-in-out;
			animation-delay: 0.32s;
		}
	}
	

	@keyframes delayed_link {
		0% {
			cursor: inherit;
			opacity: .38;
			pointer-events: none;
		}
		100% {
			cursor: pointer;
			opacity: 1;
			pointer-events: all;
		}
	}`;return u("style",{children:n})}),mG=[],yG=[],SG=[],vG="tl-container",bG=$e(function({store:e,components:n,className:r,user:o,...i}){const[s,a]=Q(null),c=ce(()=>o??kC(),[o]),l=(n==null?void 0:n.ErrorFallback)===void 0?bC:n==null?void 0:n.ErrorFallback,d={...i,shapeUtils:i.shapeUtils??mG,bindingUtils:i.bindingUtils??yG,tools:i.tools??SG,components:n};return u("div",{ref:a,"data-tldraw":GI,draggable:!1,className:de(`${vG} tl-theme__light`,r),onPointerDown:Mt,tabIndex:-1,children:u(kc,{fallback:l,onError:h=>Ey(h,{tags:{origin:"react.tldraw-before-app"}}),children:s&&u(aG,{licenseKey:i.licenseKey,children:u(T7,{container:s,children:u(AH,{overrides:n,children:e?e instanceof pS?u(H2,{...d,store:e,user:c}):u(U2,{...d,store:e,user:c}):u(wG,{...d,store:e,user:c})})})})})})});function wG(t){const{defaultName:e,snapshot:n,initialData:r,shapeUtils:o,bindingUtils:i,persistenceKey:s,sessionId:a,user:c,assets:l}=t,d=JW({shapeUtils:o,bindingUtils:i,initialData:r,persistenceKey:s,sessionId:a,defaultName:e,snapshot:n,assets:l});return u(U2,{...t,store:d,user:c})}const U2=$e(function({store:e,user:n,...r}){const o=At();je(()=>{n.userPreferences.get().colorScheme==="dark"&&(o.classList.remove("tl-theme__light"),o.classList.add("tl-theme__dark"))},[o,n]);const{LoadingScreen:i}=ht();switch(e.status){case"error":throw e.error;case"loading":return i?u(i,{}):null}return u(H2,{...r,store:e.store,user:n})}),Ef=()=>document.location.search.includes("tldraw_preserve_focus");function H2({onMount:t,children:e,store:n,tools:r,shapeUtils:o,bindingUtils:i,user:s,initialState:a,autoFocus:c=!0,inferDarkMode:l,cameraOptions:d,options:h,licenseKey:p,deepLinks:f,isShapeHidden:g}){const{ErrorFallback:m}=ht(),y=At(),[S,v]=z2(null),_=B(null),w=tl(f===!0?{}:f),x=B({autoFocus:c&&!Ef(),inferDarkMode:l,initialState:a,cameraOptions:d,deepLinks:w});je(()=>{x.current={autoFocus:c&&!Ef(),inferDarkMode:l,initialState:a,cameraOptions:d,deepLinks:w}},[c,l,a,d,w]),je(()=>{const{autoFocus:I,inferDarkMode:T,initialState:k,cameraOptions:D,deepLinks:A}=x.current,O=new te({store:n,shapeUtils:o,bindingUtils:i,tools:r,getContainer:()=>y,user:s,initialState:k,autoFocus:I,inferDarkMode:T,cameraOptions:D,options:h,licenseKey:p,isShapeHidden:g});return O.updateViewportScreenBounds(_.current??y),A&&(A!=null&&A.getUrl?O.navigateToDeepLink({...A,url:A.getUrl(O)}):O.navigateToDeepLink(A)),v(O),()=>{O.dispose()}},[i,y,h,o,n,r,s,v,p,g]),je(()=>{if(S&&w)return S.registerDeepLinkListener(w)},[S,w]),je(()=>{S&&d&&S.setCameraOptions(d)},[S,d]);const C=Yc(V(I=>S?(S.on("crash",I),()=>S.off("crash",I)):()=>{},[S]),()=>(S==null?void 0:S.getCrashingError())??null);q(function(){if(!S)return;function T(){S&&S.focus()}function k(){S&&S.blur()}if(c&&Ef())return S.getContainer().addEventListener("pointerdown",T),document.body.addEventListener("pointerdown",k),()=>{var D;(D=S.getContainer())==null||D.removeEventListener("pointerdown",T),document.body.removeEventListener("pointerdown",k)}},[S,c]);const{Canvas:E}=ht();return S?u(kc,{fallback:m,onError:I=>S.annotateError(I,{origin:"react.tldraw",willCrashApp:!0}),children:C?u(xG,{crashingError:C}):u(Xc.Provider,{value:S,children:u(_G,{onMount:t,children:[e??(E?u(E,{}):null),u(pG,{})]})})}):u("div",{className:"tl-canvas",ref:_})}function _G({children:t,onMount:e}){return QW(),PW(),IW(),CW(),K2(n=>{const r=n.store.props.onMount(n),o=e==null?void 0:e(n);return()=>{r==null||r(),o==null||o()}}),t}function xG({crashingError:t}){throw t}function KS({children:t}){return u("div",{className:"tl-loading",children:t})}function j2({children:t}){return u("div",{className:"tl-loading",children:t})}function K2(t){const e=F(),n=Oh(r=>{let o;return r.run(()=>{o=t==null?void 0:t(r),r.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,o});we.useLayoutEffect(()=>{if(e)return n==null?void 0:n(e)},[e,n])}function si({children:t,className:e="",...n}){return u("div",{...n,className:de("tl-html-container",e),children:t})}class Ed{constructor(e){this.editor=e}}P(Ed,"props"),P(Ed,"migrations"),P(Ed,"type");function zh(t,e,n={}){const{newPoint:r,handle:o,scaleX:i,scaleY:s}=e,{minWidth:a=1,maxWidth:c=1/0,minHeight:l=1,maxHeight:d=1/0}=n;let h=t.props.w*i,p=t.props.h*s;const f=new b(0,0);if(h>0){if(h<a){switch(o){case"top_left":case"left":case"bottom_left":{f.x=h-a;break}case"top":case"bottom":{f.x=(h-a)/2;break}default:f.x=0}h=a}}else if(f.x=h,h=-h,h<a){switch(o){case"top_left":case"left":case"bottom_left":{f.x=-h;break}default:f.x=-a}h=a}if(p>0){if(p<l){switch(o){case"top_left":case"top":case"top_right":{f.y=p-l;break}case"right":case"left":{f.y=(p-l)/2;break}default:f.y=0}p=l}}else if(f.y=p,p=-p,p<l){switch(o){case"top_left":case"top":case"top_right":{f.y=-p;break}default:f.y=-l}p=l}const{x:g,y:m}=f.rot(t.rotation).add(r);return{...t,x:g,y:m,props:{w:Math.min(c,h),h:Math.min(d,p)}}}class xa extends _r{getGeometry(e){return new Mo({width:e.props.w,height:e.props.h,isFilled:!0})}onResize(e,n){return zh(e,n)}getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}getInterpolatedProps(e,n,r){return{...n.props,w:De(e.props.w,n.props.w,r),h:De(e.props.h,n.props.h,r)}}}var cg;let PG=(cg=class extends ae{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},P(cg,"id","idle"),cg);var lg;let IG=(lg=class extends ae{constructor(){super(...arguments);P(this,"wasFocusedOnEnter",!1)}onEnter(){this.wasFocusedOnEnter=!this.editor.menus.hasAnyOpenMenus()}onPointerMove(n){if(this.editor.inputs.isDragging){const{originPagePoint:r}=this.editor.inputs,o=this.parent.shapeType,i=Xe(),s=this.editor.markHistoryStoppingPoint(`creating_box:${i}`);this.editor.createShapes([{id:i,type:o,x:r.x,y:r.y,props:{w:1,h:1}}]).select(i);const a=this.parent;this.editor.setCurrentTool("select.resizing",{...n,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:s,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:a.onCreate?c=>{var l;return(l=a.onCreate)==null?void 0:l.call(a,c)}:void 0})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:n}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;const r=this.parent.shapeType,o=Xe();this.editor.markHistoryStoppingPoint(`creating_box:${o}`),this.editor.createShapes([{id:o,type:r,x:n.x,y:n.y}]);const i=this.editor.getShape(o);if(!i){this.cancel();return}let{w:s,h:a}=i.props;const c=new b(s/2,a/2),l=this.editor.getShapeParentTransform(i);l&&c.rot(-l.rotation());let d=1;this.editor.user.getIsDynamicResizeMode()&&(d=1/this.editor.getZoomLevel(),s*=d,a*=d,c.mul(d));const h=ut(i);h.x=i.x-c.x,h.y=i.y-c.y,h.props.w=s,h.props.h=a,"scale"in i.props&&(h.props.scale=d),this.editor.updateShape(h),this.editor.setSelectedShapes([o]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}},P(lg,"id","pointing"),lg);class _m extends ae{static children(){return[PG,IG]}}P(_m,"id","box"),P(_m,"initial","idle");function CG(t,e,n){const r=B(!1),o=V(s=>{r.current=s,s?mr.addOpenMenu(t):mr.deleteOpenMenu(t),e==null||e(s)},[t,e]),i=U("is menu open",()=>mr.getOpenMenus().includes(t),[t]);return q(()=>(r.current&&(n==null||n("open-menu"),mr.addOpenMenu(t)),()=>{r.current&&(mr.deleteOpenMenu(t),mr.getOpenMenus().forEach(s=>{s.startsWith(t)&&(n==null||n("close-menu"),mr.deleteOpenMenu(s))}),r.current=!1)}),[t,n]),[i,o]}function Bh(t){const e=F();return U("isEditing",()=>e.getEditingShapeId()===t,[e,t])}function Lr(t){const e=F();return ce(function(){const o=l=>{if(l.isKilled)return;if(l.button===IS){e.dispatch({type:"pointer",target:"selection",handle:t,name:"right_click",...Mn(l)});return}if(l.button!==0)return;const d=Ou(l.currentTarget);function h(){d.removeEventListener("pointerup",h),Jc(d,l)}Zc(d,l),d.addEventListener("pointerup",h),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:t,...Mn(l)}),Mt(l)};let i,s;function a(l){l.isKilled||l.button===0&&(l.clientX===i&&l.clientY===s||(i=l.clientX,s=l.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:t,...Mn(l)})))}return{onPointerDown:o,onPointerMove:a,onPointerUp:l=>{l.isKilled||l.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:t,...Mn(l)})}}},[e,t])}function EG(t){const[e,n]=Q(()=>({store:Ru(t),opts:t}));if(!mx(e.opts,t)){const r={store:Ru(t),opts:t};return n(r),r.store}return e.store}const TG=20,kG=8;function WS(t,e=TG){return Math.max(kG,Math.ceil(t/e))}class Ds extends Si{constructor(n){super({...n,isFilled:!1,isClosed:!1});P(this,"_center");P(this,"radius");P(this,"start");P(this,"end");P(this,"largeArcFlag");P(this,"sweepFlag");P(this,"measure");P(this,"angleStart");P(this,"angleEnd");const{center:r,sweepFlag:o,largeArcFlag:i,start:s,end:a}=n;if(s.equals(a))throw Error("Arc must have different start and end points.");this.angleStart=b.Angle(r,s),this.angleEnd=b.Angle(r,a),this.radius=b.Dist(r,s),this.measure=v7(this.angleStart,this.angleEnd,o,i),this.start=s,this.end=a,this.sweepFlag=o,this.largeArcFlag=i,this._center=r}nearestPoint(n){const{_center:r,measure:o,radius:i,angleEnd:s,angleStart:a,start:c,end:l}=this,d=am(o,a,s,r.angle(n));if(d<=0)return c;if(d>=1)return l;const h=r.clone().add(n.clone().sub(r).uni().mul(i));let p,f=1/0,g;for(const m of[c,l,h])g=b.Dist2(n,m),g<f&&(p=m,f=g);if(!p)throw Error("nearest point not found");return p}hitTestLineSegment(n,r){const{_center:o,radius:i,measure:s,angleStart:a,angleEnd:c}=this,l=nl(n,r,o,i);return l===null?!1:l.some(d=>{const h=am(s,a,c,o.angle(d));return h>=0&&h<=1})}getVertices(){const{_center:n,measure:r,length:o,radius:i,angleStart:s}=this,a=[];for(let c=0,l=WS(Math.abs(o));c<l+1;c++){const d=c/l*r,h=s+d;a.push(Vi(n,i,h))}return a}getSvgPathData(n=!0){const{start:r,end:o,radius:i,largeArcFlag:s,sweepFlag:a}=this;return`${n?`M${r.toFixed()}`:""} A${i} ${i} 0 ${s} ${a} ${o.toFixed()}`}getLength(){return this.measure*this.radius}}class GS extends Si{constructor(n){super({isClosed:!0,...n});P(this,"_center");P(this,"radius");P(this,"x");P(this,"y");this.config=n;const{x:r=0,y:o=0,radius:i}=n;this.x=r,this.y=o,this._center=new b(i+r,i+o),this.radius=i}getBounds(){return new ee(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:n,radius:r}=this,o=Ve*r,i=[];for(let s=0,a=WS(o);s<a;s++){const c=s/a*Ve;i.push(Vi(n,r,c))}return i}nearestPoint(n){const{_center:r,radius:o}=this;return r.equals(n)?b.AddXY(r,o,0):r.clone().add(n.clone().sub(r).uni().mul(o))}hitTestLineSegment(n,r,o=0){const{_center:i,radius:s}=this;return nl(n,r,i,s+o)!==null}getSvgPathData(){const{_center:n,radius:r}=this;return`M${n.x+r},${n.y} a${r},${r} 0 1,0 ${r*2},0a${r},${r} 0 1,0 -${r*2},0`}}class tn extends ba{constructor(n){const{start:r,cp1:o,cp2:i,end:s}=n;super({...n,points:[r,s]});P(this,"a");P(this,"b");P(this,"c");P(this,"d");this.a=r,this.b=o,this.c=i,this.d=s}getVertices(){const n=[],{a:r,b:o,c:i,d:s}=this;for(let a=0,c=10;a<=c;a++){const l=a/c;n.push(new b((1-l)*(1-l)*(1-l)*r.x+3*((1-l)*(1-l))*l*o.x+3*(1-l)*(l*l)*i.x+l*l*l*s.x,(1-l)*(1-l)*(1-l)*r.y+3*((1-l)*(1-l))*l*o.y+3*(1-l)*(l*l)*i.y+l*l*l*s.y))}return n}midPoint(){return tn.GetAtT(this,.5)}nearestPoint(n){let r,o=1/0,i,s;for(const a of this.segments)s=a.nearestPoint(n),i=b.Dist2(s,n),i<o&&(r=s,o=i);if(!r)throw Error("nearest point not found");return r}getSvgPathData(n=!0){const{a:r,b:o,c:i,d:s}=this;return`${n?`M ${r.toFixed()} `:""} C${o.toFixed()} ${i.toFixed()} ${s.toFixed()}`}static GetAtT(n,r){const{a:o,b:i,c:s,d:a}=n;return new b((1-r)*(1-r)*(1-r)*o.x+3*((1-r)*(1-r))*r*i.x+3*(1-r)*(r*r)*s.x+r*r*r*a.x,(1-r)*(1-r)*(1-r)*o.y+3*((1-r)*(1-r))*r*i.y+3*(1-r)*(r*r)*s.y+r*r*r*a.y)}getLength(n=32){let r,o=this.a,i=0;for(let s=1;s<=n;s++)r=tn.GetAtT(this,s/n),i+=b.Dist(o,r),o=r;return i}}class MG extends Si{constructor(n){super({...n,isClosed:!1,isFilled:!1});P(this,"points");P(this,"_segments");const{points:r}=n;this.points=r}get segments(){if(!this._segments){this._segments=[];const{points:n}=this,r=n.length,o=r-2,i=1.25;for(let s=0;s<r-1;s++){const a=s===0?n[0]:n[s-1],c=n[s],l=n[s+1],d=s===o?l:n[s+2],h=c,p=s===0?a:new b(c.x+(l.x-a.x)/6*i,c.y+(l.y-a.y)/6*i),f=s===o?l:new b(l.x-(d.x-c.x)/6*i,l.y-(d.y-c.y)/6*i),g=l;this._segments.push(new tn({start:h,cp1:p,cp2:f,end:g}))}}return this._segments}getLength(){return this.segments.reduce((n,r)=>n+r.length,0)}getVertices(){const n=this.segments.reduce((r,o)=>r.concat(o.vertices),[]);return n.push(this.points[this.points.length-1]),n}nearestPoint(n){let r,o=1/0,i,s;for(const a of this.segments)s=a.nearestPoint(n),i=b.Dist2(s,n),i<o&&(r=s,o=i);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(n,r){return this.segments.some(o=>o.hitTestLineSegment(n,r))}getSvgPathData(){let n=this.segments.reduce((r,o,i)=>r+o.getSvgPathData(i===0),"");return this.isClosed&&(n+="Z"),n}}class AG extends Si{constructor(n){super({...n,isClosed:!0});P(this,"w");P(this,"h");P(this,"_edges");this.config=n;const{width:r,height:o}=n;this.w=r,this.h=o}get edges(){if(!this._edges){const{vertices:n}=this;this._edges=[];for(let r=0,o=n.length;r<o;r++){const i=n[r],s=n[(r+1)%o];this._edges.push(new So({start:i,end:s}))}}return this._edges}getVertices(){const n=Math.max(1,this.w),r=Math.max(1,this.h),o=n/2,i=r/2,s=Math.pow(o-i,2)/Math.pow(o+i,2),a=ze*(o+i)*(1+3*s/(10+Math.sqrt(4-3*s))),c=WS(a),l=Ve/c,d=Math.cos(l),h=Math.sin(l);let p=0,f=1,g=0,m=1;const y=Array(c);for(let S=0;S<c;S++)y[S]=new b(o+o*f,i+i*p),g=h*f+d*p,m=d*f-h*p,p=g,f=m;return y}nearestPoint(n){let r,o=1/0,i,s;for(const a of this.edges)s=a.nearestPoint(n),i=b.Dist2(s,n),i<o&&(r=s,o=i);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(n,r){return this.edges.some(o=>o.hitTestLineSegment(n,r))}getBounds(){return new ee(0,0,this.w,this.h)}getLength(){const{w:n,h:r}=this,o=n/2,i=r/2,s=Math.max(0,o),a=Math.max(0,i);return VI(s,a)}getSvgPathData(n=!1){const{w:r,h:o}=this,i=r/2,s=o/2,a=Math.max(0,i),c=Math.max(0,s);return`${n?`M${i-a},${s}`:""} a${a},${c},0,1,1,${a*2},0a${a},${c},0,1,1,-${a*2},0`}}class OG extends Si{constructor(n){super({...n,isClosed:!0});P(this,"w");P(this,"h");P(this,"a");P(this,"b");P(this,"c");P(this,"d");this.config=n;const{width:r,height:o}=n;if(this.w=r,this.h=o,o>r){const i=r/2;this.a=new Ds({start:new b(0,i),end:new b(r,i),center:new b(r/2,i),sweepFlag:1,largeArcFlag:1}),this.b=new So({start:new b(r,i),end:new b(r,o-i)}),this.c=new Ds({start:new b(r,o-i),end:new b(0,o-i),center:new b(r/2,o-i),sweepFlag:1,largeArcFlag:1}),this.d=new So({start:new b(0,o-i),end:new b(0,i)})}else{const i=o/2;this.a=new Ds({start:new b(i,o),end:new b(i,0),center:new b(i,i),sweepFlag:1,largeArcFlag:1}),this.b=new So({start:new b(i,0),end:new b(r-i,0)}),this.c=new Ds({start:new b(r-i,0),end:new b(r-i,o),center:new b(r-i,i),sweepFlag:1,largeArcFlag:1}),this.d=new So({start:new b(r-i,o),end:new b(i,o)})}}nearestPoint(n){let r,o=1/0,i,s;const{a,b:c,c:l,d}=this;for(const h of[a,c,l,d])s=h.nearestPoint(n),i=b.Dist2(s,n),i<o&&(r=s,o=i);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(n,r){const{a:o,b:i,c:s,d:a}=this;return[o,i,s,a].some(c=>c.hitTestLineSegment(n,r))}getVertices(){const{a:n,b:r,c:o,d:i}=this;return[n,r,o,i].reduce((s,a)=>(s.push(...a.vertices),s),[])}getBounds(){return new ee(0,0,this.w,this.h)}getLength(){const{h:n,w:r}=this;return n>r?(ze*(r/2)+(n-r))*2:(ze*(n/2)+(r-n))*2}getSvgPathData(){const{a:n,b:r,c:o,d:i}=this;return[n,r,o,i].map((s,a)=>s.getSvgPathData(a===0)).join(" ")+" Z"}}async function DG({shouldReload:t=!0}={}){i5();for(const e of Lu.connectedInstances)await e.close();await Promise.all(jS().map(e=>L2(e))),o5(),t&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=DG);function $G(t,e="_blank"){Ch.openWindow(t,e)}fi("@tldraw/editor","3.3.1","esm");function se(t,e,{checkForDefaultPrevented:n=!0}={}){return function(o){if(t==null||t(o),n===!1||!o.defaultPrevented)return e==null?void 0:e(o)}}function RG(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function Uh(...t){return e=>t.forEach(n=>RG(n,e))}function st(...t){return V(Uh(...t),t)}function LG(t,e){const n=Ze(e),r=i=>{const{children:s,...a}=i,c=ce(()=>a,Object.values(a));return u(n.Provider,{value:c,children:s})};r.displayName=t+"Provider";function o(i){const s=tt(n);if(s)return s;if(e!==void 0)return e;throw new Error(`\`${i}\` must be used within \`${t}\``)}return[r,o]}function as(t,e=[]){let n=[];function r(i,s){const a=Ze(s),c=n.length;n=[...n,s];const l=h=>{var S;const{scope:p,children:f,...g}=h,m=((S=p==null?void 0:p[t])==null?void 0:S[c])||a,y=ce(()=>g,Object.values(g));return u(m.Provider,{value:y,children:f})};l.displayName=i+"Provider";function d(h,p){var m;const f=((m=p==null?void 0:p[t])==null?void 0:m[c])||a,g=tt(f);if(g)return g;if(s!==void 0)return s;throw new Error(`\`${h}\` must be used within \`${i}\``)}return[l,d]}const o=()=>{const i=n.map(s=>Ze(s));return function(a){const c=(a==null?void 0:a[t])||i;return ce(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return o.scopeName=t,[r,NG(o,...e)]}function NG(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(i){const s=r.reduce((a,{useScope:c,scopeName:l})=>{const h=c(i)[`__scope${l}`];return{...a,...h}},{});return ce(()=>({[`__scope${e.scopeName}`]:s}),[s])}};return n.scopeName=e.scopeName,n}var li=globalThis!=null&&globalThis.document?je:()=>{},FG=FB.useId||(()=>{}),zG=0;function Co(t){const[e,n]=Q(FG());return li(()=>{t||n(r=>r??String(zG++))},[t]),t||(e?`radix-${e}`:"")}function Vt(t){const e=B(t);return q(()=>{e.current=t}),ce(()=>(...n)=>{var r;return(r=e.current)==null?void 0:r.call(e,...n)},[])}function bi({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,o]=BG({defaultProp:e,onChange:n}),i=t!==void 0,s=i?t:r,a=Vt(n),c=V(l=>{if(i){const h=typeof l=="function"?l(t):l;h!==t&&a(h)}else o(l)},[i,t,o,a]);return[s,c]}function BG({defaultProp:t,onChange:e}){const n=Q(t),[r]=n,o=B(r),i=Vt(e);return q(()=>{o.current!==r&&(i(r),o.current=r)},[r,o,i]),n}var Yi=X((t,e)=>{const{children:n,...r}=t,o=Wr.toArray(n),i=o.find(HG);if(i){const s=i.props.children,a=o.map(c=>c===i?Wr.count(s)>1?Wr.only(null):ko(s)?s.props.children:null:c);return u(xm,{...r,ref:e,children:ko(s)?ya(s,void 0,a):null})}return u(xm,{...r,ref:e,children:n})});Yi.displayName="Slot";var xm=X((t,e)=>{const{children:n,...r}=t;if(ko(n)){const o=KG(n);return ya(n,{...jG(r,n.props),ref:e?Uh(e,o):o})}return Wr.count(n)>1?Wr.only(null):null});xm.displayName="SlotClone";var UG=({children:t})=>u(Z,{children:t});function HG(t){return ko(t)&&t.type===UG}function jG(t,e){const n={...e};for(const r in e){const o=t[r],i=e[r];/^on[A-Z]/.test(r)?o&&i?n[r]=(...a)=>{i(...a),o(...a)}:o&&(n[r]=o):r==="style"?n[r]={...o,...i}:r==="className"&&(n[r]=[o,i].filter(Boolean).join(" "))}return{...t,...n}}function KG(t){var r,o;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(o=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:o.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var WG=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Le=WG.reduce((t,e)=>{const n=X((r,o)=>{const{asChild:i,...s}=r,a=i?Yi:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),u(a,{...s,ref:o})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function VS(t,e){t&&Hi(()=>t.dispatchEvent(e))}function GG(t,e=globalThis==null?void 0:globalThis.document){const n=Vt(t);q(()=>{const r=o=>{o.key==="Escape"&&n(o)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var VG="DismissableLayer",Pm="dismissableLayer.update",YG="dismissableLayer.pointerDownOutside",XG="dismissableLayer.focusOutside",u1,W2=Ze({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),cl=X((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:i,onInteractOutside:s,onDismiss:a,...c}=t,l=tt(W2),[d,h]=Q(null),p=(d==null?void 0:d.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=Q({}),g=st(e,E=>h(E)),m=Array.from(l.layers),[y]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),S=m.indexOf(y),v=d?m.indexOf(d):-1,_=l.layersWithOutsidePointerEventsDisabled.size>0,w=v>=S,x=ZG(E=>{const I=E.target,T=[...l.branches].some(k=>k.contains(I));!w||T||(o==null||o(E),s==null||s(E),E.defaultPrevented||a==null||a())},p),C=JG(E=>{const I=E.target;[...l.branches].some(k=>k.contains(I))||(i==null||i(E),s==null||s(E),E.defaultPrevented||a==null||a())},p);return GG(E=>{v===l.layers.size-1&&(r==null||r(E),!E.defaultPrevented&&a&&(E.preventDefault(),a()))},p),q(()=>{if(d)return n&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(u1=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(d)),l.layers.add(d),h1(),()=>{n&&l.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=u1)}},[d,p,n,l]),q(()=>()=>{d&&(l.layers.delete(d),l.layersWithOutsidePointerEventsDisabled.delete(d),h1())},[d,l]),q(()=>{const E=()=>f({});return document.addEventListener(Pm,E),()=>document.removeEventListener(Pm,E)},[]),u(Le.div,{...c,ref:g,style:{pointerEvents:_?w?"auto":"none":void 0,...t.style},onFocusCapture:se(t.onFocusCapture,C.onFocusCapture),onBlurCapture:se(t.onBlurCapture,C.onBlurCapture),onPointerDownCapture:se(t.onPointerDownCapture,x.onPointerDownCapture)})});cl.displayName=VG;var qG="DismissableLayerBranch",G2=X((t,e)=>{const n=tt(W2),r=B(null),o=st(e,r);return q(()=>{const i=r.current;if(i)return n.branches.add(i),()=>{n.branches.delete(i)}},[n.branches]),u(Le.div,{...t,ref:o})});G2.displayName=qG;function ZG(t,e=globalThis==null?void 0:globalThis.document){const n=Vt(t),r=B(!1),o=B(()=>{});return q(()=>{const i=a=>{if(a.target&&!r.current){let c=function(){V2(YG,n,l,{discrete:!0})};const l={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=c,e.addEventListener("click",o.current,{once:!0})):c()}else e.removeEventListener("click",o.current);r.current=!1},s=window.setTimeout(()=>{e.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(s),e.removeEventListener("pointerdown",i),e.removeEventListener("click",o.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function JG(t,e=globalThis==null?void 0:globalThis.document){const n=Vt(t),r=B(!1);return q(()=>{const o=i=>{i.target&&!r.current&&V2(XG,n,{originalEvent:i},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function h1(){const t=new CustomEvent(Pm);document.dispatchEvent(t)}function V2(t,e,n,{discrete:r}){const o=n.originalEvent.target,i=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&o.addEventListener(t,e,{once:!0}),r?VS(o,i):o.dispatchEvent(i)}var QG=cl,eV=G2,Tf="focusScope.autoFocusOnMount",kf="focusScope.autoFocusOnUnmount",p1={bubbles:!1,cancelable:!0},tV="FocusScope",Hh=X((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:i,...s}=t,[a,c]=Q(null),l=Vt(o),d=Vt(i),h=B(null),p=st(e,m=>c(m)),f=B({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;q(()=>{if(r){let m=function(_){if(f.paused||!a)return;const w=_.target;a.contains(w)?h.current=w:Vo(h.current,{select:!0})},y=function(_){if(f.paused||!a)return;const w=_.relatedTarget;w!==null&&(a.contains(w)||Vo(h.current,{select:!0}))},S=function(_){if(document.activeElement===document.body)for(const x of _)x.removedNodes.length>0&&Vo(a)};document.addEventListener("focusin",m),document.addEventListener("focusout",y);const v=new MutationObserver(S);return a&&v.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",m),document.removeEventListener("focusout",y),v.disconnect()}}},[r,a,f.paused]),q(()=>{if(a){g1.add(f);const m=document.activeElement;if(!a.contains(m)){const S=new CustomEvent(Tf,p1);a.addEventListener(Tf,l),a.dispatchEvent(S),S.defaultPrevented||(nV(aV(Y2(a)),{select:!0}),document.activeElement===m&&Vo(a))}return()=>{a.removeEventListener(Tf,l),setTimeout(()=>{const S=new CustomEvent(kf,p1);a.addEventListener(kf,d),a.dispatchEvent(S),S.defaultPrevented||Vo(m??document.body,{select:!0}),a.removeEventListener(kf,d),g1.remove(f)},0)}}},[a,l,d,f]);const g=V(m=>{if(!n&&!r||f.paused)return;const y=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,S=document.activeElement;if(y&&S){const v=m.currentTarget,[_,w]=rV(v);_&&w?!m.shiftKey&&S===w?(m.preventDefault(),n&&Vo(_,{select:!0})):m.shiftKey&&S===_&&(m.preventDefault(),n&&Vo(w,{select:!0})):S===v&&m.preventDefault()}},[n,r,f.paused]);return u(Le.div,{tabIndex:-1,...s,ref:p,onKeyDown:g})});Hh.displayName=tV;function nV(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(Vo(r,{select:e}),document.activeElement!==n)return}function rV(t){const e=Y2(t),n=f1(e,t),r=f1(e.reverse(),t);return[n,r]}function Y2(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function f1(t,e){for(const n of t)if(!oV(n,{upTo:e}))return n}function oV(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function iV(t){return t instanceof HTMLInputElement&&"select"in t}function Vo(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&iV(t)&&e&&t.select()}}var g1=sV();function sV(){let t=[];return{add(e){const n=t[0];e!==n&&(n==null||n.pause()),t=m1(t,e),t.unshift(e)},remove(e){var n;t=m1(t,e),(n=t[0])==null||n.resume()}}}function m1(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function aV(t){return t.filter(e=>e.tagName!=="A")}var cV="Portal",ll=X((t,e)=>{var a;const{container:n,...r}=t,[o,i]=Q(!1);li(()=>i(!0),[]);const s=n||o&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return s?we.createPortal(u(Le.div,{...r,ref:e}),s):null});ll.displayName=cV;function lV(t,e){return Vc((n,r)=>e[n][r]??n,t)}var Mr=t=>{const{present:e,children:n}=t,r=dV(e),o=typeof n=="function"?n({present:r.isPresent}):Wr.only(n),i=st(r.ref,uV(o));return typeof n=="function"||r.isPresent?ya(o,{ref:i}):null};Mr.displayName="Presence";function dV(t){const[e,n]=Q(),r=B({}),o=B(t),i=B("none"),s=t?"mounted":"unmounted",[a,c]=lV(s,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return q(()=>{const l=Vl(r.current);i.current=a==="mounted"?l:"none"},[a]),li(()=>{const l=r.current,d=o.current;if(d!==t){const p=i.current,f=Vl(l);t?c("MOUNT"):f==="none"||(l==null?void 0:l.display)==="none"?c("UNMOUNT"):c(d&&p!==f?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,c]),li(()=>{if(e){let l;const d=e.ownerDocument.defaultView??window,h=f=>{const m=Vl(r.current).includes(f.animationName);if(f.target===e&&m&&(c("ANIMATION_END"),!o.current)){const y=e.style.animationFillMode;e.style.animationFillMode="forwards",l=d.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=y)})}},p=f=>{f.target===e&&(i.current=Vl(r.current))};return e.addEventListener("animationstart",p),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{d.clearTimeout(l),e.removeEventListener("animationstart",p),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:V(l=>{l&&(r.current=getComputedStyle(l)),n(l)},[])}}function Vl(t){return(t==null?void 0:t.animationName)||"none"}function uV(t){var r,o;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(o=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:o.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Mf=0;function YS(){q(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??y1()),document.body.insertAdjacentElement("beforeend",t[1]??y1()),Mf++,()=>{Mf===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Mf--}},[])}function y1(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var zr=function(){return zr=Object.assign||function(e){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},zr.apply(this,arguments)};function X2(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}function hV(t,e,n){if(n||arguments.length===2)for(var r=0,o=e.length,i;r<o;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}var Td="right-scroll-bar-position",kd="width-before-scroll-bar",pV="with-scroll-bars-hidden",fV="--removed-body-scroll-bar-size";function Af(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function gV(t,e){var n=Q(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var o=n.value;o!==r&&(n.value=r,n.callback(r,o))}}}})[0];return n.callback=e,n.facade}var mV=typeof window<"u"?je:q,S1=new WeakMap;function yV(t,e){var n=gV(null,function(r){return t.forEach(function(o){return Af(o,r)})});return mV(function(){var r=S1.get(n);if(r){var o=new Set(r),i=new Set(t),s=n.current;o.forEach(function(a){i.has(a)||Af(a,null)}),i.forEach(function(a){o.has(a)||Af(a,s)})}S1.set(n,t)},[t]),n}function SV(t){return t}function vV(t,e){e===void 0&&(e=SV);var n=[],r=!1,o={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(i){var s=e(i,r);return n.push(s),function(){n=n.filter(function(a){return a!==s})}},assignSyncMedium:function(i){for(r=!0;n.length;){var s=n;n=[],s.forEach(i)}n={push:function(a){return i(a)},filter:function(){return n}}},assignMedium:function(i){r=!0;var s=[];if(n.length){var a=n;n=[],a.forEach(i),s=n}var c=function(){var d=s;s=[],d.forEach(i)},l=function(){return Promise.resolve().then(c)};l(),n={push:function(d){s.push(d),l()},filter:function(d){return s=s.filter(d),n}}}};return o}function bV(t){t===void 0&&(t={});var e=vV(null);return e.options=zr({async:!0,ssr:!1},t),e}var q2=function(t){var e=t.sideCar,n=X2(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return kt(r,zr({},n))};q2.isSideCarExport=!0;function wV(t,e){return t.useMedium(e),q2}var Z2=bV(),Of=function(){},jh=X(function(t,e){var n=B(null),r=Q({onScrollCapture:Of,onWheelCapture:Of,onTouchMoveCapture:Of}),o=r[0],i=r[1],s=t.forwardProps,a=t.children,c=t.className,l=t.removeScrollBar,d=t.enabled,h=t.shards,p=t.sideCar,f=t.noIsolation,g=t.inert,m=t.allowPinchZoom,y=t.as,S=y===void 0?"div":y,v=t.gapMode,_=X2(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),w=p,x=yV([n,e]),C=zr(zr({},_),o);return kt(Z,null,d&&kt(w,{sideCar:Z2,removeScrollBar:l,shards:h,noIsolation:f,inert:g,setCallbacks:i,allowPinchZoom:!!m,lockRef:n,gapMode:v}),s?ya(Wr.only(a),zr(zr({},C),{ref:x})):kt(S,zr({},C,{className:c,ref:x}),a))});jh.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};jh.classNames={fullWidth:kd,zeroRight:Td};var _V=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function xV(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=_V();return e&&t.setAttribute("nonce",e),t}function PV(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function IV(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var CV=function(){var t=0,e=null;return{add:function(n){t==0&&(e=xV())&&(PV(e,n),IV(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},EV=function(){var t=CV();return function(e,n){q(function(){return t.add(e),function(){t.remove()}},[e&&n])}},J2=function(){var t=EV(),e=function(n){var r=n.styles,o=n.dynamic;return t(r,o),null};return e},TV={left:0,top:0,right:0,gap:0},Df=function(t){return parseInt(t||"",10)||0},kV=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],o=e[t==="padding"?"paddingRight":"marginRight"];return[Df(n),Df(r),Df(o)]},MV=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return TV;var e=kV(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},AV=J2(),js="data-scroll-locked",OV=function(t,e,n,r){var o=t.left,i=t.top,s=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(pV,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(js,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(s,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Td,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(kd,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Td," .").concat(Td,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(kd," .").concat(kd,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(js,`] {
    `).concat(fV,": ").concat(a,`px;
  }
`)},v1=function(){var t=parseInt(document.body.getAttribute(js)||"0",10);return isFinite(t)?t:0},DV=function(){q(function(){return document.body.setAttribute(js,(v1()+1).toString()),function(){var t=v1()-1;t<=0?document.body.removeAttribute(js):document.body.setAttribute(js,t.toString())}},[])},$V=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,o=r===void 0?"margin":r;DV();var i=ce(function(){return MV(o)},[o]);return kt(AV,{styles:OV(i,!e,o,n?"":"!important")})},Im=!1;if(typeof window<"u")try{var Yl=Object.defineProperty({},"passive",{get:function(){return Im=!0,!0}});window.addEventListener("test",Yl,Yl),window.removeEventListener("test",Yl,Yl)}catch{Im=!1}var Ss=Im?{passive:!1}:!1,RV=function(t){return t.tagName==="TEXTAREA"},Q2=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!RV(t)&&n[e]==="visible")},LV=function(t){return Q2(t,"overflowY")},NV=function(t){return Q2(t,"overflowX")},b1=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=ek(t,r);if(o){var i=tk(t,r),s=i[1],a=i[2];if(s>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},FV=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},zV=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},ek=function(t,e){return t==="v"?LV(e):NV(e)},tk=function(t,e){return t==="v"?FV(e):zV(e)},BV=function(t,e){return t==="h"&&e==="rtl"?-1:1},UV=function(t,e,n,r,o){var i=BV(t,window.getComputedStyle(e).direction),s=i*r,a=n.target,c=e.contains(a),l=!1,d=s>0,h=0,p=0;do{var f=tk(t,a),g=f[0],m=f[1],y=f[2],S=m-y-i*g;(g||S)&&ek(t,a)&&(h+=S,p+=g),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(e.contains(a)||e===a));return(d&&(Math.abs(h)<1||!o)||!d&&(Math.abs(p)<1||!o))&&(l=!0),l},Xl=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},w1=function(t){return[t.deltaX,t.deltaY]},_1=function(t){return t&&"current"in t?t.current:t},HV=function(t,e){return t[0]===e[0]&&t[1]===e[1]},jV=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},KV=0,vs=[];function WV(t){var e=B([]),n=B([0,0]),r=B(),o=Q(KV++)[0],i=Q(J2)[0],s=B(t);q(function(){s.current=t},[t]),q(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(o));var m=hV([t.lockRef.current],(t.shards||[]).map(_1),!0).filter(Boolean);return m.forEach(function(y){return y.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),m.forEach(function(y){return y.classList.remove("allow-interactivity-".concat(o))})}}},[t.inert,t.lockRef.current,t.shards]);var a=V(function(m,y){if("touches"in m&&m.touches.length===2||m.type==="wheel"&&m.ctrlKey)return!s.current.allowPinchZoom;var S=Xl(m),v=n.current,_="deltaX"in m?m.deltaX:v[0]-S[0],w="deltaY"in m?m.deltaY:v[1]-S[1],x,C=m.target,E=Math.abs(_)>Math.abs(w)?"h":"v";if("touches"in m&&E==="h"&&C.type==="range")return!1;var I=b1(E,C);if(!I)return!0;if(I?x=E:(x=E==="v"?"h":"v",I=b1(E,C)),!I)return!1;if(!r.current&&"changedTouches"in m&&(_||w)&&(r.current=x),!x)return!0;var T=r.current||x;return UV(T,y,m,T==="h"?_:w,!0)},[]),c=V(function(m){var y=m;if(!(!vs.length||vs[vs.length-1]!==i)){var S="deltaY"in y?w1(y):Xl(y),v=e.current.filter(function(x){return x.name===y.type&&(x.target===y.target||y.target===x.shadowParent)&&HV(x.delta,S)})[0];if(v&&v.should){y.cancelable&&y.preventDefault();return}if(!v){var _=(s.current.shards||[]).map(_1).filter(Boolean).filter(function(x){return x.contains(y.target)}),w=_.length>0?a(y,_[0]):!s.current.noIsolation;w&&y.cancelable&&y.preventDefault()}}},[]),l=V(function(m,y,S,v){var _={name:m,delta:y,target:S,should:v,shadowParent:GV(S)};e.current.push(_),setTimeout(function(){e.current=e.current.filter(function(w){return w!==_})},1)},[]),d=V(function(m){n.current=Xl(m),r.current=void 0},[]),h=V(function(m){l(m.type,w1(m),m.target,a(m,t.lockRef.current))},[]),p=V(function(m){l(m.type,Xl(m),m.target,a(m,t.lockRef.current))},[]);q(function(){return vs.push(i),t.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:p}),document.addEventListener("wheel",c,Ss),document.addEventListener("touchmove",c,Ss),document.addEventListener("touchstart",d,Ss),function(){vs=vs.filter(function(m){return m!==i}),document.removeEventListener("wheel",c,Ss),document.removeEventListener("touchmove",c,Ss),document.removeEventListener("touchstart",d,Ss)}},[]);var f=t.removeScrollBar,g=t.inert;return kt(Z,null,g?kt(i,{styles:jV(o)}):null,f?kt($V,{gapMode:t.gapMode}):null)}function GV(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const VV=wV(Z2,WV);var Kh=X(function(t,e){return kt(jh,zr({},t,{ref:e,sideCar:VV}))});Kh.classNames=jh.classNames;var YV=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},bs=new WeakMap,ql=new WeakMap,Zl={},$f=0,nk=function(t){return t&&(t.host||nk(t.parentNode))},XV=function(t,e){return e.map(function(n){if(t.contains(n))return n;var r=nk(n);return r&&t.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},qV=function(t,e,n,r){var o=XV(e,Array.isArray(t)?t:[t]);Zl[n]||(Zl[n]=new WeakMap);var i=Zl[n],s=[],a=new Set,c=new Set(o),l=function(h){!h||a.has(h)||(a.add(h),l(h.parentNode))};o.forEach(l);var d=function(h){!h||c.has(h)||Array.prototype.forEach.call(h.children,function(p){if(a.has(p))d(p);else try{var f=p.getAttribute(r),g=f!==null&&f!=="false",m=(bs.get(p)||0)+1,y=(i.get(p)||0)+1;bs.set(p,m),i.set(p,y),s.push(p),m===1&&g&&ql.set(p,!0),y===1&&p.setAttribute(n,"true"),g||p.setAttribute(r,"true")}catch(S){console.error("aria-hidden: cannot operate on ",p,S)}})};return d(e),a.clear(),$f++,function(){s.forEach(function(h){var p=bs.get(h)-1,f=i.get(h)-1;bs.set(h,p),i.set(h,f),p||(ql.has(h)||h.removeAttribute(r),ql.delete(h)),f||h.removeAttribute(n)}),$f--,$f||(bs=new WeakMap,bs=new WeakMap,ql=new WeakMap,Zl={})}},XS=function(t,e,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),o=YV(t);return o?(r.push.apply(r,Array.from(o.querySelectorAll("[aria-live]"))),qV(r,o,n,"aria-hidden")):function(){return null}},qS="Dialog",[rk,bae]=as(qS),[ZV,Ar]=rk(qS),ok=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:o,onOpenChange:i,modal:s=!0}=t,a=B(null),c=B(null),[l=!1,d]=bi({prop:r,defaultProp:o,onChange:i});return u(ZV,{scope:e,triggerRef:a,contentRef:c,contentId:Co(),titleId:Co(),descriptionId:Co(),open:l,onOpenChange:d,onOpenToggle:V(()=>d(h=>!h),[d]),modal:s,children:n})};ok.displayName=qS;var ik="DialogTrigger",JV=X((t,e)=>{const{__scopeDialog:n,...r}=t,o=Ar(ik,n),i=st(e,o.triggerRef);return u(Le.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":QS(o.open),...r,ref:i,onClick:se(t.onClick,o.onOpenToggle)})});JV.displayName=ik;var ZS="DialogPortal",[QV,sk]=rk(ZS,{forceMount:void 0}),ak=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:o}=t,i=Ar(ZS,e);return u(QV,{scope:e,forceMount:n,children:Wr.map(r,s=>u(Mr,{present:n||i.open,children:u(ll,{asChild:!0,container:o,children:s})}))})};ak.displayName=ZS;var Nu="DialogOverlay",ck=X((t,e)=>{const n=sk(Nu,t.__scopeDialog),{forceMount:r=n.forceMount,...o}=t,i=Ar(Nu,t.__scopeDialog);return i.modal?u(Mr,{present:r||i.open,children:u(eY,{...o,ref:e})}):null});ck.displayName=Nu;var eY=X((t,e)=>{const{__scopeDialog:n,...r}=t,o=Ar(Nu,n);return u(Kh,{as:Yi,allowPinchZoom:!0,shards:[o.contentRef],children:u(Le.div,{"data-state":QS(o.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),Xi="DialogContent",lk=X((t,e)=>{const n=sk(Xi,t.__scopeDialog),{forceMount:r=n.forceMount,...o}=t,i=Ar(Xi,t.__scopeDialog);return u(Mr,{present:r||i.open,children:i.modal?u(tY,{...o,ref:e}):u(nY,{...o,ref:e})})});lk.displayName=Xi;var tY=X((t,e)=>{const n=Ar(Xi,t.__scopeDialog),r=B(null),o=st(e,n.contentRef,r);return q(()=>{const i=r.current;if(i)return XS(i)},[]),u(dk,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:se(t.onCloseAutoFocus,i=>{var s;i.preventDefault(),(s=n.triggerRef.current)==null||s.focus()}),onPointerDownOutside:se(t.onPointerDownOutside,i=>{const s=i.detail.originalEvent,a=s.button===0&&s.ctrlKey===!0;(s.button===2||a)&&i.preventDefault()}),onFocusOutside:se(t.onFocusOutside,i=>i.preventDefault())})}),nY=X((t,e)=>{const n=Ar(Xi,t.__scopeDialog),r=B(!1),o=B(!1);return u(dk,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{var s,a;(s=t.onCloseAutoFocus)==null||s.call(t,i),i.defaultPrevented||(r.current||(a=n.triggerRef.current)==null||a.focus(),i.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:i=>{var c,l;(c=t.onInteractOutside)==null||c.call(t,i),i.defaultPrevented||(r.current=!0,i.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const s=i.target;((l=n.triggerRef.current)==null?void 0:l.contains(s))&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&o.current&&i.preventDefault()}})}),dk=X((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:i,...s}=t,a=Ar(Xi,n),c=B(null),l=st(e,c);return YS(),u(Z,{children:[u(Hh,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:i,children:u(cl,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":QS(a.open),...s,ref:l,onDismiss:()=>a.onOpenChange(!1)})}),u(Z,{children:[u(oY,{titleId:a.titleId}),u(sY,{contentRef:c,descriptionId:a.descriptionId})]})]})}),JS="DialogTitle",uk=X((t,e)=>{const{__scopeDialog:n,...r}=t,o=Ar(JS,n);return u(Le.h2,{id:o.titleId,...r,ref:e})});uk.displayName=JS;var hk="DialogDescription",rY=X((t,e)=>{const{__scopeDialog:n,...r}=t,o=Ar(hk,n);return u(Le.p,{id:o.descriptionId,...r,ref:e})});rY.displayName=hk;var pk="DialogClose",fk=X((t,e)=>{const{__scopeDialog:n,...r}=t,o=Ar(pk,n);return u(Le.button,{type:"button",...r,ref:e,onClick:se(t.onClick,()=>o.onOpenChange(!1))})});fk.displayName=pk;function QS(t){return t?"open":"closed"}var gk="DialogTitleWarning",[wae,mk]=LG(gk,{contentName:Xi,titleName:JS,docsSlug:"dialog"}),oY=({titleId:t})=>{const e=mk(gk),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return q(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},iY="DialogDescriptionWarning",sY=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${mk(iY).contentName}}.`;return q(()=>{var i;const o=(i=t.current)==null?void 0:i.getAttribute("aria-describedby");e&&o&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},aY=ok,cY=ak,lY=ck,dY=lk;const yk=()=>{},Sk=Ze(null);function uY({onEvent:t,children:e}){return u(Sk.Provider,{value:t??yk,children:e})}function Xt(){return tt(Sk)??yk}const vk=Ze(null);function hY({context:t,children:e}){const n=Xt(),r=tI("dialogs",[]),o=ce(()=>({dialogs:r,addDialog(i){const s=i.id??Ye();return r.update(a=>[...a.filter(c=>c.id!==i.id),{...i,id:s}]),n("open-menu",{source:"dialog",id:s}),mr.addOpenMenu(s,t),s},removeDialog(i){var a;const s=r.get().find(c=>c.id===i);return s&&((a=s.onClose)==null||a.call(s),n("close-menu",{source:"dialog",id:i}),mr.deleteOpenMenu(i,t),r.update(c=>c.filter(l=>l!==s))),i},clearDialogs(){const i=r.get();i.length!==0&&(i.forEach(s=>{var a;(a=s.onClose)==null||a.call(s),n("close-menu",{source:"dialog",id:s.id}),mr.deleteOpenMenu(s.id,t)}),r.set([]))}}),[n,r,t]);return u(vk.Provider,{value:o,children:e})}function cs(){const t=tt(vk);if(!t)throw new Error("useDialogs must be used within a DialogsProvider");return t}const pY=({id:t,component:e,onClose:n})=>{const{removeDialog:r}=cs(),o=At(),i=V(s=>{if(!s){if(n)try{n()}catch(a){console.warn(a)}r(t)}},[t,n,r]);return u(aY,{onOpenChange:i,defaultOpen:!0,children:u(cY,{container:o,children:u(lY,{dir:"ltr",className:"tlui-dialog__overlay",onClick:s=>{s.target===s.currentTarget&&i(!1)},children:u(dY,{dir:"ltr",className:"tlui-dialog__content",children:u(e,{onClose:()=>i(!1)})})})})})},fY=$e(function(){const{dialogs:e}=cs();return U("dialogs",()=>e.get(),[e]).map(r=>u(pY,{...r},r.id))});function gY(t,e=[]){let n=[];function r(i,s){const a=Ze(s),c=n.length;n=[...n,s];function l(h){const{scope:p,children:f,...g}=h,m=(p==null?void 0:p[t][c])||a,y=ce(()=>g,Object.values(g));return u(m.Provider,{value:y,children:f})}function d(h,p){const f=(p==null?void 0:p[t][c])||a,g=tt(f);if(g)return g;if(s!==void 0)return s;throw new Error(`\`${h}\` must be used within \`${i}\``)}return l.displayName=i+"Provider",[l,d]}const o=()=>{const i=n.map(s=>Ze(s));return function(a){const c=(a==null?void 0:a[t])||i;return ce(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return o.scopeName=t,[r,mY(o,...e)]}function mY(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(i){const s=r.reduce((a,{useScope:c,scopeName:l})=>{const h=c(i)[`__scope${l}`];return{...a,...h}},{});return ce(()=>({[`__scope${e.scopeName}`]:s}),[s])}};return n.scopeName=e.scopeName,n}function Wh(t){const e=t+"CollectionProvider",[n,r]=gY(e),[o,i]=n(e,{collectionRef:{current:null},itemMap:new Map}),s=f=>{const{scope:g,children:m}=f,y=we.useRef(null),S=we.useRef(new Map).current;return u(o,{scope:g,itemMap:S,collectionRef:y,children:m})};s.displayName=e;const a=t+"CollectionSlot",c=we.forwardRef((f,g)=>{const{scope:m,children:y}=f,S=i(a,m),v=st(g,S.collectionRef);return u(Yi,{ref:v,children:y})});c.displayName=a;const l=t+"CollectionItemSlot",d="data-radix-collection-item",h=we.forwardRef((f,g)=>{const{scope:m,children:y,...S}=f,v=we.useRef(null),_=st(g,v),w=i(l,m);return we.useEffect(()=>(w.itemMap.set(v,{ref:v,...S}),()=>void w.itemMap.delete(v))),u(Yi,{[d]:"",ref:_,children:y})});h.displayName=l;function p(f){const g=i(t+"CollectionConsumer",f);return we.useCallback(()=>{const y=g.collectionRef.current;if(!y)return[];const S=Array.from(y.querySelectorAll(`[${d}]`));return Array.from(g.itemMap.values()).sort((w,x)=>S.indexOf(w.ref.current)-S.indexOf(x.ref.current))},[g.collectionRef,g.itemMap])}return[{Provider:s,Slot:c,ItemSlot:h},p,r]}var yY="VisuallyHidden",ev=X((t,e)=>u(Le.span,{...t,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...t.style}}));ev.displayName=yY;var tv="ToastProvider",[nv,SY,vY]=Wh("Toast"),[bk,_ae]=as("Toast",[vY]),[bY,Gh]=bk(tv),wk=t=>{const{__scopeToast:e,label:n="Notification",duration:r=5e3,swipeDirection:o="right",swipeThreshold:i=50,children:s}=t,[a,c]=Q(null),[l,d]=Q(0),h=B(!1),p=B(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${tv}\`. Expected non-empty \`string\`.`),u(nv.Provider,{scope:e,children:u(bY,{scope:e,label:n,duration:r,swipeDirection:o,swipeThreshold:i,toastCount:l,viewport:a,onViewportChange:c,onToastAdd:V(()=>d(f=>f+1),[]),onToastRemove:V(()=>d(f=>f-1),[]),isFocusedToastEscapeKeyDownRef:h,isClosePausedRef:p,children:s})})};wk.displayName=tv;var _k="ToastViewport",wY=["F8"],Cm="toast.viewportPause",Em="toast.viewportResume",xk=X((t,e)=>{const{__scopeToast:n,hotkey:r=wY,label:o="Notifications ({hotkey})",...i}=t,s=Gh(_k,n),a=SY(n),c=B(null),l=B(null),d=B(null),h=B(null),p=st(e,h,s.onViewportChange),f=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),g=s.toastCount>0;q(()=>{const y=S=>{var _;r.length!==0&&r.every(w=>S[w]||S.code===w)&&((_=h.current)==null||_.focus())};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[r]),q(()=>{const y=c.current,S=h.current;if(g&&y&&S){const v=()=>{if(!s.isClosePausedRef.current){const C=new CustomEvent(Cm);S.dispatchEvent(C),s.isClosePausedRef.current=!0}},_=()=>{if(s.isClosePausedRef.current){const C=new CustomEvent(Em);S.dispatchEvent(C),s.isClosePausedRef.current=!1}},w=C=>{!y.contains(C.relatedTarget)&&_()},x=()=>{y.contains(document.activeElement)||_()};return y.addEventListener("focusin",v),y.addEventListener("focusout",w),y.addEventListener("pointermove",v),y.addEventListener("pointerleave",x),window.addEventListener("blur",v),window.addEventListener("focus",_),()=>{y.removeEventListener("focusin",v),y.removeEventListener("focusout",w),y.removeEventListener("pointermove",v),y.removeEventListener("pointerleave",x),window.removeEventListener("blur",v),window.removeEventListener("focus",_)}}},[g,s.isClosePausedRef]);const m=V(({tabbingDirection:y})=>{const v=a().map(_=>{const w=_.ref.current,x=[w,...$Y(w)];return y==="forwards"?x:x.reverse()});return(y==="forwards"?v.reverse():v).flat()},[a]);return q(()=>{const y=h.current;if(y){const S=v=>{var x,C,E;const _=v.altKey||v.ctrlKey||v.metaKey;if(v.key==="Tab"&&!_){const I=document.activeElement,T=v.shiftKey;if(v.target===y&&T){(x=l.current)==null||x.focus();return}const A=m({tabbingDirection:T?"backwards":"forwards"}),O=A.findIndex($=>$===I);Rf(A.slice(O+1))?v.preventDefault():T?(C=l.current)==null||C.focus():(E=d.current)==null||E.focus()}};return y.addEventListener("keydown",S),()=>y.removeEventListener("keydown",S)}},[a,m]),u(eV,{ref:c,role:"region","aria-label":o.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:g?void 0:"none"},children:[g&&u(Tm,{ref:l,onFocusFromOutsideViewport:()=>{const y=m({tabbingDirection:"forwards"});Rf(y)}}),u(nv.Slot,{scope:n,children:u(Le.ol,{tabIndex:-1,...i,ref:p})}),g&&u(Tm,{ref:d,onFocusFromOutsideViewport:()=>{const y=m({tabbingDirection:"backwards"});Rf(y)}})]})});xk.displayName=_k;var Pk="ToastFocusProxy",Tm=X((t,e)=>{const{__scopeToast:n,onFocusFromOutsideViewport:r,...o}=t,i=Gh(Pk,n);return u(ev,{"aria-hidden":!0,tabIndex:0,...o,ref:e,style:{position:"fixed"},onFocus:s=>{var l;const a=s.relatedTarget;!((l=i.viewport)!=null&&l.contains(a))&&r()}})});Tm.displayName=Pk;var Vh="Toast",_Y="toast.swipeStart",xY="toast.swipeMove",PY="toast.swipeCancel",IY="toast.swipeEnd",Ik=X((t,e)=>{const{forceMount:n,open:r,defaultOpen:o,onOpenChange:i,...s}=t,[a=!0,c]=bi({prop:r,defaultProp:o,onChange:i});return u(Mr,{present:n||a,children:u(TY,{open:a,...s,ref:e,onClose:()=>c(!1),onPause:Vt(t.onPause),onResume:Vt(t.onResume),onSwipeStart:se(t.onSwipeStart,l=>{l.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:se(t.onSwipeMove,l=>{const{x:d,y:h}=l.detail.delta;l.currentTarget.setAttribute("data-swipe","move"),l.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${d}px`),l.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${h}px`)}),onSwipeCancel:se(t.onSwipeCancel,l=>{l.currentTarget.setAttribute("data-swipe","cancel"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),l.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),l.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:se(t.onSwipeEnd,l=>{const{x:d,y:h}=l.detail.delta;l.currentTarget.setAttribute("data-swipe","end"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),l.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${d}px`),l.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${h}px`),c(!1)})})})});Ik.displayName=Vh;var[CY,EY]=bk(Vh,{onClose(){}}),TY=X((t,e)=>{const{__scopeToast:n,type:r="foreground",duration:o,open:i,onClose:s,onEscapeKeyDown:a,onPause:c,onResume:l,onSwipeStart:d,onSwipeMove:h,onSwipeCancel:p,onSwipeEnd:f,...g}=t,m=Gh(Vh,n),[y,S]=Q(null),v=st(e,$=>S($)),_=B(null),w=B(null),x=o||m.duration,C=B(0),E=B(x),I=B(0),{onToastAdd:T,onToastRemove:k}=m,D=Vt(()=>{var z;(y==null?void 0:y.contains(document.activeElement))&&((z=m.viewport)==null||z.focus()),s()}),A=V($=>{!$||$===1/0||(window.clearTimeout(I.current),C.current=new Date().getTime(),I.current=window.setTimeout(D,$))},[D]);q(()=>{const $=m.viewport;if($){const z=()=>{A(E.current),l==null||l()},R=()=>{const W=new Date().getTime()-C.current;E.current=E.current-W,window.clearTimeout(I.current),c==null||c()};return $.addEventListener(Cm,R),$.addEventListener(Em,z),()=>{$.removeEventListener(Cm,R),$.removeEventListener(Em,z)}}},[m.viewport,x,c,l,A]),q(()=>{i&&!m.isClosePausedRef.current&&A(x)},[i,x,m.isClosePausedRef,A]),q(()=>(T(),()=>k()),[T,k]);const O=ce(()=>y?Ok(y):null,[y]);return m.viewport?u(Z,{children:[O&&u(kY,{__scopeToast:n,role:"status","aria-live":r==="foreground"?"assertive":"polite","aria-atomic":!0,children:O}),u(CY,{scope:n,onClose:D,children:oS(u(nv.ItemSlot,{scope:n,children:u(QG,{asChild:!0,onEscapeKeyDown:se(a,()=>{m.isFocusedToastEscapeKeyDownRef.current||D(),m.isFocusedToastEscapeKeyDownRef.current=!1}),children:u(Le.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":m.swipeDirection,...g,ref:v,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:se(t.onKeyDown,$=>{$.key==="Escape"&&(a==null||a($.nativeEvent),$.nativeEvent.defaultPrevented||(m.isFocusedToastEscapeKeyDownRef.current=!0,D()))}),onPointerDown:se(t.onPointerDown,$=>{$.button===0&&(_.current={x:$.clientX,y:$.clientY})}),onPointerMove:se(t.onPointerMove,$=>{if(!_.current)return;const z=$.clientX-_.current.x,R=$.clientY-_.current.y,W=!!w.current,j=["left","right"].includes(m.swipeDirection),G=["left","up"].includes(m.swipeDirection)?Math.min:Math.max,le=j?G(0,z):0,he=j?0:G(0,R),ve=$.pointerType==="touch"?10:2,me={x:le,y:he},Be={originalEvent:$,delta:me};W?(w.current=me,Jl(xY,h,Be,{discrete:!1})):x1(me,m.swipeDirection,ve)?(w.current=me,Jl(_Y,d,Be,{discrete:!1}),$.target.setPointerCapture($.pointerId)):(Math.abs(z)>ve||Math.abs(R)>ve)&&(_.current=null)}),onPointerUp:se(t.onPointerUp,$=>{const z=w.current,R=$.target;if(R.hasPointerCapture($.pointerId)&&R.releasePointerCapture($.pointerId),w.current=null,_.current=null,z){const W=$.currentTarget,j={originalEvent:$,delta:z};x1(z,m.swipeDirection,m.swipeThreshold)?Jl(IY,f,j,{discrete:!0}):Jl(PY,p,j,{discrete:!0}),W.addEventListener("click",G=>G.preventDefault(),{once:!0})}})})})}),m.viewport)})]}):null}),kY=t=>{const{__scopeToast:e,children:n,...r}=t,o=Gh(Vh,e),[i,s]=Q(!1),[a,c]=Q(!1);return OY(()=>s(!0)),q(()=>{const l=window.setTimeout(()=>c(!0),1e3);return()=>window.clearTimeout(l)},[]),a?null:u(ll,{asChild:!0,children:u(ev,{...r,children:i&&u(Z,{children:[o.label," ",n]})})})},MY="ToastTitle",Ck=X((t,e)=>{const{__scopeToast:n,...r}=t;return u(Le.div,{...r,ref:e})});Ck.displayName=MY;var AY="ToastDescription",Ek=X((t,e)=>{const{__scopeToast:n,...r}=t;return u(Le.div,{...r,ref:e})});Ek.displayName=AY;var Tk="ToastAction",kk=X((t,e)=>{const{altText:n,...r}=t;return n.trim()?u(Ak,{altText:n,asChild:!0,children:u(rv,{...r,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${Tk}\`. Expected non-empty \`string\`.`),null)});kk.displayName=Tk;var Mk="ToastClose",rv=X((t,e)=>{const{__scopeToast:n,...r}=t,o=EY(Mk,n);return u(Ak,{asChild:!0,children:u(Le.button,{type:"button",...r,ref:e,onClick:se(t.onClick,o.onClose)})})});rv.displayName=Mk;var Ak=X((t,e)=>{const{__scopeToast:n,altText:r,...o}=t;return u(Le.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...o,ref:e})});function Ok(t){const e=[];return Array.from(t.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&e.push(r.textContent),DY(r)){const o=r.ariaHidden||r.hidden||r.style.display==="none",i=r.dataset.radixToastAnnounceExclude==="";if(!o)if(i){const s=r.dataset.radixToastAnnounceAlt;s&&e.push(s)}else e.push(...Ok(r))}}),e}function Jl(t,e,n,{discrete:r}){const o=n.originalEvent.currentTarget,i=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:n});e&&o.addEventListener(t,e,{once:!0}),r?VS(o,i):o.dispatchEvent(i)}var x1=(t,e,n=0)=>{const r=Math.abs(t.x),o=Math.abs(t.y),i=r>o;return e==="left"||e==="right"?i&&r>n:!i&&o>n};function OY(t=()=>{}){const e=Vt(t);li(()=>{let n=0,r=0;return n=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(r)}},[e])}function DY(t){return t.nodeType===t.ELEMENT_NODE}function $Y(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function Rf(t){const e=document.activeElement;return t.some(n=>n===e?!0:(n.focus(),document.activeElement!==e))}var RY=Ik,LY=Ck,NY=Ek,FY=kk,P1=rv;const Dk=Ze(null);function zY({children:t}){const e=tI("toasts",[]),n=ce(()=>({toasts:e,addToast(r){const o=r.id??Ye();return e.update(i=>[...i.filter(s=>s.id!==r.id),{...r,id:o}]),o},removeToast(r){return e.update(o=>o.filter(i=>i.id!==r)),r},clearToasts(){e.set([])}}),[e]);return u(wk,{children:u(Dk.Provider,{value:n,children:t})})}function to(){const t=tt(Dk);if(!t)throw new Error("useToasts must be used within a ToastsProvider");return t}const $k=Ze(null);function BY({assetUrls:t,children:e}){return q(()=>{for(const n of Object.values(t.icons)){const r=xc();r.src=n,r.decode()}for(const n of Object.values(t.embedIcons)){const r=xc();r.src=n,r.decode()}},[t]),u($k.Provider,{value:t,children:e})}function ov(){const t=tt($k);if(!t)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return t}const km={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-json.short":"JSON","action.export-all-as-json":"Export as JSON","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.url.failed":"Couldn't load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","tool.pointer-down":"Pointer down","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.help":"Help","menu.view":"View","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy editor link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project…","share-menu.copied":"Copied link","document-name-menu.copy-link":"Copy link","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About tldraw","help-menu.docs":"Documentation & API","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","help-menu.terms":"Terms of service","help-menu.privacy":"Privacy policy","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},UY=new Set(["ar","fa","he","ur","ku"]),ws={locale:"en",label:"English",messages:km,dir:"ltr"};async function HY(t,e){if(!(await Pr(e.translations.en)).ok)return console.warn("No main translations found."),ws;if(t==="en")return ws;const r=Tc.find(a=>a.locale===t);if(!r)return console.warn(`No translation found for locale ${t}`),ws;const i=await(await Pr(e.translations[r.locale])).json();if(!i)return console.warn(`No messages found for locale ${t}`),ws;const s=[];for(const a in ws.messages)i[a]||s.push(a);return s.length>0,{locale:t,label:r.label,dir:UY.has(r.locale)?"rtl":"ltr",messages:{...ws.messages,...i}}}const Rk=Ze(null);function Lk(){const t=tt(Rk);if(!t)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return t}function jY({overrides:t,locale:e,children:n}){const r=ov(),[o,i]=Q(()=>t&&t.en?{locale:"en",label:"English",dir:"ltr",messages:{...km,...t.en}}:{locale:"en",label:"English",dir:"ltr",messages:km});return q(()=>{let s=!1;async function a(){const c=await HY(e,r);c&&!s&&(t&&t[e]?i({...c,messages:{...c.messages,...t[e]}}):i(c))}return a(),()=>{s=!0}},[r,e,t]),u(Rk.Provider,{value:o,children:n})}function Ae(){const t=Lk();return V(function(n){return t.messages[n]??n},[t])}const ue=X(function({children:e,disabled:n,type:r,...o},i){return u("button",{ref:i,type:"button",draggable:!1,disabled:n,...o,className:de("tlui-button",`tlui-button__${r}`,o.className),children:e})});function It({children:t}){return u("span",{className:"tlui-button__label",children:t})}const Xr=$e(function({small:e,invertIcon:n,icon:r,color:o,className:i,...s}){const a=ov(),c=a.icons[r]??a.icons["question-mark-circle"],l=B(null);return je(()=>{c||console.error(`Icon not found: ${r}. Add it to the assetUrls.icons object.`),l!=null&&l.current&&(l.current.style.webkitMask=`url(${c}) center 100% / 100% no-repeat`)},[l,c,r]),r==="none"?u("div",{className:de("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":e},i)}):u("div",{...s,ref:l,className:de("tlui-icon",{"tlui-icon__small":e},i),style:{color:o,mask:`url(${c}) center 100% / 100% no-repeat`,transform:n?"scale(-1, 1)":void 0}})}),KY=4e3,WY={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function GY({toast:t}){const{removeToast:e}=to(),n=Ae(),r=s=>{s||e(t.id)},o=t.actions&&t.actions.length>0,i=t.icon||t.severity&&WY[t.severity];return u(RY,{onOpenChange:r,className:"tlui-toast__container",duration:t.keepOpen?1/0:KY,"data-severity":t.severity,children:[i&&u("div",{className:"tlui-toast__icon",children:u(Xr,{icon:i})}),u("div",{className:"tlui-toast__main",children:[u("div",{className:"tlui-toast__content",children:[t.title&&u(LY,{className:"tlui-toast__title",children:t.title}),t.description&&u(NY,{className:"tlui-toast__description",children:t.description})]}),t.actions&&u("div",{className:"tlui-toast__actions",children:[t.actions.map((s,a)=>u(FY,{altText:s.label,asChild:!0,onClick:s.onClick,children:u(ue,{type:s.type,children:u(It,{children:s.label})})},a)),u(P1,{asChild:!0,children:u(ue,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:u(It,{children:t.closeLabel??n("toast.close")})})})]})]}),!o&&u(P1,{asChild:!0,children:u(ue,{type:"normal",className:"tlui-toast__close",children:u(It,{children:t.closeLabel??n("toast.close")})})})]})}const VY=$e(function(){const{toasts:e}=to(),n=U("toasts",()=>e.get(),[]);return u(Z,{children:[n.map(r=>u(GY,{toast:r},r.id)),u(xk,{className:"tlui-toast__viewport"})]})});function rt(t,e){var o;const n=new Set;for(const i of e){const s=t.getShape(i);if(!s)continue;t.getShapeUtil(s).onDragShapesOut&&n.add(s);const a=t.getShape(s.parentId);a&&t.getShapeUtil(a).onDragShapesOut&&n.add(a)}const r=new Map;for(const i of n){const s=Nk(t,i);s.length&&r.set(i,s)}for(const[i,s]of r){const a=t.getShapeUtil(i),c=be(s.map(l=>t.getShape(l)));(o=a.onDragShapesOut)==null||o.call(a,i,c)}}function Nk(t,e){const n=t.getSortedChildIdsForParent(e.id);if(n.length===0)return[];const r=t.getShapePageBounds(e);if(!r)return[];let o,i,s;const a=[];for(const c of n){const l=t.getShapePageBounds(c);if(!l)continue;if(!r.includes(l)){a.push(c);continue}o??(o=t.getShapeGeometry(e)),i??(i=t.getShapePageTransform(e)),s??(s=i.applyToPoints(o.vertices));const d=t.getShapePageTransform(c).clone().invert().applyToPoints(s),{vertices:h,isClosed:p}=t.getShapeGeometry(c);if(!h.some(f=>Vn(f,d))){if(p){if(LC(d,h))continue}else if(ZH(d,h))continue;a.push(c)}}return a}function Fu(t,e,n=!1){t.select(e),t.setEditingShape(e),t.setCurrentTool("select.editing_shape",{target:"shape",shape:e}),n&&t.emit("select-all-text",{shapeId:e.id}),Fk(t)}const YY=16;function Fk(t){const e=t.getSelectionPageBounds(),n=t.getViewportPageBounds();if(e&&!n.contains(e)){const r=e.clone().expandBy(YY/t.getZoomLevel()).expand(n),o=n.clone().translate({x:(r.center.x-n.center.x)*2,y:(r.center.y-n.center.y)*2});t.zoomToBounds(o,{animation:{duration:t.options.animationMediumMs},inset:0})}}function XY(t,e){const n=be(e.map(o=>t.getShape(o)).filter(o=>o&&t.isShapeOfType(o,"frame")));if(!n.length)return;const r=[];t.run(()=>{n.map(o=>{const i=t.getSortedChildIdsForParent(o.id);i.length&&(t.reparentShapes(i,o.parentId,o.index),r.push(...i))}),t.setSelectedShapes(r),t.deleteShapes(e)})}const qY=50;function ZY(t,e,n={}){const r=t.getShape(e);if(!r)return;const o=t.getSortedChildIdsForParent(r.id),i=be(o.map(f=>t.getShape(f)));if(!i.length)return;const s=ee.FromPoints(i.flatMap(f=>{const g=t.getShapeGeometry(f.id);return t.getShapeLocalTransform(f).applyToPoints(g.vertices)})),{padding:a=qY}=n,c=s.w+2*a,l=s.h+2*a,d=a-s.minX,h=a-s.minY;if(d===0&&h===0&&r.props.w===c&&r.props.h===l)return;const p=new b(d,h).rot(r.rotation);t.run(()=>{const f=o.map(g=>{const m=t.getShape(g);return{id:m.id,type:m.type,x:m.x+d,y:m.y+h}});f.push({id:r.id,type:r.type,x:r.x-p.x,y:r.y-p.y,props:{w:c,h:l}}),t.updateShapes(f)})}function ke({icon:t,small:e,invertIcon:n}){return u(Xr,{className:"tlui-button__icon",icon:t,small:e,invertIcon:n})}function Yh({className:t,children:e}){return u("div",{className:de("tlui-dialog__header",t),children:e})}function Xh({className:t,children:e}){return u(uk,{dir:"ltr",className:de("tlui-dialog__header__title",t),children:e})}function qh(){return u("div",{className:"tlui-dialog__header__close",children:u(fk,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:u(ue,{type:"icon","aria-label":"Close",onTouchEnd:t=>t.target.click(),children:u(ke,{small:!0,icon:"cross-2"})})})})}function Mc({className:t,children:e,style:n}){return u("div",{className:de("tlui-dialog__body",t),style:n,children:e})}function iv({className:t,children:e}){return u("div",{className:de("tlui-dialog__footer",t),children:e})}const Zh=X(function({className:e,label:n,icon:r,iconLeft:o,autoSelect:i=!1,autoFocus:s=!1,defaultValue:a,placeholder:c,onComplete:l,onValueChange:d,onCancel:h,onFocus:p,onBlur:f,shouldManuallyMaintainScrollPositionWhenFocused:g=!1,children:m,value:y},S){const v=xS(),_=B(null);mh(S,()=>_.current);const w=Ae(),x=B(a??""),C=B(a??""),[E,I]=Q(!1),T=V(O=>{I(!0);const $=O.currentTarget;C.current=$.value,v?v.timers.requestAnimationFrame(()=>{i&&$.select()}):gm.requestAnimationFrame("anon",()=>{i&&$.select()}),p==null||p()},[i,v,p]),k=V(O=>{const $=O.currentTarget.value;C.current=$,d==null||d($)},[d]),D=V(O=>{switch(O.key){case"Enter":{O.currentTarget.blur(),Mt(O),l==null||l(O.currentTarget.value);break}case"Escape":{O.currentTarget.value=x.current,h==null||h(O.currentTarget.value),O.currentTarget.blur(),Mt(O);break}}},[l,h]),A=V(O=>{I(!1);const $=O.currentTarget.value;f==null||f($)},[f]);return q(()=>{if(!et.isIos)return;const O=window.visualViewport;if(E&&g&&O){const $=()=>{var z;(z=_.current)==null||z.scrollIntoView({block:"center"})};return O.addEventListener("resize",$),O.addEventListener("scroll",$),v?v.timers.requestAnimationFrame(()=>{var z;(z=_.current)==null||z.scrollIntoView({block:"center"})}):gm.requestAnimationFrame("anon",()=>{var z;(z=_.current)==null||z.scrollIntoView({block:"center"})}),()=>{O.removeEventListener("resize",$),O.removeEventListener("scroll",$)}}},[E,v,g]),u("div",{draggable:!1,className:"tlui-input__wrapper",children:[m,n&&u("label",{children:w(n)}),o&&u(Xr,{icon:o,className:"tlui-icon-left",small:!0}),u("input",{ref:_,className:de("tlui-input",e),type:"text",defaultValue:a,onKeyUp:D,onChange:k,onFocus:T,onBlur:A,autoFocus:s,placeholder:c,value:y}),r&&u(Xr,{icon:r,small:!!n})]})});function I1(t){return Xn.isValid(t)?{isValid:!0,hasProtocol:!0}:Xn.isValid("https://"+t)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const JY=Nt(function({onClose:e}){const r=F().getOnlySelectedShape();return r&&"url"in r.props&&typeof r.props.url=="string"?u(QY,{onClose:e,selectedShape:r}):null}),QY=Nt(function({onClose:e,selectedShape:n}){const r=F(),o=Ae(),i=B(null);q(()=>{r.timers.requestAnimationFrame(()=>{var g;return(g=i.current)==null?void 0:g.focus()})},[r]);const s=B(n.props.url),[a,c]=Q(()=>{const g=I1(n.props.url),m=g.isValid===!0?g.hasProtocol?n.props.url:"https://"+n.props.url:"https://";return{actual:m,safe:m,valid:!0}}),l=V(g=>{const m=g.replace(/https?:\/\/(https?:\/\/)/,(v,_)=>_),y=I1(m),S=y.isValid===!0?y.hasProtocol?m:"https://"+m:"https://";c({actual:m,safe:S,valid:y.isValid})},[]),d=V(()=>{const g=r.getOnlySelectedShape();g&&(r.updateShapes([{id:g.id,type:g.type,props:{url:""}}]),e())},[r,e]),h=V(()=>{const g=r.getOnlySelectedShape();g&&(g&&"url"in g.props&&g.props.url!==a.safe&&r.updateShapes([{id:g.id,type:g.type,props:{url:a.safe}}]),e())},[r,e,a]),p=V(()=>{e()},[e]);if(!n)return e(),null;const f=s.current&&!a.valid;return u(Z,{children:[u(Yh,{children:[u(Xh,{children:o("edit-link-dialog.title")}),u(qh,{})]}),u(Mc,{children:u("div",{className:"tlui-edit-link-dialog",children:[u(Zh,{ref:i,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,value:a.actual,onValueChange:l,onComplete:h,onCancel:p}),u("div",{children:a.valid?o("edit-link-dialog.detail"):o("edit-link-dialog.invalid-url")})]})}),u(iv,{className:"tlui-dialog__footer__actions",children:[u(ue,{type:"normal",onClick:p,onTouchEnd:p,children:u(It,{children:o("edit-link-dialog.cancel")})}),f?u(ue,{type:"danger",onTouchEnd:d,onClick:d,children:u(It,{children:o("edit-link-dialog.clear")})}):u(ue,{type:"primary",disabled:!a.valid,onTouchEnd:h,onClick:h,children:u(It,{children:o("edit-link-dialog.save")})})]})]})});var eX={};const C1=/(^\/r\/[^/]+\/?$)/,sv=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(C1))return t},fromEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(C1))return t}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{if(t.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!t.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${t}`},fromEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/^\/embed\/?$/)){const n=e.searchParams.get("url");if(n)return n}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:t=>{if(t.includes("/maps/")){const e=t.match(/@(.*),(.*),(.*)z/);let n;if(e){const[,r,o,i]=e;n=`https://${new URL(t).host.replace("www.","")}/maps/embed/v1/view?key=${eX.NEXT_PUBLIC_GC_API_KEY}&center=${r},${o}&zoom=${i}`}else n="";return n}},fromEmbedUrl:t=>{const e=ye(t);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom"),[o,i]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${o},${i},${r}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=ye(t),n=e&&e.pathname.match(/\/v\/(.+)\/?/);if(n)return`https://www.val.town/embed/${n[1]}`},fromEmbedUrl:t=>{const e=ye(t),n=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=ye(t),n=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(n)return`https://codesandbox.io/embed/${n[1]}`},fromEmbedUrl:t=>{const e=ye(t),n=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:t=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,n=t.match(e);if(n){const[r,o,i]=n;return`https://codepen.io/${o}/embed/${i}`}},fromEmbedUrl:t=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,n=t.match(e);if(n){const[r,o,i]=n;return`https://codepen.io/${o}/pen/${i}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:t=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,n=t.match(e);if(n){const[r,o]=n;return`https://scratch.mit.edu/projects/embed/${o}`}},fromEmbedUrl:t=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,n=t.match(e);if(n){const[r,o]=n;return`https://scratch.mit.edu/projects/${o}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:t=>{const e=ye(t);if(!e)return;const n=e.hostname.replace(/^www./,"");if(n==="youtu.be")return`https://www.youtube.com/embed/${e.pathname.split("/").filter(Boolean)[0]}`;if((n==="youtube.com"||n==="m.youtube.com")&&e.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${e.searchParams.get("v")}`},fromEmbedUrl:t=>{const e=ye(t);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r)return`https://www.youtube.com/watch?v=${r[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:t=>{const e=ye(t),n=e==null?void 0:e.searchParams.get("cid");if(e!=null&&e.pathname.match(/\/calendar\/u\/0/)&&n){e.pathname="/calendar/embed";const r=Array.from(e.searchParams.keys());for(const o of r)e.searchParams.delete(o);return e.searchParams.set("src",n),e.href}},fromEmbedUrl:t=>{const e=ye(t),n=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&n){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const o of r)e.searchParams.delete(o);return e.searchParams.set("cid",n),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:t=>{const e=ye(t);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/pub\/?$/))){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const n=Array.from(e.searchParams.keys());for(const r of n)e.searchParams.delete(r);return e.href}},fromEmbedUrl:t=>{const e=ye(t);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const n=Array.from(e.searchParams.keys());for(const r of n)e.searchParams.delete(r);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return t.split("/").pop()?t:void 0},fromEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return t.split("/").pop()?t:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${t}?embed=true`},fromEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:t=>{const e=ye(t);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:t=>{const e=ye(t);if(e&&e.hostname==="player.vimeo.com"){const n=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(n)return"https://vimeo.com/"+n[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:t=>{const e=ye(t);if(e&&e.hash.match(/#room=/))return t},fromEmbedUrl:t=>{const e=ye(t);if(e&&e.hash.match(/#room=/))return t}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const n=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${n}?cell=*`}},fromEmbedUrl:t=>{const e=ye(t);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:t=>{const e=ye(t);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search===""&&e.hash==="")return`${t}?embed`},fromEmbedUrl:t=>{const e=ye(t);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return t.replace("?embed","")}}],tX={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},nX=sv.map(t=>t.type);function rX(t){return nX.includes(t)}function oX(t){return"icon"in t}function zk(){return F().getShapeUtil("embed")}function av(){const t=zk();return e=>t?t.getEmbedDefinition(e):void 0}function iX(){const t=zk();return t?t.getEmbedDefinitions():[]}const Bk=Nt(function({onClose:e}){const n=F(),r=Ae(),o=ov(),[i,s]=Q(null),[a,c]=Q(""),[l,d]=Q(null),[h,p]=Q(!1),f=B(-1),g=iX(),m=av();return u(Z,{children:[u(Yh,{children:[u(Xh,{children:i?`${r("embed-dialog.title")} — ${i.title}`:r("embed-dialog.title")}),u(qh,{})]}),i?u(Z,{children:[u(Mc,{className:"tlui-embed-dialog__enter",children:[u(Zh,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autoFocus:!0,onValueChange:y=>{c(y);const S=m(a);d(S&&S.definition.type===i.type?S:null),p(!1),clearTimeout(f.current),f.current=n.timers.setTimeout(()=>p(!S),320)}}),a===""?u("div",{className:"tlui-embed-dialog__instruction",children:[u("span",{children:r("embed-dialog.instruction")})," ",i.instructionLink&&u("a",{target:"_blank",rel:"noopener noreferrer",href:i.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",u(Xr,{icon:"external-link",small:!0})]})]}):u("div",{className:"tlui-embed-dialog__warning",children:h?r("embed-dialog.invalid-url"):" "})]}),u(iv,{className:"tlui-dialog__footer__actions",children:[u(ue,{type:"normal",onClick:()=>{s(null),d(null),c("")},children:u(It,{children:r("embed-dialog.back")})}),u("div",{className:"tlui-embed__spacer"}),u(ue,{type:"normal",onClick:e,children:u(It,{children:r("embed-dialog.cancel")})}),u(ue,{type:"primary",disabled:!l,onClick:()=>{l&&(n.putExternalContent({type:"embed",url:a,point:n.getViewportPageBounds().center,embed:l.definition}),e())},children:u(It,{children:r("embed-dialog.create")})})]})]}):u(Z,{children:u(Mc,{className:"tlui-embed-dialog__list",children:g.map(y=>{const S=rX(y.type)?o.embedIcons[y.type]:oX(y)?y.icon:void 0;return u(ue,{type:"menu",onClick:()=>s(y),children:[u(It,{children:y.title}),S&&u("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${S})`}})]},y.type)})})})]})});var cv={exports:{}};cv.exports;(function(t){var e=function(){var n=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={};function s(c,l){if(!i[c]){i[c]={};for(var d=0;d<c.length;d++)i[c][c.charAt(d)]=d}return i[c][l]}var a={compressToBase64:function(c){if(c==null)return"";var l=a._compress(c,6,function(d){return r.charAt(d)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:a._decompress(c.length,32,function(l){return s(r,c.charAt(l))})},compressToUTF16:function(c){return c==null?"":a._compress(c,15,function(l){return n(l+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:a._decompress(c.length,16384,function(l){return c.charCodeAt(l)-32})},compressToUint8Array:function(c){for(var l=a.compress(c),d=new Uint8Array(l.length*2),h=0,p=l.length;h<p;h++){var f=l.charCodeAt(h);d[h*2]=f>>>8,d[h*2+1]=f%256}return d},decompressFromUint8Array:function(c){if(c==null)return a.decompress(c);for(var l=new Array(c.length/2),d=0,h=l.length;d<h;d++)l[d]=c[d*2]*256+c[d*2+1];var p=[];return l.forEach(function(f){p.push(n(f))}),a.decompress(p.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":a._compress(c,6,function(l){return o.charAt(l)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),a._decompress(c.length,32,function(l){return s(o,c.charAt(l))}))},compress:function(c){return a._compress(c,16,function(l){return n(l)})},_compress:function(c,l,d){if(c==null)return"";var h,p,f={},g={},m="",y="",S="",v=2,_=3,w=2,x=[],C=0,E=0,I;for(I=0;I<c.length;I+=1)if(m=c.charAt(I),Object.prototype.hasOwnProperty.call(f,m)||(f[m]=_++,g[m]=!0),y=S+m,Object.prototype.hasOwnProperty.call(f,y))S=y;else{if(Object.prototype.hasOwnProperty.call(g,S)){if(S.charCodeAt(0)<256){for(h=0;h<w;h++)C=C<<1,E==l-1?(E=0,x.push(d(C)),C=0):E++;for(p=S.charCodeAt(0),h=0;h<8;h++)C=C<<1|p&1,E==l-1?(E=0,x.push(d(C)),C=0):E++,p=p>>1}else{for(p=1,h=0;h<w;h++)C=C<<1|p,E==l-1?(E=0,x.push(d(C)),C=0):E++,p=0;for(p=S.charCodeAt(0),h=0;h<16;h++)C=C<<1|p&1,E==l-1?(E=0,x.push(d(C)),C=0):E++,p=p>>1}v--,v==0&&(v=Math.pow(2,w),w++),delete g[S]}else for(p=f[S],h=0;h<w;h++)C=C<<1|p&1,E==l-1?(E=0,x.push(d(C)),C=0):E++,p=p>>1;v--,v==0&&(v=Math.pow(2,w),w++),f[y]=_++,S=String(m)}if(S!==""){if(Object.prototype.hasOwnProperty.call(g,S)){if(S.charCodeAt(0)<256){for(h=0;h<w;h++)C=C<<1,E==l-1?(E=0,x.push(d(C)),C=0):E++;for(p=S.charCodeAt(0),h=0;h<8;h++)C=C<<1|p&1,E==l-1?(E=0,x.push(d(C)),C=0):E++,p=p>>1}else{for(p=1,h=0;h<w;h++)C=C<<1|p,E==l-1?(E=0,x.push(d(C)),C=0):E++,p=0;for(p=S.charCodeAt(0),h=0;h<16;h++)C=C<<1|p&1,E==l-1?(E=0,x.push(d(C)),C=0):E++,p=p>>1}v--,v==0&&(v=Math.pow(2,w),w++),delete g[S]}else for(p=f[S],h=0;h<w;h++)C=C<<1|p&1,E==l-1?(E=0,x.push(d(C)),C=0):E++,p=p>>1;v--,v==0&&(v=Math.pow(2,w),w++)}for(p=2,h=0;h<w;h++)C=C<<1|p&1,E==l-1?(E=0,x.push(d(C)),C=0):E++,p=p>>1;for(;;)if(C=C<<1,E==l-1){x.push(d(C));break}else E++;return x.join("")},decompress:function(c){return c==null?"":c==""?null:a._decompress(c.length,32768,function(l){return c.charCodeAt(l)})},_decompress:function(c,l,d){var h=[],p=4,f=4,g=3,m="",y=[],S,v,_,w,x,C,E,I={val:d(0),position:l,index:1};for(S=0;S<3;S+=1)h[S]=S;for(_=0,x=Math.pow(2,2),C=1;C!=x;)w=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=d(I.index++)),_|=(w>0?1:0)*C,C<<=1;switch(_){case 0:for(_=0,x=Math.pow(2,8),C=1;C!=x;)w=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=d(I.index++)),_|=(w>0?1:0)*C,C<<=1;E=n(_);break;case 1:for(_=0,x=Math.pow(2,16),C=1;C!=x;)w=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=d(I.index++)),_|=(w>0?1:0)*C,C<<=1;E=n(_);break;case 2:return""}for(h[3]=E,v=E,y.push(E);;){if(I.index>c)return"";for(_=0,x=Math.pow(2,g),C=1;C!=x;)w=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=d(I.index++)),_|=(w>0?1:0)*C,C<<=1;switch(E=_){case 0:for(_=0,x=Math.pow(2,8),C=1;C!=x;)w=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=d(I.index++)),_|=(w>0?1:0)*C,C<<=1;h[f++]=n(_),E=f-1,p--;break;case 1:for(_=0,x=Math.pow(2,16),C=1;C!=x;)w=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=d(I.index++)),_|=(w>0?1:0)*C,C<<=1;h[f++]=n(_),E=f-1,p--;break;case 2:return y.join("")}if(p==0&&(p=Math.pow(2,g),g++),h[E])m=h[E];else if(E===f)m=v+v.charAt(0);else return null;y.push(m),h[f++]=v+m.charAt(0),p--,v=m,p==0&&(p=Math.pow(2,g),g++)}}};return a}();t!=null?t.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(cv);var sX=cv.exports;const Uk=ts(sX);async function aX(t,e,n){var S,v,_;const{elements:r,files:o}=e,i={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:t.store.schema.serialize()},s=new Map,a=new Map,c=t.getCurrentPageId(),l=new Map,d=[],h=new Set;r.forEach(w=>{if(l.set(w.id,Xe()),w.boundElements!==null)for(const x of w.boundElements)x.type==="text"&&h.add(x.id)});let p=Tx;for(const w of r){if(h.has(w.id))continue;const x=l.get(w.id),C={id:x,typeName:"shape",parentId:c,index:p,x:w.x,y:w.y,rotation:0,isLocked:w.locked,opacity:cX(w.opacity),meta:{}};switch(w.angle!==0&&a.set(x,w.angle),w.groupIds&&w.groupIds.length>0?s.has(w.groupIds[0])?(S=s.get(w.groupIds[0]))==null||S.push(x):s.set(w.groupIds[0],[x]):d.push(x),w.type){case"rectangle":case"ellipse":case"diamond":{let E="",I="middle";if(w.boundElements!==null){for(const k of w.boundElements)if(k.type==="text"){const D=r.find(A=>A.id===k.id);D&&(E=D.text,I=fX[D.textAlign])}}const T=w.backgroundColor==="transparent"?w.strokeColor:w.backgroundColor;i.shapes.push({...C,type:"geo",props:{geo:w.type,url:w.link??"",w:w.width,h:w.height,size:Ql[w.strokeWidth]??"draw",color:Ka[T]??"black",text:E,align:I,dash:ed(w),fill:yX(w)}});break}case"freedraw":{i.shapes.push({...C,type:"draw",props:{dash:ed(w),size:Ql[w.strokeWidth],color:Ka[w.strokeColor]??"black",segments:[{type:"free",points:w.points.map(([E,I,T=.5])=>({x:E,y:I,z:T}))}]}});break}case"line":{if(w.points.slice().length<2)break;const I=Ic(w.points.length);i.shapes.push({...C,type:"line",props:{dash:ed(w),size:Ql[w.strokeWidth],color:Ka[w.strokeColor]??"black",spline:w.roundness?"cubic":"line",points:{...Object.fromEntries(w.points.map(([T,k],D)=>{const A=I[D];return[A,{id:A,index:A,x:T,y:k}]}))}}});break}case"arrow":{let E="";if(w.boundElements!==null){for(const A of w.boundElements)if(A.type==="text"){const O=r.find($=>$.id===A.id);O&&(E=O.text)}}const I=w.points[0],T=w.points[w.points.length-1],k=l.get((v=w.startBinding)==null?void 0:v.elementId),D=l.get((_=w.endBinding)==null?void 0:_.elementId);i.shapes.push({...C,type:"arrow",props:{text:E,bend:mX(w,I,T),dash:ed(w),size:Ql[w.strokeWidth]??"m",color:Ka[w.strokeColor]??"black",start:{x:I[0],y:I[1]},end:{x:T[0],y:T[1]},arrowheadEnd:E1[w.endArrowhead]??"none",arrowheadStart:E1[w.startArrowhead]??"none"}}),k&&i.bindings.push({id:Ni(),typeName:"binding",type:"arrow",fromId:x,toId:k,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),D&&i.bindings.push({id:Ni(),typeName:"binding",type:"arrow",fromId:x,toId:D,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size:E,scale:I}=dX(w.fontSize);i.shapes.push({...C,type:"text",props:{size:E,scale:I,font:uX[w.fontFamily]??"draw",color:Ka[w.strokeColor]??"black",text:w.text,textAlign:gX[w.textAlign]}});break}case"image":{const E=o[w.fileId];if(!E)break;const I=qo.createId();i.assets.push({id:I,typeName:"asset",type:"image",props:{w:w.width,h:w.height,fileSize:E.size,name:w.id??"Untitled",isAnimated:!1,mimeType:E.mimeType,src:E.dataURL},meta:{}}),i.shapes.push({...C,type:"image",props:{w:w.width,h:w.height,assetId:I}})}}p=Br(p)}const f=n??(t.inputs.shiftKey?t.inputs.currentPagePoint:void 0);t.markHistoryStoppingPoint("paste"),t.putContentOntoCurrentPage(i,{point:f,select:!1,preserveIds:!0});for(const w of s.values())if(w.length>1){t.groupShapes(w);const x=t.getShape(w[0]);x!=null&&x.parentId&&In(x.parentId)&&d.push(x.parentId)}for(const[w,x]of a)t.select(w),t.rotateShapesBy([w],x);const g=be(d.map(w=>t.getShape(w))),m=ee.Common(g.map(w=>t.getShapePageBounds(w))),y=t.getViewportPageBounds().center;t.updateShapes(g.map(w=>{const x={x:(w.x??0)-(m.x+m.w/2),y:(w.y??0)-(m.y+m.h/2)};return{id:w.id,type:w.type,x:y.x+x.x,y:y.y+x.y}})),t.setSelectedShapes(d)}const cX=t=>{const e=t/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},Ql={1:"s",2:"m",3:"l",4:"xl"},lX={16:"s",20:"m",28:"l",36:"xl"};function dX(t){const e=lX[t];return e?{size:e,scale:1}:t<16?{size:"s",scale:t/16}:t>36?{size:"xl",scale:t/36}:{size:"m",scale:1}}const uX={1:"draw",2:"sans",3:"mono"},Ka={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},hX={solid:"draw",dashed:"dashed",dotted:"dotted"},pX={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},fX={left:"start",center:"middle",right:"end"},gX={left:"start",center:"middle",right:"end"},E1={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function mX(t,e,n){let r=0;if(t.points.length>2){const o=new b(e[0],e[1]),i=new b(n[0],n[1]),s=new b(t.points[1][0],t.points[1][1]),a=b.Sub(i,o),c=b.Per(a),l=b.Med(i,o),d=b.Sub(l,c),h=b.Add(l,c),p=b.NearestPointOnLineSegment(d,h,s,!1);r=b.Dist(p,l),b.Clockwise(p,i,l)&&(r*=-1)}return r}const ed=t=>{let e=hX[t.strokeStyle]??"draw";return e==="draw"&&t.roughness===0&&(e="solid"),e},yX=t=>t.backgroundColor==="transparent"?"none":pX[t.fillStyle]??"solid";async function SX(t,e,n,r){const i=(await Promise.all(e.map(async s=>await(await Pr(s)).blob()))).map(s=>new File([s],"tldrawFile",{type:s.type}));t.markHistoryStoppingPoint("paste"),await t.putExternalContent({type:"files",files:i,point:n,ignoreParent:!1,sources:r}),e.forEach(s=>URL.revokeObjectURL(s))}function vX(t,e,n){const r=t.getSelectionPageBounds();t.markHistoryStoppingPoint("paste"),t.putContentOntoCurrentPage(e,{point:n,select:!0});const o=t.getSelectionPageBounds();r&&o&&(r!=null&&r.collides(o))&&(t.updateInstanceState({isChangingStyle:!0}),t.timers.setTimeout(()=>{t.updateInstanceState({isChangingStyle:!1})},150))}async function Mm(t,e,n,r){return t.markHistoryStoppingPoint("paste"),await t.putExternalContent({type:"url",point:n,url:e,sources:r})}function bX(t){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=t.trim(),e.body.textContent||e.body.innerText||""}const wX=t=>{try{const e=new URL(t);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},_X=t=>{const e=t.split(/[\n\s]/);for(const n of e)try{const r=new URL(n);if(!(r.protocol==="http:"||r.protocol==="https:"))return}catch{return}return lC(e)},xX=t=>/^<svg/.test(t),PX=["input","select","textarea"];function Lf(t){const{activeElement:e}=document;return t.menus.hasAnyOpenMenus()||e&&(e.getAttribute("contenteditable")||PX.indexOf(e.tagName.toLowerCase())>-1)}const IX=t=>t.types.find(e=>e.match(/^image\//)),Nf=(t,e,n,r)=>{const o=_X(e);if(o)for(const i of o)Mm(t,i,n);else wX(e)?Mm(t,e,n):xX(e)?(t.markHistoryStoppingPoint("paste"),t.putExternalContent({type:"svg-text",text:e,point:n,sources:r})):(t.markHistoryStoppingPoint("paste"),t.putExternalContent({type:"text",text:e,point:n,sources:r}))},CX=async(t,e,n)=>{if(t.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const r=[];for(const o of Object.values(e.items))switch(o.kind){case"file":{r.push({type:"file",source:new Promise(i=>i(o.getAsFile()))});break}case"string":{o.type==="text/html"?r.push({type:"html",source:new Promise(i=>o.getAsString(i))}):o.type==="text/plain"?r.push({type:"text",source:new Promise(i=>o.getAsString(i))}):r.push({type:o.type,source:new Promise(i=>o.getAsString(i))});break}}jk(t,r,n)},Hk=async(t,e,n)=>{const r=[];for(const o of e){if(IX(o))for(const i of o.types)i.match(/^image\//)&&r.push({type:"blob",source:o.getType(i)});o.types.includes("text/html")&&r.push({type:"html",source:(async()=>{const i=await o.getType("text/html");return await wo.blobToText(i)})()}),o.types.includes("text/uri-list")&&r.push({type:"url",source:(async()=>{const i=await o.getType("text/uri-list");return await wo.blobToText(i)})()}),o.types.includes("text/plain")&&r.push({type:"text",source:(async()=>{const i=await o.getType("text/plain");return await wo.blobToText(i)})()})}return await jk(t,r,n)};async function jk(t,e,n){const r=e.filter(i=>(i.type==="file"||i.type==="blob")&&i.source!==null);if(r.length){if(r.length>t.options.maxFilesAtOnce)throw Error("Too many files");const s=(await Promise.all(r.map(a=>a.source))).filter(Boolean).map(a=>URL.createObjectURL(a));return await SX(t,s,n)}const o=await Promise.all(e.filter(i=>i.type!=="file").map(i=>new Promise(s=>{const a=i;if(a.type==="file"){s({type:"error",data:null,reason:"unexpected file"});return}a.source.then(c=>{var d;const l=(d=c.match(/<div data-tldraw[^>]*>(.*)<\/div>/))==null?void 0:d[1];if(l)try{const h=Uk.decompressFromBase64(l);if(h===null){s({type:"error",data:h,reason:"found tldraw data comment but could not parse base64"});return}else{const p=JSON.parse(h);if(p.type!=="application/tldraw"&&s({type:"error",data:p,reason:`found tldraw data comment but JSON was of a different type: ${p.type}`}),typeof p.data=="string"){s({type:"error",data:p,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}s({type:"tldraw",data:p.data});return}}catch{s({type:"error",data:l,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){s({type:"text",data:c,subtype:"html"});return}if(a.type==="url"){s({type:"text",data:c,subtype:"url"});return}try{const h=JSON.parse(c);if(h.type==="excalidraw/clipboard"){s({type:"excalidraw",data:h});return}else{s({type:"text",data:c,subtype:"json"});return}}catch{s({type:"text",data:c,subtype:"text"});return}}s({type:"error",data:c,reason:"unhandled case"})})})));for(const i of o)if(i.type==="tldraw"){vX(t,i.data,n);return}for(const i of o)if(i.type==="excalidraw"){aX(t,i.data,n);return}for(const i of o)if(i.type==="text"&&i.subtype==="html"){const a=new DOMParser().parseFromString(i.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(l=>l.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="A"&&a.firstElementChild.hasAttribute("href")&&a.firstElementChild.getAttribute("href")!==""){const l=a.firstElementChild.getAttribute("href");Nf(t,l,n,o);return}if(!o.some(l=>l.type==="text"&&l.subtype!=="html")&&i.data.trim()){Nf(t,bX(i.data),n,o);return}}for(const i of o)if(i.type==="text"&&i.subtype==="url"){Mm(t,i.data,n,o);return}for(const i of o)if(i.type==="text"&&i.subtype==="text"&&i.data.trim()){Nf(t,i.data,n,o);return}}const zu=async t=>{var r;const e=await t.resolveAssetsInContent(t.getContentFromCurrentPage(t.getSelectedShapeIds()));if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const n=Uk.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:e}));if(!(typeof navigator>"u")){const o=e.shapes.map(i=>t.getShapeUtil(i).getText(i)).filter(d5);if((r=navigator.clipboard)!=null&&r.write){const i=new Blob([`<div data-tldraw>${n}</div>`],{type:"text/html"});let s=o.join(" ");s===""&&(s=" "),navigator.clipboard.write([new ClipboardItem({"text/html":i,"text/plain":new Blob([s],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${n}</div>`)}};function EX(){const t=F(),e=Xt(),n=V(async function(s){t.getSelectedShapeIds().length!==0&&(await zu(t),e("copy",{source:s}))},[t,e]),r=V(async function(s){t.getSelectedShapeIds().length!==0&&(await zu(t),t.deleteShapes(t.getSelectedShapeIds()),e("cut",{source:s}))},[t,e]),o=V(async function(s,a,c){t.getEditingShapeId()===null&&(Array.isArray(s)&&s[0]instanceof ClipboardItem?(Hk(t,s,c),e("paste",{source:"menu"})):navigator.clipboard.read().then(l=>{o(l,a,c)}))},[t,e]);return{copy:n,cut:r,paste:o}}function TX(){const t=F(),e=Xt(),n=U("editor.isFocused",()=>t.getInstanceState().isFocused,[t]);q(()=>{if(!n)return;const r=async c=>{t.getSelectedShapeIds().length===0||t.getEditingShapeId()!==null||Lf(t)||(Ce(c),await zu(t),e("copy",{source:"kbd"}))};async function o(c){t.getSelectedShapeIds().length===0||t.getEditingShapeId()!==null||Lf(t)||(Ce(c),await zu(t),t.deleteShapes(t.getSelectedShapeIds()),e("cut",{source:"kbd"}))}let i=!1;const s=c=>{c.button===1&&(i=!0,t.timers.requestAnimationFrame(()=>{i=!1}))},a=c=>{if(i){Mt(c);return}if(t.getEditingShapeId()!==null||Lf(t))return;let l,d=!1;t.inputs.shiftKey&&(d=!0),t.user.getIsPasteAtCursorMode()&&(d=!d),d&&(l=t.inputs.currentPagePoint),c.clipboardData&&!t.inputs.shiftKey?CX(t,c.clipboardData,l):navigator.clipboard.read().then(h=>{Array.isArray(h)&&h[0]instanceof ClipboardItem&&Hk(t,h,l)}),Ce(c),e("paste",{source:"kbd"})};return document.addEventListener("copy",r),document.addEventListener("cut",o),document.addEventListener("paste",a),document.addEventListener("pointerup",s),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",o),document.removeEventListener("paste",a),document.removeEventListener("pointerup",s)}},[t,e,n])}/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function kX(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,o,i,s,a=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(d){l=!0,o=d}finally{try{if(!c&&n.return!=null&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw o}}return a}}function T1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,r)}return n}function Bn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?T1(Object(n),!0).forEach(function(r){MX(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T1(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function MX(t,e,n){return e=zX(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function AX(t,e){if(t==null)return{};var n={},r=Object.keys(t),o,i;for(i=0;i<r.length;i++)o=r[i],!(e.indexOf(o)>=0)&&(n[o]=t[o]);return n}function OX(t,e){if(t==null)return{};var n=AX(t,e),r,o;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(o=0;o<i.length;o++)r=i[o],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function k1(t,e){return $X(t)||kX(t,e)||Kk(t,e)||NX()}function td(t){return DX(t)||RX(t)||Kk(t)||LX()}function DX(t){if(Array.isArray(t))return Am(t)}function $X(t){if(Array.isArray(t))return t}function RX(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Kk(t,e){if(t){if(typeof t=="string")return Am(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Am(t,e)}}function Am(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function LX(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function NX(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FX(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function zX(t){var e=FX(t,"string");return typeof e=="symbol"?e:String(e)}function gc(t){var e=t.sizes.shift(),n=Math.max(Math.ceil(e[0]),1),r=Math.max(Math.ceil(e[1]),1),o=[n-1,r-1,1,1],i=Date.now(),s=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,a,c;s?(a=new OffscreenCanvas(1,1),c=new OffscreenCanvas(n,r)):(a=document.createElement("canvas"),a.width=1,a.height=1,c=document.createElement("canvas"),c.width=n,c.height=r);var l=a.getContext("2d"),d=c.getContext("2d");d&&(d.fillRect.apply(d,o),l.drawImage(c,n-1,r-1,1,1,0,0,1,1));var h=l&&l.getImageData(0,0,1,1).data[3]!==0,p=Date.now()-i;return[a,c].forEach(function(f){f.height=0,f.width=0}),s?(postMessage({width:n,height:r,benchmark:p,isTestPass:h}),!h&&t.sizes.length&&gc(t)):h?t.onSuccess(n,r,p):(t.onError(n,r,p),t.sizes.length&&gc(t)),h}var Ff={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},BX=["onError","onSuccess"],$s={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Wa={};function zf(t){var e=t.width===t.height,n=t.height===1,r=t.width===1,o=[];if(!t.width||!t.height)t.sizes.forEach(function(d){var h=e||n?d:1,p=e||r?d:1;o.push([h,p])});else for(var i=t.min||$s.min,s=t.step||$s.step,a=Math.max(t.width,t.height);a>=i;){var c=e||n?a:1,l=e||r?a:1;o.push([c,l]),a-=s}return o}function nd(t){var e=window&&"HTMLCanvasElement"in window,n=window&&"OffscreenCanvas"in window,r=Date.now(),o=t.onError,i=t.onSuccess,s=OX(t,BX),a=null;if(!e)return!1;if(t.useWorker&&n){var c=`
            var canvasTest = `.concat(gc.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),l=new Blob([c],{type:"application/javascript"}),d=URL.createObjectURL(l);a=new Worker(d),URL.revokeObjectURL(d),a.onmessage=function(h){var p=h.data,f=p.width,g=p.height,m=p.benchmark,y=p.isTestPass;y?(Wa[r].onSuccess(f,g,m),delete Wa[r]):Wa[r].onError(f,g,m)}}if(t.usePromise)return new Promise(function(h,p){var f=Bn(Bn({},t),{},{onError:function(S,v,_){var w;if(t.sizes.length===0)w=!0;else{var x=t.sizes.slice(-1),C=k1(x,1),E=k1(C[0],2),I=E[0],T=E[1];w=S===I&&v===T}o(S,v,_),w&&p({width:S,height:v,benchmark:_})},onSuccess:function(S,v,_){i(S,v,_),h({width:S,height:v,benchmark:_})}});if(a){var g=f.onError,m=f.onSuccess;Wa[r]={onError:g,onSuccess:m},a.postMessage(s)}else gc(f)});if(a)Wa[r]={onError:o,onSuccess:i},a.postMessage(s);else return gc(t)}var Bf={maxArea:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=zf({width:e.max,height:e.max,min:e.min,step:e.step,sizes:td(Ff.area)}),r=Bn(Bn(Bn({},$s),e),{},{sizes:n});return nd(r)},maxHeight:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=zf({width:1,height:e.max,min:e.min,step:e.step,sizes:td(Ff.height)}),r=Bn(Bn(Bn({},$s),e),{},{sizes:n});return nd(r)},maxWidth:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=zf({width:e.max,height:1,min:e.min,step:e.step,sizes:td(Ff.width)}),r=Bn(Bn(Bn({},$s),e),{},{sizes:n});return nd(r)},test:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=Bn(Bn({},$s),e);return n.sizes=td(n.sizes),n.width&&n.height&&(n.sizes=[[n.width,n.height]]),nd(n)}};let Uf=null;function UX(){return Uf||(Uf=HX()),Uf}async function HX(){const t=await Bf.maxWidth({usePromise:!0}),e=await Bf.maxHeight({usePromise:!0}),n=await Bf.maxArea({usePromise:!0});return{maxWidth:t.width,maxHeight:e.height,maxArea:n.width*n.height}}const M1=8192,jX=4096*4096;async function KX(t,e){if(t<=M1&&e<=M1&&t*e<=jX)return[t,e];const{maxWidth:n,maxHeight:r,maxArea:o}=await UX(),i=t/e;if(t>n&&(t=n,e=t/i),e>r&&(e=r,t=e*i),t*e>o){const s=Math.sqrt(o/(t*e));t*=s,e*=s}return[t,e]}async function Wk(t,e,n){const{type:r,quality:o,scale:i,width:s,height:a}=n;let[c,l]=await KX(s*i,a*i);c=Math.floor(c),l=Math.floor(l);const d=c/s,h=await wo.blobToDataUrl(new Blob([e],{type:"image/svg+xml"})),p=await new Promise(g=>{const m=xc();m.crossOrigin="anonymous",m.onload=async()=>{et.isSafari&&await Og(250);const y=document.createElement("canvas"),S=y.getContext("2d");y.width=c,y.height=l,S.imageSmoothingEnabled=!0,S.imageSmoothingQuality="high",S.drawImage(m,0,0,c,l),URL.revokeObjectURL(h),g(y)},m.onerror=()=>{g(null)},m.src=h});if(!p)return null;const f=await new Promise(g=>p.toBlob(m=>{(!m||Pt.throwToBlob.get())&&g(null),g(m)},"image/"+r,o));if(!f)return null;if(r==="png"){const g=new DataView(await f.arrayBuffer());return Fr.setPhysChunk(g,d,{type:"image/"+r})}else return f}async function Gk(t,e,n){const r=await t.getSvgString(e!=null&&e.length?e:[...t.getCurrentPageShapeIds()],{scale:1,background:t.getInstanceState().exportBackground,...n});if(!r)throw new Error("Could not construct SVG.");return r}async function Om(t,e,n,r={}){var o;switch(n){case"svg":return(o=await Gk(t,e,r))==null?void 0:o.svg;case"json":{const i=await t.resolveAssetsInContent(t.getContentFromCurrentPage(e));return JSON.stringify(i)}default:$t(n)}}async function Vk({editor:t,ids:e,format:n,opts:r={}}){switch(n){case"svg":return new Blob([await Om(t,e,"svg",r)],{type:"text/plain"});case"json":return new Blob([await Om(t,e,"json",r)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const o=await Gk(t,e,r);if(!o)throw new Error("Could not construct image.");const i=await Wk(t,o.svg,{type:n,quality:1,scale:2,width:o.width,height:o.height});if(!i)throw new Error("Could not construct image.");return i}default:$t(n)}}const WX={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function GX(t,e,n,r={}){return{blobPromise:Vk({editor:t,ids:e,format:n,opts:r}),mimeType:WX[n]}}function VX(t,e,n="svg",r={}){if(!window.navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(window.navigator.clipboard.write){const{blobPromise:o,mimeType:i}=GX(t,e,n,r);return o.catch(s=>{console.error(s)}),window.navigator.clipboard.write([new ClipboardItem({[i]:o})]).catch(s=>(console.error(s),o.then(a=>window.navigator.clipboard.write([new ClipboardItem({[i]:a})]))))}switch(n){case"json":case"svg":return YX(async()=>Om(t,e,n,r));case"jpeg":case"png":throw new Error("Copy not supported");default:$t(n)}}async function YX(t){var e,n;await((n=(e=navigator.clipboard)==null?void 0:e.writeText)==null?void 0:n.call(e,await t()))}function XX(){const t=F(),{addToast:e}=to(),n=Ae();return V((r,o="svg")=>{VX(t,r,o).catch(()=>{e({id:"copy-fail",severity:"warning",title:n("toast.error.copy-fail.title"),description:n("toast.error.copy-fail.desc")})})},[t,e,n])}async function qX(t,e,n="png",r,o={}){if(!r&&(r=`shapes at ${A1()}`,e.length===1)){const a=t.getShape(e[0]);t.isShapeOfType(a,"frame")?r=a.props.name??"frame":r=`${va(a.id)} at ${A1()}`}r+=`.${n}`;const i=await Vk({editor:t,ids:e,format:n,opts:o}),s=new File([i],r,{type:i.type});ZX(s)}function A1(){const t=new Date,e=String(t.getFullYear()).slice(2),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0"),s=String(t.getSeconds()).padStart(2,"0");return`${e}-${n}-${r} ${o}.${i}.${s}`}function ZX(t){const e=document.createElement("a"),n=URL.createObjectURL(t);e.href=n,e.download=t.name,e.click(),URL.revokeObjectURL(n)}function JX(){const t=F(),{addToast:e}=to(),n=Ae();return V((r,o="png",i)=>{qX(t,r,o,i,{scale:1,background:t.getInstanceState().exportBackground}).catch(s=>{console.error(s.message),e({id:"export-fail",title:n("toast.error.export-fail.title"),description:n("toast.error.export-fail.desc"),severity:"error"})})},[t,e,n])}async function QX(t,e,n){const r=be(e.map(a=>{const c=t.getShape(a);if(!(!c||t.getShapeUtil(c.type).toSvg===void 0))return c}));if(r.length===0)return;if(r.length===1){const a=r[0];if(!a||t.isShapeOfType(a,"image"))return}const o=[];if(n!==void 0){const a=r.map(c=>({shape:c,bounds:t.getShapeMaskedPageBounds(c).clone().expandBy(n)}));for(let c=0;c<a.length;c++){const l=a[c];if(c===0){o[0]={shapes:[l.shape],bounds:l.bounds};continue}let d=!1;for(const h of o)if(h.bounds.includes(l.bounds)){h.shapes.push(l.shape),h.bounds.expand(l.bounds),d=!0;break}d||o.push({shapes:[l.shape],bounds:l.bounds})}}else{const a=ee.Common(r.map(c=>t.getShapeMaskedPageBounds(c)));o.push({shapes:r,bounds:a})}const i=t.options.flattenImageBoundsPadding;for(const a of o){n!==void 0&&a.bounds.expandBy(-n);const c=await t.getSvgString(a.shapes,{padding:i});if(!(c!=null&&c.svg))continue;const l=new Blob([c.svg],{type:"image/svg+xml"}),d=await t.getAssetForExternalContent({type:"file",file:new File([l],"asset.svg",{type:"image/svg+xml"})});d&&(a.asset=d)}const s=[];return Kr(()=>{for(const a of o){const{asset:c,bounds:l,shapes:d}=a;if(!c)continue;const h=t.findCommonAncestor(d)??t.getCurrentPageId();if(!h)continue;let p="a1";for(const S of d)if(S.parentId===h){S.index>p&&(p=S.index);break}let f,g,m;if(In(h)){const S=t.getShape(h);if(!S)continue;const v=t.getPointInShapeSpace(S,{x:l.x,y:l.y});m=t.getShapePageTransform(h).rotation(),v.sub(new b(i,i).rot(-m)),f=v.x,g=v.y}else f=l.x-i,g=l.y-i,m=0;t.deleteShapes(d),t.createAssets([{...c,id:c.id}]);const y=Xe();t.createShape({id:y,type:"image",index:p,parentId:h,x:f,y:g,rotation:-m,props:{assetId:c.id,w:l.w+i*2,h:l.h+i*2}}),s.push(y)}}),s}const Yk=we.createContext([]);function Xk(){const t=F(),e=B(),n=Jo(we.useContext(Yk));return q(()=>{const r=window.document.createElement("input");r.type="file",r.accept=(n==null?void 0:n.join(","))??zL,r.multiple=!0,e.current=r;async function o(i){const s=i.target.files;!s||s.length===0||(t.markHistoryStoppingPoint("insert media"),await t.putExternalContent({type:"files",files:Array.from(s),point:t.getViewportPageBounds().center,ignoreParent:!1}),r.value="")}return r.addEventListener("change",o),()=>{e.current=void 0,r.removeEventListener("change",o)}},[t,n]),V(()=>{var r;(r=e.current)==null||r.click()},[e])}function Jh(){return F().store.props.collaboration!==void 0}function eq(){const t=F();return U("sync status",()=>{var e;return(e=t.store.props.collaboration)!=null&&e.status?t.store.props.collaboration.status.get():null},[t])}function tq(){const t=F(),e=B(null),n=B(null);return V(async function(){const o=document.createElement("div"),i=document.createElement("style"),s=(S,v)=>{S&&(S.innerHTML=""),v&&document.head.contains(v)&&document.head.removeChild(v),S&&document.body.contains(S)&&document.body.removeChild(S)};s(e.current,n.current),e.current=o,n.current=i;const a=`tl-print-surface-${Ye()}`;o.className=a,i.innerHTML=`
			.${a} {
				display: none;
			}

			.${a} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${a} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${a}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${a}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${a}__item__header {
					display: none;
				}

				.${a}__item__footer {
					display: none;
					text-align: right;
				}

				.${a}__item__footer__hide {
					display: none;
				}

				
			}

		`;const c=()=>{document.head.appendChild(i),document.body.appendChild(o)},l=()=>{t.once("tick",()=>{s(o,i)})};window.addEventListener("beforeprint",c),window.addEventListener("afterprint",l);function d(S,v,_){try{o.innerHTML+=`<div class="${a}__item">
        <div class="${a}__item__header">
          ${S.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${a}__item__main">
          ${_}
        </div>
        <div class="${a}__item__footer ${a}__item__footer__${v?"":"hide"}">
          ${v??""}
        </div>
      </div>`}catch(w){console.error(w)}}function h(){et.isChromeForIos?(c(),window.print()):et.isSafari?(c(),document.execCommand("print",!1)):window.print()}const p=t.getSelectedShapeIds(),f=t.getCurrentPageId(),g=t.getPages(),y={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(t.getSelectedShapeIds().length>0){const S=await t.getSvgString(p,y);if(S){const v=g.find(_=>_.id===f);d(`tldraw — ${v==null?void 0:v.name}`,null,S.svg),h()}}else{const S=t.getCurrentPage(),v=await t.getSvgString(t.getSortedChildIdsForParent(S.id),y);v&&(d(`tldraw — ${S.name}`,null,v.svg),h())}window.removeEventListener("beforeprint",c),window.removeEventListener("afterprint",l)},[t])}const qk=Ze(null);function nq(t){return Object.fromEntries(t.map(e=>[e.id,e]))}function _s(t,e){if(t.getSelectedShapes().length===0)return t.getDocumentSettings().name||e}function rq({overrides:t,children:e}){const n=F(),r=Jh(),{addDialog:o,clearDialogs:i}=cs(),{clearToasts:s,addToast:a}=to(),c=Ae(),l=Xk(),d=tq(),{cut:h,copy:p,paste:f}=EX(),g=XX(),m=JX(),y=c("document.default-name"),S=av(),v=Xt(),_=ce(()=>{function w(){return n.isIn("select")||(n.complete(),n.setCurrentTool("select")),!1}function x(){return n.isIn("select")&&n.getSelectedShapeIds().length>0}const C=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(I){x()&&(w()||(v("edit-link",{source:I}),n.markHistoryStoppingPoint("edit-link"),o({component:JY})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(I){v("insert-embed",{source:I}),o({component:Bk})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(I){v("insert-media",{source:I}),l()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(I){v("undo",{source:I}),n.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(I){v("redo",{source:I}),n.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(I){let T=n.getSelectedShapeIds();T.length===0&&(T=Array.from(n.getCurrentPageShapeIds().values())),T.length!==0&&(v("export-as",{format:"svg",source:I}),m(T,"svg",_s(n,y)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(I){let T=n.getSelectedShapeIds();T.length===0&&(T=Array.from(n.getCurrentPageShapeIds().values())),T.length!==0&&(v("export-as",{format:"png",source:I}),m(T,"png",_s(n,y)))}},{id:"export-as-json",label:{default:"action.export-as-json",menu:"action.export-as-json.short","context-menu":"action.export-as-json.short"},readonlyOk:!0,onSelect(I){let T=n.getSelectedShapeIds();T.length===0&&(T=Array.from(n.getCurrentPageShapeIds().values())),T.length!==0&&(v("export-as",{format:"json",source:I}),m(T,"json",_s(n,y)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(I){let T=n.getSelectedShapeIds();T.length===0&&(T=Array.from(n.getCurrentPageShapeIds().values())),T.length!==0&&(v("export-all-as",{format:"svg",source:I}),m(Array.from(n.getCurrentPageShapeIds()),"svg",_s(n,y)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(I){const T=Array.from(n.getCurrentPageShapeIds().values());T.length!==0&&(v("export-all-as",{format:"png",source:I}),m(T,"png",_s(n,y)))}},{id:"export-all-as-json",label:{default:"action.export-all-as-json",menu:"action.export-all-as-json.short","context-menu":"action.export-all-as-json.short"},readonlyOk:!0,onSelect(I){const T=Array.from(n.getCurrentPageShapeIds().values());T.length!==0&&(v("export-all-as",{format:"json",source:I}),m(T,"json",_s(n,y)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(I){let T=n.getSelectedShapeIds();T.length===0&&(T=Array.from(n.getCurrentPageShapeIds().values())),T.length!==0&&(v("copy-as",{format:"svg",source:I}),g(T,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(I){let T=n.getSelectedShapeIds();T.length===0&&(T=Array.from(n.getCurrentPageShapeIds().values())),T.length!==0&&(v("copy-as",{format:"png",source:I}),g(T,"png"))}},{id:"copy-as-json",label:{default:"action.copy-as-json",menu:"action.copy-as-json.short","context-menu":"action.copy-as-json.short"},readonlyOk:!0,onSelect(I){let T=n.getSelectedShapeIds();T.length===0&&(T=Array.from(n.getCurrentPageShapeIds().values())),T.length!==0&&(v("copy-as",{format:"json",source:I}),g(T,"json"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(I){if(!x()||w())return;v("toggle-auto-size",{source:I}),n.markHistoryStoppingPoint("toggling auto size");const T=n.getSelectedShapes().filter(k=>n.isShapeOfType(k,"text")&&k.props.autoSize===!1);n.updateShapes(T.map(k=>({id:k.id,type:k.type,props:{...k.props,w:8,autoSize:!0}}))),rt(n,T.map(k=>k.id))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(I){v("open-embed-link",{source:I});const T=n.getSelectedShapeIds(),k="No embed shapes selected";if(T.length!==1){console.error(k);return}const D=n.getShape(T[0]);if(!D||!n.isShapeOfType(D,"embed")){console.error(k);return}$G(D.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(I){var T,k;if(((T=n.root.getCurrent())==null?void 0:T.id)!=="zoom"&&(v("zoom-tool",{source:I}),!(n.inputs.shiftKey||n.inputs.ctrlKey))){const D=n.root.getCurrent();D&&((k=D.getCurrent())==null?void 0:k.id)==="idle"&&n.setCurrentTool("zoom",{onInteractionEnd:D.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(I){x()&&(w()||n.run(()=>{v("convert-to-bookmark",{source:I});const T=n.getSelectedShapes(),k=[],D=[];for(const A of T){if(!A||!n.isShapeOfType(A,"embed")||!A.props.url)continue;const O=new b(A.x,A.y);O.rot(-A.rotation),O.add(new b(A.props.w/2-300/2,A.props.h/2-320/2)),O.rot(A.rotation);const $={id:Xe(),type:"bookmark",rotation:A.rotation,x:O.x,y:O.y,opacity:1,props:{url:A.props.url}};k.push($),D.push(A.id)}n.markHistoryStoppingPoint("convert shapes to bookmark"),n.deleteShapes(D),n.createShapes(k)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(I){x()&&(w()||(v("convert-to-embed",{source:I}),n.run(()=>{const T=n.getSelectedShapeIds(),k=be(T.map(O=>n.getShape(O))),D=[],A=[];for(const O of k){if(!n.isShapeOfType(O,"bookmark"))continue;const{url:$}=O.props,z=S($);if(!z||!z.definition)continue;const{width:R,height:W}=z.definition,j=new b(O.x,O.y);j.rot(-O.rotation),j.add(new b(O.props.w/2-R/2,O.props.h/2-W/2)),j.rot(O.rotation);const G={id:Xe(),type:"embed",x:j.x,y:j.y,rotation:O.rotation,props:{url:$,w:R,h:W}};D.push(G),A.push(O.id)}n.markHistoryStoppingPoint("convert shapes to embed"),n.deleteShapes(A),n.createShapes(D)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(I){if(!x()||w())return;v("duplicate-shapes",{source:I});const T=n.getInstanceState();let k,D;if(T.duplicateProps)k=T.duplicateProps.shapeIds,D=T.duplicateProps.offset;else{k=n.getSelectedShapeIds();const A=ee.Common(be(k.map(O=>n.getShapePageBounds(O))));D=n.getCameraOptions().isLocked?{x:n.options.adjacentShapeMargin,y:n.options.adjacentShapeMargin}:{x:A.width+n.options.adjacentShapeMargin,y:0}}n.markHistoryStoppingPoint("duplicate shapes"),n.duplicateShapes(k,D),T.duplicateProps&&n.updateInstanceState({duplicateProps:{...T.duplicateProps,shapeIds:n.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(I){x()&&(w()||(v("ungroup-shapes",{source:I}),n.markHistoryStoppingPoint("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(I){if(!x()||w())return;v("group-shapes",{source:I});const T=n.getOnlySelectedShape();T&&n.isShapeOfType(T,"group")?(n.markHistoryStoppingPoint("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())):(n.markHistoryStoppingPoint("group"),n.groupShapes(n.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(I){if(!x())return;v("remove-frame",{source:I});const T=n.getSelectedShapes();T.length>0&&T.every(k=>n.isShapeOfType(k,"frame"))&&(n.markHistoryStoppingPoint("remove-frame"),XY(n,T.map(k=>k.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(I){if(!x())return;v("fit-frame-to-content",{source:I});const T=n.getOnlySelectedShape();T&&n.isShapeOfType(T,"frame")&&(n.markHistoryStoppingPoint("fit-frame-to-content"),ZY(n,T.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(I){if(!x()||w())return;v("align-shapes",{operation:"left",source:I}),n.markHistoryStoppingPoint("align left");const T=n.getSelectedShapeIds();n.alignShapes(T,"left"),rt(n,T)}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(I){if(!x()||w())return;v("align-shapes",{operation:"center-horizontal",source:I}),n.markHistoryStoppingPoint("align center horizontal");const T=n.getSelectedShapeIds();n.alignShapes(T,"center-horizontal"),rt(n,T)}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(I){if(!x()||w())return;v("align-shapes",{operation:"right",source:I}),n.markHistoryStoppingPoint("align right");const T=n.getSelectedShapeIds();n.alignShapes(T,"right"),rt(n,T)}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(I){if(!x()||w())return;v("align-shapes",{operation:"center-vertical",source:I}),n.markHistoryStoppingPoint("align center vertical");const T=n.getSelectedShapeIds();n.alignShapes(T,"center-vertical"),rt(n,T)}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(I){if(!x()||w())return;v("align-shapes",{operation:"top",source:I}),n.markHistoryStoppingPoint("align top");const T=n.getSelectedShapeIds();n.alignShapes(T,"top"),rt(n,T)}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(I){if(!x()||w())return;v("align-shapes",{operation:"bottom",source:I}),n.markHistoryStoppingPoint("align bottom");const T=n.getSelectedShapeIds();n.alignShapes(T,"bottom"),rt(n,T)}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(I){if(!x()||w())return;v("distribute-shapes",{operation:"horizontal",source:I}),n.markHistoryStoppingPoint("distribute horizontal");const T=n.getSelectedShapeIds();n.distributeShapes(T,"horizontal"),rt(n,T)}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(I){if(!x()||w())return;v("distribute-shapes",{operation:"vertical",source:I}),n.markHistoryStoppingPoint("distribute vertical");const T=n.getSelectedShapeIds();n.distributeShapes(T,"vertical"),rt(n,T)}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(I){if(!x()||w())return;v("stretch-shapes",{operation:"horizontal",source:I}),n.markHistoryStoppingPoint("stretch horizontal");const T=n.getSelectedShapeIds();n.stretchShapes(T,"horizontal"),rt(n,T)}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(I){if(!x()||w())return;v("stretch-shapes",{operation:"vertical",source:I}),n.markHistoryStoppingPoint("stretch vertical");const T=n.getSelectedShapeIds();n.stretchShapes(T,"vertical"),rt(n,T)}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(I){if(!x()||w())return;v("flip-shapes",{operation:"horizontal",source:I}),n.markHistoryStoppingPoint("flip horizontal");const T=n.getSelectedShapeIds();n.flipShapes(T,"horizontal"),rt(n,T)}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(I){if(!x()||w())return;v("flip-shapes",{operation:"vertical",source:I}),n.markHistoryStoppingPoint("flip vertical");const T=n.getSelectedShapeIds();n.flipShapes(T,"vertical"),rt(n,T)}},{id:"pack",label:"action.pack",icon:"pack",onSelect(I){if(!x()||w())return;v("pack-shapes",{source:I}),n.markHistoryStoppingPoint("pack");const T=n.getSelectedShapeIds();n.packShapes(T,n.options.adjacentShapeMargin),rt(n,T)}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(I){if(!x()||w())return;v("stack-shapes",{operation:"vertical",source:I}),n.markHistoryStoppingPoint("stack-vertical");const T=n.getSelectedShapeIds();n.stackShapes(T,"vertical",16),rt(n,T)}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(I){if(!x()||w())return;v("stack-shapes",{operation:"horizontal",source:I}),n.markHistoryStoppingPoint("stack-horizontal");const T=n.getSelectedShapeIds();n.stackShapes(T,"horizontal",16),rt(n,T)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(I){x()&&(w()||(v("reorder-shapes",{operation:"toFront",source:I}),n.markHistoryStoppingPoint("bring to front"),n.bringToFront(n.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(I){x()&&(w()||(v("reorder-shapes",{operation:"forward",source:I}),n.markHistoryStoppingPoint("bring forward"),n.bringForward(n.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(I){x()&&(w()||(v("reorder-shapes",{operation:"backward",source:I}),n.markHistoryStoppingPoint("send backward"),n.sendBackward(n.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(I){x()&&(w()||(v("reorder-shapes",{operation:"toBack",source:I}),n.markHistoryStoppingPoint("send to back"),n.sendToBack(n.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(I){x()&&(w()||(n.markHistoryStoppingPoint("cut"),h(I)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(I){x()&&(w()||p(I))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(I){var T;(T=navigator.clipboard)==null||T.read().then(k=>{f(k,I,I==="context-menu"?n.inputs.currentPagePoint:void 0)}).catch(()=>{a({title:c("action.paste-error-title"),description:c("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(I){n.run(()=>{w()||(v("select-all-shapes",{source:I}),n.markHistoryStoppingPoint("select all kbd"),n.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(I){x()&&(w()||(v("select-none-shapes",{source:I}),n.markHistoryStoppingPoint("select none"),n.selectNone()))}},{id:"delete",label:"action.delete",kbd:"⌫,del,backspace",icon:"trash",onSelect(I){x()&&(w()||(v("delete-shapes",{source:I}),n.markHistoryStoppingPoint("delete"),n.deleteShapes(n.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(I){if(!x()||w())return;v("rotate-cw",{source:I}),n.markHistoryStoppingPoint("rotate-cw");const T=n.getSelectionRotation()%(it/2),k=oi(T,0)||oi(T,it/2),D=n.getSelectedShapeIds();n.rotateShapesBy(D,it/2-(k?0:T)),rt(n,D)}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(I){if(!x()||w())return;v("rotate-ccw",{source:I}),n.markHistoryStoppingPoint("rotate-ccw");const T=n.getSelectionRotation()%(it/2),k=oi(T,0),D=n.getSelectedShapeIds();n.rotateShapesBy(D,k?-(it/2):-T),rt(n,D)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(I){v("zoom-in",{source:I}),n.zoomIn(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(I){v("zoom-out",{source:I}),n.zoomOut(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(I){v("reset-zoom",{source:I}),n.resetZoom(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(I){v("zoom-to-fit",{source:I}),n.zoomToFit({animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(I){x()&&(w()||(v("zoom-to-selection",{source:I}),n.zoomToSelection({animation:{duration:n.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(I){v("toggle-snap-mode",{source:I}),n.user.updateUserPreferences({isSnapMode:!n.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(I){const T=n.user.getIsDarkMode()?"light":"dark";v("color-scheme",{source:I,value:T}),n.user.updateUserPreferences({colorScheme:T})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(I){v("toggle-wrap-mode",{source:I}),n.user.updateUserPreferences({isWrapMode:!n.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(I){v("toggle-dynamic-size-mode",{source:I}),n.user.updateUserPreferences({isDynamicSizeMode:!n.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(I){v("toggle-paste-at-cursor",{source:I}),n.user.updateUserPreferences({isPasteAtCursorMode:!n.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(I){v("toggle-reduce-motion",{source:I}),n.user.updateUserPreferences({animationSpeed:n.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(I){v("toggle-edge-scrolling",{source:I}),n.user.updateUserPreferences({edgeScrollSpeed:n.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(I){v("toggle-transparent",{source:I}),n.updateInstanceState({exportBackground:!n.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(I){v("toggle-tool-lock",{source:I}),n.updateInstanceState({isToolLocked:!n.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(I){v("unlock-all",{source:I});const T=[];for(const k of n.getCurrentPageShapes())k.isLocked&&T.push({id:k.id,type:k.type,isLocked:!1});T.length>0&&n.updateShapes(T)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(I){n.timers.requestAnimationFrame(()=>{n.run(()=>{v("toggle-focus-mode",{source:I}),i(),s(),n.updateInstanceState({isFocusMode:!n.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(I){v("toggle-grid-mode",{source:I}),n.updateInstanceState({isGridMode:!n.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(I){v("toggle-debug-mode",{source:I}),n.updateInstanceState({isDebugMode:!n.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(I){v("print",{source:I}),d()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(I){v("exit-pen-mode",{source:I}),n.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(I){v("stop-following",{source:I}),n.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(I){v("zoom-to-content",{source:I});const T=n.getSelectionPageBounds()??n.getCurrentPageBounds();T&&n.zoomToBounds(T,{targetZoom:Math.min(1,n.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(I){n.markHistoryStoppingPoint("locking"),v("toggle-lock",{source:I}),n.toggleLock(n.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(I){const T=Zn.createId(),k=n.getSelectedShapeIds();n.run(()=>{n.markHistoryStoppingPoint("move_shapes_to_page"),n.createPage({name:c("page-menu.new-page-initial-name"),id:T}),n.moveShapesToPage(k,T)}),v("move-to-new-page",{source:I})}},{id:"select-white-color",label:"color-style.white",kbd:"?t",onSelect(I){const T=qn;n.run(()=>{n.markHistoryStoppingPoint("change-color"),n.isIn("select")&&n.setStyleForSelectedShapes(T,"white"),n.setStyleForNextShapes(T,"white")}),v("set-style",{source:I,id:T.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"?f",onSelect(I){const T=Gi;n.run(()=>{n.markHistoryStoppingPoint("change-fill"),n.isIn("select")&&n.setStyleForSelectedShapes(T,"fill"),n.setStyleForNextShapes(T,"fill")}),v("set-style",{source:I,id:T.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"!f",onSelect:async I=>{const T=n.getSelectedShapeIds();if(T.length===0)return;n.markHistoryStoppingPoint("flattening to image"),v("flatten-to-image",{source:I});const k=await QX(n,T,n.options.flattenImageBoundsExpand);k!=null&&k.length&&n.setSelectedShapes(k)}}];r&&C.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(I){v("open-cursor-chat",{source:I}),!n.getInstanceState().isCoarsePointer&&n.timers.requestAnimationFrame(()=>{n.updateInstanceState({isChatting:!0})})}});const E=nq(C);return t?t(n,E,void 0):E},[n,v,t,o,a,l,m,g,h,p,f,i,s,d,c,y,r,S]);return u(qk.Provider,{value:_,children:e})}function ls(){const t=tt(qk);if(!t)throw new Error("useTools must be used within a ToolProvider");return t}function Ac(t,e){return t?typeof t=="string"?t:e?t[e]??t.default:void 0:void 0}var oq=Ze(void 0);function lv(t){const e=tt(oq);return t||e||"ltr"}const iq=["top","right","bottom","left"],di=Math.min,jn=Math.max,Bu=Math.round,rd=Math.floor,ui=t=>({x:t,y:t}),sq={left:"right",right:"left",bottom:"top",top:"bottom"},aq={start:"end",end:"start"};function Dm(t,e,n){return jn(t,di(e,n))}function Ao(t,e){return typeof t=="function"?t(e):t}function Oo(t){return t.split("-")[0]}function Pa(t){return t.split("-")[1]}function dv(t){return t==="x"?"y":"x"}function uv(t){return t==="y"?"height":"width"}function hi(t){return["top","bottom"].includes(Oo(t))?"y":"x"}function hv(t){return dv(hi(t))}function cq(t,e,n){n===void 0&&(n=!1);const r=Pa(t),o=hv(t),i=uv(o);let s=o==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[i]>e.floating[i]&&(s=Uu(s)),[s,Uu(s)]}function lq(t){const e=Uu(t);return[$m(t),e,$m(e)]}function $m(t){return t.replace(/start|end/g,e=>aq[e])}function dq(t,e,n){const r=["left","right"],o=["right","left"],i=["top","bottom"],s=["bottom","top"];switch(t){case"top":case"bottom":return n?e?o:r:e?r:o;case"left":case"right":return e?i:s;default:return[]}}function uq(t,e,n,r){const o=Pa(t);let i=dq(Oo(t),n==="start",r);return o&&(i=i.map(s=>s+"-"+o),e&&(i=i.concat(i.map($m)))),i}function Uu(t){return t.replace(/left|right|bottom|top/g,e=>sq[e])}function hq(t){return{top:0,right:0,bottom:0,left:0,...t}}function Zk(t){return typeof t!="number"?hq(t):{top:t,right:t,bottom:t,left:t}}function Hu(t){const{x:e,y:n,width:r,height:o}=t;return{width:r,height:o,top:n,left:e,right:e+r,bottom:n+o,x:e,y:n}}function O1(t,e,n){let{reference:r,floating:o}=t;const i=hi(e),s=hv(e),a=uv(s),c=Oo(e),l=i==="y",d=r.x+r.width/2-o.width/2,h=r.y+r.height/2-o.height/2,p=r[a]/2-o[a]/2;let f;switch(c){case"top":f={x:d,y:r.y-o.height};break;case"bottom":f={x:d,y:r.y+r.height};break;case"right":f={x:r.x+r.width,y:h};break;case"left":f={x:r.x-o.width,y:h};break;default:f={x:r.x,y:r.y}}switch(Pa(e)){case"start":f[s]-=p*(n&&l?-1:1);break;case"end":f[s]+=p*(n&&l?-1:1);break}return f}const pq=async(t,e,n)=>{const{placement:r="bottom",strategy:o="absolute",middleware:i=[],platform:s}=n,a=i.filter(Boolean),c=await(s.isRTL==null?void 0:s.isRTL(e));let l=await s.getElementRects({reference:t,floating:e,strategy:o}),{x:d,y:h}=O1(l,r,c),p=r,f={},g=0;for(let m=0;m<a.length;m++){const{name:y,fn:S}=a[m],{x:v,y:_,data:w,reset:x}=await S({x:d,y:h,initialPlacement:r,placement:p,strategy:o,middlewareData:f,rects:l,platform:s,elements:{reference:t,floating:e}});d=v??d,h=_??h,f={...f,[y]:{...f[y],...w}},x&&g<=50&&(g++,typeof x=="object"&&(x.placement&&(p=x.placement),x.rects&&(l=x.rects===!0?await s.getElementRects({reference:t,floating:e,strategy:o}):x.rects),{x:d,y:h}=O1(l,p,c)),m=-1)}return{x:d,y:h,placement:p,strategy:o,middlewareData:f}};async function Oc(t,e){var n;e===void 0&&(e={});const{x:r,y:o,platform:i,rects:s,elements:a,strategy:c}=t,{boundary:l="clippingAncestors",rootBoundary:d="viewport",elementContext:h="floating",altBoundary:p=!1,padding:f=0}=Ao(e,t),g=Zk(f),y=a[p?h==="floating"?"reference":"floating":h],S=Hu(await i.getClippingRect({element:(n=await(i.isElement==null?void 0:i.isElement(y)))==null||n?y:y.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(a.floating)),boundary:l,rootBoundary:d,strategy:c})),v=h==="floating"?{x:r,y:o,width:s.floating.width,height:s.floating.height}:s.reference,_=await(i.getOffsetParent==null?void 0:i.getOffsetParent(a.floating)),w=await(i.isElement==null?void 0:i.isElement(_))?await(i.getScale==null?void 0:i.getScale(_))||{x:1,y:1}:{x:1,y:1},x=Hu(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:v,offsetParent:_,strategy:c}):v);return{top:(S.top-x.top+g.top)/w.y,bottom:(x.bottom-S.bottom+g.bottom)/w.y,left:(S.left-x.left+g.left)/w.x,right:(x.right-S.right+g.right)/w.x}}const fq=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:o,rects:i,platform:s,elements:a,middlewareData:c}=e,{element:l,padding:d=0}=Ao(t,e)||{};if(l==null)return{};const h=Zk(d),p={x:n,y:r},f=hv(o),g=uv(f),m=await s.getDimensions(l),y=f==="y",S=y?"top":"left",v=y?"bottom":"right",_=y?"clientHeight":"clientWidth",w=i.reference[g]+i.reference[f]-p[f]-i.floating[g],x=p[f]-i.reference[f],C=await(s.getOffsetParent==null?void 0:s.getOffsetParent(l));let E=C?C[_]:0;(!E||!await(s.isElement==null?void 0:s.isElement(C)))&&(E=a.floating[_]||i.floating[g]);const I=w/2-x/2,T=E/2-m[g]/2-1,k=di(h[S],T),D=di(h[v],T),A=k,O=E-m[g]-D,$=E/2-m[g]/2+I,z=Dm(A,$,O),R=!c.arrow&&Pa(o)!=null&&$!==z&&i.reference[g]/2-($<A?k:D)-m[g]/2<0,W=R?$<A?$-A:$-O:0;return{[f]:p[f]+W,data:{[f]:z,centerOffset:$-z-W,...R&&{alignmentOffset:W}},reset:R}}}),gq=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:o,middlewareData:i,rects:s,initialPlacement:a,platform:c,elements:l}=e,{mainAxis:d=!0,crossAxis:h=!0,fallbackPlacements:p,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:m=!0,...y}=Ao(t,e);if((n=i.arrow)!=null&&n.alignmentOffset)return{};const S=Oo(o),v=hi(a),_=Oo(a)===a,w=await(c.isRTL==null?void 0:c.isRTL(l.floating)),x=p||(_||!m?[Uu(a)]:lq(a)),C=g!=="none";!p&&C&&x.push(...uq(a,m,g,w));const E=[a,...x],I=await Oc(e,y),T=[];let k=((r=i.flip)==null?void 0:r.overflows)||[];if(d&&T.push(I[S]),h){const $=cq(o,s,w);T.push(I[$[0]],I[$[1]])}if(k=[...k,{placement:o,overflows:T}],!T.every($=>$<=0)){var D,A;const $=(((D=i.flip)==null?void 0:D.index)||0)+1,z=E[$];if(z)return{data:{index:$,overflows:k},reset:{placement:z}};let R=(A=k.filter(W=>W.overflows[0]<=0).sort((W,j)=>W.overflows[1]-j.overflows[1])[0])==null?void 0:A.placement;if(!R)switch(f){case"bestFit":{var O;const W=(O=k.filter(j=>{if(C){const G=hi(j.placement);return G===v||G==="y"}return!0}).map(j=>[j.placement,j.overflows.filter(G=>G>0).reduce((G,le)=>G+le,0)]).sort((j,G)=>j[1]-G[1])[0])==null?void 0:O[0];W&&(R=W);break}case"initialPlacement":R=a;break}if(o!==R)return{reset:{placement:R}}}return{}}}};function D1(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function $1(t){return iq.some(e=>t[e]>=0)}const mq=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...o}=Ao(t,e);switch(r){case"referenceHidden":{const i=await Oc(e,{...o,elementContext:"reference"}),s=D1(i,n.reference);return{data:{referenceHiddenOffsets:s,referenceHidden:$1(s)}}}case"escaped":{const i=await Oc(e,{...o,altBoundary:!0}),s=D1(i,n.floating);return{data:{escapedOffsets:s,escaped:$1(s)}}}default:return{}}}}};async function yq(t,e){const{placement:n,platform:r,elements:o}=t,i=await(r.isRTL==null?void 0:r.isRTL(o.floating)),s=Oo(n),a=Pa(n),c=hi(n)==="y",l=["left","top"].includes(s)?-1:1,d=i&&c?-1:1,h=Ao(e,t);let{mainAxis:p,crossAxis:f,alignmentAxis:g}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return a&&typeof g=="number"&&(f=a==="end"?g*-1:g),c?{x:f*d,y:p*l}:{x:p*l,y:f*d}}const Sq=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:o,y:i,placement:s,middlewareData:a}=e,c=await yq(e,t);return s===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:o+c.x,y:i+c.y,data:{...c,placement:s}}}}},vq=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:o}=e,{mainAxis:i=!0,crossAxis:s=!1,limiter:a={fn:y=>{let{x:S,y:v}=y;return{x:S,y:v}}},...c}=Ao(t,e),l={x:n,y:r},d=await Oc(e,c),h=hi(Oo(o)),p=dv(h);let f=l[p],g=l[h];if(i){const y=p==="y"?"top":"left",S=p==="y"?"bottom":"right",v=f+d[y],_=f-d[S];f=Dm(v,f,_)}if(s){const y=h==="y"?"top":"left",S=h==="y"?"bottom":"right",v=g+d[y],_=g-d[S];g=Dm(v,g,_)}const m=a.fn({...e,[p]:f,[h]:g});return{...m,data:{x:m.x-n,y:m.y-r,enabled:{[p]:i,[h]:s}}}}}},bq=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:o,rects:i,middlewareData:s}=e,{offset:a=0,mainAxis:c=!0,crossAxis:l=!0}=Ao(t,e),d={x:n,y:r},h=hi(o),p=dv(h);let f=d[p],g=d[h];const m=Ao(a,e),y=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(c){const _=p==="y"?"height":"width",w=i.reference[p]-i.floating[_]+y.mainAxis,x=i.reference[p]+i.reference[_]-y.mainAxis;f<w?f=w:f>x&&(f=x)}if(l){var S,v;const _=p==="y"?"width":"height",w=["top","left"].includes(Oo(o)),x=i.reference[h]-i.floating[_]+(w&&((S=s.offset)==null?void 0:S[h])||0)+(w?0:y.crossAxis),C=i.reference[h]+i.reference[_]+(w?0:((v=s.offset)==null?void 0:v[h])||0)-(w?y.crossAxis:0);g<x?g=x:g>C&&(g=C)}return{[p]:f,[h]:g}}}},wq=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:o,rects:i,platform:s,elements:a}=e,{apply:c=()=>{},...l}=Ao(t,e),d=await Oc(e,l),h=Oo(o),p=Pa(o),f=hi(o)==="y",{width:g,height:m}=i.floating;let y,S;h==="top"||h==="bottom"?(y=h,S=p===(await(s.isRTL==null?void 0:s.isRTL(a.floating))?"start":"end")?"left":"right"):(S=h,y=p==="end"?"top":"bottom");const v=m-d.top-d.bottom,_=g-d.left-d.right,w=di(m-d[y],v),x=di(g-d[S],_),C=!e.middlewareData.shift;let E=w,I=x;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(I=_),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(E=v),C&&!p){const k=jn(d.left,0),D=jn(d.right,0),A=jn(d.top,0),O=jn(d.bottom,0);f?I=g-2*(k!==0||D!==0?k+D:jn(d.left,d.right)):E=m-2*(A!==0||O!==0?A+O:jn(d.top,d.bottom))}await c({...e,availableWidth:I,availableHeight:E});const T=await s.getDimensions(a.floating);return g!==T.width||m!==T.height?{reset:{rects:!0}}:{}}}};function Qh(){return typeof window<"u"}function Ia(t){return Jk(t)?(t.nodeName||"").toLowerCase():"#document"}function Yn(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function no(t){var e;return(e=(Jk(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function Jk(t){return Qh()?t instanceof Node||t instanceof Yn(t).Node:!1}function Cr(t){return Qh()?t instanceof Element||t instanceof Yn(t).Element:!1}function qr(t){return Qh()?t instanceof HTMLElement||t instanceof Yn(t).HTMLElement:!1}function R1(t){return!Qh()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Yn(t).ShadowRoot}function dl(t){const{overflow:e,overflowX:n,overflowY:r,display:o}=Er(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(o)}function _q(t){return["table","td","th"].includes(Ia(t))}function ep(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function pv(t){const e=fv(),n=Cr(t)?Er(t):t;return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function xq(t){let e=pi(t);for(;qr(e)&&!Zs(e);){if(pv(e))return e;if(ep(e))return null;e=pi(e)}return null}function fv(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Zs(t){return["html","body","#document"].includes(Ia(t))}function Er(t){return Yn(t).getComputedStyle(t)}function tp(t){return Cr(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function pi(t){if(Ia(t)==="html")return t;const e=t.assignedSlot||t.parentNode||R1(t)&&t.host||no(t);return R1(e)?e.host:e}function Qk(t){const e=pi(t);return Zs(e)?t.ownerDocument?t.ownerDocument.body:t.body:qr(e)&&dl(e)?e:Qk(e)}function Dc(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const o=Qk(t),i=o===((r=t.ownerDocument)==null?void 0:r.body),s=Yn(o);if(i){const a=Rm(s);return e.concat(s,s.visualViewport||[],dl(o)?o:[],a&&n?Dc(a):[])}return e.concat(o,Dc(o,[],n))}function Rm(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function eM(t){const e=Er(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const o=qr(t),i=o?t.offsetWidth:n,s=o?t.offsetHeight:r,a=Bu(n)!==i||Bu(r)!==s;return a&&(n=i,r=s),{width:n,height:r,$:a}}function gv(t){return Cr(t)?t:t.contextElement}function Ks(t){const e=gv(t);if(!qr(e))return ui(1);const n=e.getBoundingClientRect(),{width:r,height:o,$:i}=eM(e);let s=(i?Bu(n.width):n.width)/r,a=(i?Bu(n.height):n.height)/o;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const Pq=ui(0);function tM(t){const e=Yn(t);return!fv()||!e.visualViewport?Pq:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Iq(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Yn(t)?!1:e}function qi(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const o=t.getBoundingClientRect(),i=gv(t);let s=ui(1);e&&(r?Cr(r)&&(s=Ks(r)):s=Ks(t));const a=Iq(i,n,r)?tM(i):ui(0);let c=(o.left+a.x)/s.x,l=(o.top+a.y)/s.y,d=o.width/s.x,h=o.height/s.y;if(i){const p=Yn(i),f=r&&Cr(r)?Yn(r):r;let g=p,m=Rm(g);for(;m&&r&&f!==g;){const y=Ks(m),S=m.getBoundingClientRect(),v=Er(m),_=S.left+(m.clientLeft+parseFloat(v.paddingLeft))*y.x,w=S.top+(m.clientTop+parseFloat(v.paddingTop))*y.y;c*=y.x,l*=y.y,d*=y.x,h*=y.y,c+=_,l+=w,g=Yn(m),m=Rm(g)}}return Hu({width:d,height:h,x:c,y:l})}function Cq(t){let{elements:e,rect:n,offsetParent:r,strategy:o}=t;const i=o==="fixed",s=no(r),a=e?ep(e.floating):!1;if(r===s||a&&i)return n;let c={scrollLeft:0,scrollTop:0},l=ui(1);const d=ui(0),h=qr(r);if((h||!h&&!i)&&((Ia(r)!=="body"||dl(s))&&(c=tp(r)),qr(r))){const p=qi(r);l=Ks(r),d.x=p.x+r.clientLeft,d.y=p.y+r.clientTop}return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+d.x,y:n.y*l.y-c.scrollTop*l.y+d.y}}function Eq(t){return Array.from(t.getClientRects())}function Lm(t,e){const n=tp(t).scrollLeft;return e?e.left+n:qi(no(t)).left+n}function Tq(t){const e=no(t),n=tp(t),r=t.ownerDocument.body,o=jn(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),i=jn(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let s=-n.scrollLeft+Lm(t);const a=-n.scrollTop;return Er(r).direction==="rtl"&&(s+=jn(e.clientWidth,r.clientWidth)-o),{width:o,height:i,x:s,y:a}}function kq(t,e){const n=Yn(t),r=no(t),o=n.visualViewport;let i=r.clientWidth,s=r.clientHeight,a=0,c=0;if(o){i=o.width,s=o.height;const l=fv();(!l||l&&e==="fixed")&&(a=o.offsetLeft,c=o.offsetTop)}return{width:i,height:s,x:a,y:c}}function Mq(t,e){const n=qi(t,!0,e==="fixed"),r=n.top+t.clientTop,o=n.left+t.clientLeft,i=qr(t)?Ks(t):ui(1),s=t.clientWidth*i.x,a=t.clientHeight*i.y,c=o*i.x,l=r*i.y;return{width:s,height:a,x:c,y:l}}function L1(t,e,n){let r;if(e==="viewport")r=kq(t,n);else if(e==="document")r=Tq(no(t));else if(Cr(e))r=Mq(e,n);else{const o=tM(t);r={...e,x:e.x-o.x,y:e.y-o.y}}return Hu(r)}function nM(t,e){const n=pi(t);return n===e||!Cr(n)||Zs(n)?!1:Er(n).position==="fixed"||nM(n,e)}function Aq(t,e){const n=e.get(t);if(n)return n;let r=Dc(t,[],!1).filter(a=>Cr(a)&&Ia(a)!=="body"),o=null;const i=Er(t).position==="fixed";let s=i?pi(t):t;for(;Cr(s)&&!Zs(s);){const a=Er(s),c=pv(s);!c&&a.position==="fixed"&&(o=null),(i?!c&&!o:!c&&a.position==="static"&&!!o&&["absolute","fixed"].includes(o.position)||dl(s)&&!c&&nM(t,s))?r=r.filter(d=>d!==s):o=a,s=pi(s)}return e.set(t,r),r}function Oq(t){let{element:e,boundary:n,rootBoundary:r,strategy:o}=t;const s=[...n==="clippingAncestors"?ep(e)?[]:Aq(e,this._c):[].concat(n),r],a=s[0],c=s.reduce((l,d)=>{const h=L1(e,d,o);return l.top=jn(h.top,l.top),l.right=di(h.right,l.right),l.bottom=di(h.bottom,l.bottom),l.left=jn(h.left,l.left),l},L1(e,a,o));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function Dq(t){const{width:e,height:n}=eM(t);return{width:e,height:n}}function $q(t,e,n){const r=qr(e),o=no(e),i=n==="fixed",s=qi(t,!0,i,e);let a={scrollLeft:0,scrollTop:0};const c=ui(0);if(r||!r&&!i)if((Ia(e)!=="body"||dl(o))&&(a=tp(e)),r){const f=qi(e,!0,i,e);c.x=f.x+e.clientLeft,c.y=f.y+e.clientTop}else o&&(c.x=Lm(o));let l=0,d=0;if(o&&!r&&!i){const f=o.getBoundingClientRect();d=f.top+a.scrollTop,l=f.left+a.scrollLeft-Lm(o,f)}const h=s.left+a.scrollLeft-c.x-l,p=s.top+a.scrollTop-c.y-d;return{x:h,y:p,width:s.width,height:s.height}}function Hf(t){return Er(t).position==="static"}function N1(t,e){if(!qr(t)||Er(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return no(t)===n&&(n=n.ownerDocument.body),n}function rM(t,e){const n=Yn(t);if(ep(t))return n;if(!qr(t)){let o=pi(t);for(;o&&!Zs(o);){if(Cr(o)&&!Hf(o))return o;o=pi(o)}return n}let r=N1(t,e);for(;r&&_q(r)&&Hf(r);)r=N1(r,e);return r&&Zs(r)&&Hf(r)&&!pv(r)?n:r||xq(t)||n}const Rq=async function(t){const e=this.getOffsetParent||rM,n=this.getDimensions,r=await n(t.floating);return{reference:$q(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function Lq(t){return Er(t).direction==="rtl"}const Nq={convertOffsetParentRelativeRectToViewportRelativeRect:Cq,getDocumentElement:no,getClippingRect:Oq,getOffsetParent:rM,getElementRects:Rq,getClientRects:Eq,getDimensions:Dq,getScale:Ks,isElement:Cr,isRTL:Lq};function Fq(t,e){let n=null,r;const o=no(t);function i(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function s(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),i();const{left:l,top:d,width:h,height:p}=t.getBoundingClientRect();if(a||e(),!h||!p)return;const f=rd(d),g=rd(o.clientWidth-(l+h)),m=rd(o.clientHeight-(d+p)),y=rd(l),v={rootMargin:-f+"px "+-g+"px "+-m+"px "+-y+"px",threshold:jn(0,di(1,c))||1};let _=!0;function w(x){const C=x[0].intersectionRatio;if(C!==c){if(!_)return s();C?s(!1,C):r=setTimeout(()=>{s(!1,1e-7)},1e3)}_=!1}try{n=new IntersectionObserver(w,{...v,root:o.ownerDocument})}catch{n=new IntersectionObserver(w,v)}n.observe(t)}return s(!0),i}function zq(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:o=!0,ancestorResize:i=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=r,l=gv(t),d=o||i?[...l?Dc(l):[],...Dc(e)]:[];d.forEach(S=>{o&&S.addEventListener("scroll",n,{passive:!0}),i&&S.addEventListener("resize",n)});const h=l&&a?Fq(l,n):null;let p=-1,f=null;s&&(f=new ResizeObserver(S=>{let[v]=S;v&&v.target===l&&f&&(f.unobserve(e),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{var _;(_=f)==null||_.observe(e)})),n()}),l&&!c&&f.observe(l),f.observe(e));let g,m=c?qi(t):null;c&&y();function y(){const S=qi(t);m&&(S.x!==m.x||S.y!==m.y||S.width!==m.width||S.height!==m.height)&&n(),m=S,g=requestAnimationFrame(y)}return n(),()=>{var S;d.forEach(v=>{o&&v.removeEventListener("scroll",n),i&&v.removeEventListener("resize",n)}),h==null||h(),(S=f)==null||S.disconnect(),f=null,c&&cancelAnimationFrame(g)}}const Bq=Sq,Uq=vq,Hq=gq,jq=wq,Kq=mq,F1=fq,Wq=bq,Gq=(t,e,n)=>{const r=new Map,o={platform:Nq,...n},i={...o.platform,_c:r};return pq(t,e,{...o,platform:i})};var Md=typeof document<"u"?je:q;function ju(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,o;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(r=n;r--!==0;)if(!ju(t[r],e[r]))return!1;return!0}if(o=Object.keys(t),n=o.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,o[r]))return!1;for(r=n;r--!==0;){const i=o[r];if(!(i==="_owner"&&t.$$typeof)&&!ju(t[i],e[i]))return!1}return!0}return t!==t&&e!==e}function oM(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function z1(t,e){const n=oM(t);return Math.round(e*n)/n}function jf(t){const e=B(t);return Md(()=>{e.current=t}),e}function Vq(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:o,elements:{reference:i,floating:s}={},transform:a=!0,whileElementsMounted:c,open:l}=t,[d,h]=Q({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[p,f]=Q(r);ju(p,r)||f(r);const[g,m]=Q(null),[y,S]=Q(null),v=V(j=>{j!==C.current&&(C.current=j,m(j))},[]),_=V(j=>{j!==E.current&&(E.current=j,S(j))},[]),w=i||g,x=s||y,C=B(null),E=B(null),I=B(d),T=c!=null,k=jf(c),D=jf(o),A=jf(l),O=V(()=>{if(!C.current||!E.current)return;const j={placement:e,strategy:n,middleware:p};D.current&&(j.platform=D.current),Gq(C.current,E.current,j).then(G=>{const le={...G,isPositioned:A.current!==!1};$.current&&!ju(I.current,le)&&(I.current=le,Hi(()=>{h(le)}))})},[p,e,n,D,A]);Md(()=>{l===!1&&I.current.isPositioned&&(I.current.isPositioned=!1,h(j=>({...j,isPositioned:!1})))},[l]);const $=B(!1);Md(()=>($.current=!0,()=>{$.current=!1}),[]),Md(()=>{if(w&&(C.current=w),x&&(E.current=x),w&&x){if(k.current)return k.current(w,x,O);O()}},[w,x,O,k,T]);const z=ce(()=>({reference:C,floating:E,setReference:v,setFloating:_}),[v,_]),R=ce(()=>({reference:w,floating:x}),[w,x]),W=ce(()=>{const j={position:n,left:0,top:0};if(!R.floating)return j;const G=z1(R.floating,d.x),le=z1(R.floating,d.y);return a?{...j,transform:"translate("+G+"px, "+le+"px)",...oM(R.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:G,top:le}},[n,a,R.floating,d.x,d.y]);return ce(()=>({...d,update:O,refs:z,elements:R,floatingStyles:W}),[d,O,z,R,W])}const Yq=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:r,padding:o}=typeof t=="function"?t(n):t;return r&&e(r)?r.current!=null?F1({element:r.current,padding:o}).fn(n):{}:r?F1({element:r,padding:o}).fn(n):{}}}},Xq=(t,e)=>({...Bq(t),options:[t,e]}),qq=(t,e)=>({...Uq(t),options:[t,e]}),Zq=(t,e)=>({...Wq(t),options:[t,e]}),Jq=(t,e)=>({...Hq(t),options:[t,e]}),Qq=(t,e)=>({...jq(t),options:[t,e]}),eZ=(t,e)=>({...Kq(t),options:[t,e]}),tZ=(t,e)=>({...Yq(t),options:[t,e]});var nZ="Arrow",iM=X((t,e)=>{const{children:n,width:r=10,height:o=5,...i}=t;return u(Le.svg,{...i,ref:e,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:u("polygon",{points:"0,0 30,0 15,10"})})});iM.displayName=nZ;var rZ=iM;function oZ(t,e=[]){let n=[];function r(i,s){const a=Ze(s),c=n.length;n=[...n,s];function l(h){const{scope:p,children:f,...g}=h,m=(p==null?void 0:p[t][c])||a,y=ce(()=>g,Object.values(g));return u(m.Provider,{value:y,children:f})}function d(h,p){const f=(p==null?void 0:p[t][c])||a,g=tt(f);if(g)return g;if(s!==void 0)return s;throw new Error(`\`${h}\` must be used within \`${i}\``)}return l.displayName=i+"Provider",[l,d]}const o=()=>{const i=n.map(s=>Ze(s));return function(a){const c=(a==null?void 0:a[t])||i;return ce(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return o.scopeName=t,[r,iZ(o,...e)]}function iZ(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(i){const s=r.reduce((a,{useScope:c,scopeName:l})=>{const h=c(i)[`__scope${l}`];return{...a,...h}},{});return ce(()=>({[`__scope${e.scopeName}`]:s}),[s])}};return n.scopeName=e.scopeName,n}function sM(t){const[e,n]=Q(void 0);return li(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const i=o[0];let s,a;if("borderBoxSize"in i){const c=i.borderBoxSize,l=Array.isArray(c)?c[0]:c;s=l.inlineSize,a=l.blockSize}else s=t.offsetWidth,a=t.offsetHeight;n({width:s,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var mv="Popper",[aM,np]=oZ(mv),[sZ,cM]=aM(mv),lM=t=>{const{__scopePopper:e,children:n}=t,[r,o]=Q(null);return u(sZ,{scope:e,anchor:r,onAnchorChange:o,children:n})};lM.displayName=mv;var dM="PopperAnchor",uM=X((t,e)=>{const{__scopePopper:n,virtualRef:r,...o}=t,i=cM(dM,n),s=B(null),a=st(e,s);return q(()=>{i.onAnchorChange((r==null?void 0:r.current)||s.current)}),r?null:u(Le.div,{...o,ref:a})});uM.displayName=dM;var yv="PopperContent",[aZ,cZ]=aM(yv),hM=X((t,e)=>{var Ke,We,Ee,Je,Ne,vt;const{__scopePopper:n,side:r="bottom",sideOffset:o=0,align:i="center",alignOffset:s=0,arrowPadding:a=0,avoidCollisions:c=!0,collisionBoundary:l=[],collisionPadding:d=0,sticky:h="partial",hideWhenDetached:p=!1,updatePositionStrategy:f="optimized",onPlaced:g,...m}=t,y=cM(yv,n),[S,v]=Q(null),_=st(e,Ft=>v(Ft)),[w,x]=Q(null),C=sM(w),E=(C==null?void 0:C.width)??0,I=(C==null?void 0:C.height)??0,T=r+(i!=="center"?"-"+i:""),k=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},D=Array.isArray(l)?l:[l],A=D.length>0,O={padding:k,boundary:D.filter(dZ),altBoundary:A},{refs:$,floatingStyles:z,placement:R,isPositioned:W,middlewareData:j}=Vq({strategy:"fixed",placement:T,whileElementsMounted:(...Ft)=>zq(...Ft,{animationFrame:f==="always"}),elements:{reference:y.anchor},middleware:[Xq({mainAxis:o+I,alignmentAxis:s}),c&&qq({mainAxis:!0,crossAxis:!1,limiter:h==="partial"?Zq():void 0,...O}),c&&Jq({...O}),Qq({...O,apply:({elements:Ft,rects:bn,availableWidth:_t,availableHeight:qt})=>{const{width:oo,height:Ta}=bn.reference,Bo=Ft.floating.style;Bo.setProperty("--radix-popper-available-width",`${_t}px`),Bo.setProperty("--radix-popper-available-height",`${qt}px`),Bo.setProperty("--radix-popper-anchor-width",`${oo}px`),Bo.setProperty("--radix-popper-anchor-height",`${Ta}px`)}}),w&&tZ({element:w,padding:a}),uZ({arrowWidth:E,arrowHeight:I}),p&&eZ({strategy:"referenceHidden",...O})]}),[G,le]=gM(R),he=Vt(g);li(()=>{W&&(he==null||he())},[W,he]);const ve=(Ke=j.arrow)==null?void 0:Ke.x,me=(We=j.arrow)==null?void 0:We.y,Be=((Ee=j.arrow)==null?void 0:Ee.centerOffset)!==0,[ie,at]=Q();return li(()=>{S&&at(window.getComputedStyle(S).zIndex)},[S]),u("div",{ref:$.setFloating,"data-radix-popper-content-wrapper":"",style:{...z,transform:W?z.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ie,"--radix-popper-transform-origin":[(Je=j.transformOrigin)==null?void 0:Je.x,(Ne=j.transformOrigin)==null?void 0:Ne.y].join(" "),...((vt=j.hide)==null?void 0:vt.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:u(aZ,{scope:n,placedSide:G,onArrowChange:x,arrowX:ve,arrowY:me,shouldHideArrow:Be,children:u(Le.div,{"data-side":G,"data-align":le,...m,ref:_,style:{...m.style,animation:W?void 0:"none"}})})})});hM.displayName=yv;var pM="PopperArrow",lZ={top:"bottom",right:"left",bottom:"top",left:"right"},fM=X(function(e,n){const{__scopePopper:r,...o}=e,i=cZ(pM,r),s=lZ[i.placedSide];return u("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[s]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:u(rZ,{...o,ref:n,style:{...o.style,display:"block"}})})});fM.displayName=pM;function dZ(t){return t!==null}var uZ=t=>({name:"transformOrigin",options:t,fn(e){var y,S,v;const{placement:n,rects:r,middlewareData:o}=e,s=((y=o.arrow)==null?void 0:y.centerOffset)!==0,a=s?0:t.arrowWidth,c=s?0:t.arrowHeight,[l,d]=gM(n),h={start:"0%",center:"50%",end:"100%"}[d],p=(((S=o.arrow)==null?void 0:S.x)??0)+a/2,f=(((v=o.arrow)==null?void 0:v.y)??0)+c/2;let g="",m="";return l==="bottom"?(g=s?h:`${p}px`,m=`${-c}px`):l==="top"?(g=s?h:`${p}px`,m=`${r.floating.height+c}px`):l==="right"?(g=`${-c}px`,m=s?h:`${f}px`):l==="left"&&(g=`${r.floating.width+c}px`,m=s?h:`${f}px`),{data:{x:g,y:m}}}});function gM(t){const[e,n="center"]=t.split("-");return[e,n]}var Sv=lM,vv=uM,mM=hM,yM=fM;function hZ(t,e=[]){let n=[];function r(i,s){const a=Ze(s),c=n.length;n=[...n,s];function l(h){const{scope:p,children:f,...g}=h,m=(p==null?void 0:p[t][c])||a,y=ce(()=>g,Object.values(g));return u(m.Provider,{value:y,children:f})}function d(h,p){const f=(p==null?void 0:p[t][c])||a,g=tt(f);if(g)return g;if(s!==void 0)return s;throw new Error(`\`${h}\` must be used within \`${i}\``)}return l.displayName=i+"Provider",[l,d]}const o=()=>{const i=n.map(s=>Ze(s));return function(a){const c=(a==null?void 0:a[t])||i;return ce(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return o.scopeName=t,[r,pZ(o,...e)]}function pZ(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(i){const s=r.reduce((a,{useScope:c,scopeName:l})=>{const h=c(i)[`__scope${l}`];return{...a,...h}},{});return ce(()=>({[`__scope${e.scopeName}`]:s}),[s])}};return n.scopeName=e.scopeName,n}var Kf="rovingFocusGroup.onEntryFocus",fZ={bubbles:!1,cancelable:!0},rp="RovingFocusGroup",[Nm,SM,gZ]=Wh(rp),[mZ,vM]=hZ(rp,[gZ]),[yZ,SZ]=mZ(rp),bM=X((t,e)=>u(Nm.Provider,{scope:t.__scopeRovingFocusGroup,children:u(Nm.Slot,{scope:t.__scopeRovingFocusGroup,children:u(vZ,{...t,ref:e})})}));bM.displayName=rp;var vZ=X((t,e)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:o=!1,dir:i,currentTabStopId:s,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:c,onEntryFocus:l,preventScrollOnEntryFocus:d=!1,...h}=t,p=B(null),f=st(e,p),g=lv(i),[m=null,y]=bi({prop:s,defaultProp:a,onChange:c}),[S,v]=Q(!1),_=Vt(l),w=SM(n),x=B(!1),[C,E]=Q(0);return q(()=>{const I=p.current;if(I)return I.addEventListener(Kf,_),()=>I.removeEventListener(Kf,_)},[_]),u(yZ,{scope:n,orientation:r,dir:g,loop:o,currentTabStopId:m,onItemFocus:V(I=>y(I),[y]),onItemShiftTab:V(()=>v(!0),[]),onFocusableItemAdd:V(()=>E(I=>I+1),[]),onFocusableItemRemove:V(()=>E(I=>I-1),[]),children:u(Le.div,{tabIndex:S||C===0?-1:0,"data-orientation":r,...h,ref:f,style:{outline:"none",...t.style},onMouseDown:se(t.onMouseDown,()=>{x.current=!0}),onFocus:se(t.onFocus,I=>{const T=!x.current;if(I.target===I.currentTarget&&T&&!S){const k=new CustomEvent(Kf,fZ);if(I.currentTarget.dispatchEvent(k),!k.defaultPrevented){const D=w().filter(R=>R.focusable),A=D.find(R=>R.active),O=D.find(R=>R.id===m),z=[A,O,...D].filter(Boolean).map(R=>R.ref.current);xM(z,d)}}x.current=!1}),onBlur:se(t.onBlur,()=>v(!1))})})}),wM="RovingFocusGroupItem",_M=X((t,e)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:o=!1,tabStopId:i,...s}=t,a=Co(),c=i||a,l=SZ(wM,n),d=l.currentTabStopId===c,h=SM(n),{onFocusableItemAdd:p,onFocusableItemRemove:f}=l;return q(()=>{if(r)return p(),()=>f()},[r,p,f]),u(Nm.ItemSlot,{scope:n,id:c,focusable:r,active:o,children:u(Le.span,{tabIndex:d?0:-1,"data-orientation":l.orientation,...s,ref:e,onMouseDown:se(t.onMouseDown,g=>{r?l.onItemFocus(c):g.preventDefault()}),onFocus:se(t.onFocus,()=>l.onItemFocus(c)),onKeyDown:se(t.onKeyDown,g=>{if(g.key==="Tab"&&g.shiftKey){l.onItemShiftTab();return}if(g.target!==g.currentTarget)return;const m=_Z(g,l.orientation,l.dir);if(m!==void 0){if(g.metaKey||g.ctrlKey||g.altKey||g.shiftKey)return;g.preventDefault();let S=h().filter(v=>v.focusable).map(v=>v.ref.current);if(m==="last")S.reverse();else if(m==="prev"||m==="next"){m==="prev"&&S.reverse();const v=S.indexOf(g.currentTarget);S=l.loop?xZ(S,v+1):S.slice(v+1)}setTimeout(()=>xM(S))}})})})});_M.displayName=wM;var bZ={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function wZ(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function _Z(t,e,n){const r=wZ(t.key,n);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return bZ[r]}function xM(t,e=!1){const n=document.activeElement;for(const r of t)if(r===n||(r.focus({preventScroll:e}),document.activeElement!==n))return}function xZ(t,e){return t.map((n,r)=>t[(e+r)%t.length])}var PZ=bM,IZ=_M,Fm=["Enter"," "],CZ=["ArrowDown","PageUp","Home"],PM=["ArrowUp","PageDown","End"],EZ=[...CZ,...PM],TZ={ltr:[...Fm,"ArrowRight"],rtl:[...Fm,"ArrowLeft"]},kZ={ltr:["ArrowLeft"],rtl:["ArrowRight"]},ul="Menu",[$c,MZ,AZ]=Wh(ul),[ds,op]=as(ul,[AZ,np,vM]),hl=np(),IM=vM(),[CM,wi]=ds(ul),[OZ,pl]=ds(ul),EM=t=>{const{__scopeMenu:e,open:n=!1,children:r,dir:o,onOpenChange:i,modal:s=!0}=t,a=hl(e),[c,l]=Q(null),d=B(!1),h=Vt(i),p=lv(o);return q(()=>{const f=()=>{d.current=!0,document.addEventListener("pointerdown",g,{capture:!0,once:!0}),document.addEventListener("pointermove",g,{capture:!0,once:!0})},g=()=>d.current=!1;return document.addEventListener("keydown",f,{capture:!0}),()=>{document.removeEventListener("keydown",f,{capture:!0}),document.removeEventListener("pointerdown",g,{capture:!0}),document.removeEventListener("pointermove",g,{capture:!0})}},[]),u(Sv,{...a,children:u(CM,{scope:e,open:n,onOpenChange:h,content:c,onContentChange:l,children:u(OZ,{scope:e,onClose:V(()=>h(!1),[h]),isUsingKeyboardRef:d,dir:p,modal:s,children:r})})})};EM.displayName=ul;var DZ="MenuAnchor",bv=X((t,e)=>{const{__scopeMenu:n,...r}=t,o=hl(n);return u(vv,{...o,...r,ref:e})});bv.displayName=DZ;var wv="MenuPortal",[$Z,TM]=ds(wv,{forceMount:void 0}),kM=t=>{const{__scopeMenu:e,forceMount:n,children:r,container:o}=t,i=wi(wv,e);return u($Z,{scope:e,forceMount:n,children:u(Mr,{present:n||i.open,children:u(ll,{asChild:!0,container:o,children:r})})})};kM.displayName=wv;var cr="MenuContent",[RZ,_v]=ds(cr),MM=X((t,e)=>{const n=TM(cr,t.__scopeMenu),{forceMount:r=n.forceMount,...o}=t,i=wi(cr,t.__scopeMenu),s=pl(cr,t.__scopeMenu);return u($c.Provider,{scope:t.__scopeMenu,children:u(Mr,{present:r||i.open,children:u($c.Slot,{scope:t.__scopeMenu,children:s.modal?u(LZ,{...o,ref:e}):u(NZ,{...o,ref:e})})})})}),LZ=X((t,e)=>{const n=wi(cr,t.__scopeMenu),r=B(null),o=st(e,r);return q(()=>{const i=r.current;if(i)return XS(i)},[]),u(xv,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:se(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),NZ=X((t,e)=>{const n=wi(cr,t.__scopeMenu);return u(xv,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),xv=X((t,e)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:o,onOpenAutoFocus:i,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEntryFocus:c,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:p,onDismiss:f,disableOutsideScroll:g,...m}=t,y=wi(cr,n),S=pl(cr,n),v=hl(n),_=IM(n),w=MZ(n),[x,C]=Q(null),E=B(null),I=st(e,E,y.onContentChange),T=B(0),k=B(""),D=B(0),A=B(null),O=B("right"),$=B(0),z=g?Kh:Z,R=g?{as:Yi,allowPinchZoom:!0}:void 0,W=G=>{var Ke,We;const le=k.current+G,he=w().filter(Ee=>!Ee.disabled),ve=document.activeElement,me=(Ke=he.find(Ee=>Ee.ref.current===ve))==null?void 0:Ke.textValue,Be=he.map(Ee=>Ee.textValue),ie=XZ(Be,le,me),at=(We=he.find(Ee=>Ee.textValue===ie))==null?void 0:We.ref.current;(function Ee(Je){k.current=Je,window.clearTimeout(T.current),Je!==""&&(T.current=window.setTimeout(()=>Ee(""),1e3))})(le),at&&setTimeout(()=>at.focus())};q(()=>()=>window.clearTimeout(T.current),[]),YS();const j=V(G=>{var he,ve;return O.current===((he=A.current)==null?void 0:he.side)&&ZZ(G,(ve=A.current)==null?void 0:ve.area)},[]);return u(RZ,{scope:n,searchRef:k,onItemEnter:V(G=>{j(G)&&G.preventDefault()},[j]),onItemLeave:V(G=>{var le;j(G)||((le=E.current)==null||le.focus(),C(null))},[j]),onTriggerLeave:V(G=>{j(G)&&G.preventDefault()},[j]),pointerGraceTimerRef:D,onPointerGraceIntentChange:V(G=>{A.current=G},[]),children:u(z,{...R,children:u(Hh,{asChild:!0,trapped:o,onMountAutoFocus:se(i,G=>{var le;G.preventDefault(),(le=E.current)==null||le.focus({preventScroll:!0})}),onUnmountAutoFocus:s,children:u(cl,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:p,onDismiss:f,children:u(PZ,{asChild:!0,..._,dir:S.dir,orientation:"vertical",loop:r,currentTabStopId:x,onCurrentTabStopIdChange:C,onEntryFocus:se(c,G=>{S.isUsingKeyboardRef.current||G.preventDefault()}),preventScrollOnEntryFocus:!0,children:u(mM,{role:"menu","aria-orientation":"vertical","data-state":VM(y.open),"data-radix-menu-content":"",dir:S.dir,...v,...m,ref:I,style:{outline:"none",...m.style},onKeyDown:se(m.onKeyDown,G=>{const he=G.target.closest("[data-radix-menu-content]")===G.currentTarget,ve=G.ctrlKey||G.altKey||G.metaKey,me=G.key.length===1;he&&(G.key==="Tab"&&G.preventDefault(),!ve&&me&&W(G.key));const Be=E.current;if(G.target!==Be||!EZ.includes(G.key))return;G.preventDefault();const at=w().filter(Ke=>!Ke.disabled).map(Ke=>Ke.ref.current);PM.includes(G.key)&&at.reverse(),VZ(at)}),onBlur:se(t.onBlur,G=>{G.currentTarget.contains(G.target)||(window.clearTimeout(T.current),k.current="")}),onPointerMove:se(t.onPointerMove,Rc(G=>{const le=G.target,he=$.current!==G.clientX;if(G.currentTarget.contains(le)&&he){const ve=G.clientX>$.current?"right":"left";O.current=ve,$.current=G.clientX}}))})})})})})})});MM.displayName=cr;var FZ="MenuGroup",Pv=X((t,e)=>{const{__scopeMenu:n,...r}=t;return u(Le.div,{role:"group",...r,ref:e})});Pv.displayName=FZ;var zZ="MenuLabel",AM=X((t,e)=>{const{__scopeMenu:n,...r}=t;return u(Le.div,{...r,ref:e})});AM.displayName=zZ;var Ku="MenuItem",B1="menu.itemSelect",ip=X((t,e)=>{const{disabled:n=!1,onSelect:r,...o}=t,i=B(null),s=pl(Ku,t.__scopeMenu),a=_v(Ku,t.__scopeMenu),c=st(e,i),l=B(!1),d=()=>{const h=i.current;if(!n&&h){const p=new CustomEvent(B1,{bubbles:!0,cancelable:!0});h.addEventListener(B1,f=>r==null?void 0:r(f),{once:!0}),VS(h,p),p.defaultPrevented?l.current=!1:s.onClose()}};return u(OM,{...o,ref:c,disabled:n,onClick:se(t.onClick,d),onPointerDown:h=>{var p;(p=t.onPointerDown)==null||p.call(t,h),l.current=!0},onPointerUp:se(t.onPointerUp,h=>{var p;l.current||(p=h.currentTarget)==null||p.click()}),onKeyDown:se(t.onKeyDown,h=>{const p=a.searchRef.current!=="";n||p&&h.key===" "||Fm.includes(h.key)&&(h.currentTarget.click(),h.preventDefault())})})});ip.displayName=Ku;var OM=X((t,e)=>{const{__scopeMenu:n,disabled:r=!1,textValue:o,...i}=t,s=_v(Ku,n),a=IM(n),c=B(null),l=st(e,c),[d,h]=Q(!1),[p,f]=Q("");return q(()=>{const g=c.current;g&&f((g.textContent??"").trim())},[i.children]),u($c.ItemSlot,{scope:n,disabled:r,textValue:o??p,children:u(IZ,{asChild:!0,...a,focusable:!r,children:u(Le.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...i,ref:l,onPointerMove:se(t.onPointerMove,Rc(g=>{r?s.onItemLeave(g):(s.onItemEnter(g),g.defaultPrevented||g.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:se(t.onPointerLeave,Rc(g=>s.onItemLeave(g))),onFocus:se(t.onFocus,()=>h(!0)),onBlur:se(t.onBlur,()=>h(!1))})})})}),BZ="MenuCheckboxItem",DM=X((t,e)=>{const{checked:n=!1,onCheckedChange:r,...o}=t;return u(FM,{scope:t.__scopeMenu,checked:n,children:u(ip,{role:"menuitemcheckbox","aria-checked":Wu(n)?"mixed":n,...o,ref:e,"data-state":Ev(n),onSelect:se(o.onSelect,()=>r==null?void 0:r(Wu(n)?!0:!n),{checkForDefaultPrevented:!1})})})});DM.displayName=BZ;var $M="MenuRadioGroup",[UZ,HZ]=ds($M,{value:void 0,onValueChange:()=>{}}),RM=X((t,e)=>{const{value:n,onValueChange:r,...o}=t,i=Vt(r);return u(UZ,{scope:t.__scopeMenu,value:n,onValueChange:i,children:u(Pv,{...o,ref:e})})});RM.displayName=$M;var LM="MenuRadioItem",NM=X((t,e)=>{const{value:n,...r}=t,o=HZ(LM,t.__scopeMenu),i=n===o.value;return u(FM,{scope:t.__scopeMenu,checked:i,children:u(ip,{role:"menuitemradio","aria-checked":i,...r,ref:e,"data-state":Ev(i),onSelect:se(r.onSelect,()=>{var s;return(s=o.onValueChange)==null?void 0:s.call(o,n)},{checkForDefaultPrevented:!1})})})});NM.displayName=LM;var Iv="MenuItemIndicator",[FM,jZ]=ds(Iv,{checked:!1}),zM=X((t,e)=>{const{__scopeMenu:n,forceMount:r,...o}=t,i=jZ(Iv,n);return u(Mr,{present:r||Wu(i.checked)||i.checked===!0,children:u(Le.span,{...o,ref:e,"data-state":Ev(i.checked)})})});zM.displayName=Iv;var KZ="MenuSeparator",BM=X((t,e)=>{const{__scopeMenu:n,...r}=t;return u(Le.div,{role:"separator","aria-orientation":"horizontal",...r,ref:e})});BM.displayName=KZ;var WZ="MenuArrow",UM=X((t,e)=>{const{__scopeMenu:n,...r}=t,o=hl(n);return u(yM,{...o,...r,ref:e})});UM.displayName=WZ;var Cv="MenuSub",[GZ,HM]=ds(Cv),jM=t=>{const{__scopeMenu:e,children:n,open:r=!1,onOpenChange:o}=t,i=wi(Cv,e),s=hl(e),[a,c]=Q(null),[l,d]=Q(null),h=Vt(o);return q(()=>(i.open===!1&&h(!1),()=>h(!1)),[i.open,h]),u(Sv,{...s,children:u(CM,{scope:e,open:r,onOpenChange:h,content:l,onContentChange:d,children:u(GZ,{scope:e,contentId:Co(),triggerId:Co(),trigger:a,onTriggerChange:c,children:n})})})};jM.displayName=Cv;var rc="MenuSubTrigger",KM=X((t,e)=>{const n=wi(rc,t.__scopeMenu),r=pl(rc,t.__scopeMenu),o=HM(rc,t.__scopeMenu),i=_v(rc,t.__scopeMenu),s=B(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:c}=i,l={__scopeMenu:t.__scopeMenu},d=V(()=>{s.current&&window.clearTimeout(s.current),s.current=null},[]);return q(()=>d,[d]),q(()=>{const h=a.current;return()=>{window.clearTimeout(h),c(null)}},[a,c]),u(bv,{asChild:!0,...l,children:u(OM,{id:o.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":o.contentId,"data-state":VM(n.open),...t,ref:Uh(e,o.onTriggerChange),onClick:h=>{var p;(p=t.onClick)==null||p.call(t,h),!(t.disabled||h.defaultPrevented)&&(h.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:se(t.onPointerMove,Rc(h=>{i.onItemEnter(h),!h.defaultPrevented&&!t.disabled&&!n.open&&!s.current&&(i.onPointerGraceIntentChange(null),s.current=window.setTimeout(()=>{n.onOpenChange(!0),d()},100))})),onPointerLeave:se(t.onPointerLeave,Rc(h=>{var f,g;d();const p=(f=n.content)==null?void 0:f.getBoundingClientRect();if(p){const m=(g=n.content)==null?void 0:g.dataset.side,y=m==="right",S=y?-5:5,v=p[y?"left":"right"],_=p[y?"right":"left"];i.onPointerGraceIntentChange({area:[{x:h.clientX+S,y:h.clientY},{x:v,y:p.top},{x:_,y:p.top},{x:_,y:p.bottom},{x:v,y:p.bottom}],side:m}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(h),h.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:se(t.onKeyDown,h=>{var f;const p=i.searchRef.current!=="";t.disabled||p&&h.key===" "||TZ[r.dir].includes(h.key)&&(n.onOpenChange(!0),(f=n.content)==null||f.focus(),h.preventDefault())})})})});KM.displayName=rc;var WM="MenuSubContent",GM=X((t,e)=>{const n=TM(cr,t.__scopeMenu),{forceMount:r=n.forceMount,...o}=t,i=wi(cr,t.__scopeMenu),s=pl(cr,t.__scopeMenu),a=HM(WM,t.__scopeMenu),c=B(null),l=st(e,c);return u($c.Provider,{scope:t.__scopeMenu,children:u(Mr,{present:r||i.open,children:u($c.Slot,{scope:t.__scopeMenu,children:u(xv,{id:a.contentId,"aria-labelledby":a.triggerId,...o,ref:l,align:"start",side:s.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{var h;s.isUsingKeyboardRef.current&&((h=c.current)==null||h.focus()),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:se(t.onFocusOutside,d=>{d.target!==a.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:se(t.onEscapeKeyDown,d=>{s.onClose(),d.preventDefault()}),onKeyDown:se(t.onKeyDown,d=>{var f;const h=d.currentTarget.contains(d.target),p=kZ[s.dir].includes(d.key);h&&p&&(i.onOpenChange(!1),(f=a.trigger)==null||f.focus(),d.preventDefault())})})})})})});GM.displayName=WM;function VM(t){return t?"open":"closed"}function Wu(t){return t==="indeterminate"}function Ev(t){return Wu(t)?"indeterminate":t?"checked":"unchecked"}function VZ(t){const e=document.activeElement;for(const n of t)if(n===e||(n.focus(),document.activeElement!==e))return}function YZ(t,e){return t.map((n,r)=>t[(e+r)%t.length])}function XZ(t,e,n){const o=e.length>1&&Array.from(e).every(l=>l===e[0])?e[0]:e,i=n?t.indexOf(n):-1;let s=YZ(t,Math.max(i,0));o.length===1&&(s=s.filter(l=>l!==n));const c=s.find(l=>l.toLowerCase().startsWith(o.toLowerCase()));return c!==n?c:void 0}function qZ(t,e){const{x:n,y:r}=t;let o=!1;for(let i=0,s=e.length-1;i<e.length;s=i++){const a=e[i].x,c=e[i].y,l=e[s].x,d=e[s].y;c>r!=d>r&&n<(l-a)*(r-c)/(d-c)+a&&(o=!o)}return o}function ZZ(t,e){if(!e)return!1;const n={x:t.clientX,y:t.clientY};return qZ(n,e)}function Rc(t){return e=>e.pointerType==="mouse"?t(e):void 0}var YM=EM,XM=bv,qM=kM,ZM=MM,JM=Pv,QM=AM,eA=ip,tA=DM,nA=RM,rA=NM,oA=zM,iA=BM,sA=UM,aA=jM,cA=KM,lA=GM,Tv="ContextMenu",[JZ,xae]=as(Tv,[op]),ln=op(),[QZ,dA]=JZ(Tv),uA=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:r,dir:o,modal:i=!0}=t,[s,a]=Q(!1),c=ln(e),l=Vt(r),d=V(h=>{a(h),l(h)},[l]);return u(QZ,{scope:e,open:s,onOpenChange:d,modal:i,children:u(YM,{...c,dir:o,open:s,onOpenChange:d,modal:i,children:n})})};uA.displayName=Tv;var hA="ContextMenuTrigger",pA=X((t,e)=>{const{__scopeContextMenu:n,disabled:r=!1,...o}=t,i=dA(hA,n),s=ln(n),a=B({x:0,y:0}),c=B({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),l=B(0),d=V(()=>window.clearTimeout(l.current),[]),h=p=>{a.current={x:p.clientX,y:p.clientY},i.onOpenChange(!0)};return q(()=>d,[d]),q(()=>void(r&&d()),[r,d]),u(Z,{children:[u(XM,{...s,virtualRef:c}),u(Le.span,{"data-state":i.open?"open":"closed","data-disabled":r?"":void 0,...o,ref:e,style:{WebkitTouchCallout:"none",...t.style},onContextMenu:r?t.onContextMenu:se(t.onContextMenu,p=>{d(),h(p),p.preventDefault()}),onPointerDown:r?t.onPointerDown:se(t.onPointerDown,od(p=>{d(),l.current=window.setTimeout(()=>h(p),700)})),onPointerMove:r?t.onPointerMove:se(t.onPointerMove,od(d)),onPointerCancel:r?t.onPointerCancel:se(t.onPointerCancel,od(d)),onPointerUp:r?t.onPointerUp:se(t.onPointerUp,od(d))})]})});pA.displayName=hA;var eJ="ContextMenuPortal",kv=t=>{const{__scopeContextMenu:e,...n}=t,r=ln(e);return u(qM,{...r,...n})};kv.displayName=eJ;var fA="ContextMenuContent",gA=X((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=dA(fA,n),i=ln(n),s=B(!1);return u(ZM,{...i,...r,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{var c;(c=t.onCloseAutoFocus)==null||c.call(t,a),!a.defaultPrevented&&s.current&&a.preventDefault(),s.current=!1},onInteractOutside:a=>{var c;(c=t.onInteractOutside)==null||c.call(t,a),!a.defaultPrevented&&!o.modal&&(s.current=!0)},style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});gA.displayName=fA;var tJ="ContextMenuGroup",mA=X((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ln(n);return u(JM,{...o,...r,ref:e})});mA.displayName=tJ;var nJ="ContextMenuLabel",rJ=X((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ln(n);return u(QM,{...o,...r,ref:e})});rJ.displayName=nJ;var oJ="ContextMenuItem",yA=X((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ln(n);return u(eA,{...o,...r,ref:e})});yA.displayName=oJ;var iJ="ContextMenuCheckboxItem",SA=X((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ln(n);return u(tA,{...o,...r,ref:e})});SA.displayName=iJ;var sJ="ContextMenuRadioGroup",aJ=X((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ln(n);return u(nA,{...o,...r,ref:e})});aJ.displayName=sJ;var cJ="ContextMenuRadioItem",lJ=X((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ln(n);return u(rA,{...o,...r,ref:e})});lJ.displayName=cJ;var dJ="ContextMenuItemIndicator",uJ=X((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ln(n);return u(oA,{...o,...r,ref:e})});uJ.displayName=dJ;var hJ="ContextMenuSeparator",pJ=X((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ln(n);return u(iA,{...o,...r,ref:e})});pJ.displayName=hJ;var fJ="ContextMenuArrow",gJ=X((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ln(n);return u(sA,{...o,...r,ref:e})});gJ.displayName=fJ;var mJ="ContextMenuSub",vA=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:r,open:o,defaultOpen:i}=t,s=ln(e),[a,c]=bi({prop:o,defaultProp:i,onChange:r});return u(aA,{...s,open:a,onOpenChange:c,children:n})};vA.displayName=mJ;var yJ="ContextMenuSubTrigger",bA=X((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ln(n);return u(cA,{...o,...r,ref:e})});bA.displayName=yJ;var SJ="ContextMenuSubContent",wA=X((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ln(n);return u(lA,{...o,...r,ref:e,style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});wA.displayName=SJ;function od(t){return e=>e.pointerType!=="mouse"?t(e):void 0}var vJ=uA,bJ=pA,wJ=kv,_J=gA,xJ=SA,Mv="DropdownMenu",[PJ,Pae]=as(Mv,[op]),dn=op(),[IJ,_A]=PJ(Mv),xA=t=>{const{__scopeDropdownMenu:e,children:n,dir:r,open:o,defaultOpen:i,onOpenChange:s,modal:a=!0}=t,c=dn(e),l=B(null),[d=!1,h]=bi({prop:o,defaultProp:i,onChange:s});return u(IJ,{scope:e,triggerId:Co(),triggerRef:l,contentId:Co(),open:d,onOpenChange:h,onOpenToggle:V(()=>h(p=>!p),[h]),modal:a,children:u(YM,{...c,open:d,onOpenChange:h,dir:r,modal:a,children:n})})};xA.displayName=Mv;var PA="DropdownMenuTrigger",IA=X((t,e)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...o}=t,i=_A(PA,n),s=dn(n);return u(XM,{asChild:!0,...s,children:u(Le.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...o,ref:Uh(e,i.triggerRef),onPointerDown:se(t.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(i.onOpenToggle(),i.open||a.preventDefault())}),onKeyDown:se(t.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&i.onOpenToggle(),a.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});IA.displayName=PA;var CJ="DropdownMenuPortal",CA=t=>{const{__scopeDropdownMenu:e,...n}=t,r=dn(e);return u(qM,{...r,...n})};CA.displayName=CJ;var EA="DropdownMenuContent",TA=X((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=_A(EA,n),i=dn(n),s=B(!1);return u(ZM,{id:o.contentId,"aria-labelledby":o.triggerId,...i,...r,ref:e,onCloseAutoFocus:se(t.onCloseAutoFocus,a=>{var c;s.current||(c=o.triggerRef.current)==null||c.focus(),s.current=!1,a.preventDefault()}),onInteractOutside:se(t.onInteractOutside,a=>{const c=a.detail.originalEvent,l=c.button===0&&c.ctrlKey===!0,d=c.button===2||l;(!o.modal||d)&&(s.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});TA.displayName=EA;var EJ="DropdownMenuGroup",kA=X((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dn(n);return u(JM,{...o,...r,ref:e})});kA.displayName=EJ;var TJ="DropdownMenuLabel",kJ=X((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dn(n);return u(QM,{...o,...r,ref:e})});kJ.displayName=TJ;var MJ="DropdownMenuItem",MA=X((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dn(n);return u(eA,{...o,...r,ref:e})});MA.displayName=MJ;var AJ="DropdownMenuCheckboxItem",AA=X((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dn(n);return u(tA,{...o,...r,ref:e})});AA.displayName=AJ;var OJ="DropdownMenuRadioGroup",DJ=X((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dn(n);return u(nA,{...o,...r,ref:e})});DJ.displayName=OJ;var $J="DropdownMenuRadioItem",RJ=X((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dn(n);return u(rA,{...o,...r,ref:e})});RJ.displayName=$J;var LJ="DropdownMenuItemIndicator",NJ=X((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dn(n);return u(oA,{...o,...r,ref:e})});NJ.displayName=LJ;var FJ="DropdownMenuSeparator",zJ=X((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dn(n);return u(iA,{...o,...r,ref:e})});zJ.displayName=FJ;var BJ="DropdownMenuArrow",UJ=X((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dn(n);return u(sA,{...o,...r,ref:e})});UJ.displayName=BJ;var HJ=t=>{const{__scopeDropdownMenu:e,children:n,open:r,onOpenChange:o,defaultOpen:i}=t,s=dn(e),[a=!1,c]=bi({prop:r,defaultProp:i,onChange:o});return u(aA,{...s,open:a,onOpenChange:c,children:n})},jJ="DropdownMenuSubTrigger",OA=X((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dn(n);return u(cA,{...o,...r,ref:e})});OA.displayName=jJ;var KJ="DropdownMenuSubContent",DA=X((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dn(n);return u(lA,{...o,...r,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});DA.displayName=KJ;var Av=xA,Ov=IA,sp=CA,Dv=TA,WJ=kA,GJ=MA,VJ=AA,YJ=HJ,XJ=OA,qJ=DA;function No(){const t=xS();return U("isReadonlyMode",()=>!!(t!=null&&t.getIsReadonly()),[t])}const Wf=[0,389,436,476,580,640,840,1023];var wt=(t=>(t[t.ZERO=0]="ZERO",t[t.MOBILE_XXS=1]="MOBILE_XXS",t[t.MOBILE_XS=2]="MOBILE_XS",t[t.MOBILE_SM=3]="MOBILE_SM",t[t.MOBILE=4]="MOBILE",t[t.TABLET_SM=5]="TABLET_SM",t[t.TABLET=6]="TABLET",t[t.DESKTOP=7]="DESKTOP",t))(wt||{});const $A=we.createContext(null);function ZJ({forceMobile:t=!1,children:e}){const n=F(),r=U("breakpoint",()=>{const{width:o}=n.getViewportScreenBounds(),i=t?wt.MOBILE_SM:Wf.length-1;for(let s=0;s<i;s++)if(o>Wf[s]&&o<=Wf[s+1])return s;return i},[n]);return u($A.Provider,{value:r,children:e})}function Sn(){const t=tt($A);if(t===null)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return t}const JJ=et.isDarwin?"⌘":"Ctrl",QJ=et.isDarwin?"⌥":"Alt";function RA(t){return t===","?[","]:t.split(",")[0].split("").map(e=>{const n=e.replace(/\$/g,JJ).replace(/\?/g,QJ).replace(/!/g,"⇧");return n[0].toUpperCase()+n.slice(1)})}function zm(t){return"— "+RA(t).join(" ")}function mc({children:t,visibleOnMobileLayout:e=!1}){const n=Sn();return!e&&n<wt.MOBILE?null:u("kbd",{className:"tlui-kbd",children:RA(t).map((r,o)=>u("span",{children:r},o))})}const LA=Ze(null);function ap(){const t=tt(LA);if(!t)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return t}function lr({type:t,sourceId:e,children:n}){return u(LA.Provider,{value:{type:t,sourceId:e},children:n})}function cp({id:t,kbd:e,label:n,readonlyOk:r,onSelect:o,toggle:i=!1,disabled:s=!1,checked:a=!1}){const{type:c,sourceId:l}=ap(),d=No(),h=Ae();if(d&&!r)return null;const p=Ac(n,c),f=p?h(p):void 0;switch(c){case"menu":return u(VJ,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:f,onSelect:g=>{o==null||o(l),Ce(g)},disabled:s,checked:a,children:[u(Xr,{small:!0,icon:i?a?"toggle-on":"toggle-off":a?"check":"none"}),f&&u("span",{className:"tlui-button__label",draggable:!1,children:f}),e&&u(mc,{children:e})]});case"context-menu":return u(xJ,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:f,onSelect:g=>{o(l),Ce(g)},disabled:s,checked:a,children:[u(Xr,{small:!0,icon:i?a?"toggle-on":"toggle-off":a?"check":"none"}),f&&u("span",{className:"tlui-button__label",draggable:!1,children:f}),e&&u(mc,{children:e})]},t);default:return null}}function Or({actionId:t="",...e}){const r=ls()[t];return r?u(cp,{...r,...e}):null}function eQ(t){return u("svg",{width:16,height:16,viewBox:"0 0 16 16",...t,children:u("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[u("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),u("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:u("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}function Fo(t,e){const n=xS(),r=V(s=>{s&&(n==null||n.complete()),e==null||e(s)},[n,e]),o=Xt(),i=V(s=>{o(s,{source:"unknown",id:t})},[t,o]);return CG(n?`${t}-${n.contextId}`:t,r,i)}function Zi({id:t,children:e,modal:n=!1,debugOpen:r=!1}){const[o,i]=Fo(t);return u(Av,{open:r||o,dir:"ltr",modal:n,onOpenChange:i,children:e})}function Ji({children:t,...e}){return u(Ov,{dir:"ltr",asChild:!0,onTouchEnd:n=>Ce(n),...e,children:t})}function Qi({className:t,side:e="bottom",align:n="start",sideOffset:r=8,alignOffset:o=8,children:i}){const s=At();return u(sp,{container:s,children:u(Dv,{className:de("tlui-menu",t),side:e,sideOffset:r,align:n,alignOffset:o,collisionPadding:4,children:i})})}function tQ({id:t,children:e}){const[n,r]=Fo(t);return u(YJ,{open:n,onOpenChange:r,children:e})}function nQ({id:t,label:e,title:n,disabled:r}){return u(XJ,{dir:"ltr",asChild:!0,disabled:r,children:u(ue,{"data-testid":t,type:"menu",className:"tlui-menu__submenu__trigger",disabled:r,title:n,children:[u(It,{children:e}),u(ke,{icon:"chevron-right",small:!0})]})})}function rQ({id:t,alignOffset:e=-1,sideOffset:n=-4,size:r="small",children:o}){const i=At();return u(sp,{container:i,children:u(qJ,{"data-testid":t,className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:n,collisionPadding:4,"data-size":r,children:o})})}function oQ({children:t}){return u(WJ,{dir:"ltr",className:"tlui-menu__group",children:t})}function Lc({noClose:t,children:e}){return u(GJ,{dir:"ltr",asChild:!0,onClick:t?Ce:void 0,children:e})}function jt({disabled:t=!1,spinner:e=!1,readonlyOk:n=!1,id:r,kbd:o,label:i,icon:s,onSelect:a,noClose:c,isSelected:l}){const{type:d,sourceId:h}=ap(),p=Ae(),[f,g]=Q(!1);if(No()&&!n)return null;const y=Ac(i,d),S=o?zm(o):void 0,v=y?p(y):void 0,_=v&&S?`${v} ${S}`:v;switch(d){case"menu":return u(Lc,{children:u(ue,{type:"menu","data-testid":`${h}.${r}`,disabled:t,title:_,onClick:w=>{c&&Ce(w),f?g(!1):a(h)},children:[u(It,{children:v}),o&&u(mc,{children:o})]})});case"context-menu":return t?null:u(yA,{dir:"ltr",title:_,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${h}.${r}`,onSelect:w=>{c&&Ce(w),f?g(!1):a(h)},children:[u("span",{className:"tlui-button__label",draggable:!1,children:v}),o&&u(mc,{children:o}),e&&u(eQ,{})]});case"panel":return u(ue,{"data-testid":`${h}.${r}`,type:"menu",title:_,disabled:t,onClick:()=>a(h),children:[u(It,{children:v}),s&&u(ke,{icon:s})]});case"small-icons":case"icons":return u(ue,{"data-testid":`${h}.${r}`,type:"icon",title:_,disabled:t,onClick:()=>a(h),children:u(ke,{icon:s,small:d==="small-icons"})});case"keyboard-shortcuts":return o?u("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${h}.${r}`,children:[u("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:v}),u("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:u(mc,{visibleOnMobileLayout:!0,children:o})})]}):(console.warn(`Menu item '${i}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return u(ue,{type:"low",onClick:()=>a(h),children:[u(ke,{icon:s}),u(It,{children:v})]});case"toolbar":return u(ue,{type:"tool","data-testid":`tools.${r}`,"aria-label":y,"data-value":r,onClick:()=>a("toolbar"),title:_,disabled:t,onTouchStart:w=>{Ce(w),a("toolbar")},role:"radio","aria-checked":l?"true":"false",children:u(ke,{icon:s})});case"toolbar-overflow":return u(Lc,{"aria-label":i,children:u(ue,{type:"icon",className:"tlui-button-grid__button",onClick:()=>{a("toolbar")},"data-testid":`tools.more.${r}`,title:_,disabled:t,role:"radio","aria-checked":l?"true":"false","data-value":r,children:u(ke,{icon:s})})});default:throw $t(d)}}function H({actionId:t="",...e}){const r=ls()[t];return r?u(jt,{...r,...e}):null}const NA=Ze(null);function iQ({overrides:t,children:e}){const n=F(),r=Xt(),{addDialog:o}=cs(),i=Xk(),s=ce(()=>{const a=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(l){if(n.isIn("select")){const d=n.root.getCurrent();d.exit({},d.id),d.enter({},d.id)}n.setCurrentTool("select"),r("select-tool",{source:l,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(l){n.setCurrentTool("hand"),r("select-tool",{source:l,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(l){n.setCurrentTool("eraser"),r("select-tool",{source:l,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(l){n.setCurrentTool("draw"),r("select-tool",{source:l,id:"draw"})}},...[...br.values].map(l=>({id:l,label:`tool.${l}`,meta:{geo:l},kbd:l==="rectangle"?"r":l==="ellipse"?"o":void 0,icon:"geo-"+l,onSelect(d){n.run(()=>{n.setStyleForNextShapes(br,l),n.setCurrentTool("geo"),r("select-tool",{source:d,id:`geo-${l}`})})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(l){n.setCurrentTool("arrow"),r("select-tool",{source:l,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(l){n.setCurrentTool("line"),r("select-tool",{source:l,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(l){n.setCurrentTool("frame"),r("select-tool",{source:l,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(l){n.setCurrentTool("text"),r("select-tool",{source:l,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(l){i(),r("select-tool",{source:l,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(l){n.setCurrentTool("note"),r("select-tool",{source:l,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(l){n.setCurrentTool("laser"),r("select-tool",{source:l,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(l){o({component:Bk}),r("select-tool",{source:l,id:"embed"})}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(l){n.setCurrentTool("highlight"),r("select-tool",{source:l,id:"highlight"})}}];a.push();const c=Object.fromEntries(a.map(l=>[l.id,l]));return t?t(n,c,{insertMedia:i}):c},[t,n,r,i,o]);return u(NA.Provider,{value:s,children:e})}function $v(){const t=tt(NA);if(!t)throw new Error("useTools must be used within a ToolProvider");return t}function xn({toolId:t="",...e}){const r=$v()[t];return r?u(jt,{...r,...e}):null}function sQ({children:t}){const e=F();return U("shouldDisplayHandles",()=>{if(e.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(e.isInAny("select.editing_shape")){const r=e.getOnlySelectedShape();return r&&e.isShapeOfType(r,"note")}return!1},[e])?u("svg",{className:"tl-user-handles tl-overlays__item",children:t}):null}const{PI:aQ}=Math,Ws=aQ+1e-4;function FA(t,e={}){const{size:n=16,smoothing:r=.5}=e;if(t.length===0||n<=0)return{left:[],right:[]};const o=t[0],i=t[t.length-1],s=i.runningLength,a=Math.pow(n*r,2),c=[],l=[];let d=t[0].vector,h=t[0].point,p=h,f=h,g=p,m=!1,y;for(let S=0;S<t.length;S++){y=t[S];const{point:v,vector:_}=t[S],w=y.vector.dpr(d),x=(S<t.length-1?t[S+1]:t[S]).vector,C=S<t.length-1?x.dpr(y.vector):1,E=w<0&&!m,I=C!==null&&C<.2;if(E||I){if(C>-.62&&s-y.runningLength>y.radius){const k=d.clone().mul(y.radius);d.clone().cpr(x)<0?(f=b.Add(v,k),g=b.Sub(v,k)):(f=b.Sub(v,k),g=b.Add(v,k)),c.push(f),l.push(g)}else{const k=d.clone().mul(y.radius).per(),D=b.Sub(y.input,k);for(let A=1/13,O=0;O<1;O+=A)f=b.RotWith(D,y.input,Ws*O),c.push(f),g=b.RotWith(D,y.input,Ws+Ws*-O),l.push(g)}h=f,p=g,I&&(m=!0);continue}if(m=!1,y===o||y===i){const k=b.Per(_).mul(y.radius);c.push(b.Sub(v,k)),l.push(b.Add(v,k));continue}const T=b.Lrp(x,_,C).per().mul(y.radius);f=b.Sub(v,T),(S<=1||b.Dist2(h,f)>a)&&(c.push(f),h=f),g=b.Add(v,T),(S<=1||b.Dist2(p,g)>a)&&(l.push(g),p=g),d=_}return{left:c,right:l}}function Rv(t,e={}){const{size:n=16,start:r={},end:o={},last:i=!1}=e,{cap:s=!0}=r,{cap:a=!0}=o;if(t.length===0||n<=0)return[];const c=t[0],l=t[t.length-1],d=l.runningLength,h=r.taper===!1?0:r.taper===!0?Math.max(n,d):r.taper,p=o.taper===!1?0:o.taper===!0?Math.max(n,d):o.taper,{left:f,right:g}=FA(t,e),m=c.point,y=t.length>1?t[t.length-1].point:b.AddXY(c.point,1,1);if(t.length===1&&(!(h||p)||i)){const w=b.Add(m,b.Sub(m,y).uni().per().mul(-c.radius)),x=[];for(let C=1/13,E=C;E<=1;E+=C)x.push(b.RotWith(w,m,Ws*2*E));return x}const S=[];if(!(h||p&&t.length===1))if(s)for(let w=1/8,x=w;x<=1;x+=w){const C=b.RotWith(g[0],m,Ws*x);S.push(C)}else{const w=b.Sub(f[0],g[0]),x=b.Mul(w,.5),C=b.Mul(w,.51);S.push(b.Sub(m,x),b.Sub(m,C),b.Add(m,C),b.Add(m,x))}const v=[],_=l.vector.clone().per().neg();if(p||h&&t.length===1)v.push(y);else if(a){const w=b.Add(y,b.Mul(_,l.radius));for(let x=1/29,C=x;C<1;C+=x)v.push(b.RotWith(w,y,Ws*3*C))}else v.push(b.Add(y,b.Mul(_,l.radius)),b.Add(y,b.Mul(_,l.radius*.99)),b.Sub(y,b.Mul(_,l.radius*.99)),b.Sub(y,b.Mul(_,l.radius)));return f.concat(v,g.reverse(),S)}const cQ=.025,lQ=.01;function Zr(t,e={}){var y;const{streamline:n=.5,size:r=16,simulatePressure:o=!1}=e;if(t.length===0)return[];const i=.15+(1-n)*.85;let s=t.map(b.From),a=0;if(!o){let S=s[0];for(;S&&!(S.z>=cQ);)s.shift(),S=s[0]}if(!o){let S=s[s.length-1];for(;S&&!(S.z>=lQ);)s.pop(),S=s[s.length-1]}if(s.length===0)return[{point:b.From(t[0]),input:b.From(t[0]),pressure:o?.5:.15,vector:new b(1,1),distance:0,runningLength:0,radius:1}];let c=s[1];for(;c&&!(b.Dist2(c,s[0])>(r/3)**2);)s[0].z=Math.max(s[0].z,c.z),s.splice(1,1),c=s[1];const l=s.pop();for(c=s[s.length-1];c&&!(b.Dist2(c,l)>(r/3)**2);)s.pop(),c=s[s.length-1],a++;s.push(l);const d=e.last||!e.simulatePressure||s.length>1&&b.Dist2(s[s.length-1],s[s.length-2])<r**2||a>0;if(s.length===2&&e.simulatePressure){const S=s[1];s=s.slice(0,-1);for(let v=1;v<5;v++){const _=b.Lrp(s[0],S,v/4);_.z=(s[0].z+(S.z-s[0].z))*v/4,s.push(_)}}const h=[{point:s[0],input:s[0],pressure:o?.5:s[0].z,vector:new b(1,1),distance:0,runningLength:0,radius:1}];let p=0,f=h[0],g,m;d&&n>0&&s.push(s[s.length-1].clone());for(let S=1,v=s.length;S<v;S++)g=!i||e.last&&S===v-1?s[S].clone():s[S].clone().lrp(f.point,1-i),!f.point.equals(g)&&(m=b.Dist(g,f.point),p+=m,!(S<4&&p<r)&&(f={input:s[S],point:g,pressure:o?.5:s[S].z,vector:b.Sub(f.point,g).uni(),distance:m,runningLength:p,radius:1},h.push(f)));if((y=h[1])!=null&&y.vector&&(h[0].vector=h[1].vector.clone()),p<1){const S=Math.max(.5,...h.map(v=>v.pressure));h.forEach(v=>v.pressure=S)}return h}const{min:Wo}=Math,Gf=.275;function lp(t,e){const{size:n=16,thinning:r=.5,simulatePressure:o=!0,easing:i=y=>y,start:s={},end:a={}}=e,{easing:c=Rt.easeOutQuad}=s,{easing:l=Rt.easeOutCubic}=a,d=t[t.length-1].runningLength;let h,p=t[0].pressure,f;if(!o&&d<n){const y=t.reduce((S,v)=>Math.max(S,v.pressure),.5);return t.forEach(S=>{S.pressure=y,S.radius=n*i(.5-r*(.5-S.pressure))}),t}else{let y;for(let S=0,v=t.length;S<v&&(f=t[S],!(f.runningLength>n*5));S++){const _=Wo(1,f.distance/n);if(o){const w=Wo(1,1-_);y=Wo(1,p+(w-p)*(_*Gf))}else y=Wo(1,p+(f.pressure-p)*.5);p=p+(y-p)*.5}for(let S=0;S<t.length;S++){if(f=t[S],r){let{pressure:v}=f;const _=Wo(1,f.distance/n);if(o){const w=Wo(1,1-_);v=Wo(1,p+(w-p)*(_*Gf))}else v=Wo(1,p+(v-p)*(_*Gf));f.radius=n*i(.5-r*(.5-v)),p=v}else f.radius=n/2;h===void 0&&(h=f.radius)}}const g=s.taper===!1?0:s.taper===!0?Math.max(n,d):s.taper,m=a.taper===!1?0:a.taper===!0?Math.max(n,d):a.taper;if(g||m)for(let y=0;y<t.length;y++){f=t[y];const{runningLength:S}=f,v=S<g?c(S/g):1,_=d-S<m?l((d-S)/m):1;f.radius=Math.max(.01,f.radius*Math.min(v,_))}return t}function dQ(t,e={}){return Rv(lp(Zr(t,e),e),e)}function U1({scribble:t,zoom:e,color:n,opacity:r,className:o}){if(!t.points.length)return null;const i=dQ(t.points,{size:t.size/e,start:{taper:t.taper,easing:Rt.linear},last:t.state==="stopping",simulatePressure:!1,streamline:.32});let s;if(i.length<4){const a=t.size/e/2,{x:c,y:l}=t.points[t.points.length-1];s=`M ${c-a},${l} a ${a},${a} 0 1,0 ${a*2},0 a ${a},${a} 0 1,0 ${-a*2},0`}else s=ES(i);return u("svg",{className:o&&de("tl-overlays__item",o),children:u("path",{className:"tl-scribble",d:s,fill:n??`var(--color-${t.color})`,opacity:r??t.opacity})})}const uQ=({bounds:t,rotation:e})=>{const n=F();return U("should display",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[n])?u(gC,{bounds:t,rotation:e}):null};function hQ({size:t,width:e,height:n,hideAlternateHandles:r}){const o=N(t/3),i=o/2;return u("svg",{className:"tl-overlays__item",children:[u("polyline",{className:"tl-corner-crop-handle",points:`
						${N(0-i)},${N(t)} 
						${N(0-i)},${N(0-i)} 
						${N(t)},${N(0-i)}`,strokeWidth:o,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),u("line",{className:de("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:N(e/2-t),y1:N(0-i),x2:N(e/2+t),y2:N(0-i),strokeWidth:o,"data-testid":"selection.crop.top","aria-label":"top handle"}),u("polyline",{className:de("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${N(e-t)},${N(0-i)} 
						${N(e+i)},${N(0-i)} 
						${N(e+i)},${N(t)}`,strokeWidth:o,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),u("line",{className:de("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:N(e+i),y1:N(n/2-t),x2:N(e+i),y2:N(n/2+t),strokeWidth:o,"data-testid":"selection.crop.right","aria-label":"right handle"}),u("polyline",{className:"tl-corner-crop-handle",points:`
						${N(e+i)},${N(n-t)} 
						${N(e+i)},${N(n+i)}
						${N(e-t)},${N(n+i)}`,strokeWidth:o,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),u("line",{className:de("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:N(e/2-t),y1:N(n+i),x2:N(e/2+t),y2:N(n+i),strokeWidth:o,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),u("polyline",{className:de("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${N(0+t)},${N(n+i)} 
						${N(0-i)},${N(n+i)}
						${N(0-i)},${N(n-t)}`,strokeWidth:o,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),u("line",{className:de("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:N(0-i),y1:N(n/2-t),x2:N(0-i),y2:N(n/2+t),strokeWidth:o,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const pQ=Nt(function({bounds:e,rotation:n}){const r=F(),o=B(null),i=No(),s=Lr("top"),a=Lr("right"),c=Lr("bottom"),l=Lr("left"),d=Lr("top_left"),h=Lr("top_right"),p=Lr("bottom_right"),f=Lr("bottom_left"),g=!r.menus.hasAnyOpenMenus()&&r.getInstanceState().cursor.type==="default",m=r.getInstanceState().isCoarsePointer,y=r.getOnlySelectedShape(),S=y&&r.isShapeOrAncestorLocked(y),v=y?r.getShapeUtil(y).expandSelectionOutlinePx(y):0;if(Sa(o,e==null?void 0:e.x,e==null?void 0:e.y,1,r.getSelectionRotation(),{x:-v,y:-v}),y&&r.isShapeHidden(y)||!e)return null;e=e.clone().expandBy(v).zeroFix();const _=r.getZoomLevel(),w=r.getInstanceState().isChangingStyle,x=e.width,C=e.height,E=8/_,I=x<E*2,T=C<E*2,k=x<E*4,D=C<E*4,A=x<E*5,O=C<E*5,$=m?1.75:1,z=6/_*$,R=(k?z/2:z)*($*.75),W=(D?z/2:z)*($*.75),j=(y?!r.getShapeUtil(y).hideSelectionBoundsFg(y):!0)&&!w;let G=j&&r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||j&&r.isIn("select.resizing")&&y&&r.isShapeOfType(y,"text");y&&G&&et.isFirefox&&r.isShapeOfType(y,"embed")&&(G=!1);const le=r.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!w&&!i,he=r.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!w&&!i,ve=!m&&!(I||T)&&(he||le)&&(y?!r.getShapeUtil(y).hideRotateHandle(y):!0)&&!S,me=m&&(!k||!D)&&(he||le)&&(y?!r.getShapeUtil(y).hideRotateHandle(y):!0)&&!S,Be=he&&(y?r.getShapeUtil(y).canResize(y)&&!r.getShapeUtil(y).hideResizeHandles(y):!0)&&!le&&!S,ie=I||T,at=I&&T,Ke=A||O,We=Be||le,Ee=!ve,Je=!he||!me,Ne=!he||!We,vt=!he||!We||ie,Ft=!he||!We||ie,bn=!he||!We||at&&!le;let _t=!0,qt=!0;if(le)_t=Ke,qt=Ke;else if(Be){_t=ie||at||m;const Bo=m&&y&&y.type==="text";qt=_t&&!Bo}const oo=Math.min(24/_,C-W*3),Ta=he&&m&&y&&r.isShapeOfType(y,"text")&&oo*_>=4;return u("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:u("g",{ref:o,children:[G&&u("rect",{className:"tl-selection__fg__outline",width:N(x),height:N(C)}),u(id,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:z,corner:"top_left_rotate",cursor:g?zn("nwse-rotate",n):void 0,isHidden:Ee}),u(id,{"data-testid":"selection.rotate.top-right",cx:x+z*3,cy:0,targetSize:z,corner:"top_right_rotate",cursor:g?zn("nesw-rotate",n):void 0,isHidden:Ee}),u(id,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:C+z*3,targetSize:z,corner:"bottom_left_rotate",cursor:g?zn("swne-rotate",n):void 0,isHidden:Ee}),u(id,{"data-testid":"selection.rotate.bottom-right",cx:x+z*3,cy:C+z*3,targetSize:z,corner:"bottom_right_rotate",cursor:g?zn("senw-rotate",n):void 0,isHidden:Ee}),u(gQ,{"data-testid":"selection.rotate.mobile",cx:k?-z*1.5:x/2,cy:k?C/2:-z*1.5,size:E,isHidden:Je}),u("rect",{className:de("tl-transparent",{"tl-hidden":_t}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:N(0-(D?W*2:W)),width:N(x),height:N(Math.max(1,W*2)),style:g?{cursor:zn("ns-resize",n)}:void 0,...s}),u("rect",{className:de("tl-transparent",{"tl-hidden":qt}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:N(x-(k?0:R)),y:0,height:N(C),width:N(Math.max(1,R*2)),style:g?{cursor:zn("ew-resize",n)}:void 0,...a}),u("rect",{className:de("tl-transparent",{"tl-hidden":_t}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:N(C-(D?0:W)),width:N(x),height:N(Math.max(1,W*2)),style:g?{cursor:zn("ns-resize",n)}:void 0,...c}),u("rect",{className:de("tl-transparent",{"tl-hidden":qt}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:N(0-(k?R*2:R)),y:0,height:N(C),width:N(Math.max(1,R*2)),style:g?{cursor:zn("ew-resize",n)}:void 0,...l}),u("rect",{className:de("tl-transparent",{"tl-hidden":Ne}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:N(0-(k?R*2:R*1.5)),y:N(0-(D?W*2:W*1.5)),width:N(R*3),height:N(W*3),style:g?{cursor:zn("nwse-resize",n)}:void 0,...d}),u("rect",{className:de("tl-transparent",{"tl-hidden":vt}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:N(x-(k?0:R*1.5)),y:N(0-(D?W*2:W*1.5)),width:N(R*3),height:N(W*3),style:g?{cursor:zn("nesw-resize",n)}:void 0,...h}),u("rect",{className:de("tl-transparent",{"tl-hidden":bn}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:N(x-(k?R:R*1.5)),y:N(C-(D?W:W*1.5)),width:N(R*3),height:N(W*3),style:g?{cursor:zn("nwse-resize",n)}:void 0,...p}),u("rect",{className:de("tl-transparent",{"tl-hidden":Ft}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:N(0-(k?R*3:R*1.5)),y:N(C-(D?0:W*1.5)),width:N(R*3),height:N(W*3),style:g?{cursor:zn("nesw-resize",n)}:void 0,...f}),Be&&u(Z,{children:[u("rect",{"data-testid":"selection.resize.top-left",className:de("tl-corner-handle",{"tl-hidden":Ne}),"aria-label":"top_left handle",x:N(0-E/2),y:N(0-E/2),width:N(E),height:N(E)}),u("rect",{"data-testid":"selection.resize.top-right",className:de("tl-corner-handle",{"tl-hidden":vt}),"aria-label":"top_right handle",x:N(x-E/2),y:N(0-E/2),width:N(E),height:N(E)}),u("rect",{"data-testid":"selection.resize.bottom-right",className:de("tl-corner-handle",{"tl-hidden":bn}),"aria-label":"bottom_right handle",x:N(x-E/2),y:N(C-E/2),width:N(E),height:N(E)}),u("rect",{"data-testid":"selection.resize.bottom-left",className:de("tl-corner-handle",{"tl-hidden":Ft}),"aria-label":"bottom_left handle",x:N(0-E/2),y:N(C-E/2),width:N(E),height:N(E)})]}),Ta&&u(Z,{children:[u("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:N(0-E/4),y:N(C/2-oo/2),rx:E/4,width:N(E/2),height:N(oo)}),u("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:E/4,x:N(x-E/4),y:N(C/2-oo/2),width:N(E/2),height:N(oo)})]}),le&&u(hQ,{size:E,width:x,height:C,hideAlternateHandles:Ke})]})})}),id=function({cx:e,cy:n,targetSize:r,corner:o,cursor:i,isHidden:s,"data-testid":a}){const c=Lr(o);return u("rect",{className:de("tl-transparent","tl-rotate-corner",{"tl-hidden":s}),"data-testid":a,"aria-label":`${o} target`,pointerEvents:"all",x:N(e-r*3),y:N(n-r*3),width:N(Math.max(1,r*3)),height:N(Math.max(1,r*3)),cursor:i,...c})},fQ=Math.sqrt(Math.PI),gQ=function({cx:e,cy:n,size:r,isHidden:o,"data-testid":i}){const s=Lr("mobile_rotate"),a=F(),c=U("zoom level",()=>a.getZoomLevel(),[a]),l=Math.max(14*(1/c),20/Math.max(1,c));return u("g",{children:[u("circle",{"data-testid":i,pointerEvents:"all",className:de("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":o}),cx:e,cy:n,r:l,...s}),u("circle",{className:de("tl-mobile-rotate__fg",{"tl-hidden":o}),cx:e,cy:n,r:r/fQ})]})};function mQ(){const t=F();return U("is in a valid select state",()=>t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[t])?u(mC,{}):null}function Bm(t,e,n){const{arrowheadStart:r,arrowheadEnd:o}=e.props,i=Rs(t,e,n),s=i.start.clone(),a=i.end.clone(),c=b.Med(s,a);if(b.Equals(s,a))return{bindings:n,isStraight:!0,start:{handle:s,point:s,arrowhead:e.props.arrowheadStart},end:{handle:a,point:a,arrowhead:e.props.arrowheadEnd},middle:c,isValid:!1,length:0};const l=b.Sub(a,s).uni(),d=Gu(t,e,"start"),h=Gu(t,e,"end"),p=t.getShapePageTransform(e);H1(a,i.start,p,h),H1(s,i.end,p,d);let f=0,g=0,m=0,y=0,S=Ls*e.props.scale;const v=d&&h&&d.shape===h.shape,_=d&&h?Lv(t,d.shape.id,h.shape.id):"safe";_==="safe"&&d&&h&&!v&&!d.isExact&&!h.isExact&&(h.didIntersect&&!d.didIntersect?d.isClosed&&s.setTo(a.clone().add(l.clone().mul(Ls*e.props.scale))):h.didIntersect||h.isClosed&&a.setTo(s.clone().sub(l.clone().mul(Ls*e.props.scale))));const w=b.Sub(a,s),x=b.Len(w)?w.uni():b.From(w),C=!b.Equals(x,l);v||(_!=="start-contains-end"&&d&&r!=="none"&&!d.isExact&&(m=jr[e.props.size]/2+("size"in d.shape.props?jr[d.shape.props.size]/2:0),f=(Vu+m)*e.props.scale,S+=m*e.props.scale),_!=="end-contains-start"&&h&&o!=="none"&&!h.isExact&&(y=jr[e.props.size]/2+("size"in h.shape.props?jr[h.shape.props.size]/2:0),g=(Vu+y)*e.props.scale,S+=y*e.props.scale));const E=s.clone().add(x.clone().mul(f*(C?-1:1))),I=a.clone().sub(x.clone().mul(g*(C?-1:1)));b.DistMin(E,I,S)&&(f!==0&&g!==0?(f*=-1.5,g*=-1.5):f!==0?f*=-1:g!==0&&(g*=-1)),s.add(x.clone().mul(f*(C?-1:1))),a.sub(x.clone().mul(g*(C?-1:1))),C?(d&&h&&a.setTo(b.Add(s,x.clone().mul(-Ls*e.props.scale))),c.setTo(b.Med(i.start,i.end))):c.setTo(b.Med(s,a));const T=b.Dist(s,a);return{bindings:n,isStraight:!0,start:{handle:i.start,point:s,arrowhead:e.props.arrowheadStart},end:{handle:i.end,point:a,arrowhead:e.props.arrowheadEnd},middle:c,isValid:T>0,length:T}}function H1(t,e,n,r){if(r===void 0||r.isExact)return;const o=J.applyToPoint(n,e),i=J.applyToPoint(n,t),s=J.applyToPoint(J.Inverse(r.transform),o),a=J.applyToPoint(J.Inverse(r.transform),i),c=r.isClosed,d=(c?OS:YH)(s,a,r.outline);let h;if(d!==null&&(h=d.sort((g,m)=>b.Dist2(g,s)-b.Dist2(m,s))[0]??(c?void 0:a)),h===void 0)return;const p=J.applyToPoint(r.transform,h),f=J.applyToPoint(J.Inverse(n),p);t.setTo(f),r.didIntersect=!0}function yQ(t,e,n){const{arrowheadEnd:r,arrowheadStart:o}=e.props,i=e.props.bend;if(Math.abs(i)>Math.abs(e.props.bend*(_Q*e.props.scale)))return Bm(t,e,n);const s=Rs(t,e,n),a=b.Med(s.start,s.end),c=b.Sub(s.end,s.start),l=b.Len(c)?c.uni():b.From(c),d=b.Add(a,l.per().mul(-i)),h=Gu(t,e,"start"),p=Gu(t,e,"end"),f=s.start.clone(),g=s.end.clone(),m=d.clone();if(b.Equals(f,g))return{bindings:n,isStraight:!0,start:{handle:f,point:f,arrowhead:e.props.arrowheadStart},end:{handle:g,point:g,arrowhead:e.props.arrowheadEnd},middle:m,isValid:!1,length:0};const y=e.props.bend<0,S=y?qc:YI,v=j1(f,g,m),_=b.Angle(v.center,f),w=b.Angle(v.center,g),x=S(_,w);if(v.length===0||v.size===0||!w0(v.length)||!w0(v.size))return Bm(t,e,n);const C=f.clone(),E=g.clone(),I=m.clone(),T=t.getShapePageTransform(e);let k=0,D=0,A=Ls*e.props.scale;if(h&&!h.isExact){const le=J.applyToPoint(T,C),he=J.applyToPoint(T,v.center),ve=J.applyToPoint(T,E),me=J.Inverse(h.transform),Be=J.applyToPoint(me,le),ie=J.applyToPoint(me,he),at=J.applyToPoint(me,ve),{isClosed:Ke}=h,We=Ke?hm:H0;let Ee,Je=We(ie,v.radius,h.outline);if(Je){const Ne=ie.angle(Be),vt=ie.angle(at),Ft=S(Ne,vt);Je=Je.filter(_t=>S(Ne,ie.angle(_t))<=Ft);const bn=Ft*.25;Je.sort(Ke?(_t,qt)=>Math.abs(S(Ne,ie.angle(_t))-bn)<Math.abs(S(Ne,ie.angle(qt))-bn)?-1:1:(_t,qt)=>S(Ne,ie.angle(_t))<S(Ne,ie.angle(qt))?-1:1),Ee=Je[0]??(Ke?void 0:Be)}else Ee=Ke?void 0:Be;if(Ee&&(C.setTo(t.getPointInShapeSpace(e,J.applyToPoint(h.transform,Ee))),h.didIntersect=!0,o!=="none")){const Ne=jr[e.props.size]/2+("size"in h.shape.props?jr[h.shape.props.size]/2:0);k=(Vu+Ne)*e.props.scale,A+=Ne*e.props.scale}}if(p&&!p.isExact){const le=J.applyToPoint(T,C),he=J.applyToPoint(T,E),ve=J.applyToPoint(T,v.center),me=J.Inverse(p.transform),Be=J.applyToPoint(me,le),ie=J.applyToPoint(me,ve),at=J.applyToPoint(me,he),Ke=p.isClosed,We=Ke?hm:H0;let Ee,Je=We(ie,v.radius,p.outline);if(Je){const Ne=ie.angle(Be),vt=ie.angle(at),Ft=S(Ne,vt),bn=Ft*.75;Je=Je.filter(_t=>S(Ne,ie.angle(_t))<=Ft),Je.sort(Ke?(_t,qt)=>Math.abs(S(Ne,ie.angle(_t))-bn)<Math.abs(S(Ne,ie.angle(qt))-bn)?-1:1:(_t,qt)=>S(Ne,ie.angle(_t))<S(Ne,ie.angle(qt))?-1:1),Je[0]?Ee=Je[0]:Ee=Ke?void 0:at}else Ee=Ke?void 0:at;if(Ee&&(E.setTo(t.getPointInShapeSpace(e,J.applyToPoint(p.transform,Ee))),p.didIntersect=!0,r!=="none")){const Ne=jr[e.props.size]/2+("size"in p.shape.props?jr[p.shape.props.size]/2:0);D=(Vu+Ne)*e.props.scale,A+=Ne*e.props.scale}}let O=b.Angle(v.center,C),$=b.Angle(v.center,E),z=S(O,$),R=z*v.radius;const W=C.clone(),j=E.clone();if(k!==0&&W.setTo(v.center).add(b.FromAngle(O+z*(k/R*(y?1:-1))).mul(v.radius)),D!==0&&j.setTo(v.center).add(b.FromAngle($+z*(D/R*(y?-1:1))).mul(v.radius)),b.DistMin(W,j,A)&&(k!==0&&D!==0?(k*=-1.5,D*=-1.5):k!==0?k*=-2:D!==0&&(D*=-2)),k!==0&&C.setTo(v.center).add(b.FromAngle(O+z*(k/R*(y?1:-1))).mul(v.radius)),D!==0&&E.setTo(v.center).add(b.FromAngle($+z*(D/R*(y?-1:1))).mul(v.radius)),h&&p&&!h.isExact&&!p.isExact){O=b.Angle(v.center,C),$=b.Angle(v.center,E),z=S(O,$),R=z*v.radius;const le=Lv(t,h.shape.id,p.shape.id);le==="double-bound"&&R<30?(C.setTo(f),E.setTo(g),I.setTo(m)):le==="safe"&&(h&&!h.didIntersect&&C.setTo(f),(p&&!p.didIntersect||S(_,O)>S(_,$))&&E.setTo(v.center).add(b.FromAngle(O+z*(Math.min(.9,Ls*e.props.scale/R)*(y?1:-1))).mul(v.radius)))}SQ(v.center,v.radius,C,E,I,x,y),C.equals(E)&&(C.setTo(I.clone().addXY(1,1)),E.setTo(I.clone().subXY(1,1))),f.setTo(C),g.setTo(E),m.setTo(I);const G=j1(f,g,m);return{bindings:n,isStraight:!1,start:{point:f,handle:s.start,arrowhead:e.props.arrowheadStart},end:{point:g,handle:s.end,arrowhead:e.props.arrowheadEnd},middle:m,handleArc:v,bodyArc:G,isValid:G.length!==0&&isFinite(G.center.x)&&isFinite(G.center.y)}}function j1(t,e,n){const r=PS(t,e,n)??b.Med(t,e),o=b.Dist(r,t),i=+b.Clockwise(t,n,e),s=((t.y-e.y)**2+(t.x-e.x)**2)**.5,a=((e.y-n.y)**2+(e.x-n.x)**2)**.5,c=((n.y-t.y)**2+(n.x-t.x)**2)**.5,l=Math.acos((a*a+c*c-s*s)/(2*a*c))*2,d=+(ze>l),h=(Ve-l)*(i?1:-1),p=h*o;return{center:r,radius:o,size:h,length:p,largeArcFlag:d,sweepFlag:i}}function SQ(t,e,n,r,o,i,s){const a=b.Angle(t,n),c=b.Angle(t,r);let l=qc(a,c);if(s||(l=Ve-l),o.setTo(t).add(b.FromAngle(a+l*(.5*(s?1:-1))).mul(e)),l>i){o.rotWith(t,ze);const d=r.clone();r.setTo(n),n.setTo(d)}}const vQ=8;function bQ(t){return Math.abs(t.props.bend)<vQ*t.props.scale}function Gu(t,e,n){const r=t.getBindingsFromShape(e,"arrow").find(c=>c.props.terminal===n);if(!r)return;const o=t.getShape(r.toId);if(!o)return;const i=t.getShapePageTransform(o),s=t.getShapeGeometry(o),a=s instanceof Ir?s.children[0].vertices:s.vertices;return{shape:o,transform:i,isClosed:s.isClosed,isExact:r.props.isExact,didIntersect:!1,outline:a}}function K1(t,e,n,r){const o=t.getShape(n.toId);if(o){const{point:i,size:s}=t.getShapeGeometry(o).bounds,a=b.Add(i,b.MulV(n.props.isPrecise||r?n.props.normalizedAnchor:{x:.5,y:.5},s)),c=J.applyToPoint(t.getShapePageTransform(o),a);return J.applyToPoint(J.Inverse(e),c)}else return new b(0,0)}function En(t,e){const n=t.getBindingsFromShape(e,"arrow");return{start:n.find(r=>r.props.terminal==="start"),end:n.find(r=>r.props.terminal==="end")}}const wQ=qB("arrow info",(t,e)=>{const n=En(t,e);return bQ(e)?Bm(t,e,n):yQ(t,e,n)});function Hr(t,e){const n=typeof e=="string"?e:e.id;return wQ.get(t,n)}function Rs(t,e,n){var a,c;const r=t.getShapePageTransform(e),o=Lv(t,(a=n.start)==null?void 0:a.toId,(c=n.end)==null?void 0:c.toId),i=n.start?K1(t,r,n.start,o==="double-bound"||o==="start-contains-end"):b.From(e.props.start),s=n.end?K1(t,r,n.end,o==="double-bound"||o==="end-contains-start"):b.From(e.props.end);return{start:i,end:s}}function Ga(t,e,n,r){const o=typeof e=="string"?e:e.id,i=typeof n=="string"?n:n.id,s=t.getBindingsFromShape(o,"arrow").filter(c=>c.props.terminal===r.terminal);s.length>1&&t.deleteBindings(s.slice(1));const a=s[0];a?t.updateBinding({...a,toId:i,props:r}):t.createBinding({type:"arrow",fromId:o,toId:i,props:r})}function Ad(t,e,n){const r=t.getBindingsFromShape(e,"arrow").filter(o=>o.props.terminal===n);t.deleteBindings(r)}const Ls=10,Vu=10,_Q=10,jr={s:2,m:3.5,l:5,xl:10};function Lv(t,e,n){if(!e||!n)return"safe";if(e===n)return"double-bound";const r=t.getShapePageBounds(e),o=t.getShapePageBounds(n);if(r&&o){if(r.contains(o))return"start-contains-end";if(o.contains(r))return"end-contains-start"}return"safe"}class Od extends Ed{getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5}}}onAfterCreate({binding:e}){const n=this.editor.getShape(e.fromId);n&&Vf(this.editor,n)}onAfterChange({bindingAfter:e}){const n=this.editor.getShape(e.fromId);n&&Vf(this.editor,n)}onAfterChangeFromShape({shapeAfter:e}){Vf(this.editor,e)}onAfterChangeToShape({binding:e}){zA(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){const n=this.editor.getShape(e.fromId);n&&Yu({editor:this.editor,arrow:n,terminal:e.props.terminal})}}P(Od,"type","arrow"),P(Od,"props",gI),P(Od,"migrations",mI);function zA(t,e){var y;const n=t.getShape(e);if(!n)return;const r=En(t,n),{start:o,end:i}=r,s=o?t.getShape(o.toId):void 0,a=i?t.getShape(i.toId):void 0,c=t.getAncestorPageId(n);if(!c)return;let l;if(s&&a)l=t.findCommonAncestor([s,a])??c;else if(s||a){const S=(y=s||a)==null?void 0:y.parentId;S&&S===n.parentId?l=n.parentId:l=c}else return;l&&l!==n.parentId&&t.reparentShapes([e],l);const d=t.getShape(e);if(!d)throw Error("no reparented arrow");const h=t.getShapeNearestSibling(d,s),p=t.getShapeNearestSibling(d,a);let f;if(h&&p)f=h.index>p.index?h:p;else if(h&&!p)f=h;else if(p&&!h)f=p;else return;let g;const m=t.getSortedChildIdsForParent(f.parentId).map(S=>t.getShape(S)).filter(S=>S.index>f.index);if(m.length){const S=m.find(v=>v.type!=="arrow");if(d.index>f.index&&(!S||d.index<S.index))return;g=Pc(f.index,m[0].index)}else g=Br(f.index);g!==d.index&&t.updateShapes([{id:e,type:"arrow",index:g}])}function Vf(t,e){const n=En(t,e);for(const r of["start","end"]){const o=n[r];if(!o)continue;const i=t.getShape(o.toId),s=t.getAncestorPageId(e)===t.getAncestorPageId(i);(!i||!s)&&Yu({editor:t,arrow:e,terminal:r,unbind:!0})}zA(t,e.id)}function Yu({editor:t,arrow:e,terminal:n,unbind:r=!1,useHandle:o=!1}){const i=Hr(t,e);if(!i)throw new Error("expected arrow info");const s=o?i.start.handle:i.start.point,a=o?i.end.handle:i.end.point,c=n==="start"?s:a,l={id:e.id,type:"arrow",props:{[n]:{x:c.x,y:c.y},bend:e.props.bend}};if(!i.isStraight){const d=n==="start"?s:i.start.handle,h=n==="end"?a:i.end.handle,p=b.Med(d,h),f=b.Sub(d,h).per().uni().mul(i.handleArc.radius*2*Math.sign(e.props.bend)),g=nl(i.handleArc.center,b.Add(p,f),i.handleArc.center,i.handleArc.radius);He((g==null?void 0:g.length)===1);const m=b.Dist(p,g[0])*Math.sign(e.props.bend);oi(m,l.props.bend)||(l.props.bend=m)}t.updateShape(l),r&&Ad(t,e,n)}const BA=[Od],an={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},sn={s:2,m:3.5,l:5,xl:10},Js={s:18,m:24,l:36,xl:44},Eo={s:18,m:22,l:26,xl:32},xQ={s:18,m:20,l:24,xl:28},Do={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},PQ=20,Xu=4.25,or=16;function IQ(t,e){const n=t.w/e.w,r=t.h/e.h;return n<=1&&r<=1?t:n>r?{w:t.w/n,h:t.h/n}:{w:t.w/r,h:t.h/r}}/*!
 * MIT License
 * Adapted (mostly copied) the work of https://github.com/fregante/text-field-edit
 * Copyright (c) Federico Brigante <opensource@bfred.it> (bfred.it)
 */const Ns="  ",un=class un{static insertTextFirefox(e,n){e.setRangeText(n,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:n,inputType:"insertText",isComposing:!1}))}static insert(e,n){const r=e.ownerDocument,o=r.activeElement;o!==e&&e.focus(),r.execCommand("insertText",!1,n)||un.insertTextFirefox(e,n),o===r.body?e.blur():o instanceof HTMLElement&&o!==e&&o.focus()}static set(e,n){e.select(),un.insert(e,n)}static getSelection(e){const{selectionStart:n,selectionEnd:r}=e;return e.value.slice(n||void 0,r||void 0)}static wrapSelection(e,n,r){const{selectionStart:o,selectionEnd:i}=e,s=un.getSelection(e);un.insert(e,n+s+(r??n)),e.selectionStart=(o||0)+n.length,e.selectionEnd=(i||0)+n.length}static replace(e,n,r){let o=0;e.value.replace(n,(...i)=>{const s=o+i[i.length-2],a=i[0].length;e.selectionStart=s,e.selectionEnd=s+a;const c=typeof r=="string"?r:r(...i);return un.insert(e,c),e.selectionStart=s,o+=c.length-a,c})}static findLineEnd(e,n){const r=e.lastIndexOf(`
`,n-1)+1;return e.charAt(r)!=="	"?n:r+1}static indent(e){var a;const{selectionStart:n,selectionEnd:r,value:o}=e,i=o.slice(n,r),s=(a=/\n/g.exec(i))==null?void 0:a.length;if(s&&s>0){const c=o.lastIndexOf(`
`,n-1)+1,l=e.value.slice(c,r-1),d=l.replace(/^|\n/g,`$&${Ns}`),h=d.length-l.length;e.setSelectionRange(c,r-1),un.insert(e,d),e.setSelectionRange(n+1,r+h)}else un.insert(e,Ns)}static unindent(e){const{selectionStart:n,selectionEnd:r,value:o}=e,i=o.lastIndexOf(`
`,n-1)+1,s=un.findLineEnd(o,r),a=e.value.slice(i,s),c=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),l=a.length-c.length;e.setSelectionRange(i,s),un.insert(e,c);const d=/\t| {1,2}/.exec(o.slice(i,n)),h=d?d[0].length:0,p=n-h;e.setSelectionRange(n-h,Math.max(p,r-l))}static indentCE(e){var c;const n=window.getSelection(),r=e.innerText,o=sd(e)??0,i=sd(e)??0,s=r.slice(o,i),a=(c=/\n/g.exec(s))==null?void 0:c.length;if(a&&a>0){const l=r.lastIndexOf(`
`,o-1)+1,d=r.slice(l,i-1),p=d.replace(/^|\n/g,`$&${Ns}`).length-d.length;n&&n.setBaseAndExtent(e,o+1,e,i+p)}else{const l=window.getSelection();e.innerText=r.slice(0,o)+Ns+r.slice(o),l==null||l.setBaseAndExtent(e,o+1,e,o+2)}}static unindentCE(e){const n=window.getSelection(),r=e.innerText,o=sd(e)??0,i=sd(e)??0,s=r.lastIndexOf(`
`,o-1)+1,a=un.findLineEnd(r,i),c=r.slice(s,a),l=c.replace(/(^|\n)(\t| {1,2})/g,"$1"),d=c.length-l.length;if(n){n.setBaseAndExtent(e,s,e,a);const h=/\t| {1,2}/.exec(r.slice(s,o)),p=h?h[0].length:0,f=o-p;n.setBaseAndExtent(e,o-p,e,Math.max(f,i-d))}}static normalizeText(e){return e.replace(un.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(un.fixNewLines,`
`).split(`
`).map(n=>n||" ").join(`
`)}};P(un,"fixNewLines",/\r?\n|\r/g);let Qs=un;function sd(t){if(typeof window.getSelection>"u")return;const e=window.getSelection();if(!e)return;let n=0;if(e.rangeCount!==0){const r=e.getRangeAt(0),o=r.cloneRange();o.selectNodeContents(t),o.setEnd(r.endContainer,r.endOffset),n=o.toString().length}return n}const CQ=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function UA(t){return CQ.test(t)}function EQ(t){return t.replace(/\t/g,Ns)}function TQ(t){const e=t.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let n=1/0;for(const r of e)if(r.trim().length>0){const o=r.length-r.trimStart().length;n=Math.min(n,o)}return e.map(r=>r.slice(n)).join(`
`)}const HA={"&amp;":"&","&quot;":'"',"&apos;":"'","&#34;":'"',"&#38;":"&","&#39;":"'","&#8211;":"–","&#8212;":"—","&#8216;":"‘","&#8217;":"’","&#8220;":"“","&#8221;":"”","&#8230;":"…"},kQ=new RegExp(Object.keys(HA).join("|"),"g");function MQ(t){return t.replace(kQ,e=>HA[e])}function AQ(t){return t.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function OQ(t){return AQ(TQ(EQ(t)))}function DQ(t,{maxImageDimension:e,maxAssetSize:n,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:o},{toasts:i,msg:s}){t.registerExternalAssetHandler("file",async({file:a,assetId:c})=>{const l=r.includes(a.type),d=o.includes(a.type);!l&&!d&&i.addToast({title:s("assets.files.type-not-allowed"),severity:"error"}),He(l||d,`File type not allowed: ${a.type}`),a.size>n&&i.addToast({title:s("assets.files.size-too-big"),severity:"error"}),He(a.size<=n,`File size too big: ${(a.size/1024).toFixed()}kb > ${(n/1024).toFixed()}kb`);const h=Fb(await a.arrayBuffer());c=c??qo.createId(h);const p=await W1(a,c,l,d);if(isFinite(e)){const f={w:p.props.w,h:p.props.h},g=IQ(f,{w:e,h:e});f!==g&&Kn.isStaticImageType(a.type)&&(p.props.w=g.w,p.props.h=g.h)}return p.props.src=await t.uploadAsset(p,a),qo.create(p)}),t.registerExternalAssetHandler("url",async({url:a})=>{var l,d,h,p,f;let c;try{const m=await(await Pr(a,{method:"GET",mode:"no-cors"})).text(),y=new DOMParser().parseFromString(m,"text/html");c={image:((l=y.head.querySelector('meta[property="og:image"]'))==null?void 0:l.getAttribute("content"))??"",favicon:((d=y.head.querySelector('link[rel="apple-touch-icon"]'))==null?void 0:d.getAttribute("href"))??((h=y.head.querySelector('link[rel="icon"]'))==null?void 0:h.getAttribute("href"))??"",title:((p=y.head.querySelector('meta[property="og:title"]'))==null?void 0:p.getAttribute("content"))??a,description:((f=y.head.querySelector('meta[property="og:description"]'))==null?void 0:f.getAttribute("content"))??""},c.image.startsWith("http")||(c.image=new URL(c.image,a).href),c.favicon.startsWith("http")||(c.favicon=new URL(c.favicon,a).href)}catch(g){console.error(g),i.addToast({title:s("assets.url.failed"),severity:"error"}),c={image:"",favicon:"",title:"",description:""}}return{id:qo.createId(Dg(a)),typeName:"asset",type:"bookmark",props:{src:a,description:c.description,image:c.image,favicon:c.favicon,title:c.title},meta:{}}}),t.registerExternalContentHandler("svg-text",async({point:a,text:c})=>{const l=a??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),d=new DOMParser().parseFromString(c,"image/svg+xml").querySelector("svg");if(!d)throw new Error("No <svg/> element present");let h=parseFloat(d.getAttribute("width")||"0"),p=parseFloat(d.getAttribute("height")||"0");if(!(h&&p)){document.body.appendChild(d);const g=d.getBoundingClientRect();document.body.removeChild(d),h=g.width,p=g.height}const f=await t.getAssetForExternalContent({type:"file",file:new File([c],"asset.svg",{type:"image/svg+xml"})});if(!f)throw Error("Could not create an asset");G1(t,[f],l)}),t.registerExternalContentHandler("embed",({point:a,url:c,embed:l})=>{const d=a??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),{width:h,height:p}=l,f=Xe(),g={id:f,type:"embed",x:d.x-(h||450)/2,y:d.y-(p||450)/2,props:{w:h,h:p,url:c}};t.createShapes([g]).select(f)}),t.registerExternalContentHandler("files",async({point:a,files:c})=>{if(c.length>t.options.maxFilesAtOnce)throw Error("Too many files");const l=a??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),d=new b(l.x,l.y),h=[],p=[];for(const f of c){if(f.size>n){i.addToast({title:s("assets.files.size-too-big"),severity:"error"}),console.warn(`File size too big: ${(f.size/1024).toFixed()}kb > ${(n/1024).toFixed()}kb`);continue}if(!f.type){i.addToast({title:s("assets.files.upload-failed"),severity:"error"}),console.error("No mime type");continue}if(!r.concat(o).includes(f.type)){i.addToast({title:s("assets.files.type-not-allowed"),severity:"error"}),console.warn(`${f.name} not loaded - Mime type not allowed ${f.type}.`);continue}const g=r.includes(f.type),m=o.includes(f.type),y=Fb(await f.arrayBuffer()),S=qo.createId(y),v=await W1(f,S,g,m);let _;g&&(_=t.createTemporaryAssetPreview(S,f)),h.push(v),p.push({asset:v,file:f,temporaryAssetPreview:_})}Promise.allSettled(p.map(async f=>{try{const g=await t.getAssetForExternalContent({type:"file",file:f.file});if(!g)throw Error("Could not create an asset");t.updateAssets([{...g,id:f.asset.id}])}catch(g){i.addToast({title:s("assets.files.upload-failed"),severity:"error"}),console.error(g);return}})),G1(t,h,d)}),t.registerExternalContentHandler("text",async({point:a,text:c})=>{const l=a??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),d=t.getShapeUtil("text").getDefaultProps(),h=OQ(c),p=t.getOnlySelectedShape();if(p&&"text"in p.props){t.updateShapes([{id:p.id,type:p.type,props:{text:h}}]);return}let f,g,m,y="middle";const S=h.split(`
`).length>1,v=UA(h);S&&(y=S?v?"end":"start":"middle");const _=t.textMeasure.measureText(h,{...an,fontFamily:Do[d.font],fontSize:Js[d.size],maxWidth:null}),w=Math.min(S?t.getViewportPageBounds().width*.9:920,Math.max(200,t.getViewportPageBounds().width*.9));if(_.w>w){const x=t.textMeasure.measureText(h,{...an,fontFamily:Do[d.font],fontSize:Js[d.size],maxWidth:w});f=x.w,g=x.h,m=!1,y=v?"end":"start"}else f=_.w,g=_.h,m=!0;l.y-g/2<t.getViewportPageBounds().minY+40&&(l.y=t.getViewportPageBounds().minY+40+g/2),t.createShapes([{id:Xe(),type:"text",x:l.x-f/2,y:l.y-g/2,props:{text:h,textAlign:y,autoSize:m,w:f}}])}),t.registerExternalContentHandler("url",async({point:a,url:c})=>{const l=t.getShapeUtil("embed"),d=l==null?void 0:l.getEmbedDefinition(c);if(d)return t.putExternalContent({type:"embed",url:d.url,point:a,embed:d.definition});const h=a??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),p=qo.createId(Dg(c)),f=$Q(t,c,h);let g=t.getAsset(p),m=!1;if(!g){m=!0;try{const y=await t.getAssetForExternalContent({type:"url",url:c});if(!y)throw Error("Could not create an asset");g=y}catch{i.addToast({title:s("assets.url.failed"),severity:"error"});return}}t.run(()=>{m&&t.createAssets([g]),t.updateShapes([{id:f.id,type:f.type,props:{assetId:g.id}}])})})}async function W1(t,e,n,r){let o=t.type;t.type==="video/quicktime"&&(o="video/mp4");const i=n?await Kn.getImageSize(t):await Kn.getVideoSize(t),s=await Kn.isAnimated(t)||r;return{id:e,type:n?"image":"video",typeName:"asset",props:{name:t.name,src:"",w:i.w,h:i.h,fileSize:t.size,mimeType:o,isAnimated:s},meta:{}}}async function G1(t,e,n){if(!e.length)return[];const r=b.From(n),o=[];for(let i=0;i<e.length;i++){const s=e[i];switch(s.type){case"image":{o.push({id:Xe(),type:"image",x:r.x,y:r.y,opacity:1,props:{assetId:s.id,w:s.props.w,h:s.props.h}}),r.x+=s.props.w;break}case"video":o.push({id:Xe(),type:"video",x:r.x,y:r.y,opacity:1,props:{assetId:s.id,w:s.props.w,h:s.props.h}}),r.x+=s.props.w}}return t.run(()=>{const i=e.filter(s=>!t.getAsset(s.id));i.length&&t.createAssets(i),t.createShapes(o).select(...o.map(s=>s.id)),jA(t,n)}),o.map(i=>i.id)}function jA(t,e){const n=t.getViewportPageBounds();let r=t.getSelectionPageBounds();if(r){const o=r.center.sub(e);t.updateShapes(t.getSelectedShapes().map(i=>{const s=t.getShapeParentTransform(i).decompose().rotation,a=b.Rot(o,-s);return{id:i.id,type:i.type,x:i.x-a.x,y:i.y-a.y}}))}r=t.getSelectionPageBounds(),r&&!n.contains(r)&&t.zoomToSelection({animation:{duration:t.options.animationMediumMs}})}function $Q(t,e,n){const r={id:Xe(),type:"bookmark",x:n.x-150,y:n.y-160,opacity:1,props:{assetId:null,url:e}};return t.run(()=>{t.createShapes([r]).select(r.id),jA(t,n)}),t.getShape(r.id)}var dg;let RQ=(dg=class extends ae{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}onKeyUp(e){var n;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(n=this.editor.root.getCurrent())==null||n.transition("editing_shape",{...e,target:"shape",shape:r}))}}},P(dg,"id","idle"),dg);var ug;let LQ=(ug=class extends ae{constructor(){super(...arguments);P(this,"shape");P(this,"markId","");P(this,"preciseTimeout",-1);P(this,"didTimeout",!1)}onEnter(){this.markId="",this.didTimeout=!1;const n=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:r=>!r.isLocked&&this.editor.canBindShapes({fromShape:"arrow",toShape:r,binding:"arrow"}),margin:0,hitInside:!0,renderingOnly:!0});n?this.editor.setHintingShapes([n.id]):this.createArrowShape(),this.startPreciseTimeout()}onExit(){this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()}onPointerMove(){if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,creatingMarkId:this.markId||void 0,onInteractionEnd:"arrow"})}}onPointerUp(){this.cancel()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var d;const{originPagePoint:n}=this.editor.inputs,r=Xe();this.markId=this.editor.markHistoryStoppingPoint(`creating_arrow:${r}`),this.editor.createShape({id:r,type:"arrow",x:n.x,y:n.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const o=this.editor.getShape(r);if(!o)throw Error("expected shape");const i=this.editor.getShapeHandles(o);if(!i)throw Error("expected handles for arrow");const s=this.editor.getShapeUtil("arrow"),a=this.shape,c=i.find(h=>h.id==="start"),l=(d=s.onHandleDrag)==null?void 0:d.call(s,o,{handle:{...c,x:0,y:0},isPrecise:!0,initial:a});l&&this.editor.updateShapes([l]),this.shape=this.editor.getShape(r),this.editor.select(r)}updateArrowShapeEndHandle(){var o,i;const n=this.shape;if(!n)throw Error("expected shape");const r=this.editor.getShapeHandles(n);if(!r)throw Error("expected handles for arrow");{const s=this.editor.getShapeUtil("arrow"),a=this.shape,c=r.find(d=>d.id==="start"),l=(o=s.onHandleDrag)==null?void 0:o.call(s,n,{handle:{...c,x:0,y:0},isPrecise:this.didTimeout,initial:a});l&&this.editor.updateShapes([l])}{const s=this.editor.getShapeUtil("arrow"),a=this.shape,c=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint),l=r.find(h=>h.id==="end"),d=(i=s.onHandleDrag)==null?void 0:i.call(s,this.editor.getShape(n),{handle:{...l,x:c.x,y:c.y},isPrecise:!1,initial:a});d&&this.editor.updateShapes([d])}this.shape=this.editor.getShape(n.id)}startPreciseTimeout(){this.preciseTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},P(ug,"id","pointing"),ug);class Um extends ae{constructor(){super(...arguments);P(this,"shapeType","arrow")}static children(){return[RQ,LQ]}}P(Um,"id","arrow"),P(Um,"initial","idle");class Nv extends ae{constructor(){super(...arguments);P(this,"info",{});P(this,"initialShape");P(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");P(this,"util",this.editor.getShapeUtil(this.shapeType));P(this,"isPen",!1);P(this,"isPenOrStylus",!1);P(this,"segmentMode","free");P(this,"didJustShiftClickToExtendPreviousShapeLine",!1);P(this,"pagePointWhereCurrentSegmentChanged",{});P(this,"pagePointWhereNextSegmentChanged",null);P(this,"lastRecordedPoint",{});P(this,"mergeNextPoint",!1);P(this,"currentLineLength",0);P(this,"canDraw",!1);P(this,"markId",null)}onEnter(n){this.markId=null,this.info=n,this.canDraw=!this.editor.menus.hasAnyOpenMenus(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()}onPointerMove(){const{inputs:n}=this.editor;if(this.isPen&&!n.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&n.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(this.isPenOrStylus?b.Dist(n.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=n.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape())}onKeyDown(n){if(n.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()}onKeyUp(n){if(n.key==="Shift")switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateDrawingShape()}onExit(){this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()}canClose(){return this.shapeType!=="highlight"}getIsClosed(n,r,o){if(!this.canClose())return!1;const i=sn[r],s=n[0].points[0],a=n[n.length-1],c=a.points[a.points.length-1];return s!==c&&this.currentLineLength>i*4*o&&b.DistMin(s,c,i*2*o)}startShape(){const{inputs:{originPagePoint:n,isPen:r}}=this.editor;this.markId=this.editor.markHistoryStoppingPoint("draw start");const{z:o=.5}=this.info.point;this.isPen=r,this.isPenOrStylus=r||o>0&&o<.5||o>.5&&o<1;const i=this.isPenOrStylus?o*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=n.clone(),this.initialShape){const a=this.editor.getShape(this.initialShape.id);if(a&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const c=Ht(a.props.segments);if(!c)throw Error("Expected a previous segment!");const l=Ht(c.points);if(!l)throw Error("Expected a previous point!");const{x:d,y:h}=this.editor.getPointInShapeSpace(a,n).toFixed(),p={type:this.segmentMode,points:[{x:l.x,y:l.y,z:+i.toFixed(2)},{x:d,y:h,z:+i.toFixed(2)}]},f=J.applyToPoint(this.editor.getShapePageTransform(a.id),l);this.pagePointWhereCurrentSegmentChanged=f,this.pagePointWhereNextSegmentChanged=null;const g=[...a.props.segments,p];this.currentLineLength<sn[a.props.size]*4&&(this.currentLineLength=this.getLineLength(g));const m={id:a.id,type:this.shapeType,props:{segments:g}};this.canClose()&&(m.props.isClosed=this.getIsClosed(g,a.props.size,a.props.scale)),this.editor.updateShapes([m]);return}}this.pagePointWhereCurrentSegmentChanged=n.clone();const s=Xe();this.editor.createShapes([{id:s,type:this.shapeType,x:n.x,y:n.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+i.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(s)}updateDrawingShape(){const{initialShape:n}=this,{inputs:r}=this.editor;if(!n)return;const{id:o,props:{size:i,scale:s}}=n,a=this.editor.getShape(o);if(!a)return;const{segments:c}=a.props,{x:l,y:d,z:h}=this.editor.getPointInShapeSpace(a,r.currentPagePoint).toFixed(),p=this.isPenOrStylus?+(r.currentPagePoint.z*1.25).toFixed(2):.5,f={x:l,y:d,z:p};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:g}=this;if(g===null)throw Error("We should have a point where the segment changed");if(b.Dist2(g,r.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const y=Ht(c);if(!y)throw Error("Expected a previous segment!");const S=Ht(y.points);if(!S)throw Error("Expected a previous last point!");let v;const _=this.editor.getPointInShapeSpace(a,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(y.type==="straight"){this.currentLineLength+=b.Dist(S,_),v={type:"straight",points:[{...S},_]};const x=this.editor.getShapePageTransform(a);this.pagePointWhereCurrentSegmentChanged=J.applyToPoint(x,S)}else v={type:"straight",points:[_,f]};const w={id:o,type:this.shapeType,props:{segments:[...c,v]}};this.canClose()&&(w.props.isClosed=this.getIsClosed(c,i,s)),this.editor.updateShapes([w])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:g}=this;if(g===null)throw Error("We should have a point where the segment changed");if(b.Dist2(g,r.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const y=c.slice(),S=y[y.length-1],v=Ht(S.points);if(!v)throw Error("No previous point!");const _={type:"free",points:[...b.PointsBetween(v,f,6).map(C=>({x:mo(C.x),y:mo(C.y),z:mo(C.z)}))]},w=[...y,_];this.currentLineLength<sn[a.props.size]*4&&(this.currentLineLength=this.getLineLength(w));const x={id:o,type:this.shapeType,props:{segments:w}};this.canClose()&&(x.props.isClosed=this.getIsClosed(w,i,s)),this.editor.updateShapes([x])}break}case"straight":{const g=c.slice(),m=g[g.length-1],{pagePointWhereCurrentSegmentChanged:y}=this,{ctrlKey:S,currentPagePoint:v}=this.editor.inputs;if(!y)throw Error("We should have a point where the segment changed");let _,w=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(w=!S,this.didJustShiftClickToExtendPreviousShapeLine=!1):w=!S;let x=this.editor.getPointInShapeSpace(a,v).toFixed().toJson(),C=!1,E;if((this.editor.user.getIsSnapMode()?!S:S)&&g.length>2){let k,D=8/this.editor.getZoomLevel();for(let A=0,O=c.length-2;A<O;A++){const $=c[A];if(!$)break;if($.type==="free")continue;const z=$.points[0],R=Ht($.points);if(!(z&&R))continue;const W=b.NearestPointOnLineSegment(z,R,x);if(b.DistMin(W,x,D)){k=W.toFixed().toJson(),D=b.Dist(W,x),E=$;break}}k&&(C=!0,x=k)}if(C&&E){const k=this.editor.getShapePageTransform(a),D=E.points[0],A=Ht(E.points);if(!A)throw Error("Expected a last point!");const O=J.applyToPoint(k,D),$=J.applyToPoint(k,A),z=J.applyToPoint(k,x);this.editor.snaps.setIndicators([{id:Ye(),type:"points",points:[O,z,$]}])}else{if(this.editor.snaps.clearIndicators(),w){const k=b.Angle(y,v),A=Au(k,24)-k;_=b.RotWith(v,y,A)}else _=v;x=this.editor.getPointInShapeSpace(a,_).toFixed().toJson()}this.currentLineLength+=b.Dist(m.points[0],x),g[g.length-1]={...m,type:"straight",points:[m.points[0],x]};const T={id:o,type:this.shapeType,props:{segments:g}};this.canClose()&&(T.props.isClosed=this.getIsClosed(c,i,s)),this.editor.updateShapes([T]);break}case"free":{const g=c.slice(),m=g[g.length-1],y=[...m.points];if(y.length&&this.mergeNextPoint){const{z:v}=y[y.length-1];y[y.length-1]={x:f.x,y:f.y,z:v?Math.max(v,f.z):f.z}}else this.currentLineLength+=b.Dist(y[y.length-1],f),y.push(f);g[g.length-1]={...m,points:y},this.currentLineLength<sn[a.props.size]*4&&(this.currentLineLength=this.getLineLength(g));const S={id:o,type:this.shapeType,props:{segments:g}};if(this.canClose()&&(S.props.isClosed=this.getIsClosed(g,i,s)),this.editor.updateShapes([S]),y.length>this.editor.options.maxPointsPerDrawShape){this.editor.updateShapes([{id:o,type:this.shapeType,props:{isComplete:!0}}]);const v=Xe(),_=this.editor.getShape(o).props;this.editor.createShapes([{id:v,type:this.shapeType,x:mo(r.currentPagePoint.x),y:mo(r.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:_.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(h*1.25).toFixed():.5}]}]}}]),this.initialShape=ut(this.editor.getShape(v)),this.mergeNextPoint=!1,this.lastRecordedPoint=r.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(n){let r=0;for(const o of n)for(let i=0;i<o.points.length-1;i++){const s=o.points[i],a=o.points[i+1];r+=b.Dist2(a,s)}return Math.sqrt(r)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())}complete(){if(!this.canDraw){this.cancel();return}const{initialShape:n}=this;n&&(this.editor.updateShapes([{id:n.id,type:n.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}P(Nv,"id","drawing");var hg;let KA=(hg=class extends ae{onPointerDown(e){this.parent.transition("drawing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},P(hg,"id","idle"),hg);class Dd extends ae{constructor(){super(...arguments);P(this,"shapeType","draw")}static children(){return[KA,Nv]}onExit(){const n=this.children.drawing;n.initialShape=void 0}}P(Dd,"id","draw"),P(Dd,"initial","idle"),P(Dd,"isLockable",!1);class Hm extends _m{constructor(){super(...arguments);P(this,"shapeType","frame")}onCreate(n){if(!n)return;const r=this.editor.getShapePageBounds(n),o=[],i=this.editor.getShapeAncestors(n).map(s=>s.id);this.editor.getSortedChildIdsForParent(n.parentId).map(s=>{const a=this.editor.getShape(s);if(!a||a.id===n.id||a.isLocked)return;const c=this.editor.getShapePageBounds(a);c&&r.contains(c)&&NQ(a,i,n)&&o.push(a.id)}),this.editor.reparentShapes(o,n.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}}P(Hm,"id","frame"),P(Hm,"initial","idle");function NQ(t,e,n){return e.includes(t.id)?!1:t.parentId===n.parentId}var pg;let FQ=(pg=class extends ae{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onKeyUp(e){var n;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(n=this.editor.root.getCurrent())==null||n.transition("editing_shape",{...e,target:"shape",shape:r}))}}onCancel(){this.editor.setCurrentTool("select")}},P(pg,"id","idle"),pg);var fg;let zQ=(fg=class extends ae{onPointerUp(){this.complete()}onPointerMove(e){if(this.editor.inputs.isDragging){const{originPagePoint:n}=this.editor.inputs,r=Xe(),o=this.editor.markHistoryStoppingPoint(`creating_geo:${r}`);this.editor.createShapes([{id:r,type:"geo",x:n.x,y:n.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(br),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(r).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:o,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,n=Xe();this.editor.markHistoryStoppingPoint(`creating_geo:${n}`);const r=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,o=this.editor.getStyleForNextShape(br),i=o==="star"?{w:200,h:190}:o==="cloud"?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:n,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(br),scale:r,...i}}]);const s=this.editor.getShape(n);if(!s)return;const{w:a,h:c}=s.props,l=new b(a/2,c/2).mul(r),d=this.editor.getShapeParentTransform(s);d&&l.rot(-d.rotation()),this.editor.select(n),this.editor.updateShape({id:s.id,type:"geo",x:s.x-l.x,y:s.y-l.y,props:{geo:this.editor.getStyleForNextShape(br),w:a*r,h:c*r}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},P(fg,"id","pointing"),fg);class jm extends ae{constructor(){super(...arguments);P(this,"shapeType","geo")}static children(){return[FQ,zQ]}}P(jm,"id","geo"),P(jm,"initial","idle");class $d extends ae{constructor(){super(...arguments);P(this,"shapeType","highlight")}static children(){return[KA,Nv]}onExit(){const n=this.children.drawing;n.initialShape=void 0}}P($d,"id","highlight"),P($d,"initial","idle"),P($d,"isLockable",!1);var gg;let BQ=(gg=class extends ae{constructor(){super(...arguments);P(this,"shapeId","")}onEnter(n){this.shapeId=n.shapeId,this.editor.setCursor({type:"cross",rotation:0})}onPointerDown(){this.parent.transition("pointing",{shapeId:this.shapeId})}onCancel(){this.editor.setCurrentTool("select")}},P(gg,"id","idle"),gg);const V1=2;var mg;let UQ=(mg=class extends ae{constructor(){super(...arguments);P(this,"shape",{});P(this,"markId")}onEnter(n){const{inputs:r}=this.editor,{currentPagePoint:o}=r;this.markId=void 0;const i=n.shapeId&&this.editor.getShape(n.shapeId);if(i&&r.shiftKey){this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${i.id}`),this.shape=i;const s=this.editor.getShapeHandles(this.shape);if(!s)return;const a=s.filter(f=>f.type==="vertex").sort(nn),c=a[a.length-1],l=a[a.length-2],d=J.applyToPoint(this.editor.getShapeParentTransform(this.shape),new b(this.shape.x,this.shape.y)),h=b.Sub(o,d).addXY(.1,.1),p=ut(this.shape.props.points);if(b.DistMin(c,l,V1)||b.DistMin(h,c,V1))p[c.id]={id:c.id,index:c.index,x:h.x,y:h.y};else{const f=Br(c.index);p[f]={id:f,index:f,x:h.x,y:h.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:p}}])}else{const s=Xe();this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${s}`),this.editor.createShapes([{id:s,type:"line",x:o.x,y:o.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),this.editor.select(s),this.shape=this.editor.getShape(s)}}onPointerMove(){if(this.shape&&this.editor.inputs.isDragging){const n=this.editor.getShapeHandles(this.shape);if(!n)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const r=Ht(n);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,creatingMarkId:this.markId,handle:{...r,x:r.x-.1,y:r.y-.1},onInteractionEnd:"line"})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}},P(mg,"id","pointing"),mg);class Km extends ae{constructor(){super(...arguments);P(this,"shapeType","line")}static children(){return[BQ,UQ]}}P(Km,"id","line"),P(Km,"initial","idle");var yg;let HQ=(yg=class extends ae{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},P(yg,"id","idle"),yg);const jQ=0,qe=200,dp=new b(qe/2,qe/2),WA=10,KQ=t=>[[["a1"],new b(qe*.5,qe*-.5-t.options.adjacentShapeMargin)],[["a2"],new b(qe*1.5+t.options.adjacentShapeMargin,qe*.5)],[["a3"],new b(qe*.5,qe*1.5+t.options.adjacentShapeMargin)],[["a4"],new b(qe*-.5-t.options.adjacentShapeMargin,qe*.5)]];function WQ(t,e){if(e===1)return KQ(t);const n=qe*e,r=t.options.adjacentShapeMargin*e;return[[["a1"],new b(n*.5,n*-.5-r)],[["a2"],new b(n*1.5+r,n*.5)],[["a3"],new b(n*.5,n*1.5+r)],[["a4"],new b(n*-.5-r,n*.5)]]}function GA(t,e,n,r,o,i){return Object.fromEntries(WQ(t,i).map(([s,a],c)=>{const l=a.clone();return c===0&&o?l.y-=o:c===2&&r&&(l.y+=r),[s,l.rot(n).add(e)]}))}function VA(t,e,n,r){const o=new Set(t.getSelectedShapeIds()),i=(qe+t.options.adjacentShapeMargin+r)**2,s=new Map,a=[];for(const d of t.getCurrentPageShapes()){if(!t.isShapeOfType(d,"note")||n!==d.props.scale||o.has(d.id))continue;const h=t.getShapePageTransform(d.id);e===h.rotation()&&(s.set(d,t.getShapePageBounds(d).center),a.push(...Object.values(GA(t,h.point(),e,d.props.growY,r,n))))}const c=a.length;let l;for(const[d,h]of s)for(let p=0;p<c;p++)l=a[p],l&&(b.Dist2(h,l)>i||t.isPointInShape(d,l)&&(a[p]=void 0));return be(a)}function YA(t,e,n,r,o=!1){let i;const s=t.getCurrentPageShapesSorted(),a=(qe+t.options.adjacentShapeMargin**2)**e.props.scale;for(let c=s.length-1;c>=0;c--){const l=s[c];if(l.type==="note"&&l.id!==e.id){const d=t.getShapePageBounds(l);if(d&&b.Dist2(d.center,n)<a&&t.isPointInShape(l,n)){i=l;break}}}if(t.complete(),!i||o){t.markHistoryStoppingPoint("creating note shape");const c=Xe();t.createShape({id:c,type:"note",x:n.x,y:n.y,rotation:r,opacity:e.opacity,props:{...e.props,text:"",growY:0,fontSizeAdjustment:0,url:""}});const l=t.getShape(c);if(!l)return;const d=t.getPointInParentSpace(l,b.Sub(n,b.Rot(dp.clone().mul(l.props.scale),r)));t.updateShape({id:c,type:"note",x:d.x,y:d.y}),i=t.getShape(c)}return Fk(t),i}var Sg;let GQ=(Sg=class extends ae{constructor(){super(...arguments);P(this,"dragged",!1);P(this,"info",{});P(this,"wasFocusedOnEnter",!1);P(this,"markId","");P(this,"shape",{})}onEnter(){const{editor:n}=this;if(this.wasFocusedOnEnter=!n.menus.hasAnyOpenMenus(),this.wasFocusedOnEnter){const r=Xe();this.markId=n.markHistoryStoppingPoint(`creating_note:${r}`);const o=this.editor.inputs.originPagePoint.clone(),i=Y1(this.editor,o,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);i&&o.sub(i),this.shape=X1(this.editor,r,o)}}onPointerMove(n){if(this.editor.inputs.isDragging){if(!this.wasFocusedOnEnter){const r=Xe(),o=this.editor.inputs.originPagePoint.clone(),i=Y1(this.editor,o,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);i&&o.sub(i),this.shape=X1(this.editor,r,o)}this.editor.setCurrentTool("select.translating",{...n,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,creatingMarkId:this.markId,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}}onPointerUp(){this.complete()}onInterrupt(){this.cancel()}onComplete(){this.complete()}onCancel(){this.cancel()}complete(){this.wasFocusedOnEnter&&(this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}},P(Sg,"id","pointing"),Sg);function Y1(t,e,n){let r=WA/t.getZoomLevel(),o;for(const i of VA(t,0,n,0)){const s=b.Sub(e,i),a=s.len();a<r&&(r=a,o=s)}return o}function X1(t,e,n){t.createShape({id:e,type:"note",x:n.x,y:n.y,props:{scale:t.user.getIsDynamicResizeMode()?1/t.getZoomLevel():1}}).select(e);const r=t.getShape(e),o=t.getShapeGeometry(r).bounds;return t.updateShapes([{id:e,type:"note",x:r.x-o.width/2,y:r.y-o.height/2}]),t.getShape(e)}class Wm extends ae{constructor(){super(...arguments);P(this,"shapeType","note")}static children(){return[HQ,GQ]}}P(Wm,"id","note"),P(Wm,"initial","idle");function VQ(t){const e=t.getShapeAtPoint(t.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:t.options.hitTestMargin/t.getZoomLevel(),renderingOnly:!0});if(!e)return t.setHoveredShape(null);let n;const r=t.getOutermostSelectableShape(e);return r===e||r.id===t.getFocusedGroupId()||t.getSelectedShapeIds().includes(r.id)?n=e:n=r,t.setHoveredShape(n.id)}const vo=ix(VQ,32);var vg;let YQ=(vg=class extends ae{onPointerMove(e){switch(e.target){case"shape":case"canvas":vo(this.editor)}}onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){vo.cancel()}onKeyDown(e){var n;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(n=this.editor.root.getCurrent())==null||n.transition("editing_shape",{...e,target:"shape",shape:r}))}}onCancel(){this.editor.setCurrentTool("select")}},P(vg,"id","idle"),vg);var bg;let XQ=(bg=class extends ae{constructor(){super(...arguments);P(this,"shape");P(this,"markId","");P(this,"enterTime",0)}onEnter(){this.enterTime=Date.now()}onExit(){this.editor.setHintingShapes([])}onPointerMove(n){if(Date.now()-this.enterTime<150)return;const{editor:r}=this,{isPointing:o}=r.inputs;if(!o)return;const{originPagePoint:i,currentPagePoint:s}=r.inputs,a=Math.abs(i.x-s.x),l=Math.sqrt(r.getInstanceState().isCoarsePointer?r.options.coarseDragDistanceSquared:r.options.dragDistanceSquared)*6/r.getZoomLevel();if(a>l){const d=Xe();this.markId=r.markHistoryStoppingPoint(`creating_text:${d}`);const h=this.createTextShape(d,i,!1,a);if(!h){this.cancel();return}this.shape=r.getShape(h),r.select(d),r.setCurrentTool("select.resizing",{...n,target:"selection",handle:"right",isCreating:!0,creatingMarkId:this.markId,creationCursorOffset:{x:a,y:1},onInteractionEnd:"text",onCreate:()=>{r.setEditingShape(h.id)}})}}onPointerUp(){this.complete()}onComplete(){this.cancel()}onCancel(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.editor.markHistoryStoppingPoint("creating text shape");const n=Xe(),{originPagePoint:r}=this.editor.inputs;this.createTextShape(n,r,!0,20)&&(this.editor.select(n),this.editor.setEditingShape(n))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(n,r,o,i){this.editor.createShape({id:n,type:"text",x:r.x,y:r.y,props:{text:"",autoSize:o,w:i,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const s=this.editor.getShape(n);if(!s){this.cancel();return}const a=this.editor.getShapePageBounds(s),c=new b;if(o)switch(s.props.textAlign){case"start":{c.x=0;break}case"middle":{c.x=-a.width/2;break}case"end":{c.x=-a.width;break}}else c.x=0;if(c.y=-a.height/2,In(s.parentId)){const l=this.editor.getShapeParentTransform(s);c.rot(-l.rotation())}return this.editor.updateShape({...s,x:s.x+c.x,y:s.y+c.y}),s}},P(bg,"id","pointing"),bg);class Gm extends ae{constructor(){super(...arguments);P(this,"shapeType","text")}static children(){return[YQ,XQ]}}P(Gm,"id","text"),P(Gm,"initial","idle");const qQ=[Gm,Dd,jm,Wm,Km,Hm,Um,$d];function hr(){return Lo({isDarkMode:al()})}function up(t){return{key:`${Vr.id}:${t}`,async getElement(){const e=ZQ(t);if(!e)return null;const n=e.$$_url,r=e.$$_fontface;if(!n||!r)return null;const o=await(await Pr(n)).blob(),i=await wo.blobToDataUrl(o),s=r.replace(n,i);return u("style",{children:s})}}}function ZQ(t){const e=uI[t];for(const n of document.fonts)if(e.includes(n.family))return n;return null}function Fv(t){return{key:`${Vr.id}:${t}`,async getElement(){return t!=="pattern"?null:u(JQ,{})}}}function JQ(){const t=hr(),e=8/12;return u(Z,{children:[u("mask",{id:"hash_pattern_mask",children:[u("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),u("g",{strokeLinecap:"round",stroke:"black",children:[u("line",{x1:e*1,y1:e*3,x2:e*3,y2:e*1}),u("line",{x1:e*5,y1:e*7,x2:e*7,y2:e*5}),u("line",{x1:e*9,y1:e*11,x2:e*11,y2:e*9})]})]}),u("pattern",{id:qu(1,t.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:u("rect",{x:"0",y:"0",width:"8",height:"8",fill:t.solid,mask:"url(#hash_pattern_mask)"})})]})}function zv(){return{key:`${Vr.id}:pattern`,component:nee}}const oc=8,q1=(t,e,n)=>new Promise((r,o)=>{const i=oc*e*t,s=document.createElement("canvas");s.width=i,s.height=i;const a=s.getContext("2d");if(!a)return;a.fillStyle=n?Pu.darkMode.solid:Pu.lightMode.solid,a.fillRect(0,0,i,i),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*e*t;const c=8/12,l=d=>d*e*t;a.beginPath(),a.moveTo(l(c*1),l(c*3)),a.lineTo(l(c*3),l(c*1)),a.moveTo(l(c*5),l(c*7)),a.lineTo(l(c*7),l(c*5)),a.moveTo(l(c*9),l(c*11)),a.lineTo(l(c*11),l(c*9)),a.stroke(),s.toBlob(d=>{!d||Pt.throwToBlob.get()?o():r(d)})}),Z1=(t,e)=>{const n=document.createElement("canvas");n.width=t[0],n.height=t[1];const r=n.getContext("2d");return r?(e(r),n.toDataURL()):""};let Yf=null;function QQ(){return Yf||(Yf={white:Z1([1,1],t=>{t.fillStyle="#f8f9fa",t.fillRect(0,0,1,1)}),black:Z1([1,1],t=>{t.fillStyle="#212529",t.fillRect(0,0,1,1)})}),Yf}function XA(t){return Math.ceil(Math.log2(Math.max(1,t)))}function qu(t,e){const n=XA(t);return`tldraw_hash_pattern_${e}_${n}`}function qA(t){const e=[],r=XA(t);for(let o=0;o<=r;o++)e.push(Math.pow(2,o));return e}function eee(t){const e=QQ();return qA(t).flatMap(n=>[{zoom:n,url:e.white,theme:"light"},{zoom:n,url:e.black,theme:"dark"}])}function tee(){const t=F(),e=U("devicePixelRatio",()=>t.getInstanceState().devicePixelRatio,[t]),n=U("maxZoom",()=>Math.ceil(Ht(t.getCameraOptions().zoomSteps)),[t]),[r,o]=Q(!1),[i,s]=Q(()=>eee(n));return q(()=>{const c=Promise.all(qA(n).flatMap(d=>[q1(e,d,!1).then(h=>({zoom:d,theme:"light",url:URL.createObjectURL(h)})),q1(e,d,!0).then(h=>({zoom:d,theme:"dark",url:URL.createObjectURL(h)}))]));let l=!1;return c.then(d=>{l||(s(d),o(!0))}),()=>{l=!0,o(!1),c.then(d=>{for(const{url:h}of d)URL.revokeObjectURL(h)})}},[e,n]),{defs:u(Z,{children:i.map(c=>{const l=qu(c.zoom,c.theme);return u("pattern",{id:l,width:oc,height:oc,patternUnits:"userSpaceOnUse",children:u("image",{href:c.url,width:oc,height:oc})},l)})}),isReady:r}}function nee(){const t=F(),e=B(null),{defs:n,isReady:r}=tee();return q(()=>{if(r&&et.isSafari){const o=ZA(e.current);o&&t.timers.requestAnimationFrame(()=>{o.style.display="none",t.timers.requestAnimationFrame(()=>{o.style.display=""})})}},[t,r]),u("g",{ref:e,"data-testid":r?"ready-pattern-fill-defs":void 0,children:n})}function ZA(t){return t.classList.contains("tl-html-layer")?t:t.parentElement?ZA(t.parentElement):null}const Qt=we.memo(function({theme:e,d:n,color:r,fill:o,scale:i}){switch(o){case"none":return null;case"solid":return u("path",{fill:e[r].semi,d:n});case"semi":return u("path",{fill:e.solid,d:n});case"fill":return u("path",{fill:e[r].fill,d:n});case"pattern":return u(ree,{theme:e,color:r,fill:o,d:n,scale:i})}});function ree({d:t,color:e,theme:n}){const r=F(),o=rl(),i=U("zoomLevel",()=>r.getZoomLevel(),[r]),s=r.getZoomLevel()<=.18;return u(Z,{children:[u("path",{fill:n[e].pattern,d:t}),u("path",{fill:o?`url(#${qu(1,n.id)})`:s?n[e].semi:`url(#${qu(i,n.id)})`,d:t})]})}function oee(t){return t.replace(/\s/g," ")}function Vm(t,e,n){const{padding:r=0}=n;if(e.length===0)return null;const o=ee.From(e[0].box);for(const{box:l}of e)o.union(l);const i=r+(n.offsetX??0),s=(n.offsetY??0)+n.fontSize/2+(n.verticalTextAlign==="start"?r:n.verticalTextAlign==="end"?n.height-r-o.height:(Math.ceil(n.height)-o.height)/2);let a=null;const c=[];for(const{text:l,box:d}of e)a!==null&&d.y>a&&c.push(u("tspan",{alignmentBaseline:"mathematical",x:i,y:d.y+s,children:`
`},c.length)),c.push(u("tspan",{alignmentBaseline:"mathematical",x:d.x+i,y:d.y+s,unicodeBidi:"plaintext",children:oee(l)},c.length)),a=d.y;return u("text",{fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:n.stroke,strokeWidth:n.strokeWidth,fill:n.fill,children:c})}function iee(t,e,n,r){if((t==="start-legacy"||t==="end-legacy")&&n.length!==0){const o=ee.From(n[0].box);for(const{box:i}of n)o.union(i);if(t==="start-legacy")return(r-2*e-o.width)/2;if(t==="end-legacy")return-(r-2*e-o.width)/2}}function see(t){return t==="start-legacy"||t==="middle-legacy"||t==="end-legacy"}function hp({fontSize:t,font:e,align:n,verticalAlign:r,text:o,labelColor:i,bounds:s,padding:a=16,stroke:c=!0}){const l=F(),d=hr(),h={fontSize:t,fontFamily:uI[e],textAlign:n,verticalTextAlign:r,width:Math.ceil(s.width),height:Math.ceil(s.height),padding:a,lineHeight:an.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:i,stroke:void 0,strokeWidth:void 0},p=l.textMeasure.measureTextSpans(o,h),f=iee(n,a,p,s.width);f&&(h.offsetX=f),h.offsetX+=s.x,h.offsetY+=s.y;const g=Vm(l,p,h);let m=null;return c&&(h.fill=d.background,h.stroke=d.background,h.strokeWidth=2,m=Vm(l,p,h)),u(Z,{children:[m,g]})}const aee=X(function({isEditing:e,text:n,handleFocus:r,handleChange:o,handleKeyDown:i,handleBlur:s,handleInputPointerDown:a,handleDoubleClick:c},l){return u("textarea",{ref:l,className:"tl-text tl-text-input",name:"text",tabIndex:-1,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:n,onFocus:r,onChange:o,onKeyDown:i,onBlur:s,onTouchEnd:Mt,onContextMenu:e?Mt:void 0,onPointerDown:a,onDoubleClick:c,onDragStart:Ce})});function cee(t,e,n){const r=F(),o=B(null),i=U("isEditing",()=>r.getEditingShapeId()===t,[r]),s=U("isEditingAnything",()=>!!r.getEditingShapeId(),[r]);q(()=>{function d({shapeId:h}){var p;h===t&&((p=o.current)==null||p.select())}return r.on("select-all-text",d),()=>{r.off("select-all-text",d)}},[r,t,i]),q(()=>{var d,h,p,f;i&&(document.activeElement!==o.current&&((d=o.current)==null||d.focus()),r.getInstanceState().isCoarsePointer&&((h=o.current)==null||h.select()),et.isSafari&&((p=o.current)==null||p.blur(),(f=o.current)==null||f.focus()))},[r,i]);const a=V(d=>{if(r.getEditingShapeId()===t)switch(d.key){case"Enter":{(d.ctrlKey||d.metaKey)&&r.complete();break}}},[r,t]),c=V(d=>{if(r.getEditingShapeId()!==t)return;let h=Qs.normalizeText(d.currentTarget.value);const p=h.replace(/\t/g,Ns);if(p!==h){const f=d.currentTarget.selectionStart;d.currentTarget.value=p,d.currentTarget.selectionStart=f+(p.length-h.length),d.currentTarget.selectionEnd=f+(p.length-h.length),h=p}r.updateShape({id:t,type:e,props:{text:h}})},[r,t,e]),l=V(d=>{r.dispatch({...Mn(d),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(t)}),Mt(d)},[r,t]);return{rInput:o,handleFocus:_c,handleBlur:_c,handleKeyDown:a,handleChange:c,handleInputPointerDown:l,handleDoubleClick:Mt,isEmpty:n.trim().length===0,isEditing:i,isEditingAnything:s}}const pp=we.memo(function({id:e,type:n,text:r,labelColor:o,font:i,fontSize:s,lineHeight:a,align:c,verticalAlign:l,wrap:d,isSelected:h,padding:p=0,onKeyDown:f,classNamePrefix:g,style:m,textWidth:y,textHeight:S}){const{rInput:v,isEmpty:_,isEditing:w,isEditingAnything:x,...C}=cee(e,n,r),[E,I]=Q(r);q(()=>{w||I(r)},[w,r]);const T=Qs.normalizeTextForDom(r),k=T.length>0,D=see(c);if(!w&&!k)return null;const A=g||"tl-text";return u("div",{className:`${A}-label tl-text-wrapper`,"data-font":i,"data-align":c,"data-hastext":!_,"data-isediting":w,"data-iseditinganything":x,"data-textwrap":!!d,"data-isselected":h,style:{justifyContent:c==="middle"||D?"center":c,alignItems:l==="middle"?"center":l,padding:p,...m},children:u("div",{className:`${A}-label__inner tl-text-content__wrapper`,style:{fontSize:s,lineHeight:Math.floor(s*a)+"px",minHeight:Math.floor(s*a)+"px",minWidth:Math.ceil(y||0),color:o,width:y?Math.ceil(y):void 0,height:S?Math.ceil(S):void 0},children:[u("div",{className:`${A} tl-text tl-text-content`,dir:"auto",children:T.split(`
`).map((O,$)=>u("div",{dir:"auto",children:O},$))}),(x||h)&&u(aee,{ref:v,text:r,isEditing:w,...C,handleKeyDown:f??C.handleKeyDown},E)]})})}),lee=new Gr;function dee(t){return lee.get(t,()=>t.store.createComputedCache("arrowLabelSize",e=>{const n=Hr(t,e);let r=0,o=0;const i=n.isStraight?new So({start:b.From(n.start.point),end:b.From(n.end.point)}):new Ds({center:b.Cast(n.handleArc.center),start:b.Cast(n.start.point),end:b.Cast(n.end.point),sweepFlag:n.bodyArc.sweepFlag,largeArcFlag:n.bodyArc.largeArcFlag});if(e.props.text.trim()){const s=i.bounds,a=Ym(e),{w:c,h:l}=t.textMeasure.measureText(e.props.text,{...an,fontFamily:Do[e.props.font],fontSize:a,maxWidth:null});r=c,o=l;let d=!1;if(s.width>s.height?(r=Math.max(Math.min(c,64),Math.min(s.width-64,c)),d=!0):r>16*a&&(r=16*a,d=!0),d){const{w:h,h:p}=t.textMeasure.measureText(e.props.text,{...an,fontFamily:Do[e.props.font],fontSize:a,maxWidth:r});r=h,o=p}}return new b(r,o).addScalar(Xu*2*e.props.scale)}))}function Bv(t,e){return e.props.text.trim()===""?new b(0,0).addScalar(Xu*2*e.props.scale):dee(t).get(e.id)??new b(0,0)}function JA(t){const e=sn[t.props.size];return(PQ+(e-sn.s)*2+(e===sn.xl?20:0))*t.props.scale}function uee(t,e,n){const r=Bv(t,e),o=JA(e),i=b.Nudge(n.start.point,n.end.point,o),s=b.Nudge(n.end.point,n.start.point,o),a=OS(i,s,ee.FromCenter(n.middle,r).corners);if(!a||a.length!==2)return{start:.5,end:.5};let[c,l]=a;b.Dist2(c,i)>b.Dist2(l,i)&&([l,c]=a);const d=i.add(b.Sub(n.middle,c)),h=s.add(b.Sub(n.middle,l)),p=b.Dist(n.start.point,d)/n.length,f=b.Dist(n.start.point,h)/n.length;return{start:p,end:f}}function hee(t,e,n){const r=Bv(t,e),o=JA(e),i=Math.sign(e.props.bend),s=o/n.handleArc.radius*i,a=b.Angle(n.bodyArc.center,n.start.point)-s,c=b.Angle(n.bodyArc.center,n.end.point)+s,l=Vi(n.bodyArc.center,n.bodyArc.radius,a),d=Vi(n.bodyArc.center,n.bodyArc.radius,c),h=[],p=Q1(n.bodyArc.center,n.bodyArc.radius,a,c,i,ee.FromCenter(l,r).corners);h.push(new xt({points:ee.FromCenter(l,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));const f=Q1(n.bodyArc.center,n.bodyArc.radius,a,c,i,ee.FromCenter(d,r).corners);h.push(new xt({points:ee.FromCenter(d,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));for(const E of[...p??[],...f??[],l,d])h.push(new GS({x:E.x-3,y:E.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));const g=(p&&e_(n.start.point,p))??n.middle,m=(f&&e_(n.end.point,f))??n.middle,y=b.Angle(n.bodyArc.center,n.start.point),S=b.Angle(n.bodyArc.center,n.end.point),v=b.Angle(n.bodyArc.center,g),_=b.Angle(n.bodyArc.center,m);if(Zo(y,v,i)>Zo(y,_,i))return{start:.5,end:.5,dbg:h};const w=Zo(y,S,i),x=Zo(y,v,i)/w,C=Zo(y,_,i)/w;return{start:x,end:C,dbg:h}}function Rd(t,e){let n;const r=[],o=Hr(t,e),i={hasStartBinding:!!o.bindings.start,hasEndBinding:!!o.bindings.end,hasStartArrowhead:o.start.arrowhead!=="none",hasEndArrowhead:o.end.arrowhead!=="none"};if(o.isStraight){const a=uee(t,e,o),c=J1(t,e,a,i);n=b.Lrp(o.start.point,o.end.point,c)}else{const a=hee(t,e,o);a.dbg&&r.push(...a.dbg);const c=J1(t,e,a,i),l=pee(b.Angle(o.bodyArc.center,o.start.point),b.Angle(o.bodyArc.center,o.end.point),Math.sign(e.props.bend),c);n=Vi(o.bodyArc.center,o.bodyArc.radius,l)}const s=Bv(t,e);return{box:ee.FromCenter(n,s),debugGeom:r}}function J1(t,e,n,r){const{hasEndArrowhead:o,hasEndBinding:i,hasStartBinding:s,hasStartArrowhead:a}=r,c=nO(t,e);let l=Bt(e.props.labelPosition,a||s?n.start:0,o||i?n.end:1);const d=Math.min(.02,500/c*.02);return l=l>=.5-d&&l<=.5+d?.5:l,l}function Q1(t,e,n,r,o,i){const s=hm(t,e,i),a=Zo(n,r,o);return s==null?void 0:s.filter(c=>{const l=Zo(n,b.Angle(t,c),o);return l>=0&&l<=a})}function e_(t,e){let n=null,r=-1/0;for(const o of e){const i=b.Dist2(t,o);i>r&&(n=o,r=i)}return n}function pee(t,e,n,r){const o=Zo(t,e,n);return t+o*r*n*-1}function Ym(t){return xQ[t.props.size]*t.props.scale}function fee(t,e,n){const r=e==="end"?t.end.point:t.start.point,o=e==="end"?t.start.point:t.end.point,i=t.isStraight?b.Dist(o,r):Math.abs(t.bodyArc.length),s=Math.max(Math.min(i/5,n*3),n);let a;if(t.isStraight)a=b.Nudge(r,o,s);else{const c=XH(r,s,t.handleArc.center,t.handleArc.radius);a=e==="end"?t.handleArc.sweepFlag?c[0]:c[1]:t.handleArc.sweepFlag?c[1]:c[0]}return b.IsNaN(a)&&(a=t.start.point),{point:r,int:a}}function gee({point:t,int:e}){const n=b.RotWith(e,t,ze/6),r=b.RotWith(e,t,-ze/6);return`M ${n.x} ${n.y} L ${t.x} ${t.y} L ${r.x} ${r.y}`}function mee({point:t,int:e}){const n=b.RotWith(e,t,ze/6),r=b.RotWith(e,t,-ze/6);return`M ${n.x} ${n.y} L ${r.x} ${r.y} L ${t.x} ${t.y} Z`}function yee({point:t,int:e}){const n=b.Sub(e,t).div(2),r=b.Add(t,b.Rot(n,it)),o=b.Sub(t,b.Rot(n,it));return`M ${r.x} ${r.y} L ${e.x} ${e.y} L ${o.x} ${o.y} Z`}function See({point:t,int:e}){const n=b.Lrp(t,e,.45),r=b.Dist(n,t);return`M ${n.x-r},${n.y}
  a ${r},${r} 0 1,0 ${r*2},0
  a ${r},${r} 0 1,0 -${r*2},0 `}function vee({point:t,int:e}){const n=b.Lrp(t,e,.75),r=b.RotWith(n,t,ze/4),o=b.RotWith(n,t,-ze/4),i=b.Lrp(r,o,.5);return i.add(b.Sub(i,t)),`M ${i.x} ${i.y} L ${o.x} ${o.y} ${t.x} ${t.y} L ${r.x} ${r.y} Z`}function bee({int:t,point:e}){const n=b.Lrp(e,t,.85),r=b.Sub(n,e).div(2),o=b.Add(e,b.Rot(r,it)),i=b.Sub(e,b.Rot(r,it)),s=b.Add(n,b.Rot(r,it)),a=b.Sub(n,b.Rot(r,it));return`M ${o.x} ${o.y} L ${s.x} ${s.y} L ${a.x} ${a.y} L ${i.x} ${i.y} Z`}function wee({int:t,point:e}){const n=b.Sub(t,e).div(2),r=b.Add(e,b.Rot(n,it)),o=b.Sub(e,b.Rot(n,it));return`M ${r.x} ${r.y} L ${o.x} ${o.y}`}function Zu(t,e,n){const r=e==="end"?t.end.arrowhead:t.start.arrowhead;if(r==="none")return;const o=fee(t,e,n);if(o){switch(r){case"bar":return wee(o);case"square":return bee(o);case"diamond":return vee(o);case"dot":return See(o);case"inverted":return yee(o);case"arrow":return gee(o);case"triangle":return mee(o)}return""}}function _ee(t){const{start:e,end:n,handleArc:{radius:r,largeArcFlag:o,sweepFlag:i}}=t;return`M${e.handle.x},${e.handle.y} A${r} ${r} 0 ${o} ${i} ${n.handle.x},${n.handle.y}`}function QA(t){const{start:e,end:n,bodyArc:{radius:r,largeArcFlag:o,sweepFlag:i}}=t;return`M${e.point.x},${e.point.y} A${r} ${r} 0 ${o} ${i} ${n.point.x},${n.point.y}`}function eO(t,e){return`M${t.x},${t.y}L${e.x},${e.y}`}function xee(t){return eO(t.start.handle,t.end.handle)}function tO(t){return eO(t.start.point,t.end.point)}class Ld extends _r{constructor(){super(...arguments);P(this,"_resizeInitialBindings",new Gr)}canEdit(){return!0}canBind({toShapeType:n}){return n!=="arrow"}canSnap(){return!1}hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsBg(){return!0}hideSelectionBoundsFg(){return!0}canBeLaidOut(n){const r=En(this.editor,n);return!r.start&&!r.end}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(n){const r=Hr(this.editor,n),o=[],i=r.isStraight?new So({start:b.From(r.start.point),end:b.From(r.end.point)}):new Ds({center:b.Cast(r.handleArc.center),start:b.Cast(r.start.point),end:b.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});let s;if(n.props.text.trim()){const a=Rd(this.editor,n);o.push(...a.debugGeom),s=new Mo({x:a.box.x,y:a.box.y,width:a.box.w,height:a.box.h,isFilled:!0,isLabel:!0})}return new Ir({children:[...s?[i,s]:[i],...o]})}getHandles(n){const r=Hr(this.editor,n);return[{id:"start",type:"vertex",index:"a0",x:r.start.handle.x,y:r.start.handle.y},{id:"middle",type:"virtual",index:"a2",x:r.middle.x,y:r.middle.y},{id:"end",type:"vertex",index:"a3",x:r.end.handle.x,y:r.end.handle.y}].filter(Boolean)}getText(n){return n.props.text}onHandleDrag(n,{handle:r,isPrecise:o}){const i=r.id,s=En(this.editor,n);if(i==="middle"){const{start:C,end:E}=Rs(this.editor,n,s),I=b.Sub(E,C),T=b.Per(I),k=b.Med(E,C),D=b.Sub(k,T),A=b.Add(k,T),O=b.NearestPointOnLineSegment(D,A,r,!1);let $=b.Dist(O,k);return b.Clockwise(O,E,k)&&($*=-1),{id:n.id,type:n.type,props:{bend:$}}}const a={id:n.id,type:"arrow",props:{}},c=s[i],d=s[i==="start"?"end":"start"];if(this.editor.inputs.ctrlKey)return Ad(this.editor,n,i),a.props[i]={x:r.x,y:r.y},a;const h=this.editor.getShapePageTransform(n.id).applyToPoint(r),p=this.editor.getShapeAtPoint(h,{hitInside:!0,hitFrameInside:!0,margin:0,filter:C=>!C.isLocked&&this.editor.canBindShapes({fromShape:n,toShape:C,binding:"arrow"})});if(!p)return Ad(this.editor,n,i),a.props[i]={x:r.x,y:r.y},a;const f=this.editor.getShapeGeometry(p),g=ee.ZeroFix(f.bounds),y=this.editor.getShapePageTransform(a.id).applyToPoint(r),S=this.editor.getPointInShapeSpace(p,y);let v=o;v||(!c||c&&p.id!==c.toId)&&(v=this.editor.inputs.pointerVelocity.len()<.5),o||(f.isClosed||(v=!0),d&&p.id===d.toId&&d.props.isPrecise&&(v=!0));const _={x:(S.x-g.minX)/g.width,y:(S.y-g.minY)/g.height};v&&b.Dist(S,g.center)<Math.max(4,Math.min(Math.min(g.width,g.height)*.15,16))/this.editor.getZoomLevel()&&(_.x=.5,_.y=.5);const w={terminal:i,normalizedAnchor:_,isPrecise:v,isExact:this.editor.inputs.altKey};Ga(this.editor,n,p.id,w),this.editor.setHintingShapes([p.id]);const x=En(this.editor,n);return x.start&&x.end&&x.start.toId===x.end.toId&&b.Equals(x.start.props.normalizedAnchor,x.end.props.normalizedAnchor)&&Ga(this.editor,n,x.end.toId,{...x.end.props,normalizedAnchor:{x:x.end.props.normalizedAnchor.x+.05,y:x.end.props.normalizedAnchor.y}}),a}onTranslateStart(n){const r=En(this.editor,n),o=Rs(this.editor,n,r),i=this.editor.getShapePageTransform(n.id),s=this.editor.getSelectedShapeIds();if(!(r.start&&(s.includes(r.start.toId)||this.editor.isAncestorSelected(r.start.toId))||r.end&&(s.includes(r.end.toId)||this.editor.isAncestorSelected(r.end.toId)))){n_.set(n,{pagePosition:i.applyToPoint(n),terminalBindings:Uc(o,(a,c)=>{const l=r[a];return l?{binding:l,shapePosition:c,pagePosition:i.applyToPoint(c)}:null})}),r.start&&(Yu({editor:this.editor,arrow:n,terminal:"start",useHandle:!0}),n=this.editor.getShape(n.id)),r.end&&Yu({editor:this.editor,arrow:n,terminal:"end",useHandle:!0});for(const a of["start","end"]){const c=r[a];c&&this.editor.updateBinding({...c,props:{...c.props,isPrecise:!0}})}}}onTranslate(n,r){const o=n_.get(n);if(!o)return;const i=this.editor.getShapePageTransform(r.id),s=b.Sub(i.applyToPoint(r),o.pagePosition);for(const a of Object.values(o.terminalBindings)){if(!a)continue;const c=b.Add(a.pagePosition,b.Mul(s,.5)),l=this.editor.getShapeAtPoint(c,{hitInside:!0,hitFrameInside:!0,margin:0,filter:d=>!d.isLocked&&this.editor.canBindShapes({fromShape:r,toShape:d,binding:"arrow"})});if((l==null?void 0:l.id)===a.binding.toId){const d=ee.ZeroFix(this.editor.getShapeGeometry(l).bounds),h=this.editor.getPointInShapeSpace(l,c),p={x:(h.x-d.minX)/d.width,y:(h.y-d.minY)/d.height};Ga(this.editor,r,l.id,{...a.binding.props,normalizedAnchor:p,isPrecise:!0})}else Ad(this.editor,r,a.binding.props.terminal)}}onResize(n,r){const{scaleX:o,scaleY:i}=r,s=this._resizeInitialBindings.get(n,()=>En(this.editor,n)),a=Rs(this.editor,n,s),{start:c,end:l}=ut(n.props);let{bend:d}=n.props;s.start||(c.x=a.start.x*o,c.y=a.start.y*i),s.end||(l.x=a.end.x*o,l.y=a.end.y*i);const h=Math.abs(o),p=Math.abs(i),f=s!=null&&s.start?b.From(s.start.props.normalizedAnchor):null,g=s!=null&&s.end?b.From(s.end.props.normalizedAnchor):null;return o<0&&i>=0?(d!==0&&(d*=-1,d*=Math.max(h,p)),f&&(f.x=1-f.x),g&&(g.x=1-g.x)):o>=0&&i<0?(d!==0&&(d*=-1,d*=Math.max(h,p)),f&&(f.y=1-f.y),g&&(g.y=1-g.y)):o>=0&&i>=0?d!==0&&(d*=Math.max(h,p)):o<0&&i<0&&(d!==0&&(d*=Math.max(h,p)),f&&(f.x=1-f.x,f.y=1-f.y),g&&(g.x=1-g.x,g.y=1-g.y)),s.start&&f&&Ga(this.editor,n,s.start.toId,{...s.start.props,normalizedAnchor:f.toJson()}),s.end&&g&&Ga(this.editor,n,s.end.toId,{...s.end.props,normalizedAnchor:g.toJson()}),{props:{start:c,end:l,bend:d}}}onDoubleClickHandle(n,r){switch(r.id){case"start":return{id:n.id,type:n.type,props:{...n.props,arrowheadStart:n.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:n.id,type:n.type,props:{...n.props,arrowheadEnd:n.props.arrowheadEnd==="none"?"arrow":"none"}}}}component(n){const r=hr(),o=this.editor.getOnlySelectedShape(),i=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getIsReadonly(),s=Hr(this.editor,n);if(!(s!=null&&s.isValid))return null;const a=Rd(this.editor,n),c=n.id===this.editor.getOnlySelectedShapeId(),d=this.editor.getEditingShapeId()===n.id||n.props.text;return u(Z,{children:[u(ci,{id:n.id,style:{minWidth:50,minHeight:50},children:u(t_,{shape:n,shouldDisplayHandles:i&&(o==null?void 0:o.id)===n.id})}),d&&u(pp,{id:n.id,classNamePrefix:"tl-arrow",type:"arrow",font:n.props.font,fontSize:Ym(n),lineHeight:an.lineHeight,align:"middle",verticalAlign:"middle",text:n.props.text,labelColor:r[n.props.labelColor].solid,textWidth:a.box.w-Xu*2*n.props.scale,isSelected:c,padding:0,style:{transform:`translate(${a.box.center.x}px, ${a.box.center.y}px)`}})]})}indicator(n){const r=Bh(n.id),o=Hr(this.editor,n);if(!o)return null;const{start:i,end:s}=Rs(this.editor,n,o==null?void 0:o.bindings),a=this.editor.getShapeGeometry(n),c=a.bounds,l=n.props.text.trim()?a.children[1]:null;if(b.Equals(i,s))return null;const d=sn[n.props.size]*n.props.scale,h=o.start.arrowhead&&Zu(o,"start",d),p=o.end.arrowhead&&Zu(o,"end",d),f=o.isStraight?tO(o):QA(o),g=h&&o.start.arrowhead!=="arrow"||p&&o.end.arrowhead!=="arrow"||!!l,m=va(n.id+"_clip");if(r&&l)return u("rect",{x:N(l.x),y:N(l.y),width:l.w,height:l.h,rx:3.5*n.props.scale,ry:3.5*n.props.scale});const y=!(o.start.arrowhead==="none"||o.start.arrowhead==="arrow"),S=!(o.end.arrowhead==="none"||o.end.arrowhead==="arrow");return u("g",{children:[g&&u("defs",{children:u(rO,{hasText:n.props.text.trim().length>0,bounds:c,labelBounds:l?l.getBounds():new ee(0,0,0,0),as:y&&h?h:"",ae:S&&p?p:""})}),u("g",{style:{clipPath:g?`url(#${m})`:void 0,WebkitClipPath:g?`url(#${m})`:void 0},children:[g&&u("rect",{x:c.minX-100,y:c.minY-100,width:c.width+200,height:c.height+200,opacity:0}),u("path",{d:f})]}),h&&u("path",{d:h}),p&&u("path",{d:p}),l&&u("rect",{x:N(l.x),y:N(l.y),width:l.w,height:l.h,rx:3.5,ry:3.5})]})}onEditEnd(n){const{id:r,type:o,props:{text:i}}=n;i.trimEnd()!==n.props.text&&this.editor.updateShapes([{id:r,type:o,props:{text:i.trimEnd()}}])}toSvg(n,r){r.addExportDef(Fv(n.props.fill)),n.props.text&&r.addExportDef(up(n.props.font));const o=Lo(r),i=1/n.props.scale;return u("g",{transform:`scale(${i})`,children:[u(t_,{shape:n,shouldDisplayHandles:!1}),u(hp,{fontSize:Ym(n),font:n.props.font,align:"middle",verticalAlign:"middle",text:n.props.text,labelColor:o[n.props.labelColor].solid,bounds:Rd(this.editor,n).box.clone().expandBy(-Xu*n.props.scale),padding:0})]})}getCanvasSvgDefs(){return[zv(),{key:"arrow:dot",component:Pee},{key:"arrow:cross",component:Iee}]}getInterpolatedProps(n,r,o){return{...o>.5?r.props:n.props,scale:De(n.props.scale,r.props.scale,o),start:{x:De(n.props.start.x,r.props.start.x,o),y:De(n.props.start.y,r.props.start.y,o)},end:{x:De(n.props.end.x,r.props.end.x,o),y:De(n.props.end.y,r.props.end.y,o)},bend:De(n.props.bend,r.props.bend,o),labelPosition:De(n.props.labelPosition,r.props.labelPosition,o)}}}P(Ld,"type","arrow"),P(Ld,"props",pI),P(Ld,"migrations",fI);function nO(t,e){const n=Hr(t,e);return n.isStraight?b.Dist(n.start.handle,n.end.handle):Math.abs(n.handleArc.length)}const t_=Nt(function({shape:e,shouldDisplayHandles:n}){const r=F(),o=hr(),i=Hr(r,e),s=ee.ZeroFix(r.getShapeGeometry(e).bounds),a=En(r,e),c=U("force solid",()=>r.getZoomLevel()<.2,[r]);if(!(i!=null&&i.isValid))return null;const l=sn[e.props.size]*e.props.scale,d=i.start.arrowhead&&Zu(i,"start",l),h=i.end.arrowhead&&Zu(i,"end",l),p=i.isStraight?tO(i):QA(i);let f=null;if(n){const w=2/r.getZoomLevel(),{strokeDasharray:x,strokeDashoffset:C}=Sr(nO(r,e),w,{end:"skip",start:"skip",lengthRatio:2.5});f=a.start||a.end?u("path",{className:"tl-arrow-hint",d:i.isStraight?xee(i):_ee(i),strokeDasharray:x,strokeDashoffset:C,strokeWidth:w,markerStart:a.start?a.start.props.isExact?"":a.start.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:a.end?a.end.props.isExact?"":a.end.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}const{strokeDasharray:g,strokeDashoffset:m}=Sr(i.isStraight?i.length:Math.abs(i.bodyArc.length),l,{style:e.props.dash,forceSolid:c}),y=Rd(r,e),S=!(i.start.arrowhead==="none"||i.start.arrowhead==="arrow"),v=!(i.end.arrowhead==="none"||i.end.arrowhead==="arrow"),_=va(e.id+"_clip");return u(Z,{children:[u("defs",{children:u("clipPath",{id:_,children:u(rO,{hasText:e.props.text.trim().length>0,bounds:s,labelBounds:y.box,as:S&&d?d:"",ae:v&&h?h:""})})}),u("g",{fill:"none",stroke:o[e.props.color].solid,strokeWidth:l,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[f,u("g",{style:{clipPath:`url(#${_})`,WebkitClipPath:`url(#${_})`},children:[u("rect",{x:N(s.minX-100),y:N(s.minY-100),width:N(s.width+200),height:N(s.height+200),opacity:0}),u("path",{d:p,strokeDasharray:g,strokeDashoffset:m})]}),d&&S&&e.props.fill!=="none"&&u(Qt,{theme:o,d,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),h&&v&&e.props.fill!=="none"&&u(Qt,{theme:o,d:h,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),d&&u("path",{d}),h&&u("path",{d:h})]})]})});function rO({hasText:t,bounds:e,labelBounds:n,as:r,ae:o}){const i=`M${N(e.minX-100)},${N(e.minY-100)} h${e.width+200} v${e.height+200} h-${e.width+200} Z`,s=`M${N(n.minX)},${N(n.minY)} v${n.height} h${n.width} v-${n.height} Z`;return u("path",{d:`${i}${t?s:""}${r}${o}`})}const n_=new WeakMap;function Pee(){return u("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:u("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function Iee(){return u("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[u("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),u("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const r_="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function ea({url:t,zoomLevel:e}){return u("a",{className:de("tl-hyperlink-button",{"tl-hyperlink-button__hidden":e<.32}),href:t,target:"_blank",rel:"noopener noreferrer",onPointerDown:Mt,onPointerUp:Mt,title:t,draggable:!1,children:u("div",{className:"tl-hyperlink__icon",style:{mask:`url("${r_}") center 100% / 100% no-repeat`,WebkitMask:`url("${r_}") center 100% / 100% no-repeat`}})})}const o_="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",Cee=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function Ju(t){return Cee.map(n=>{const{offsetX:r,offsetY:o,blur:i,spread:s,color:a}=n,c=new b(r,o),{x:l,y:d}=c.rot(-t);return`${l}px ${d}px ${i}px ${s}px ${a}`}).join(", ")}const Eee=300,oO=320,Tee=46,kee=101;class Nd extends xa{canResize(){return!1}hideSelectionBoundsFg(){return!0}getText(e){return e.props.url}getDefaultProps(){return{url:"",w:Eee,h:oO,assetId:null}}component(e){return u(Mee,{shape:e,util:this})}indicator(e){return u("rect",{width:N(e.props.w),height:N(e.props.h),rx:"6",ry:"6"})}onBeforeCreate(e){return i_(this.editor,e)}onBeforeUpdate(e,n){if(e.props.url!==n.props.url)if(Xn.isValid(n.props.url))Oee(this.editor,n);else return{...n,props:{...n.props,url:e.props.url}};if(e.props.assetId!==n.props.assetId)return i_(this.editor,n)}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,w:De(e.props.w,n.props.w,r),h:De(e.props.h,n.props.h,r)}}}P(Nd,"type","bookmark"),P(Nd,"props",bI),P(Nd,"migrations",wI);function Mee({shape:t,util:e}){const n=t.props.assetId?e.editor.getAsset(t.props.assetId):null,r=!!rl()&&et.isSafari,o=e.editor.getShapePageTransform(t).rotation(),i=Aee(t),[s,a]=Q(!0),c=()=>a(!1);return u(si,{children:u("div",{className:de("tl-bookmark__container",r&&"tl-bookmark__container--safariExport"),style:{boxShadow:r?void 0:Ju(o),maxHeight:t.props.h},children:[(!n||n.props.image)&&u("div",{className:"tl-bookmark__image_container",children:[n?u("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:n==null?void 0:n.props.image,alt:(n==null?void 0:n.props.title)||""}):u("div",{className:"tl-bookmark__placeholder"}),(n==null?void 0:n.props.image)&&u(ea,{url:t.props.url,zoomLevel:e.editor.getZoomLevel()})]}),u("div",{className:"tl-bookmark__copy_container",children:[n!=null&&n.props.title?u("h2",{className:"tl-bookmark__heading",children:MQ(n.props.title)}):null,n!=null&&n.props.description&&(n!=null&&n.props.image)?u("p",{className:"tl-bookmark__description",children:n.props.description}):null,u("a",{className:"tl-bookmark__link",href:t.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:Mt,onPointerUp:Mt,onClick:Mt,children:[s&&(n!=null&&n.props.favicon)?u("img",{className:"tl-bookmark__favicon",src:n==null?void 0:n.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",onError:c,alt:`favicon of ${i}`}):u("div",{className:"tl-hyperlink__icon",style:{mask:`url("${o_}") center 100% / 100% no-repeat`,WebkitMask:`url("${o_}") center 100% / 100% no-repeat`}}),u("span",{children:i})]})]})]})})}function i_(t,e){const n=e.props.assetId?t.getAsset(e.props.assetId):null;let r=oO;return n&&(n.props.image||(n.props.title?r=kee:r=Tee)),{...e,props:{...e.props,h:r}}}const Aee=t=>{try{return new URL(t.props.url).hostname.replace(/^www\./,"")}catch{return t.props.url}};function Oee(t,e){const{url:n}=e.props,r=qo.createId(Dg(n));t.getAsset(r)?e.props.assetId!==r&&t.updateShapes([{id:e.id,type:e.type,props:{assetId:r}}]):(t.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),Dee(t,e))}const Dee=Cy(async(t,e)=>{if(t.isDisposed)return;const{url:n}=e.props,r=await t.getAssetForExternalContent({type:"url",url:n});r&&t.run(()=>{t.createAssets([r]),t.updateShapes([{id:e.id,type:e.type,props:{assetId:r.id}}])})},500);function es(t,e=!1){const n=t.length;if(n<2)return"";let r=t[0].point,o=t[1].point;if(n===2)return`M${Fe(r)}L${Fe(o)}`;let i="";for(let s=2,a=n-1;s<a;s++)r=t[s].point,o=t[s+1].point,i+=Cn(r,o);return e?`M${Cn(t[0].point,t[1].point)}Q${Fe(t[1].point)}${Cn(t[1].point,t[2].point)}T${i}${Cn(t[n-1].point,t[0].point)}${Cn(t[0].point,t[1].point)}Z`:`M${Fe(t[0].point)}Q${Fe(t[1].point)}${Cn(t[1].point,t[2].point)}${t.length>3?"T":""}${i}L${Fe(t[n-1].point)}`}function $ee(t,e={}){const{start:n={},end:r={}}=e,{cap:o=!0}=n,{cap:i=!0}=r;He(!n.taper&&!r.taper,"cap taper not supported here"),He(!n.easing&&!r.easing,"cap easing not supported here"),He(o&&i,"cap must be true");const s=Zr(t,e);lp(s,e);const a=Ree(s);let c="";for(const l of a)c+=Nee(l,e);return c}function Ree(t){if(t.length<=2)return[t];const e=[];let n=[t[0]],r=b.Sub(t[1].point,t[0].point).uni(),o,i,s,a,c;for(let l=1,d=t.length;l<d-1;l++){if(s=t[l-1],a=t[l],c=t[l+1],o=b.Sub(c.point,a.point).uni(),i=b.Dpr(r,o),r=o,i<-.8){const h={...a,point:a.input};n.push(h),e.push(Xf(n)),n=[h];continue}if(n.push(a),!(i>.7)&&(b.Dist2(s.point,a.point)+b.Dist2(a.point,c.point))/((s.radius+a.radius+c.radius)/3)**2<1.5){n.push(a),e.push(Xf(n)),n=[a];continue}}return n.push(t[t.length-1]),e.push(Xf(n)),e}function Xf(t){const e=t[0];let n;for(;t.length>2&&(n=t[1],b.Dist2(e.point,n.point)<((e.radius+n.radius)/2*.5)**2);)t.splice(1,1);const r=t[t.length-1];let o;for(;t.length>2&&(o=t[t.length-2],b.Dist2(r.point,o.point)<((r.radius+o.radius)/2*.5)**2);)t.splice(t.length-2,1);return t.length>1&&(t[0]={...t[0],vector:b.Sub(t[0].point,t[1].point).uni()},t[t.length-1]={...t[t.length-1],vector:b.Sub(t[t.length-2].point,t[t.length-1].point).uni()}),t}function Lee(t,e,n){return"M "+t+" "+e+" m -"+n+", 0 a "+n+","+n+" 0 1,1 "+n*2+",0 a "+n+","+n+" 0 1,1 -"+n*2+",0"}function Nee(t,e={}){if(t.length===0)return"";if(t.length===1)return Lee(t[0].point.x,t[0].point.y,t[0].radius);const{left:n,right:r}=FA(t,e);r.reverse();let o=`M${Fe(n[0])}T`;for(let i=1;i<n.length;i++)o+=Cn(n[i-1],n[i]);{const i=t[t.length-1],s=i.radius,a=i.vector.clone().per().neg(),c=b.Add(i.point,b.Mul(a,s)),l=b.Add(i.point,b.Mul(a,-s));o+=`${Fe(c)}A${N(s)},${N(s)} 0 0 1 ${Fe(l)}T`}for(let i=1;i<r.length;i++)o+=Cn(r[i-1],r[i]);{const i=t[0],s=i.radius,a=i.vector.clone().per(),c=b.Add(i.point,b.Mul(a,s)),l=b.Add(i.point,b.Mul(a,-s));o+=`${Fe(c)}A${N(s)},${N(s)} 0 0 1 ${Fe(l)}Z`}return o}const iO=(t,e,n)=>{const r=[],o=[];t.forEach(l=>r.push(...l.points)),e.forEach(l=>o.push(...l.points));const i=Math.max(r.length,o.length),s=[],a=[];for(let l=0;l<i;l++)s.push(r[l]||r[r.length-1]),a.push(o[l]||o[o.length-1]);return[{type:"free",points:s.map((l,d)=>{let h=.5;return a[d].z!==void 0&&l.z!==void 0&&(h=De(l.z,a[d].z,n)),{x:De(l.x,a[d].x,n),y:De(l.y,a[d].y,n),z:h}})}]},Fee=t=>t*.65+m7(t*ze/2)*.35,zee=t=>({size:t,thinning:.5,streamline:Ys(t,[9,16],[.64,.74],!0),smoothing:.62,easing:Rt.easeOutSine,simulatePressure:!0}),Bee=t=>({size:1+t*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Fee}),s_=t=>({size:t,thinning:0,streamline:Ys(t,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:Rt.linear}),Uee=t=>({size:t,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Rt.linear});function Uv({strokeWidth:t,showAsComplete:e}){return{size:1+t,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:Rt.easeOutSine,last:e}}function Xm(t,e,n,r){const o=t.isComplete||n;return r?t.isPen?{...Uee(e),last:o}:{...s_(e),last:o}:t.dash==="draw"?t.isPen?{...Bee(e),last:o}:{...zee(e),last:o}:{...s_(e),last:o}}function ta(t){const e=[];for(const n of t)if(n.type==="free"||n.points.length<2)e.push(...n.points.map(b.Cast));else{const r=Math.max(4,Math.floor(b.Dist(n.points[0],n.points[1])/16));e.push(...b.PointsBetween(n.points[0],n.points[1],r))}return e}function Hee(t,e,n){return{draw:"none",solid:"none",dotted:`${n} ${e*2}`,dashed:`${e*2} ${e*2}`}[t.props.dash]}class Fd extends _r{hideResizeHandles(e){return qf(e)}hideRotateHandle(e){return qf(e)}hideSelectionBoundsFg(e){return qf(e)}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(e){const n=ta(e.props.segments),r=(sn[e.props.size]+1)*e.props.scale;if(e.props.segments.length===1){const i=ee.FromPoints(n);if(i.width<r*2&&i.height<r*2)return new GS({x:-r,y:-r,radius:r,isFilled:!0})}const o=Zr(n,Xm(e.props,r,e.props.isPen,!0)).map(i=>i.point);return e.props.isClosed?new xt({points:o,isFilled:e.props.fill!=="none"}):new ba({points:o})}component(e){return u(ci,{id:e.id,children:u(a_,{shape:e})})}indicator(e){var d;const n=ta(e.props.segments);let r=(sn[e.props.size]+1)*e.props.scale;const o=this.editor.getZoomLevel();!(o<.5&&o<1.5/r)&&!e.props.isPen&&e.props.dash==="draw"&&n.length===1&&(r+=Tr(e.id)()*(r/6));const s=e.props.isComplete||((d=Ht(e.props.segments))==null?void 0:d.type)==="straight",a=Xm(e.props,r,s,!0),c=Zr(n,a),l=c.length>1?es(c,e.props.isClosed):sO(n[0],r);return u("path",{d:l})}toSvg(e,n){n.addExportDef(Fv(e.props.fill));const r=1/e.props.scale;return u("g",{transform:`scale(${r})`,children:u(a_,{shape:e,zoomOverride:1})})}getCanvasSvgDefs(){return[zv()]}onResize(e,n){const{scaleX:r,scaleY:o}=n,i=[];for(const s of e.props.segments)i.push({...s,points:s.points.map(({x:a,y:c,z:l})=>({x:mo(r*a),y:mo(o*c),z:l}))});return{props:{segments:i}}}expandSelectionOutlinePx(e){const n=e.props.dash==="draw"?1.6:1;return sn[e.props.size]*n/2*e.props.scale}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,segments:iO(e.props.segments,n.props.segments,r),scale:De(e.props.scale,n.props.scale,r)}}}P(Fd,"type","draw"),P(Fd,"props",xI),P(Fd,"migrations",PI);function sO(t,e){const n=(e+1)*.5;return`M ${t.x} ${t.y} m -${n}, 0 a ${n},${n} 0 1,0 ${n*2},0 a ${n},${n} 0 1,0 -${n*2},0`}function qf(t){return t.props.segments.length===1&&t.props.segments[0].points.length<2}function a_({shape:t,zoomOverride:e}){var f;const n=hr(),r=F(),o=ta(t.props.segments),i=t.props.isComplete||((f=Ht(t.props.segments))==null?void 0:f.type)==="straight";let s=(sn[t.props.size]+1)*t.props.scale;const a=U("force solid",()=>{const g=e??r.getZoomLevel();return g<.5&&g<1.5/s},[r,s,e]),c=U("dot adjustment",()=>(e??r.getZoomLevel())<.2?0:.1,[r,e]);!a&&!t.props.isPen&&t.props.dash==="draw"&&o.length===1&&(s+=Tr(t.id)()*(s/6));const l=Xm(t.props,s,i,a);if(!a&&t.props.dash==="draw")return u(Z,{children:[t.props.isClosed&&t.props.fill&&o.length>1?u(Qt,{d:es(Zr(o,l),t.props.isClosed),theme:n,color:t.props.color,fill:t.props.isClosed?t.props.fill:"none",scale:t.props.scale}):null,u("path",{d:$ee(o,l),strokeLinecap:"round",fill:n[t.props.color].solid})]});const d=Zr(o,l),h=d.length<2,p=h?sO(o[0],0):es(d,t.props.isClosed);return u(Z,{children:[u(Qt,{d:p,theme:n,color:t.props.color,fill:h||t.props.isClosed?t.props.fill:"none",scale:t.props.scale}),u("path",{d:p,strokeLinecap:"round",fill:h?n[t.props.color].solid:"none",stroke:n[t.props.color].solid,strokeWidth:s,strokeDasharray:h?"none":Hee(t,s,c),strokeDashoffset:"0"})]})}function jee(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Kee(t,e){const n=ye(e);if(!n)return;const r=n.host.replace("www.","");for(const o of t)if(aO(o.hostnames,r)){const i=o.fromEmbedUrl(e);if(i)return{definition:o,url:i,embedUrl:e}}}const Wee=t=>t.split("*").map(e=>jee(e)).join(".+"),aO=(t,e)=>!!t.find(n=>{const r=new RegExp(Wee(n));return e.match(r)});function Gee(t,e){const n=ye(e);if(!n)return;const r=n.host.replace("www.","");for(const o of t)if(aO(o.hostnames,r)){const i=o.toEmbedUrl(e);if(i)return{definition:o,embedUrl:i,url:e}}}function Vee(t,e){try{return Gee(t,e)??Kee(t,e)}catch{return}}const Yee=t=>Object.entries(t).filter(([e,n])=>n).map(([e])=>e).join(" ");class zd extends xa{constructor(){super(...arguments);P(this,"embedDefinitions",sv)}setEmbedDefinitions(n){this.embedDefinitions=n}getEmbedDefinitions(){return this.embedDefinitions}getEmbedDefinition(n){return Vee(this.embedDefinitions,n)}getText(n){return n.props.url}hideSelectionBoundsFg(n){return!this.canResize(n)}canEdit(){return!0}canResize(n){var r,o;return!!((o=(r=this.getEmbedDefinition(n.props.url))==null?void 0:r.definition)!=null&&o.doesResize)}canEditInReadOnly(){return!0}getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked(n){const r=this.getEmbedDefinition(n.props.url);return(r==null?void 0:r.definition.isAspectRatioLocked)??!1}onResize(n,r){const o=this.isAspectRatioLocked(n),i=this.getEmbedDefinition(n.props.url);let s=(i==null?void 0:i.definition.minWidth)??200,a=(i==null?void 0:i.definition.minHeight)??200;if(o){const c=n.props.w/n.props.h;c>1?s*=c:a/=c}return zh(n,r,{minWidth:s,minHeight:a})}component(n){const r=rl(),{w:o,h:i,url:s}=n.props,a=Bh(n.id),c=this.getEmbedDefinition(s),l=U("is hovering",()=>{const{editingShapeId:g,hoveredShapeId:m}=this.editor.getCurrentPageState();if(g&&m!==g){const y=this.editor.getShape(g);if(y&&this.editor.isShapeOfType(y,"embed"))return!0}return!1},[]),d=this.editor.getShapePageTransform(n).rotation();if(r)return u(si,{className:"tl-embed-container",id:n.id,children:u("div",{className:"tl-embed",style:{border:0,boxShadow:Ju(d),borderRadius:(c==null?void 0:c.definition.overrideOutlineRadius)??8,background:(c==null?void 0:c.definition.backgroundColor)??"var(--color-background)",width:o,height:i}})});const h=a||l;if(typeof window<"u"&&(window!==window.top||window.self!==window.parent)&&(c==null?void 0:c.definition.type)==="tldraw")return null;if((c==null?void 0:c.definition.type)==="github_gist"){const g=c.url.split("/").pop();if(!g)throw Error("No gist id!");return u(si,{className:"tl-embed-container",id:n.id,children:u(Xee,{id:g,width:N(o),height:N(i),isInteractive:h,pageRotation:d})})}const f=Yee({...tX,...(c==null?void 0:c.definition.overridePermissions)??{}});return u(si,{className:"tl-embed-container",id:n.id,children:c!=null&&c.definition?u("iframe",{className:"tl-embed",sandbox:f,src:c.embedUrl,width:N(o),height:N(i),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:h?"auto":"none",zIndex:h?"":"-1",boxShadow:Ju(d),borderRadius:(c==null?void 0:c.definition.overrideOutlineRadius)??8,background:c==null?void 0:c.definition.backgroundColor}}):null})}indicator(n){const r=this.getEmbedDefinition(n.props.url);return u("rect",{width:N(n.props.w),height:N(n.props.h),rx:(r==null?void 0:r.definition.overrideOutlineRadius)??8,ry:(r==null?void 0:r.definition.overrideOutlineRadius)??8})}getInterpolatedProps(n,r,o){return{...o>.5?r.props:n.props,w:De(n.props.w,r.props.w,o),h:De(n.props.h,r.props.h,o)}}}P(zd,"type","embed"),P(zd,"props",II),P(zd,"migrations",CI);function Xee({id:t,file:e,isInteractive:n,width:r,height:o,style:i,pageRotation:s}){return u("iframe",{className:"tl-embed",draggable:!1,width:N(r),height:N(o),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...i,pointerEvents:n?"all":"none",zIndex:n?"":"-1",boxShadow:Ju(s)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${t}.js${e?`?file=${e}`:""}`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}const qee=X(({id:t,name:e,isEditing:n},r)=>{const o=F(),i=V(c=>{c.key==="Enter"&&!c.nativeEvent.isComposing&&(Mt(c),c.currentTarget.blur(),o.setEditingShape(null))},[o]),s=V(c=>{const l=o.getShape(t);if(!l)return;const d=l.props.name,h=c.currentTarget.value.trim();d!==h&&o.updateShapes([{id:t,type:"frame",props:{name:h}}])},[t,o]),a=V(c=>{const l=o.getShape(t);if(!l)return;const d=l.props.name,h=c.currentTarget.value;d!==h&&o.updateShapes([{id:t,type:"frame",props:{name:h}}])},[t,o]);return u("div",{className:`tl-frame-label ${n?"tl-frame-label__editing":""}`,children:[u("input",{className:"tl-frame-name-input",ref:r,style:{display:n?void 0:"none"},value:e,autoFocus:!0,onKeyDown:i,onBlur:s,onChange:a}),cO(e,"Frame")+"​"]})}),Zee=function({id:e,name:n,width:r,height:o}){const i=F(),s=U("shape rotation",()=>ii(i.getShapePageTransform(e).rotation()),[i,e]),a=Bh(e),c=B(null),l=V(g=>{const m=Mn(g);g.preventDefault(),i.getEditingShapeId()!==e&&i.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:i.getShape(e),...m})},[i,e]);q(()=>{const g=c.current;g&&a&&(g.focus(),g.select())},[c,a]);const h=((s+Math.PI/4)*(2/Math.PI)+4)%4,p=["top","left","bottom","right"][Math.floor(h)];let f;switch(p){case"top":f="";break;case"right":f=`translate(${N(r)}px, 0px) rotate(90deg)`;break;case"bottom":f=`translate(${N(r)}px, ${N(o)}px) rotate(180deg)`;break;case"left":f=`translate(0px, ${N(o)}px) rotate(270deg)`;break}return u("div",{className:"tl-frame-heading",style:{overflow:a?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(p==="top"||p==="bottom"?r:o)}px + var(--space-5))`,bottom:"100%",transform:`${f} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:l,children:u("div",{className:"tl-frame-heading-hit-area",children:u(qee,{ref:c,id:e,name:n,isEditing:a})})})};function cO(t,e){return t.match(/^\s*$/)?e:t}class Bd extends xa{canEdit(){return!0}getDefaultProps(){return{w:160*2,h:90*2,name:""}}getGeometry(e){return new Mo({width:e.props.w,height:e.props.h,isFilled:!1})}getText(e){return e.props.name}component(e){const n=this.editor.getShapeGeometry(e).bounds,r=hr(),o=U("is creating this shape",()=>{const i=this.editor.getStateDescendant("select.resizing");if(!i||!i.getIsActive())return!1;const s=i==null?void 0:i.info;return s?s.isCreating&&this.editor.getOnlySelectedShapeId()===e.id:!1},[e.id]);return u(Z,{children:[u(ci,{children:u("rect",{className:de("tl-frame__body",{"tl-frame__creating":o}),width:n.width,height:n.height,fill:r.solid,stroke:r.text})}),o?null:u(Zee,{id:e.id,name:e.props.name,width:n.width,height:n.height})]})}toSvg(e,n){const r=Lo({isDarkMode:n.isDarkMode}),s=((ii(this.editor.getShapePageTransform(e.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4,a=Math.floor(s);let c;switch(a){case 0:c="";break;case 3:c=`translate(${N(e.props.w)}, 0) rotate(90)`;break;case 2:c=`translate(${N(e.props.w)}, ${N(e.props.h)}) rotate(180)`;break;case 1:c=`translate(0, ${N(e.props.h)}) rotate(270)`;break;default:throw Error("labelSide out of bounds")}const l={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:e.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle",fill:r.text},d=this.editor.textMeasure.measureTextSpans(cO(e.props.name,"Frame")+"​",l),h=d[0],p=Ht(d),f=p.box.w+p.box.x-h.box.x,g=Vm(this.editor,d,{offsetY:-l.height-2,...l});return u(Z,{children:[u("rect",{width:e.props.w,height:e.props.h,fill:r.solid,stroke:r.black.solid,strokeWidth:1,rx:1,ry:1}),u("g",{transform:c,children:[u("rect",{x:-8,y:-l.height-4,width:f+16,height:l.height,fill:r.background,rx:4,ry:4}),g]})]})}indicator(e){const n=this.editor.getShapeGeometry(e).bounds;return u("rect",{width:N(n.width),height:N(n.height),className:"tl-frame-indicator"})}canReceiveNewChildrenOfType(e,n){return!e.isLocked}providesBackgroundForChildren(){return!0}canDropShapes(e,n){return!e.isLocked}onDragShapesOver(e,n){n.every(r=>r.parentId===e.id)||this.editor.reparentShapes(n,e.id)}onDragShapesOut(e,n){const r=this.editor.getShape(e.parentId);r&&this.editor.isShapeOfType(r,"group")?this.editor.reparentShapes(n,r.id):this.editor.reparentShapes(n,this.editor.getCurrentPageId())}onResize(e,n){return zh(e,n)}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,w:De(e.props.w,n.props.w,r),h:De(e.props.h,n.props.h,r)}}}P(Bd,"type","frame"),P(Bd,"props",EI),P(Bd,"migrations",TI);function c_(t,e){return t>e?(ze*(e/2)+(t-e))*2:(ze*(t/2)+(e-t))*2}function lO(t,e){return Hv(t,e).map((n,r)=>n.getSvgPathData(r===0)).join(" ")+" Z"}function Jee(t,e,n,r){const o=t/4,i=e/4,s=Tr(r),a=n*.75,c=v=>v.addXY(s()*a,s()*a),l=new b(t/2,e),d=new b(0,i*1.2),h=new b(t/2,i*.9),p=new b(t,i*1.2),f=c(new b(t/2,e)),g=c(new b(0,i*1.2)),m=c(new b(t/2,i*.9)),y=c(new b(t,i*1.2));return[new tn({start:l,cp1:new b(o*1.5,i*3),cp2:new b(0,i*2.5),end:d}),new tn({start:d,cp1:new b(0,-i*.32),cp2:new b(o*1.85,-i*.32),end:h}),new tn({start:h,cp1:new b(o*2.15,-i*.32),cp2:new b(t,-i*.32),end:p}),new tn({start:p,cp1:new b(t,i*2.5),cp2:new b(o*2.5,i*3),end:f}),new tn({start:f,cp1:new b(o*1.5,i*3),cp2:new b(0,i*2.5),end:g}),new tn({start:g,cp1:new b(0,-i*.32),cp2:new b(o*1.85,-i*.32),end:m}),new tn({start:m,cp1:new b(o*2.15,-i*.32),cp2:new b(t,-i*.32),end:y}),new tn({start:y,cp1:new b(t,i*2.5),cp2:new b(o*2.5,i*3),end:l})].map((v,_)=>v.getSvgPathData(_===0)).join(" ")+" Z"}function Hv(t,e){const n=t/4,r=e/4;return[new tn({start:new b(t/2,e),cp1:new b(n*1.5,r*3),cp2:new b(0,r*2.5),end:new b(0,r*1.2)}),new tn({start:new b(0,r*1.2),cp1:new b(0,-r*.32),cp2:new b(n*1.85,-r*.32),end:new b(t/2,r*.9)}),new tn({start:new b(t/2,r*.9),cp1:new b(n*2.15,-r*.32),cp2:new b(t,-r*.32),end:new b(t,r*1.2)}),new tn({start:new b(t,r*1.2),cp1:new b(t,r*2.5),cp2:new b(n*2.5,r*3),end:new b(t/2,e)})]}function Qee(t){return{size:1+t,thinning:.25,end:{taper:t},start:{taper:t},streamline:0,smoothing:1,simulatePressure:!1}}function ete(t,e,n,r){const o=Tr(t),i=e/2,s=n/2,a=VI(i,s),c=[],l=Ve*o(),d=Ve+it/2+Math.abs(o())*it,h=Math.max(16,a/10);for(let p=0;p<h;p++){const f=p/(h-1),g=l+f*d,m=Math.cos(g),y=Math.sin(g);c.push(new b(i*m+e*.5+.05*o(),s*y+n/2+.05*o(),Math.min(1,.5+Math.abs(.5-(o()>0?Rt.easeInOutSine(f):Rt.easeInExpo(f)))/2)))}return Zr(c,Qee(r))}function tte(t,e,n,r){return es(ete(t,e,n,r))}function qm(t){let e="M";const n=t.length;let r,o,i;for(let s=0,a=n;s<a;s+=3)r=t[s],o=t[s+1],i=t[s+2],e+=`${Fe(r)}L${Fe(o)}Q${Fe(i)}`;return e+=`${Fe(t[0])}`,e}function Zm(t,e,n,r,o){const i=[],s=Tr(t);let a=e[0],c;const l=e.length;for(let d=0,h=l*o;d<h;d++){c=b.AddXY(e[(d+1)%l],s()*n,s()*n);const p=b.Sub(c,a),f=b.Len(p),g=b.Div(p,f).mul(Math.min(f/4,r));i.push(b.Add(a,g),b.Add(c,g.neg()),c),a=c}return i}function nte(t,e,n){const r=Math.min(t,e)/2,o=Math.max(t,e)-r*2,s=(Math.PI*(r*2)+2*o)/n,a=t>e?[{type:"straight",start:new b(r,0),delta:new b(1,0)},{type:"arc",center:new b(t-r,r),startAngle:-ze/2},{type:"straight",start:new b(t-r,e),delta:new b(-1,0)},{type:"arc",center:new b(r,r),startAngle:ze/2}]:[{type:"straight",start:new b(t,r),delta:new b(0,1)},{type:"arc",center:new b(r,e-r),startAngle:0},{type:"straight",start:new b(0,e-r),delta:new b(0,-1)},{type:"arc",center:new b(r,r),startAngle:ze}];let c=0;const l=[];for(let d=0;d<n;d++){const h=a[0];h.type==="straight"?l.push(b.Add(h.start,b.Mul(h.delta,c))):l.push(Vi(h.center,r,h.startAngle+c/r)),c+=s;let p=h.type==="straight"?o:ze*r;for(;c>p;)c-=p,a.push(a.shift()),p=a[0].type==="straight"?o:ze*r}return l}const rte={s:50,m:70,l:100,xl:130},ote=.2;function fp(t,e,n,r,o){const i=Tr(n),s=c_(t,e),a=Math.max(Math.ceil(s/rte[r]),6,Math.ceil(s/Math.min(t,e))),c=s/a*ote,l=Math.max(t-c*2,1),d=Math.max(e-c*2,1),p=c_(l,d)/a,f=(t-l)/2,g=(e-d)/2,m=nte(l,d,a).map(w=>w.addXY(f,g)),y=t<20?0:c*.3,S=e<20?0:c*.3,v=m.slice(0);for(let w=0;w<Math.floor(a/2);w++)v[w]=b.AddXY(v[w],i()*y*o,i()*S*o),v[a-w-1]=b.AddXY(v[a-w-1],i()*y*o,i()*S*o);const _=[];for(let w=0;w<v.length;w++){const x=w===v.length-1?0:w+1,C=v[w],E=v[x],I=m[w],T=m[x],k=b.Dist(I,T),D=p-k,O=b.Dist(C,E)/k,$=(Math.max(f,g)+D)*O,z=b.Lrp(I,T,.5).add(b.Sub(T,I).uni().per().mul($));z.x<0?z.x=0:z.x>t&&(z.x=t),z.y<0?z.y=0:z.y>e&&(z.y=e);const R=PS(C,E,z),W=b.Dist(R||b.Average([C,E]),C);_.push({leftPoint:C,rightPoint:E,arcPoint:z,center:R,radius:W})}return _}function ite(t,e,n,r,o){const i=[],s=fp(t,e,n,r,o);for(const{center:a,radius:c,leftPoint:l,rightPoint:d}of s)i.push(...b7(l,d,a,c,10));return i}function Jm(t,e,n,r,o){const i=fp(t,e,n,r,o);let s=`M${i[0].leftPoint.toFixed()}`;for(const{leftPoint:a,rightPoint:c,radius:l,center:d}of i){if(d===null){s+=` L${c.toFixed()}`;continue}const h=b.Clockwise(a,c,d)?"0":"1";s+=` A${N(l)},${N(l)} 0 ${h},1 ${c.toFixed()}`}return s+=" Z",s}const ste={s:.5,m:.7,l:.9,xl:1.6};function ate(t,e,n,r,o){const i=Tr(n),s=ste[r]*o,a=fp(t,e,n,r,o),d=a.reduce((g,m)=>g+b.Dist2(m.leftPoint,m.rightPoint),0)/a.length>(s*15)**2?g=>b.AddXY(g,i()*s*2,i()*s*2):g=>g;let h=`M${a[0].leftPoint.toFixed()}`,p=d(a[0].leftPoint),f=`M${p.toFixed()}`;for(const{leftPoint:g,center:m,rightPoint:y,radius:S,arcPoint:v}of a){if(m===null){h+=` L${y.toFixed()}`;const I=d(y);f+=` L${I.toFixed()}`,p=I;continue}const _=b.Clockwise(g,y,m)?"0":"1";h+=` A${N(S)},${N(S)} 0 ${_},1 ${y.toFixed()}`;const w=d(y),x=d(v),C=PS(p,w,x);if(!C){f+=` L${w.toFixed()}`,p=w;continue}const E=Math.abs(b.Dist(C,p));f+=` A${N(E)},${N(E)} 0 ${_},1 ${w.toFixed()}`,p=w}return h+f+" Z"}function Qm(t,e){switch(t.geo){case"x-box":return cte(t.w,t.h,e,t.dash);case"check-box":return lte(t.w,t.h);default:return}}function cte(t,e,n,r){const o=r==="draw"?.62:0;if(r==="dashed")return[[new b(0,0),new b(t/2,e/2)],[new b(t,e),new b(t/2,e/2)],[new b(0,e),new b(t/2,e/2)],[new b(t,0),new b(t/2,e/2)]];const i=a=>Math.max(0,Math.min(t,a)),s=a=>Math.max(0,Math.min(e,a));return[[new b(i(n*o),s(n*o)),new b(i(t-n*o),s(e-n*o))],[new b(i(n*o),s(e-n*o)),new b(i(t-n*o),s(n*o))]]}function lte(t,e){const n=Math.min(t,e)*.82,r=(t-n)/2,o=(e-n)/2,i=a=>Math.max(0,Math.min(t,a)),s=a=>Math.max(0,Math.min(e,a));return[[new b(i(r+n*.25),s(o+n*.52)),new b(i(r+n*.45),s(o+n*.82))],[new b(i(r+n*.45),s(o+n*.82)),new b(i(r+n*.82),s(o+n*.22))]]}function l_({shape:t,shouldScale:e,forceSolid:n}){const r=e?t.props.scale:1,o=F(),i=hr(),{id:s,props:a}=t,{w:c,color:l,fill:d,dash:h,growY:p,size:f,scale:g}=a,m=sn[f]*r,y=a.h+p;switch(a.geo){case"cloud":if(h==="solid"){const S=Jm(c,y,s,f,g);return u(Z,{children:[u(Qt,{theme:i,d:S,color:l,fill:d,scale:r}),u("path",{d:S,stroke:i[l].solid,strokeWidth:m,fill:"none"})]})}else if(h==="draw"){const S=ate(c,y,s,f,g);return u(Z,{children:[u(Qt,{theme:i,d:S,color:l,fill:d,scale:r}),u("path",{d:S,stroke:i[l].solid,strokeWidth:m,fill:"none"})]})}else{const S=Jm(c,y,s,f,g),v=fp(c,y,s,f,g);return u(Z,{children:[u(Qt,{theme:i,d:S,color:l,fill:d,scale:r}),u("g",{strokeWidth:m,stroke:i[l].solid,fill:"none",pointerEvents:"all",children:v.map(({leftPoint:_,rightPoint:w,center:x,radius:C},E)=>{const I=x?C*ii(ii(b.Angle(x,w))-ii(b.Angle(x,_))):b.Dist(_,w),{strokeDasharray:T,strokeDashoffset:k}=Sr(I,m,{style:h,start:"outset",end:"outset",forceSolid:n});return u("path",{d:x?`M${_.x},${_.y}A${C},${C},0,0,1,${w.x},${w.y}`:`M${_.x},${_.y}L${w.x},${w.y}`,strokeDasharray:T,strokeDashoffset:k},E)})})]})}case"ellipse":{const S=e?o.getShapeGeometry(t):o.getShapeUtil(t).getGeometry(t),v=S.getSvgPathData(!0);if(h==="dashed"||h==="dotted"){const _=S.length,{strokeDasharray:w,strokeDashoffset:x}=Sr(_<64?_*2:_,m,{style:h,snap:4,closed:!0,forceSolid:n});return u(Z,{children:[u(Qt,{theme:i,d:v,color:l,fill:d,scale:r}),u("path",{d:v,strokeWidth:m,fill:"none",stroke:i[l].solid,strokeDasharray:w,strokeDashoffset:x})]})}else{const w=(e?o.getShapeGeometry(t):o.getShapeUtil(t).getGeometry(t)).getSvgPathData(!0);return u(Z,{children:[u(Qt,{theme:i,d:w,color:l,fill:d,scale:r}),u("path",{d:w,stroke:i[l].solid,strokeWidth:m,fill:"none"})]})}}case"oval":{const S=e?o.getShapeGeometry(t):o.getShapeUtil(t).getGeometry(t),v=S.getSvgPathData(!0);if(h==="dashed"||h==="dotted"){const _=S.getLength(),{strokeDasharray:w,strokeDashoffset:x}=Sr(_<64?_*2:_,m,{style:h,snap:4,start:"outset",end:"outset",closed:!0,forceSolid:n});return u(Z,{children:[u(Qt,{theme:i,d:v,color:l,fill:d,scale:r}),u("path",{d:v,strokeWidth:m,fill:"none",stroke:i[l].solid,strokeDasharray:w,strokeDashoffset:x})]})}else return u(Z,{children:[u(Qt,{theme:i,d:v,color:l,fill:d,scale:r}),u("path",{d:v,stroke:i[l].solid,strokeWidth:m,fill:"none"})]})}case"heart":if(h==="dashed"||h==="dotted"||h==="solid"){const S=lO(c,y),v=Hv(c,y);return u(Z,{children:[u(Qt,{theme:i,d:S,color:l,fill:d,scale:r}),v.map((_,w)=>{const{strokeDasharray:x,strokeDashoffset:C}=Sr(_.length,m,{style:h,snap:1,start:"outset",end:"outset",closed:!0,forceSolid:n});return u("path",{d:_.getSvgPathData(),strokeWidth:m,fill:"none",stroke:i[l].solid,strokeDasharray:x,strokeDashoffset:C,pointerEvents:"all"},`curve_${w}`)})]})}else{const S=Jee(c,y,m,t.id);return u(Z,{children:[u(Qt,{theme:i,d:S,color:l,fill:d,scale:r}),u("path",{d:S,stroke:i[l].solid,strokeWidth:m,fill:"none"})]})}default:{const S=e?o.getShapeGeometry(t):o.getShapeUtil(t).getGeometry(t),v=S instanceof Ir?S.children[0].vertices:S.vertices,_=Qm(t.props,m);if(h==="solid"){let w="M"+v[0]+"L"+v.slice(1)+"Z";if(_)for(const[x,C]of _)w+=`M${x.x},${x.y}L${C.x},${C.y}`;return u(Z,{children:[u(Qt,{theme:i,d:w,color:l,fill:d,scale:r}),u("path",{d:w,stroke:i[l].solid,strokeWidth:m,fill:"none"})]})}else if(h==="dashed"||h==="dotted"){const w="M"+v[0]+"L"+v.slice(1)+"Z";return u(Z,{children:[u(Qt,{theme:i,d:w,color:l,fill:d,scale:r}),u("g",{strokeWidth:m,stroke:i[l].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(v.length)).map((x,C)=>{const E=b.ToFixed(v[C]),I=b.ToFixed(v[(C+1)%v.length]),T=b.Dist(E,I),{strokeDasharray:k,strokeDashoffset:D}=Sr(T,m,{style:h,start:"outset",end:"outset",forceSolid:n});return u("line",{x1:E.x,y1:E.y,x2:I.x,y2:I.y,strokeDasharray:k,strokeDashoffset:D},C)}),_&&_.map(([x,C],E)=>{const I=b.Dist(x,C),{strokeDasharray:T,strokeDashoffset:k}=Sr(I,m,{style:h,start:"skip",end:"skip",snap:h==="dotted"?4:void 0,forceSolid:n});return u("path",{d:`M${x.x},${x.y}L${C.x},${C.y}`,stroke:i[l].solid,strokeWidth:m,fill:"none",strokeDasharray:T,strokeDashoffset:k},`line_fg_${E}`)})]})]})}else if(h==="draw"){let w=qm(Zm(s,v,m/3,m*2,2));if(_)for(const[C,E]of _)w+=`M${C.toFixed()}L${E.toFixed()}`;const x=qm(Zm(s,v,0,m*2,1));return u(Z,{children:[u(Qt,{theme:i,d:x,color:l,fill:d,scale:r}),u("path",{d:w,stroke:i[l].solid,strokeWidth:m,fill:"none"})]})}}}}const d_=17*3;class Ud extends xa{canEdit(){return!0}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:"",scale:1}}getGeometry(e){const n=Math.max(1,e.props.w),r=Math.max(1,e.props.h+e.props.growY),o=n/2,i=r/2,s=e.props.fill!=="none";let a;switch(e.props.geo){case"cloud":{a=new xt({points:ite(n,r,e.id,e.props.size,e.props.scale),isFilled:s});break}case"triangle":{a=new xt({points:[new b(o,0),new b(n,r),new b(0,r)],isFilled:s});break}case"diamond":{a=new xt({points:[new b(o,0),new b(n,i),new b(o,r),new b(0,i)],isFilled:s});break}case"pentagon":{a=new xt({points:uf(n,r,5),isFilled:s});break}case"hexagon":{a=new xt({points:uf(n,r,6),isFilled:s});break}case"octagon":{a=new xt({points:uf(n,r,8),isFilled:s});break}case"ellipse":{a=new AG({width:n,height:r,isFilled:s});break}case"oval":{a=new OG({width:n,height:r,isFilled:s});break}case"star":{const v=Ve/5/2,_=Math.floor(5/4)*2,w=5*2-_,x=0,C=Math.floor(5/2)*2,E=Math.cos(-it+_*v)*n/2,I=Math.cos(-it+w*v)*n/2,T=Math.sin(-it+x*v)*r/2,k=Math.sin(-it+C*v)*r/2,D=n-Math.abs(E-I),A=r-Math.abs(k-T),O=n/2+I-(n/2-E),$=r/2+T-(r/2-k),z=1,R=(n-O)/2,W=(r-$)/2,j=(n+D)/2,G=(r+A)/2,le=j*z/2,he=G*z/2;a=new xt({points:Array.from(Array(5*2)).map((ve,me)=>{const Be=-it+me*v;return new b(R+(me%2?le:j)*Math.cos(Be),W+(me%2?he:G)*Math.sin(Be))}),isFilled:s});break}case"rhombus":{const S=Math.min(n*.38,r*.38);a=new xt({points:[new b(S,0),new b(n,0),new b(n-S,r),new b(0,r)],isFilled:s});break}case"rhombus-2":{const S=Math.min(n*.38,r*.38);a=new xt({points:[new b(0,0),new b(n-S,0),new b(n,r),new b(S,r)],isFilled:s});break}case"trapezoid":{const S=Math.min(n*.38,r*.38);a=new xt({points:[new b(S,0),new b(n-S,0),new b(n,r),new b(0,r)],isFilled:s});break}case"arrow-right":{const S=Math.min(n,r)*.38,v=r*.16;a=new xt({points:[new b(0,v),new b(n-S,v),new b(n-S,0),new b(n,r/2),new b(n-S,r),new b(n-S,r-v),new b(0,r-v)],isFilled:s});break}case"arrow-left":{const S=Math.min(n,r)*.38,v=r*.16;a=new xt({points:[new b(S,0),new b(S,v),new b(n,v),new b(n,r-v),new b(S,r-v),new b(S,r),new b(0,r/2)],isFilled:s});break}case"arrow-up":{const S=n*.16,v=Math.min(n,r)*.38;a=new xt({points:[new b(n/2,0),new b(n,v),new b(n-S,v),new b(n-S,r),new b(S,r),new b(S,v),new b(0,v)],isFilled:s});break}case"arrow-down":{const S=n*.16,v=Math.min(n,r)*.38;a=new xt({points:[new b(S,0),new b(n-S,0),new b(n-S,r-v),new b(n,r-v),new b(n/2,r),new b(0,r-v),new b(S,r-v)],isFilled:s});break}case"check-box":case"x-box":case"rectangle":{a=new Mo({width:n,height:r,isFilled:s});break}case"heart":{const v=Hv(n,r).reduce((_,w)=>(_.push(...w.vertices),_),[]);a=new xt({points:v,isFilled:s});break}default:$t(e.props.geo)}const c=ad(this.editor,e),l=n/e.props.scale,d=r/e.props.scale,h=Math.min(100,l/2),p=Math.min(Eo[e.props.size]*an.lineHeight+or*2,d/2),f=Math.min(l,Math.max(c.w,Math.min(h,Math.max(1,l-8)))),g=Math.min(d,Math.max(c.h,Math.min(p,Math.max(1,d-8)))),m=Qm(e.props,sn[e.props.size]*e.props.scale),y=m?m.map(S=>new ba({points:S})):[];return new Ir({children:[a,new Mo({x:e.props.align==="start"?0:e.props.align==="end"?(l-f)*e.props.scale:(l-f)/2*e.props.scale,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?(d-g)*e.props.scale:(d-g)/2*e.props.scale,width:f*e.props.scale,height:g*e.props.scale,isFilled:!0,isLabel:!0}),...y]})}getHandleSnapGeometry(e){const n=this.getGeometry(e),r=n.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:r,points:[...r.getVertices(),n.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:r,points:[n.bounds.center]};default:$t(e.props.geo)}}getText(e){return e.props.text}onEditEnd(e){const{id:n,type:r,props:{text:o}}=e;o.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:n,type:r,props:{text:o.trimEnd()}}])}component(e){const{id:n,type:r,props:o}=e,{fill:i,font:s,align:a,verticalAlign:c,size:l,text:d}=o,h=hr(),{editor:p}=this,f=U("isGeoOnlySelected",()=>e.id===p.getOnlySelectedShapeId(),[]),m=p.getEditingShapeId()!==null||e.props.text,y=U("force solid",()=>p.getZoomLevel()<.2,[p]);return u(Z,{children:[u(ci,{id:n,children:u(l_,{shape:e,shouldScale:!0,forceSolid:y})}),m&&u(si,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+o.growY},children:u(pp,{id:n,type:r,font:s,fontSize:Eo[l]*e.props.scale,lineHeight:an.lineHeight,padding:or*e.props.scale,fill:i,align:a,verticalAlign:c,text:d,isSelected:f,labelColor:h[o.labelColor].solid,wrap:!0})}),e.props.url&&u(ea,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){const{id:n,props:r}=e,{w:o,size:i}=r,s=r.h+r.growY,a=sn[i],c=this.editor.getShapeGeometry(e);switch(r.geo){case"ellipse":return r.dash==="draw"?u("path",{d:tte(n,o,s,a)}):u("path",{d:c.getSvgPathData(!0)});case"heart":return u("path",{d:lO(o,s)});case"oval":return u("path",{d:c.getSvgPathData(!0)});case"cloud":return u("path",{d:Jm(o,s,n,i,e.props.scale)});default:{const l=this.editor.getShapeGeometry(e),d=l instanceof Ir?l.children[0].vertices:l.vertices;let h;if(r.dash==="draw"){const f=Zm(n,d,0,a*2*e.props.scale,1);h=qm(f)}else h="M"+d[0]+"L"+d.slice(1)+"Z";const p=Qm(e.props,a);if(p)for(const[f,g]of p)h+=`M${f.x},${f.y}L${g.x},${g.y}`;return u("path",{d:h})}}}toSvg(e,n){const r={...e,props:{...e.props,w:e.props.w/e.props.scale,h:e.props.h/e.props.scale}},o=r.props;n.addExportDef(Fv(o.fill));let i;if(o.text){n.addExportDef(up(o.font));const s=Lo(n),a=new ee(0,0,o.w,o.h+o.growY);i=u(hp,{fontSize:Eo[o.size],font:o.font,align:o.align,verticalAlign:o.verticalAlign,text:o.text,labelColor:s[o.labelColor].solid,bounds:a,padding:16})}return u(Z,{children:[u(l_,{shouldScale:!1,shape:r,forceSolid:!1}),i]})}getCanvasSvgDefs(){return[zv()]}onResize(e,{handle:n,newPoint:r,scaleX:o,scaleY:i,initialShape:s}){const a=s.props.w/s.props.scale,c=s.props.h/s.props.scale,l=s.props.growY/s.props.scale;let d=a*o,h=(c+l)*i,p=0,f=0;const g=d_;if(e.props.text.trim()){let w=Math.max(Math.abs(d),g),x=Math.max(Math.abs(h),g);w<g&&x===g&&(w=g),w===g&&x<g&&(x=g);const C=ad(this.editor,{...e,props:{...e.props,w:w*e.props.scale,h:x*e.props.scale}}),E=Math.max(Math.abs(d),C.w)*Math.sign(d),I=Math.max(Math.abs(h),C.h)*Math.sign(h);p=Math.abs(E)-Math.abs(d),f=Math.abs(I)-Math.abs(h),d=E,h=I}const m=d*e.props.scale,y=h*e.props.scale,S=new b(0,0);o<0&&(S.x+=m),(n==="left"||n==="top_left"||n==="bottom_left")&&(S.x+=o<0?p:-p),i<0&&(S.y+=y),(n==="top"||n==="top_left"||n==="top_right")&&(S.y+=i<0?f:-f);const{x:v,y:_}=S.rot(e.rotation).add(r);return{x:v,y:_,props:{w:Math.max(Math.abs(m),1),h:Math.max(Math.abs(y),1),growY:0}}}onBeforeCreate(e){if(!e.props.text)return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;const n=e.props.h/e.props.scale,r=ad(this.editor,e).h;let o=null;if(r>n?o=r-n:e.props.growY&&(o=0),o!==null)return{...e,props:{...e.props,growY:o*e.props.scale}}}onBeforeUpdate(e,n){const r=e.props.text,o=n.props.text;if(r===o&&e.props.font===n.props.font&&e.props.size===n.props.size)return;if(r&&!o)return{...n,props:{...n.props,growY:0}};const i=e.props.w/e.props.scale,s=e.props.h/e.props.scale,a=e.props.growY/e.props.scale,c=ad(this.editor,n);if(!r&&o&&o.length===1){let d=Math.max(i,c.w),h=Math.max(s,c.h);const p=d_;return i<p&&s<p&&(d=Math.max(d,p),h=Math.max(h,p),d=Math.max(d,h),h=Math.max(d,h)),{...n,props:{...n.props,w:d*n.props.scale,h:h*n.props.scale,growY:0}}}let l=null;if(c.h>s?l=c.h-s:a&&(l=0),l!==null){const d=n.props.w/n.props.scale;return{...n,props:{...n.props,growY:l*n.props.scale,w:Math.max(d,c.w)*n.props.scale}}}if(c.w>i)return{...n,props:{...n.props,w:c.w*n.props.scale}}}onDoubleClick(e){if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,w:De(e.props.w,n.props.w,r),h:De(e.props.h,n.props.h,r),scale:De(e.props.scale,n.props.scale,r)}}}P(Ud,"type","geo"),P(Ud,"props",kI),P(Ud,"migrations",MI);function ad(t,e){const{text:n,font:r,size:o,w:i}=e.props;if(!n)return{w:0,h:0};const s=t.textMeasure.measureText("w",{...an,fontFamily:Do[r],fontSize:Eo[o],maxWidth:100}),a={s:2,m:3.5,l:5,xl:10},c=t.textMeasure.measureText(n,{...an,fontFamily:Do[r],fontSize:Eo[o],minWidth:s.w,maxWidth:Math.max(0,Math.ceil(s.w+a[o]),Math.ceil(i/e.props.scale-or*2))});return{w:c.w+or*2,h:c.h+or*2}}function dte(){const[t,e]=Q(!1);return q(()=>{const r=CSS.supports("color","color(display-p3 1 1 1)"),o=matchMedia("(color-gamut: p3)");e(r&&o.matches);const i=()=>e(r&&o.matches);return o.addEventListener("change",i),()=>o.removeEventListener("change",i)},[]),U(Pt.forceSrgb)||!t?"srgb":"p3"}const u_=.35,h_=.82;class Hd extends _r{hideResizeHandles(e){return cd(e)}hideRotateHandle(e){return cd(e)}hideSelectionBoundsFg(e){return cd(e)}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(e){const n=Oi(e);if(cd(e))return new GS({x:-n/2,y:-n/2,radius:n/2,isFilled:!0});const{strokePoints:r,sw:o}=p_(e,n,!0),i=Uv({strokeWidth:o,showAsComplete:!0});return lp(r,i),new xt({points:Rv(r,i),isFilled:!0})}component(e){const n=Zf(this.editor,e),r=Oi(e);return u(ci,{id:e.id,children:u(ld,{shape:e,forceSolid:n,strokeWidth:r,opacity:u_})})}backgroundComponent(e){const n=Zf(this.editor,e),r=Oi(e);return u(ci,{id:e.id,children:u(ld,{shape:e,forceSolid:n,strokeWidth:r,opacity:h_})})}indicator(e){const n=Zf(this.editor,e),r=Oi(e),{strokePoints:o,sw:i}=p_(e,r,n),s=ta(e.props.segments);let a;return o.length<2?a=hte(s[0],i):a=es(o,!1),u("path",{d:a})}toSvg(e){const n=Oi(e),r=n<1.5,o=1/e.props.scale;return u("g",{transform:`scale(${o})`,children:u(ld,{forceSolid:r,strokeWidth:n,shape:e,opacity:u_})})}toBackgroundSvg(e){const n=Oi(e),r=n<1.5,o=1/e.props.scale;return u("g",{transform:`scale(${o})`,children:u(ld,{forceSolid:r,strokeWidth:n,shape:e,opacity:h_})})}onResize(e,n){const{scaleX:r,scaleY:o}=n,i=[];for(const s of e.props.segments)i.push({...s,points:s.points.map(({x:a,y:c,z:l})=>({x:r*a,y:o*c,z:l}))});return{props:{segments:i}}}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,...n.props,segments:iO(e.props.segments,n.props.segments,r),scale:De(e.props.scale,n.props.scale,r)}}}P(Hd,"type","highlight"),P(Hd,"props",DI),P(Hd,"migrations",$I);function ute(t){return`M ${t.x} ${t.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function hte(t,e){const n=e/2;return`M ${t.x} ${t.y} m -${n}, 0 a ${n},${n} 0 1,0 ${n*2},0 a ${n},${n} 0 1,0 -${n*2},0`}function p_(t,e,n){var c;const r=ta(t.props.segments),o=t.props.isComplete||((c=Ht(t.props.segments))==null?void 0:c.type)==="straight";let i=e;!n&&!t.props.isPen&&r.length===1&&(i+=Tr(t.id)()*(e/6));const s=Uv({strokeWidth:i,showAsComplete:o});return{strokePoints:Zr(r,s),sw:i}}function Oi(t){return Js[t.props.size]*1.12*t.props.scale}function cd(t){return t.props.segments.length===1&&t.props.segments[0].points.length<2}function ld({strokeWidth:t,forceSolid:e,shape:n,opacity:r}){var p;const o=hr(),i=ta(n.props.segments);let s=t;!e&&!n.props.isPen&&i.length===1&&(s+=Tr(n.id)()*(s/6));const a=Uv({strokeWidth:s,showAsComplete:n.props.isComplete||((p=Ht(n.props.segments))==null?void 0:p.type)==="straight"}),c=Zr(i,a),l=c.length>1?es(c,!1):ute(n.props.segments[0].points[0]),d=dte(),h=o[n.props.color].highlight[d];return u("path",{d:l,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:h,strokeWidth:s,opacity:r})}function Zf(t,e){return U("forceSolid",()=>{const n=Oi(e),r=t.getZoomLevel();return n/r<1.5},[t])}function dO(){return u("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[u("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),u("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),u("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function uO(t){const{shapeId:e,assetId:n,width:r}=t,o=F(),[i,s]=Q(null),[a,c]=Q(!1),l=!!rl(),d=n?o.getAsset(n):null,p=o.getCulledShapes().has(e),f=B(!1),g=Aj();q(()=>{i&&(f.current=!0)},[i]);const m=d&&"w"in d.props?r/d.props.w:1,y=U("zoom level",()=>o.getZoomLevel()*m,[o,m]);return q(()=>{i&&(f.current=!0)},[i]),q(()=>{if(!l&&p)return;if(n&&!(d!=null&&d.props.src)){const _=o.getTemporaryAssetPreview(n);if(_){s(_),c(!0),g();return}}let S=!1;async function v(){const _=await o.resolveAssetUrl(n,{screenScale:y,shouldResolveToOriginal:l});S||(s(_),c(!1),g())}if(f.current){const _=o.timers.setTimeout(v,500);return()=>{clearTimeout(_),S=!0}}else return v(),()=>{S=!0}},[n,d==null?void 0:d.props.src,p,y,o,l,g]),{asset:d,url:i,isPlaceholder:a}}function hO(){const[t,e]=Q(!1);return q(()=>{if(typeof window>"u"||!("matchMedia"in window))return;const n=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{e(n.matches)};return r(),n.addEventListener("change",r),()=>n.removeEventListener("change",r)},[]),t}async function pte(t){const n=await(await Pr(t)).blob();return wo.blobToDataUrl(n)}class jd extends xa{isAspectRatioLocked(){return!0}canCrop(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1}}onResize(e,n){let r=zh(e,n);const{flipX:o,flipY:i}=n.initialShape.props,{scaleX:s,scaleY:a,mode:c}=n;if(r={...r,props:{...r.props,flipX:s<0!==o,flipY:a<0!==i}},!e.props.crop)return r;const l=c==="scale_shape"&&s===-1||c==="resize_bounds"&&o!==r.props.flipX,d=c==="scale_shape"&&a===-1||c==="resize_bounds"&&i!==r.props.flipY,{topLeft:h,bottomRight:p}=e.props.crop;return r.props.crop={topLeft:{x:l?1-p.x:h.x,y:d?1-p.y:h.y},bottomRight:{x:l?1-h.x:p.x,y:d?1-h.y:p.y}},r}isAnimated(e){const n=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;return n?"mimeType"in n.props&&Kn.isAnimatedImageType(n==null?void 0:n.props.mimeType)||"isAnimated"in n.props&&n.props.isAnimated:!1}component(e){var S;const n=this.editor.getCroppingShapeId()===e.id,r=hO(),[o,i]=Q(""),[s,a]=Q(null),c=e.id===this.editor.getOnlySelectedShapeId(),{asset:l,url:d}=uO({shapeId:e.id,assetId:e.props.assetId,width:e.props.w});if(q(()=>{if(d&&this.isAnimated(e)){let v=!1;const _=xc();return _.onload=()=>{if(v)return;const w=document.createElement("canvas");w.width=_.width,w.height=_.height;const x=w.getContext("2d");x&&(x.drawImage(_,0,0),i(w.toDataURL()),a(d))},_.crossOrigin="anonymous",_.src=d,()=>{v=!0}}},[r,d,e]),(l==null?void 0:l.type)==="bookmark")throw Error("Bookmark assets can't be rendered as images");const h=c&&n&&this.editor.isIn("select.crop"),p=r&&(((S=l==null?void 0:l.props.mimeType)==null?void 0:S.includes("video"))||this.isAnimated(e)),f=f_(e),g=d===s?null:d,m=p?o:s;if(!d&&!(l!=null&&l.props.src))return u(si,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,color:"var(--color-text-3)",backgroundColor:"var(--color-low)",border:"1px solid var(--color-low-border)"},children:[u("div",{className:de("tl-image-container",l&&"tl-image-container-loading"),style:f,children:l?null:u(dO,{})}),"url"in e.props&&e.props.url&&u(ea,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]});const y=this.isAnimated(e)?"anonymous":void 0;return u(Z,{children:[h&&m&&u("div",{style:f,children:u("img",{className:"tl-image",style:{...Va(e),opacity:.1},crossOrigin:y,src:m,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1})}),u(si,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h},children:[u("div",{className:de("tl-image-container"),style:f,children:[m&&u("img",{className:"tl-image",style:Va(e),crossOrigin:y,src:m,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1},m),g&&u("img",{className:"tl-image",style:Va(e),crossOrigin:y,src:g,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,onLoad:()=>a(g)},g)]}),e.props.url&&u(ea,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})]})}indicator(e){return this.editor.getCroppingShapeId()===e.id?null:u("rect",{width:N(e.props.w),height:N(e.props.h)})}async toSvg(e){if(!e.props.assetId||!this.editor.getAsset(e.props.assetId))return null;let r=await this.editor.resolveAssetUrl(e.props.assetId,{shouldResolveToOriginal:!0});if(!r)return null;(r.startsWith("blob:")||r.startsWith("http")||r.startsWith("/")||r.startsWith("./"))&&(r=await pte(r)||"");const o=f_(e),i=e.props.crop;if(o.transform&&i){const{transform:s,width:a,height:c}=o,l=(i.bottomRight.x-i.topLeft.x)*a,d=(i.bottomRight.y-i.topLeft.y)*c,h=[new b(0,0),new b(l,0),new b(l,d),new b(0,d)],p=`cropClipPath_${va(e.id)}`,f=Va(e,{width:a,height:c});return u(Z,{children:[u("defs",{children:u("clipPath",{id:p,children:u("polygon",{points:h.map(g=>`${g.x},${g.y}`).join(" ")})})}),u("g",{clipPath:`url(#${p})`,children:u("image",{href:r,width:a,height:c,style:f?{...f,transform:`${s} ${f.transform}`}:{transform:s}})})]})}else return u("image",{href:r,width:e.props.w,height:e.props.h,style:Va(e,{width:e.props.w,height:e.props.h})})}onDoubleClickEdge(e){const n=e.props;if(!n||this.editor.getCroppingShapeId()!==e.id)return;const r=ut(n.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},o=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,i=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,s=new b(r.topLeft.x*o,r.topLeft.y*i).rot(e.rotation),a={id:e.id,type:e.type,x:e.x-s.x,y:e.y-s.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:o,h:i}};this.editor.updateShapes([a])}getInterpolatedProps(e,n,r){function o(i,s){var h,p,f,g;if(i.props.crop===null&&s.props.crop===null)return null;const a=((h=i.props.crop)==null?void 0:h.topLeft)||{x:0,y:0},c=((p=i.props.crop)==null?void 0:p.bottomRight)||{x:1,y:1},l=((f=s.props.crop)==null?void 0:f.topLeft)||{x:0,y:0},d=((g=s.props.crop)==null?void 0:g.bottomRight)||{x:1,y:1};return{topLeft:{x:De(a.x,l.x,r),y:De(a.y,l.y,r)},bottomRight:{x:De(c.x,d.x,r),y:De(c.y,d.y,r)}}}return{...r>.5?n.props:e.props,w:De(e.props.w,n.props.w,r),h:De(e.props.h,n.props.h,r),crop:o(e,n)}}}P(jd,"type","image"),P(jd,"props",RI),P(jd,"migrations",LI);function f_(t){const e=t.props.crop,n=e==null?void 0:e.topLeft;if(!n)return{width:t.props.w,height:t.props.h};const r=1/(e.bottomRight.x-e.topLeft.x)*t.props.w,o=1/(e.bottomRight.y-e.topLeft.y)*t.props.h,i=-n.x*r,s=-n.y*o;return{transform:`translate(${i}px, ${s}px)`,width:r,height:o}}function Va(t,e){const{flipX:n,flipY:r}=t.props;if(!n&&!r)return;const o=`scale(${n?-1:1}, ${r?-1:1})`;return{transform:`${e?`translate(${n?e.width:0}px, ${r?e.height:0}px)`:""} ${o}`,transformOrigin:e?"0 0":"center center"}}function pO(t){return{size:t,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function fO(t,e,n){const r=e.vertices,o=pO(n);return Zr(r,o)}function fte(t,e,n){const r=pO(n);return Rv(lp(fO(t,e,n),r),r)}function gte(t,e,n){const r=fte(t,e,n);return ES(r)}function mte(t,e,n){if(t.props.dash==="draw"){const r=fO(t,e,n);return es(r)}return e.getSvgPathData()}function gO(t,e,n){let r=`M ${Fe(e[0])}L`,o=`M ${Fe(e[0])}L`;const i=n/3,s=n*2,a=Tr(t);let c=e[0],l,d=e[0],h;const p=e.length;for(let f=0,g=p-1;f<g;f++){l=e[f+1],h=b.AddXY(e[f+1],a()*i,a()*i);const m=b.Sub(l,c),y=b.Len(m),S=b.Div(m,y).mul(Math.min(y/4,s)),v=b.Add(c,S),_=b.Add(l,S.neg()),w=b.Sub(h,d),x=b.Len(w),C=b.Div(w,x).mul(Math.min(x/4,s)),E=b.Add(d,C),I=b.Add(h,C.neg());f===g-1?(r+=`${Fe(v)}L ${Fe(l)}`,o+=`${Fe(E)}L ${Fe(h)}`):(r+=`${Fe(v)}L ${Fe(_)}Q ${Fe(l)}`,o+=`${Fe(E)}L ${Fe(I)}Q ${Fe(h)}`,c=l,d=h)}return[r,r+o]}const yte=new Gr;class Kd extends _r{hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsFg(){return!0}hideSelectionBoundsBg(){return!0}getDefaultProps(){const[e,n]=Ic(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[n]:{id:n,index:n,x:.1,y:.1}},scale:1}}getGeometry(e){return sc(e)}getHandles(e){return yte.get(e.props,()=>{const n=sc(e),r=ic(e),o=r.map(i=>({...i,id:i.index,type:"vertex",canSnap:!0}));for(let i=0;i<r.length-1;i++){const s=Pc(r[i].index,r[i+1].index),c=n.segments[i].midPoint();o.push({id:s,type:"create",index:s,x:c.x,y:c.y,canSnap:!0})}return o.sort(nn)})}onResize(e,n){const{scaleX:r,scaleY:o}=n;return{props:{points:Uc(e.props.points,(i,{id:s,index:a,x:c,y:l})=>({id:s,index:a,x:c*r,y:l*o}))}}}onBeforeCreate(e){const{props:{points:n}}=e,r=Object.keys(n);if(r.length<2)return;const o=n[r[0]];if(r.every(s=>{const a=n[s];return a.x===o.x&&a.y===o.y})){const s=r[r.length-1];return n[s]={...n[s],x:n[s].x+.1,y:n[s].y+.1},e}}onHandleDrag(e,{handle:n}){if(n.type==="vertex")return{...e,props:{...e.props,points:{...e.props.points,[n.id]:{id:n.id,index:n.index,x:n.x,y:n.y}}}}}component(e){return u(ci,{id:e.id,children:u(g_,{shape:e})})}indicator(e){const n=jr[e.props.size]*e.props.scale,r=sc(e),{dash:o}=e.props;let i;if(e.props.spline==="line"){const s=r.points;if(o==="solid"||o==="dotted"||o==="dashed")i="M"+s[0]+"L"+s.slice(1);else{const[a]=gO(e.id,s,n);i=a}}else i=mte(e,r,n);return u("path",{d:i})}toSvg(e){return u(g_,{shouldScale:!0,shape:e})}getHandleSnapGeometry(e){const n=ic(e);return{points:n,getSelfSnapPoints:r=>{const o=this.getHandles(e).filter(i=>i.type==="vertex").findIndex(i=>i.id===r.id);return n.filter((i,s)=>Math.abs(s-o)>1).map(b.From)},getSelfSnapOutline:r=>{const o=this.getHandles(e).filter(s=>s.type==="vertex").findIndex(s=>s.id===r.id),i=sc(e).segments.filter((s,a)=>a!==o-1&&a!==o);return i.length?new Ir({children:i}):null}}}getInterpolatedProps(e,n,r){const o=ic(e),i=ic(n),s=[],a=[];let c=Tx;if(o.length>i.length)for(let l=0;l<o.length;l++)s[l]={...o[l]},i[l]===void 0?a[l]={...i[i.length-1],id:c}:a[l]={...i[l],id:c},c=Br(c);else if(i.length>o.length)for(let l=0;l<i.length;l++)a[l]={...i[l]},o[l]===void 0?s[l]={...o[o.length-1],id:c}:s[l]={...o[l],id:c},c=Br(c);else for(let l=0;l<i.length;l++)s[l]=o[l],a[l]=i[l];return{...r>.5?n.props:e.props,points:Object.fromEntries(s.map((l,d)=>{const h=a[d];return[l.id,{...l,x:De(l.x,h.x,r),y:De(l.y,h.y,r)}]})),scale:De(e.props.scale,n.props.scale,r)}}}P(Kd,"type","line"),P(Kd,"props",NI),P(Kd,"migrations",FI);function ic(t){return Object.values(t.props.points).sort(nn)}function sc(t){const e=ic(t).map(b.From);switch(t.props.spline){case"cubic":return new MG({points:e});case"line":return new ba({points:e})}}function g_({shape:t,shouldScale:e=!1,forceSolid:n=!1}){const r=hr(),o=sc(t),{dash:i,color:s,size:a}=t.props,c=1/t.props.scale,l=e?c:1,d=jr[a]*t.props.scale;if(t.props.spline==="line"){if(i==="solid"){const h=o.points,p="M"+h[0]+"L"+h.slice(1);return u("path",{d:p,stroke:r[s].solid,strokeWidth:d,fill:"none",transform:`scale(${l})`})}if(i==="dashed"||i==="dotted")return u("g",{stroke:r[s].solid,strokeWidth:d,transform:`scale(${l})`,children:o.segments.map((h,p)=>{const{strokeDasharray:f,strokeDashoffset:g}=n?{strokeDasharray:"none",strokeDashoffset:"none"}:Sr(h.length,d,{style:i,start:p>0?"outset":"none",end:p<o.segments.length-1?"outset":"none"});return u("path",{strokeDasharray:f,strokeDashoffset:g,d:h.getSvgPathData(!0),fill:"none"},p)})});if(i==="draw"){const h=o.points,[p,f]=gO(t.id,h,d);return u("path",{d:f,stroke:r[s].solid,strokeWidth:d,fill:"none",transform:`scale(${l})`})}}if(t.props.spline==="cubic"){const h=o.getSvgPathData();if(i==="solid")return u("path",{strokeWidth:d,stroke:r[s].solid,fill:"none",d:h,transform:`scale(${l})`});if(i==="dashed"||i==="dotted")return u("g",{stroke:r[s].solid,strokeWidth:d,transform:`scale(${l})`,children:o.segments.map((p,f)=>{const{strokeDasharray:g,strokeDashoffset:m}=Sr(p.length,d,{style:i,start:f>0?"outset":"none",end:f<o.segments.length-1?"outset":"none",forceSolid:n});return u("path",{strokeDasharray:g,strokeDashoffset:m,d:p.getSvgPathData(),fill:"none"},f)})});if(i==="draw")return u("path",{d:gte(t,o,d),strokeWidth:1,stroke:r[s].solid,fill:r[s].solid,transform:`scale(${l})`})}}class Wd extends _r{canEdit(){return!0}hideResizeHandles(){return!0}hideSelectionBoundsFg(){return!1}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(e){const{labelHeight:n,labelWidth:r}=mO(this.editor,e),{scale:o}=e.props,i=n*o,s=r*o,a=qe*o,c=dd(e);return new Ir({children:[new Mo({width:a,height:c,isFilled:!0}),new Mo({x:e.props.align==="start"?0:e.props.align==="end"?a-s:(a-s)/2,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?c-i:(c-i)/2,width:s,height:i,isFilled:!0,isLabel:!0})]})}getHandles(e){const{scale:n}=e.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const o=this.editor.getZoomLevel();if(o*n<.25)return[];const i=dd(e),s=qe*n,a=jQ/o*n;return o*n<.5?[{id:"bottom",index:"a3",type:"clone",x:s/2,y:i+a}]:[{id:"top",index:"a1",type:"clone",x:s/2,y:-a},{id:"right",index:"a2",type:"clone",x:s+a,y:i/2},{id:"bottom",index:"a3",type:"clone",x:s/2,y:i+a},{id:"left",index:"a4",type:"clone",x:-a,y:i/2}]}getText(e){return e.props.text}component(e){const{id:n,type:r,props:{scale:o,color:i,font:s,size:a,align:c,text:l,verticalAlign:d,fontSizeAdjustment:h}}=e,p=bte(n),f=hr(),g=qe*o,m=dd(e),y=U("shape rotation",()=>{var _;return((_=this.editor.getShapePageTransform(n))==null?void 0:_.rotation())??0},[this.editor]),S=U("zoom",()=>this.editor.getZoomLevel()<.35/o,[o,this.editor]),v=e.id===this.editor.getOnlySelectedShapeId();return u(Z,{children:[u("div",{id:n,className:"tl-note__container",style:{width:g,height:m,backgroundColor:f[i].note.fill,borderBottom:S?`${3*o}px solid rgb(15, 23, 31, .2)`:"none",boxShadow:S?"none":wte(e.id,y,o)},children:u(pp,{id:n,type:r,font:s,fontSize:(h||Eo[a])*o,lineHeight:an.lineHeight,align:c,verticalAlign:d,text:l,isNote:!0,isSelected:v,labelColor:f[i].note.text,wrap:!0,padding:16*o,onKeyDown:p})}),"url"in e.props&&e.props.url&&u(ea,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){const{scale:n}=e.props;return u("rect",{rx:n,width:N(qe*n),height:N(dd(e))})}toSvg(e,n){e.props.text&&n.addExportDef(up(e.props.font));const r=Lo({isDarkMode:n.isDarkMode}),o=_te(e);return u(Z,{children:[u("rect",{x:5,y:5,rx:1,width:qe-10,height:o.h,fill:"rgba(0,0,0,.1)"}),u("rect",{rx:1,width:qe,height:o.h,fill:r[e.props.color].note.fill}),u(hp,{fontSize:e.props.fontSizeAdjustment||Eo[e.props.size],font:e.props.font,align:e.props.align,verticalAlign:e.props.verticalAlign,text:e.props.text,labelColor:r[e.props.color].note.text,bounds:o,stroke:!1})]})}onBeforeCreate(e){return m_(this.editor,e)}onBeforeUpdate(e,n){if(!(e.props.text===n.props.text&&e.props.font===n.props.font&&e.props.size===n.props.size))return m_(this.editor,n)}onEditEnd(e){const{id:n,type:r,props:{text:o}}=e;o.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:n,type:r,props:{text:o.trimEnd()}}])}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,scale:De(e.props.scale,n.props.scale,r)}}}P(Wd,"type","note"),P(Wd,"props",zI),P(Wd,"migrations",BI);function m_(t,e){const{labelHeight:n,fontSizeAdjustment:r}=mO(t,e),o=Math.max(0,n-qe);if(o!==e.props.growY||r!==e.props.fontSizeAdjustment)return{...e,props:{...e.props,growY:o,fontSizeAdjustment:r}}}function Ste(t,e){const{text:n}=e.props;if(!n)return{labelHeight:Eo[e.props.size]*an.lineHeight+or*2,labelWidth:100,fontSizeAdjustment:0};const r=Eo[e.props.size];let o=0,i=0,s=qe,a=qe;const c=1;do{o=Math.min(r,r-i);const l=t.textMeasure.measureText(n,{...an,fontFamily:Do[e.props.font],fontSize:o,maxWidth:qe-or*2-c,disableOverflowWrapBreaking:!0});if(s=l.h+or*2,a=l.w+or*2,o<=14){const d=t.textMeasure.measureText(n,{...an,fontFamily:Do[e.props.font],fontSize:o,maxWidth:qe-or*2-c});s=d.h+or*2,a=d.w+or*2;break}if(l.scrollWidth.toFixed(0)===l.w.toFixed(0))break}while(i++<50);return{labelHeight:s,labelWidth:a,fontSizeAdjustment:o}}const vte=new Gr;function mO(t,e){return vte.get(e,()=>Ste(t,e))}function bte(t){const e=F(),n=Lk();return V(r=>{const o=e.getShape(t);if(!o)return;const i=r.key==="Tab",s=(r.metaKey||r.ctrlKey)&&r.key==="Enter";if(i||s){r.preventDefault();const a=e.getShapePageTransform(t),c=a.rotation(),l=!!(n.dir==="rtl"||UA(o.props.text)),d=(qe+e.options.adjacentShapeMargin+(s&&!r.shiftKey?o.props.growY:0))*o.props.scale,h=new b(i?r.shiftKey!=l?-1:1:0,s?r.shiftKey?-1:1:0).mul(d).add(dp.clone().mul(o.props.scale)).rot(c).add(a.point()),p=YA(e,o,h,c);p&&(e.markHistoryStoppingPoint("editing adjacent shape"),Fu(e,p,!0))}},[t,e,n.dir])}function dd(t){return(qe+t.props.growY)*t.props.scale}function wte(t,e,n){const r=Tr(t),o=Math.abs(r())+.5,i=Math.cos(e),s=5*n,a=4*n,c=6*n,l=7*n;return`0px ${s-o}px ${s}px -${s}px rgba(15, 23, 31, .6),
	0px ${(a+o*l)*Math.max(0,i)}px ${c+o*l}px -${a+o*c}px rgba(15, 23, 31, ${(.3+o*.1).toFixed(2)}), 
	0px ${48*n}px ${10*n}px -${10*n}px inset rgba(15, 23, 44, ${((.022+r()*.005)*((1+i)/2)).toFixed(2)})`}function _te(t){return new ee(0,0,qe,qe+t.props.growY)}function xte(t,{initialBounds:e,scaleX:n,scaleY:r,newPoint:o}){const i=Math.max(.01,Math.min(Math.abs(n),Math.abs(r))),s=new b(0,0);n<0&&(s.x=-(e.width*i)),r<0&&(s.y=-(e.height*i));const{x:a,y:c}=b.Add(o,s.rot(t.rotation));return{x:a,y:c,props:{scale:i*t.props.scale}}}const Pte=new Gr;class Gd extends _r{getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",textAlign:"start",autoSize:!0,scale:1}}getMinDimensions(e){return Pte.get(e.props,n=>y_(this.editor,n))}getGeometry(e){const{scale:n}=e.props,{width:r,height:o}=this.getMinDimensions(e);return new Mo({width:r*n,height:o*n,isFilled:!0,isLabel:!0})}getText(e){return e.props.text}canEdit(){return!0}isAspectRatioLocked(){return!0}component(e){const{id:n,props:{font:r,size:o,text:i,color:s,scale:a,textAlign:c}}=e,{width:l,height:d}=this.getMinDimensions(e),h=e.id===this.editor.getOnlySelectedShapeId(),p=hr(),f=Ite(n);return u(pp,{id:n,classNamePrefix:"tl-text-shape",type:"text",font:r,fontSize:Js[o],lineHeight:an.lineHeight,align:c,verticalAlign:"middle",text:i,labelColor:p[s].solid,isSelected:h,textWidth:l,textHeight:d,style:{transform:`scale(${a})`,transformOrigin:"top left"},wrap:!0,onKeyDown:f})}indicator(e){const n=this.editor.getShapeGeometry(e).bounds,r=F();return e.props.autoSize&&r.getEditingShapeId()===e.id?null:u("rect",{width:N(n.width),height:N(n.height)})}toSvg(e,n){e.props.text&&n.addExportDef(up(e.props.font));const r=this.editor.getShapeGeometry(e).bounds,o=r.width/(e.props.scale??1),i=r.height/(e.props.scale??1),s=Lo(n);return u(hp,{fontSize:Js[e.props.size],font:e.props.font,align:e.props.textAlign,verticalAlign:"middle",text:e.props.text,labelColor:s[e.props.color].solid,bounds:new ee(0,0,o,i),padding:0})}onResize(e,n){const{newPoint:r,initialBounds:o,initialShape:i,scaleX:s,handle:a}=n;if(n.mode==="scale_shape"||a!=="right"&&a!=="left")return{id:e.id,type:e.type,...xte(e,n)};{const c=Math.max(1,Math.abs(o.width*s)),{x:l,y:d}=s<0?b.Sub(r,b.FromAngle(e.rotation).mul(c)):r;return{id:e.id,type:e.type,x:l,y:d,props:{w:c/i.props.scale,autoSize:!1}}}}onEditEnd(e){const{id:n,type:r,props:{text:o}}=e,i=e.props.text.trimEnd();i.length===0?this.editor.deleteShapes([e.id]):i!==e.props.text&&this.editor.updateShapes([{id:n,type:r,props:{text:o.trimEnd()}}])}onBeforeUpdate(e,n){if(!n.props.autoSize)return;const r=e.props.size!==n.props.size||e.props.textAlign!==n.props.textAlign||e.props.font!==n.props.font||e.props.scale!==1&&n.props.scale===1,o=e.props.text!==n.props.text;if(!r&&!o)return;const i=this.getMinDimensions(e),s=y_(this.editor,n.props),a=i.width*e.props.scale,c=i.height*e.props.scale,l=s.width*n.props.scale,d=s.height*n.props.scale;let h;switch(n.props.textAlign){case"middle":{h=new b((l-a)/2,o?0:(d-c)/2);break}case"end":{h=new b(l-a,o?0:(d-c)/2);break}default:{if(o)break;h=new b(0,(d-c)/2);break}}if(h){h.rot(n.rotation);const{x:p,y:f}=n;return{...n,x:p-h.x,y:f-h.y,props:{...n.props,w:l}}}else return{...n,props:{...n.props,w:l}}}}P(Gd,"type","text"),P(Gd,"props",UI),P(Gd,"migrations",HI);function y_(t,e){const{font:n,text:r,autoSize:o,size:i,w:s}=e,a=o?16:Math.max(16,s),c=Js[i],l=o?null:Math.floor(Math.max(a,s)),d=t.textMeasure.measureText(r,{...an,fontFamily:Do[n],fontSize:c,maxWidth:l});return o&&(d.w+=1),{width:Math.max(a,d.w),height:Math.max(c,d.h)}}function Ite(t){const e=F();return V(n=>{if(e.getEditingShapeId()===t)switch(n.key){case"Enter":{(n.ctrlKey||n.metaKey)&&e.complete();break}case"Tab":{Ce(n),n.shiftKey?Qs.unindent(n.currentTarget):Qs.indent(n.currentTarget);break}}},[e,t])}class Vd extends xa{canEdit(){return!0}isAspectRatioLocked(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){const{editor:n}=this,r=n.getShapeGeometry(e).bounds.w*n.getZoomLevel()>=110,{asset:o,url:i}=uO({shapeId:e.id,assetId:e.props.assetId,width:e.props.w}),s=Bh(e.id),a=hO(),{Spinner:c}=ht(),l=B(null),[d,h]=Q(!1),[p,f]=Q(!1);q(()=>{const m=()=>f(document.fullscreenElement===l.current);return document.addEventListener("fullscreenchange",m),()=>document.removeEventListener("fullscreenchange",m)});const g=V(m=>{m.currentTarget&&h(!0)},[]);return q(()=>{const m=l.current;m&&s&&document.activeElement!==m&&m.focus()},[s,d]),q(()=>{if(a){const m=l.current;if(!m)return;m.pause(),m.currentTime=0}},[l,a]),u(Z,{children:[u(si,{id:e.id,style:{color:"var(--color-text-3)",backgroundColor:o?"transparent":"var(--color-low)",border:o?"none":"1px solid var(--color-low-border)"},children:u("div",{className:"tl-counter-scaled",children:u("div",{className:"tl-video-container",children:o?c&&!o.props.src?u(c,{}):i?u(Z,{children:[u("video",{ref:l,style:s?{pointerEvents:"all"}:d?void 0:{display:"none"},className:de("tl-video",`tl-video-shape-${e.id.split(":")[1]}`,{"tl-video-is-fullscreen":p}),width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:s&&r,onLoadedData:g,hidden:!d,children:u("source",{src:i})}),!d&&c&&u(c,{})]}):null:u(dO,{})})})}),"url"in e.props&&e.props.url&&u(ea,{url:e.props.url,zoomLevel:n.getZoomLevel()})]})}indicator(e){return u("rect",{width:N(e.props.w),height:N(e.props.h)})}async toSvg(e){const n=await Cte(this.editor,e);return n?u("image",{href:n,width:e.props.w,height:e.props.h}):null}}P(Vd,"type","video"),P(Vd,"props",jI),P(Vd,"migrations",KI);async function Cte(t,e){const n=await t.resolveAssetUrl(e.props.assetId,{shouldResolveToOriginal:!0});if(!n)return null;const r=await Kn.loadVideo(n);return Kn.getVideoFrameAsDataUrl(r,0)}const yO=[Gd,Nd,Fd,Ud,Wd,Kd,Bd,Ld,Hd,zd,jd,Vd];function Ete(t){return t.sideEffects.register({instance_page_state:{afterChange:(e,n)=>{if(e.croppingShapeId!==n.croppingShapeId){const r=t.isIn("select.crop");!e.croppingShapeId&&n.croppingShapeId?r||t.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!n.croppingShapeId&&r&&t.setCurrentTool("select.idle")}if(e.editingShapeId!==n.editingShapeId)if(!e.editingShapeId&&n.editingShapeId){if(!t.isIn("select.editing_shape")){const r=t.getEditingShape();r&&r.type==="text"&&t.isInAny("text.pointing","select.resizing")&&t.getInstanceState().isToolLocked?t.setCurrentTool("select.editing_shape",{isCreatingTextWhileToolLocked:!0}):t.setCurrentTool("select.editing_shape")}}else e.editingShapeId&&!n.editingShapeId&&t.isIn("select.editing_shape")&&t.setCurrentTool("select.idle")}}})}class SO extends ae{constructor(){super(...arguments);P(this,"info",{});P(this,"scribbleId","id");P(this,"markId","");P(this,"excludedShapeIds",new Set)}onEnter(n){this.markId=this.editor.markHistoryStoppingPoint("erase scribble begin"),this.info=n;const{originPagePoint:r}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(i=>{if(this.editor.isShapeOrAncestorLocked(i))return!0;if(this.editor.isShapeOfType(i,"group")||this.editor.isShapeOfType(i,"frame")){const s=this.editor.getPointInShapeSpace(i,r);return this.editor.getShapeGeometry(i).bounds.containsPoint(s)}return!1}).map(i=>i.id));const o=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=o.id,this.update()}pushPointToScribble(){const{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,n,r)}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}update(){const{editor:n,excludedShapeIds:r}=this,o=n.getErasingShapeIds(),i=n.getZoomLevel(),s=n.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:a,previousPagePoint:c}}=n;this.pushPointToScribble();const l=new Set(o),d=this.editor.options.hitTestMargin/i;for(const h of s){if(n.isShapeOfType(h,"group"))continue;const p=n.getShapeMask(h.id);if(p&&!Vn(a,p))continue;const f=n.getShapeGeometry(h),g=n.getShapePageTransform(h);if(!f||!g)continue;const m=g.clone().invert(),y=m.applyToPoint(c),S=m.applyToPoint(a),{bounds:v}=f;v.minX-d>Math.max(y.x,S.x)||v.minY-d>Math.max(y.y,S.y)||v.maxX+d<Math.min(y.x,S.x)||v.maxY+d<Math.min(y.y,S.y)||f.hitTestLineSegment(y,S,d)&&l.add(n.getOutermostSelectableShape(h).id)}this.editor.setErasingShapes([...l].filter(h=>!r.has(h)))}complete(){const{editor:n}=this;n.deleteShapes(n.getCurrentPageState().erasingShapeIds),n.setErasingShapes([]),this.parent.transition("idle")}cancel(){const{editor:n}=this;n.setErasingShapes([]),n.bailToMark(this.markId),this.parent.transition("idle",this.info)}}P(SO,"id","erasing");var wg;let Tte=(wg=class extends ae{onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},P(wg,"id","idle"),wg);var _g;let kte=(_g=class extends ae{onEnter(){const e=this.editor.getZoomLevel(),n=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:r}}=this.editor,o=new Set,i=o.size;for(let s=n.length,a=s-1;a>=0;a--){const c=n[a];if(!(this.editor.isShapeOrAncestorLocked(c)||this.editor.isShapeOfType(c,"group"))&&this.editor.isPointInShape(c,r,{hitInside:!1,margin:this.editor.options.hitTestMargin/e})){const l=this.editor.getOutermostSelectableShape(c);if(this.editor.isShapeOfType(l,"frame")&&o.size>i)break;o.add(l.id)}}this.editor.setErasingShapes([...o])}onLongPress(e){this.startErasing(e)}onPointerMove(e){this.editor.inputs.isDragging&&this.startErasing(e)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}startErasing(e){this.parent.transition("erasing",e)}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.markHistoryStoppingPoint("erase end"),this.editor.deleteShapes(e)),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle")}},P(_g,"id","pointing"),_g);class Yd extends ae{static children(){return[Tte,kte,SO]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}P(Yd,"id","eraser"),P(Yd,"initial","idle"),P(Yd,"isLockable",!1);class vO extends ae{constructor(){super(...arguments);P(this,"initialCamera",new b)}onEnter(){this.initialCamera=b.From(this.editor.getCamera()),this.update()}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.parent.transition("idle")}onComplete(){this.complete()}update(){const{initialCamera:n,editor:r}=this,{currentScreenPoint:o,originScreenPoint:i}=r.inputs,s=b.Sub(o,i).div(r.getZoomLevel());s.len2()!==0&&r.setCamera(n.clone().add(s))}complete(){const{editor:n}=this,{pointerVelocity:r}=n.inputs,o=Math.min(r.len(),2);o>.1&&this.editor.slideCamera({speed:o,direction:r}),this.parent.transition("idle")}}P(vO,"id","dragging");var xg;let Mte=(xg=class extends ae{onEnter(){this.editor.setCursor({type:"grab",rotation:0})}onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},P(xg,"id","idle"),xg);var Pg;let Ate=(Pg=class extends ae{onEnter(){this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})}onLongPress(){this.startDragging()}onPointerMove(){this.editor.inputs.isDragging&&this.startDragging()}startDragging(){this.parent.transition("dragging")}onPointerUp(){this.complete()}onCancel(){this.complete()}onComplete(){this.complete()}onInterrupt(){this.complete()}complete(){this.parent.transition("idle")}},P(Pg,"id","pointing"),Pg);class Xd extends ae{static children(){return[Mte,Ate,vO]}onDoubleClick(e){if(e.phase==="settle"){const{currentScreenPoint:n}=this.editor.inputs;this.editor.zoomIn(n,{animation:{duration:220,easing:Rt.easeOutQuint}})}}onTripleClick(e){if(e.phase==="settle"){const{currentScreenPoint:n}=this.editor.inputs;this.editor.zoomOut(n,{animation:{duration:320,easing:Rt.easeOutQuint}})}}onQuadrupleClick(e){if(e.phase==="settle"){const n=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:r}}=this.editor;n===1?this.editor.zoomToFit({animation:{duration:400,easing:Rt.easeOutQuint}}):this.editor.resetZoom(r,{animation:{duration:320,easing:Rt.easeOutQuint}})}}}P(Xd,"id","hand"),P(Xd,"initial","idle"),P(Xd,"isLockable",!1);var Ig;let Ote=(Ig=class extends ae{onPointerDown(e){this.parent.transition("lasering",e)}},P(Ig,"id","idle"),Ig);class bO extends ae{constructor(){super(...arguments);P(this,"scribbleId","id")}onEnter(){const n=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:this.editor.options.laserDelayMs,shrink:.05,taper:!0});this.scribbleId=n.id,this.pushPointToScribble()}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.pushPointToScribble()}onPointerUp(){this.complete()}pushPointToScribble(){const{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,n,r)}onCancel(){this.cancel()}onComplete(){this.complete()}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}P(bO,"id","lasering");class qd extends ae{static children(){return[Ote,bO]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}P(qd,"id","laser"),P(qd,"initial","idle"),P(qd,"isLockable",!1);class wO extends ae{constructor(){super(...arguments);P(this,"info",{});P(this,"initialSelectedShapeIds",[]);P(this,"excludedShapeIds",new Set);P(this,"isWrapMode",!1);P(this,"initialStartShape",null)}onEnter(n){const{altKey:r,currentPagePoint:o}=this.editor.inputs;if(this.isWrapMode=this.editor.user.getIsWrapMode(),r){this.parent.transition("scribble_brushing",n);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(i=>this.editor.isShapeOfType(i,"group")||this.editor.isShapeOrAncestorLocked(i)).map(i=>i.id)),this.info=n,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(o)[0],this.hitTestShapes()}onExit(){this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})}onTick({elapsed:n}){const{editor:r}=this;r.edgeScrollManager.updateEdgeScrolling(n)}onPointerMove(){this.hitTestShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(n){this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",n)}onKeyDown(n){this.editor.inputs.altKey?this.parent.transition("scribble_brushing",n):this.hitTestShapes()}onKeyUp(){this.hitTestShapes()}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:n,excludedShapeIds:r,isWrapMode:o}=this,{inputs:{originPagePoint:i,currentPagePoint:s,shiftKey:a,ctrlKey:c}}=n,l=new Set(a?this.initialSelectedShapeIds:[]),d=o?!c:c,h=ee.FromPoints([i,s]),{corners:p}=h;let f,g,m,y,S,v;const _=n.getCurrentPageRenderingShapesSorted(),w=n.getCurrentPageId();e:for(let E=0,I=_.length;E<I;E++){if(m=_[E],r.has(m.id)||l.has(m.id)||(y=n.getShapePageBounds(m),!y))continue e;if(h.contains(y)){this.handleHit(m,s,w,l,p);continue e}if(d||n.isShapeOfType(m,"frame"))continue e;if(h.collides(y)){if(S=n.getShapePageTransform(m),!S)continue e;v=S.clone().invert().applyToPoints(p);const T=n.getShapeGeometry(m);t:for(let k=0;k<4;k++)if(f=v[k],g=v[(k+1)%4],T.hitTestLineSegment(f,g,0)){this.handleHit(m,s,w,l,p);break t}}}n.getInstanceState().isCoarsePointer;const x=n.getInstanceState().brush;(!x||!h.equals(x))&&n.updateInstanceState({brush:{...h.toJson()}});const C=n.getSelectedShapeIds();(C.length!==l.size||C.some(E=>!l.has(E)))&&n.setSelectedShapes(Array.from(l))}onInterrupt(){this.editor.updateInstanceState({brush:null})}handleHit(n,r,o,i,s){if(n.parentId===o){i.add(n.id);return}const a=this.editor.getOutermostSelectableShape(n),c=this.editor.getShapeMask(a.id);c&&!LC(c,s)&&!Vn(r,c)||i.add(a.id)}}P(wO,"id","brushing");const na={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class _O extends ae{constructor(){super(...arguments);P(this,"info",{})}updateCursor(){const n=this.editor.getSelectedShapes(),r=na[this.info.handle];this.editor.setCursor({type:r,rotation:n.length===1?this.editor.getSelectionRotation():0})}onEnter(n){this.info=n,this.updateCursor()}onPointerMove(){this.editor.inputs.isDragging&&this.startResizing()}onLongPress(){this.startResizing()}startResizing(){this.editor.getIsReadonly()||this.parent.transition("resizing",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}P(_O,"id","pointing_resize_handle");const nr=8;class jv extends ae{constructor(){super(...arguments);P(this,"info",{});P(this,"markId","");P(this,"snapshot",{})}onEnter(n){this.info=n,this.markId=this.editor.markHistoryStoppingPoint("cropping"),this.snapshot=this.createSnapshot(),this.updateShapes()}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const r=na[this.info.handle];this.editor.setCursor({type:r,rotation:this.editor.getSelectionRotation()})}getDefaultCrop(){return{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}}updateShapes(){const{shape:n,cursorHandleOffset:r}=this.snapshot;if(!n||!this.editor.getShapeUtil("image"))return;const i=n.props,s=this.editor.inputs.currentPagePoint.clone().sub(r),a=this.editor.inputs.originPagePoint.clone().sub(r),c=s.clone().sub(a).rot(-n.rotation),l=i.crop??this.getDefaultCrop(),d=ut(l),h=new b(n.x,n.y),p=new b(0,0),f=1/(l.bottomRight.x-l.topLeft.x)*i.w,g=1/(l.bottomRight.y-l.topLeft.y)*i.h;let m=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(g<nr)break;m=!0,d.topLeft.y=d.topLeft.y+c.y/g,g*(d.bottomRight.y-d.topLeft.y)<nr?(d.topLeft.y=d.bottomRight.y-nr/g,p.y=(d.topLeft.y-l.topLeft.y)*g):d.topLeft.y<=0?(d.topLeft.y=0,p.y=(d.topLeft.y-l.topLeft.y)*g):p.y=c.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(g<nr)break;m=!0,d.bottomRight.y=Math.min(1,d.bottomRight.y+c.y/g),g*(d.bottomRight.y-d.topLeft.y)<nr&&(d.bottomRight.y=d.topLeft.y+nr/g);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(f<nr)break;m=!0,d.topLeft.x=d.topLeft.x+c.x/f,f*(d.bottomRight.x-d.topLeft.x)<nr?(d.topLeft.x=d.bottomRight.x-nr/f,p.x=(d.topLeft.x-l.topLeft.x)*f):d.topLeft.x<=0?(d.topLeft.x=0,p.x=(d.topLeft.x-l.topLeft.x)*f):p.x=c.x;break}case"right":case"top_right":case"bottom_right":{if(f<nr)break;m=!0,d.bottomRight.x=Math.min(1,d.bottomRight.x+c.x/f),f*(d.bottomRight.x-d.topLeft.x)<nr&&(d.bottomRight.x=d.topLeft.x+nr/f);break}}if(!m)return;h.add(p.rot(n.rotation));const y={id:n.id,type:n.type,x:h.x,y:h.y,props:{crop:d,w:(d.bottomRight.x-d.topLeft.x)*f,h:(d.bottomRight.y-d.topLeft.y)*g}};this.editor.updateShapes([y]),this.updateCursor()}complete(){this.updateShapes(),rt(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const n=this.editor.getSelectionRotation(),{inputs:{originPagePoint:r}}=this.editor,o=this.editor.getOnlySelectedShape(),i=this.editor.getSelectionRotatedPageBounds(),s=b.RotWith(i.getHandlePoint(this.info.handle),i.point,n),a=b.Sub(r,s);return{shape:o,cursorHandleOffset:a}}}P(jv,"id","cropping");function xO(t,e=!1){const n=t.getZoomLevel(),{inputs:{currentPagePoint:r}}=t;return t.getShapeAtPoint(r,{hitInside:!1,hitLabels:e,margin:t.options.hitTestMargin/n,renderingOnly:!0})??t.getSelectedShapeAtPoint(r)}function PO(t,e,n){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:r}=e.props;if(!r)return;const o=t.inputs.shiftKey?Math.abs(n.x)<Math.abs(n.y)?"x":"y":null;o==="x"?n.x=0:o==="y"&&(n.y=0),n.rot(-e.rotation);const i=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,s=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,a=r.bottomRight.y-r.topLeft.y,c=r.bottomRight.x-r.topLeft.x,l=ut(r);return l.topLeft.x=Math.min(1-c,Math.max(0,l.topLeft.x-n.x/i)),l.topLeft.y=Math.min(1-a,Math.max(0,l.topLeft.y-n.y/s)),l.bottomRight.x=l.topLeft.x+c,l.bottomRight.y=l.topLeft.y+a,{id:e.id,type:e.type,props:{crop:l}}}var Cg;let Dte=(Cg=class extends ae{onEnter(){this.editor.setCursor({type:"default",rotation:0});const e=this.editor.getOnlySelectedShape();e&&this.editor.setCroppingShape(e.id)}onExit(){this.editor.setCursor({type:"default",rotation:0})}onCancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}onPointerDown(e){var n;if(!this.editor.menus.hasAnyOpenMenus()){if(e.accelKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{const r=xO(this.editor);if(r&&!this.editor.isShapeOfType(r,"group")){this.onPointerDown({...e,shape:r,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":{if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}else(n=this.editor.getShapeUtil(e.shape))!=null&&n.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop.idle"});break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...e,onInteractionEnd:"select.crop.idle"});break}default:this.cancel()}break}}}}onDoubleClick(e){var i;if(this.editor.inputs.shiftKey||e.phase!=="up")return;const n=this.editor.getCroppingShapeId();if(!n)return;const r=this.editor.getShape(n);if(!r)return;const o=this.editor.getShapeUtil(r);if(o){if(e.target==="selection"){(i=o.onDoubleClickEdge)==null||i.call(o,r);return}this.cancel(),this.editor.root.handleEvent(e)}}onKeyDown(){this.nudgeCroppingImage(!1)}onKeyRepeat(){this.nudgeCroppingImage(!0)}onKeyUp(e){switch(e.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:n}}}=this,r=n.has("ShiftLeft"),o=new b(0,0);if(n.has("ArrowLeft")&&(o.x+=1),n.has("ArrowRight")&&(o.x-=1),n.has("ArrowUp")&&(o.y+=1),n.has("ArrowDown")&&(o.y-=1),o.equals(new b(0,0)))return;r&&o.mul(10);const i=this.editor.getShape(this.editor.getCroppingShapeId());if(!i)return;const s=PO(this.editor,i,o);s&&(e||this.editor.markHistoryStoppingPoint("translate crop"),this.editor.updateShapes([s]))}},P(Cg,"id","idle"),Cg);class IO extends ae{onCancel(){this.editor.setCurrentTool("select.crop.idle",{})}onPointerMove(e){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)}onPointerUp(e){this.editor.setCurrentTool("select.crop.idle",e)}}P(IO,"id","pointing_crop");class Kv extends ae{constructor(){super(...arguments);P(this,"info",{})}onEnter(n){this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd);const r=this.editor.getSelectedShapes()[0];if(!r)return;const o=na[this.info.handle];this.editor.setCursor({type:o,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(r.id)}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.isDragging&&this.startCropping()}onLongPress(){this.startCropping()}startCropping(){this.editor.getIsReadonly()||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}onPointerUp(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}P(Kv,"id","pointing_crop_handle");class CO extends ae{constructor(){super(...arguments);P(this,"info",{});P(this,"markId","");P(this,"snapshot",{})}onEnter(n){this.info=n,this.snapshot=this.createSnapshot(),this.markId=this.editor.markHistoryStoppingPoint("translating_crop"),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()}onExit(){this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onKeyDown(n){switch(n.key){case"Alt":case"Shift":{this.updateShapes();return}}}onKeyUp(n){switch(n.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const n=this.snapshot.shape;if(!n)return;const{originPagePoint:r,currentPagePoint:o}=this.editor.inputs,i=o.clone().sub(r),s=PO(this.editor,n,i);s&&this.editor.updateShapes([s])}}P(CO,"id","translating_crop");class ey extends ae{constructor(){super(...arguments);P(this,"markId","");P(this,"didExit",!1)}static children(){return[Dte,CO,IO,Kv,jv]}onEnter(){this.didExit=!1,this.markId=this.editor.markHistoryStoppingPoint("crop")}onExit(){this.didExit||(this.didExit=!0,this.editor.squashToMark(this.markId))}onCancel(){this.didExit||(this.didExit=!0,this.editor.bailToMark(this.markId))}}P(ey,"id","crop"),P(ey,"initial","idle");class EO extends ae{constructor(){super(...arguments);P(this,"shapeId","");P(this,"initialHandle",{});P(this,"initialAdjacentHandle",null);P(this,"initialPagePoint",{});P(this,"markId","");P(this,"initialPageTransform");P(this,"initialPageRotation");P(this,"info",{});P(this,"isPrecise",!1);P(this,"isPreciseId",null);P(this,"pointingId",null);P(this,"exactTimeout",-1)}onEnter(n){const{shape:r,isCreating:o,creatingMarkId:i,handle:s}=n;if(this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.shapeId=r.id,this.markId="",o)if(i)this.markId=i;else{const l=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);l&&(this.markId=l)}else this.markId=this.editor.markHistoryStoppingPoint("dragging handle");if(this.initialHandle=ut(s),this.editor.isShapeOfType(r,"line")&&this.initialHandle.type==="create"){this.editor.updateShape({...r,props:{points:{...r.props.points,[s.index]:{id:s.index,index:s.index,x:s.x,y:s.y}}}});const d=this.editor.getShapeHandles(r).find(h=>h.index===s.index);this.initialHandle=ut(d)}this.initialPageTransform=this.editor.getShapePageTransform(r),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:o?"cross":"grabbing",rotation:0});const a=this.editor.getShapeHandles(r).sort(nn),c=a.findIndex(l=>l.id===n.handle.id);this.initialAdjacentHandle=null;for(let l=c+1;l<a.length;l++){const d=a[l];if(d.type==="vertex"&&d.id!=="middle"&&d.id!==n.handle.id){this.initialAdjacentHandle=d;break}}if(!this.initialAdjacentHandle)for(let l=a.length-1;l>=0;l--){const d=a[l];if(d.type==="vertex"&&d.id!=="middle"&&d.id!==n.handle.id){this.initialAdjacentHandle=d;break}}if(this.editor.isShapeOfType(r,"arrow")){const l=En(this.editor,r)[n.handle.id];this.isPrecise=!1,l?(this.editor.setHintingShapes([l.toId]),this.isPrecise=l.props.isPrecise,this.isPrecise?this.isPreciseId=l.toId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.update(),this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})}complete(){this.editor.snaps.clearIndicators(),rt(this.editor,[this.shapeId]);const{onInteractionEnd:n}=this.info;if(this.editor.getInstanceState().isToolLocked&&n){this.editor.setCurrentTool(n,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:n}=this.info;if(n){this.editor.setCurrentTool(n,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){var E;const{editor:n,shapeId:r,initialPagePoint:o}=this,{initialHandle:i,initialPageRotation:s,initialAdjacentHandle:a}=this,c=this.editor.getHintingShapeIds(),l=this.editor.user.getIsSnapMode(),{snaps:d,inputs:{currentPagePoint:h,shiftKey:p,ctrlKey:f,altKey:g,pointerVelocity:m}}=n,y=this.info.shape,S=n.getShape(r);if(!S)return;const v=n.getShapeUtil(S);let _=h.clone().sub(o).rot(-s).add(i);if(p&&a&&i.id!=="middle"){const I=b.Angle(a,_),k=Au(I,24)-I;_=b.RotWith(_,a,k)}n.snaps.clearIndicators();let w={...i,x:_.x,y:_.y};if(i.canSnap&&(l?!f:f)){if(!n.getShapePageTransform(S.id))throw Error("Expected a page transform");const T=d.handles.snapHandle({currentShapeId:r,handle:w});T&&(T.nudge.rot(-n.getShapeParentTransform(S).rotation()),_.add(T.nudge),w={...i,x:_.x,y:_.y})}const x=(E=v.onHandleDrag)==null?void 0:E.call(v,S,{handle:w,isPrecise:this.isPrecise||g,initial:y}),C={id:S.id,type:S.type,...x};if(i.type==="vertex"&&this.editor.isShapeOfType(S,"arrow")){const I=En(n,S)[i.id];I?c[0]!==I.toId&&(n.setHintingShapes([I.toId]),this.pointingId=I.toId,this.isPrecise=m.len()<.5||g,this.isPreciseId=this.isPrecise?I.toId:null,this.resetExactTimeout()):c.length>0&&(n.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}x&&n.updateShapes([C])}}P(EO,"id","dragging_handle");function TO(t){return t.isLabel?[t]:t instanceof Ir?t.children.filter(e=>e.isLabel):[]}class kO extends ae{constructor(){super(...arguments);P(this,"hitShapeForPointerUp",null);P(this,"info",{})}onEnter(n){const r=this.editor.getEditingShape();if(!r)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,this.info=n,n.isCreatingTextWhileToolLocked&&this.parent.setCurrentToolIdMask("text"),vo(this.editor),this.editor.select(r)}onExit(){var i;const{editingShapeId:n}=this.editor.getCurrentPageState();if(!n)return;this.editor.setEditingShape(null),vo.cancel();const r=this.editor.getShape(n),o=this.editor.getShapeUtil(r);(i=o.onEditEnd)==null||i.call(o,r),this.info.isCreatingTextWhileToolLocked&&(this.parent.setCurrentToolIdMask(void 0),this.editor.setCurrentTool("text",{}))}onPointerMove(n){if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getIsReadonly()||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",n),this.hitShapeForPointerUp=null;return}switch(n.target){case"shape":case"canvas":{vo(this.editor);return}}}onPointerDown(n){switch(this.hitShapeForPointerUp=null,n.target){case"shape":{const{shape:r}=n,o=this.editor.getEditingShape();if(!o)throw Error("Expected an editing shape!");const i=this.editor.getShapeUtil(r).getGeometry(r),s=TO(i),a=s.length===1?s[0]:void 0,c=this.editor.isShapeOfType(o,"text")&&o.props.text.trim()==="";if(a&&!c){const l=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint);if(a.bounds.containsPoint(l,0)&&a.hitTestPoint(l)){if(r.id===o.id)return;this.hitShapeForPointerUp=r,this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(r.id);return}}else{if(r.id===o.id)this.editor.isShapeOfType(r,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",n));else{this.parent.transition("pointing_shape",n);return}return}break}}this.parent.transition("idle",n),this.editor.root.handleEvent(n)}onPointerUp(n){const r=this.hitShapeForPointerUp;if(!r)return;this.hitShapeForPointerUp=null;const o=this.editor.getShapeUtil(r);if(!r.isLocked){if(this.editor.getIsReadonly()&&!o.canEditInReadOnly(r)){this.parent.transition("pointing_shape",n);return}this.editor.select(r.id),this.editor.setEditingShape(r.id),vo(this.editor)}}onComplete(n){this.parent.transition("idle",n)}onCancel(n){this.parent.transition("idle",n)}}P(kO,"id","editing_shape");function S_(t){const e=t.getOnlySelectedShape();return!!(e&&!t.isShapeOrAncestorLocked(e)&&t.getShapeUtil(e).canCrop(e))}function Qu(t,e){const n=t.getSelectedShapeIds(),{currentPagePoint:r}=t.inputs,{shiftKey:o,altKey:i,accelKey:s}=e,a=o||s,c=t.getShapeAtPoint(r,{hitInside:!1,margin:t.options.hitTestMargin/t.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:l=>!l.isLocked});if(c){const l=t.getOutermostSelectableShape(c);if(a&&!i)t.cancelDoubleClick(),n.includes(l.id)?(t.markHistoryStoppingPoint("deselecting shape"),t.deselect(l)):(t.markHistoryStoppingPoint("shift selecting shape"),t.setSelectedShapes([...n,l.id]));else{let d;l===c||l.id===t.getFocusedGroupId()||n.includes(l.id)?d=c:d=l,d&&!n.includes(d.id)&&(t.markHistoryStoppingPoint("selecting shape"),t.select(d.id))}}else{if(a)return;{n.length>0&&(t.markHistoryStoppingPoint("selecting none"),t.selectNone());const l=t.getFocusedGroupId();if(In(l)){const d=t.getShape(l);t.isPointInShape(d,r,{margin:0,hitInside:!0})||t.setFocusedGroup(null)}}}}const $te=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];var Eg;let Rte=(Eg=class extends ae{onEnter(){this.parent.setCurrentToolIdMask(void 0),vo(this.editor),this.editor.setCursor({type:"default",rotation:0})}onExit(){vo.cancel()}onPointerMove(){vo(this.editor)}onPointerDown(e){if(this.editor.menus.hasAnyOpenMenus())return;const n=e.ctrlKey&&S_(this.editor);switch(e.target){case"canvas":{const r=xO(this.editor);if(r&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}const o=this.editor.getSelectedShapeIds(),i=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:s}}=this.editor;if((o.length>1||i&&!this.editor.getShapeUtil(i).hideSelectionBoundsBg(i))&&v_(this.editor,s)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{const{shape:r}=e;if(this.isOverArrowLabelTest(r)){this.parent.transition("pointing_arrow_label",e);break}if(this.editor.isShapeOrAncestorLocked(r)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":{if(this.editor.getIsReadonly())break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{if(n)this.parent.transition("crop.pointing_crop_handle",e);else{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_rotate_handle",e)}break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{if(n)this.parent.transition("crop.pointing_crop_handle",e);else{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_resize_handle",e)}break}default:{const r=this.editor.getHoveredShape();if(r&&!this.editor.getSelectedShapeIds().includes(r.id)&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}this.parent.transition("pointing_selection",e)}}break}}}onDoubleClick(e){var n,r,o,i;if(!(this.editor.inputs.shiftKey||e.phase!=="up")&&!(e.ctrlKey||e.shiftKey))switch(e.target){case"canvas":{const s=this.editor.getHoveredShape(),a=s&&!this.editor.isShapeOfType(s,"group")?s:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),c=this.editor.getFocusedGroupId();if(a){if(this.editor.isShapeOfType(a,"group")){Qu(this.editor,e);return}else{const l=this.editor.getShape(a.parentId);if(l&&this.editor.isShapeOfType(l,"group")&&!(c&&l.id===c)){Qu(this.editor,e);return}}this.onDoubleClick({...e,shape:a,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getIsReadonly())break;const s=this.editor.getOnlySelectedShape();if(s){const a=this.editor.getShapeUtil(s);if(!this.canInteractWithShapeInReadOnly(s))return;if(e.handle==="right"||e.handle==="left"||e.handle==="top"||e.handle==="bottom"){const c=(n=a.onDoubleClickEdge)==null?void 0:n.call(a,s);if(c){this.editor.markHistoryStoppingPoint("double click edge"),this.editor.updateShapes([c]),rt(this.editor,[s.id]);return}}if(a.canCrop(s)&&!this.editor.isShapeOrAncestorLocked(s)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(s)&&this.startEditingShape(s,e,!0)}break}case"shape":{const{shape:s}=e,a=this.editor.getShapeUtil(s);if(s.type!=="video"&&s.type!=="embed"&&this.editor.getIsReadonly())break;if(a.onDoubleClick){const c=(r=a.onDoubleClick)==null?void 0:r.call(a,s);if(c){this.editor.updateShapes([c]);return}}if(a.canCrop(s)&&!this.editor.isShapeOrAncestorLocked(s)){this.editor.markHistoryStoppingPoint("select and crop"),this.editor.select((o=e.shape)==null?void 0:o.id),this.parent.transition("crop",e);return}this.shouldStartEditingShape(s)?this.startEditingShape(s,e,!0):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getIsReadonly())break;const{shape:s,handle:a}=e,c=this.editor.getShapeUtil(s),l=(i=c.onDoubleClickHandle)==null?void 0:i.call(c,s,a);l?this.editor.updateShapes([l]):this.shouldStartEditingShape(s)&&this.startEditingShape(s,e,!0)}}}onRightClick(e){switch(e.target){case"canvas":{const n=this.editor.getHoveredShape(),r=n&&!this.editor.isShapeOfType(n,"group")?n:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!1,renderingOnly:!0});if(r){this.onRightClick({...e,shape:r,target:"shape"});return}const o=this.editor.getSelectedShapeIds(),i=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:s}}=this.editor;if((o.length>1||i&&!this.editor.getShapeUtil(i).hideSelectionBoundsBg(i))&&v_(this.editor,s)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:n}=this.editor.getCurrentPageState(),{shape:r}=e,o=this.editor.getOutermostSelectableShape(r,i=>!n.includes(i.id));!n.includes(o.id)&&!this.editor.findShapeAncestor(o,i=>n.includes(i.id))&&(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([o.id]));break}}}onCancel(){this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.markHistoryStoppingPoint("clearing selection"),this.editor.selectNone())}onKeyDown(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);return}}if(Pt.editOnType.get()&&!$te.includes(e.key)&&!e.altKey&&!e.ctrlKey){const n=this.editor.getOnlySelectedShape();if(n&&this.editor.isShapeOfType(n,"note")&&this.shouldStartEditingShape(n)){this.startEditingShape(n,{...e,target:"shape",shape:n},!0);return}}}onKeyRepeat(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}}onKeyUp(e){switch(e.code){case"Enter":{const n=this.editor.getSelectedShapes();if(n.every(o=>this.editor.isShapeOfType(o,"group"))){this.editor.setSelectedShapes(n.flatMap(o=>this.editor.getSortedChildIdsForParent(o.id)));return}const r=this.editor.getOnlySelectedShape();if(r&&this.shouldStartEditingShape(r)){this.startEditingShape(r,{...e,target:"shape",shape:r},!0);return}S_(this.editor)&&this.parent.transition("crop",e);break}}}shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!e||this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||!this.canInteractWithShapeInReadOnly(e)?!1:this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,n,r){this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||(this.editor.markHistoryStoppingPoint("editing shape"),Fu(this.editor,e,r),this.parent.transition("editing_shape",n))}isOverArrowLabelTest(e){if(!e)return!1;const n=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(e,"arrow")){const r=this.editor.getShapeGeometry(e).children[1];if(r&&Vn(n,r.vertices))return!0}return!1}handleDoubleClickOnCanvas(e){if(this.editor.getIsReadonly())return;this.editor.markHistoryStoppingPoint("creating text shape");const n=Xe(),{x:r,y:o}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:n,type:"text",x:r,y:o,props:{text:"",autoSize:!0}}]);const i=this.editor.getShape(n);if(!i)return;const s=this.editor.getShapeUtil(i);this.editor.getIsReadonly()&&!s.canEditInReadOnly(i)||(this.editor.setEditingShape(n),this.editor.select(n),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){const{editor:{inputs:{keys:n}}}=this,r=n.has("ShiftLeft"),o=new b(0,0);if(n.has("ArrowLeft")&&(o.x-=1),n.has("ArrowRight")&&(o.x+=1),n.has("ArrowUp")&&(o.y-=1),n.has("ArrowDown")&&(o.y+=1),o.equals(new b(0,0)))return;e||this.editor.markHistoryStoppingPoint("nudge shapes");const{gridSize:i}=this.editor.getDocumentSettings(),s=this.editor.getInstanceState().isGridMode?r?i*Fte:i:r?Lte:Nte,a=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(a,o.mul(s)),rt(this.editor,a)}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getIsReadonly()||this.editor.getShapeUtil(e).canEditInReadOnly(e))}},P(Eg,"id","idle"),Eg);const Lte=10,Nte=1,Fte=5;function v_(t,e){const n=t.getSelectionRotatedPageBounds();if(!n)return!1;const r=t.getSelectionRotation();return r?Vn(e,n.corners.map(o=>b.RotWith(o,n.point,r))):n.containsPoint(e)}class MO extends ae{constructor(){super(...arguments);P(this,"shapeId","");P(this,"markId","");P(this,"wasAlreadySelected",!1);P(this,"didDrag",!1);P(this,"didCtrlOnEnter",!1);P(this,"info",{});P(this,"_labelDragOffset",new b(0,0))}updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter(n){const{shape:r}=n;this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.info=n,this.shapeId=r.id,this.didDrag=!1,this.didCtrlOnEnter=n.accelKey,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===r.id,this.updateCursor();const i=this.editor.getShapeGeometry(r).children[1];if(!i)throw Error(`Expected to find an arrow label geometry for shape: ${r.id}`);const{currentPagePoint:s}=this.editor.inputs,a=this.editor.getPointInShapeSpace(r,s);this._labelDragOffset=b.Sub(i.center,a),this.markId=this.editor.markHistoryStoppingPoint("label-drag start"),this.editor.setSelectedShapes([this.shapeId])}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){const{isDragging:n}=this.editor.inputs;if(!n)return;if(this.didCtrlOnEnter){this.parent.transition("brushing",this.info);return}const r=this.editor.getShape(this.shapeId);if(!r)return;const o=Hr(this.editor,r),i=this.editor.getShapeGeometry(r),s=i.children[0],a=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint),c=s.nearestPoint(b.Add(a,this._labelDragOffset));let l;if(o.isStraight){const d=b.Dist(o.start.point,o.end.point);l=1-b.Dist(o.end.point,c)/d}else{const{_center:d,measure:h,angleEnd:p,angleStart:f}=i.children[0];l=am(h,f,p,d.angle(c))}isNaN(l)&&(l=.5),this.didDrag=!0,this.editor.updateShape({id:r.id,type:r.type,props:{labelPosition:l}})}onPointerUp(){const n=this.editor.getShape(this.shapeId);n&&(this.didDrag||!this.wasAlreadySelected?this.complete():this.editor.getIsReadonly()||(this.editor.setEditingShape(n.id),this.editor.setCurrentTool("select.editing_shape")))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}P(MO,"id","pointing_arrow_label");class AO extends ae{onEnter(e){e.shiftKey||e.accelKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.markHistoryStoppingPoint("selecting none"),this.editor.selectNone())}onPointerMove(e){this.editor.inputs.isDragging&&this.parent.transition("brushing",e)}onPointerUp(e){Qu(this.editor,e),this.complete()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle")}complete(){this.parent.transition("idle")}}P(AO,"id","pointing_canvas");class OO extends ae{constructor(){super(...arguments);P(this,"didCtrlOnEnter",!1);P(this,"info",{})}onEnter(n){this.info=n,this.didCtrlOnEnter=n.accelKey;const{shape:r}=n;if(this.editor.isShapeOfType(r,"arrow")){const o=En(this.editor,r)[n.handle.id];o&&this.editor.setHintingShapes([o.toId])}this.editor.setCursor({type:"grabbing",rotation:0})}onExit(){this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})}onPointerUp(){const{shape:n,handle:r}=this.info;if(this.editor.isShapeOfType(n,"note")){const{editor:o}=this,i=b_(o,n,r,!1);if(i){Fu(o,i,!0);return}}this.parent.transition("idle",this.info)}onPointerMove(n){const{editor:r}=this;r.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",n):this.startDraggingHandle())}onLongPress(){this.startDraggingHandle()}startDraggingHandle(){const{editor:n}=this;if(n.getIsReadonly())return;const{shape:r,handle:o}=this.info;if(n.isShapeOfType(r,"note")){const i=b_(n,r,o,!0);if(i){const s=n.getPointInParentSpace(i,n.inputs.originPagePoint).sub(b.Rot(dp.clone().mul(r.props.scale),i.rotation));n.updateShape({...i,x:s.x,y:s.y}),n.setHoveredShape(i.id).select(i.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:n.getShape(i),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{Fu(n,i,!0)}});return}}this.parent.transition("dragging_handle",this.info)}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}P(OO,"id","pointing_handle");function b_(t,e,n,r){const o=t.getShapePageTransform(e.id),i=o.point(),s=o.rotation(),c=GA(t,i,s,e.props.growY,0,e.props.scale)[n.index];if(c)return YA(t,e,c,s,r)}class DO extends ae{constructor(){super(...arguments);P(this,"info",{})}updateCursor(){this.editor.setCursor({type:na[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter(n){this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.info=n,this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.editor.inputs.isDragging&&this.startRotating()}onLongPress(){this.startRotating()}startRotating(){this.editor.getIsReadonly()||this.parent.transition("rotating",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}P(DO,"id","pointing_rotate_handle");class $O extends ae{constructor(){super(...arguments);P(this,"info",{})}onEnter(n){this.info=n}onPointerUp(n){Qu(this.editor,n),this.parent.transition("idle",n)}onPointerMove(n){this.editor.inputs.isDragging&&this.startTranslating(n)}onLongPress(n){this.startTranslating(n)}startTranslating(n){this.editor.getIsReadonly()||this.parent.transition("translating",n)}onDoubleClick(n){var i,s;const r=this.editor.getHoveredShape(),o=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(o){this.parent.transition("idle"),(s=(i=this.parent).onDoubleClick)==null||s.call(i,{...n,target:"shape",shape:this.editor.getShape(o)});return}}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}P($O,"id","pointing_selection");class RO extends ae{constructor(){super(...arguments);P(this,"hitShape",{});P(this,"hitShapeForPointerUp",{});P(this,"isDoubleClick",!1);P(this,"didCtrlOnEnter",!1);P(this,"didSelectOnEnter",!1)}onEnter(n){const r=this.editor.getSelectedShapeIds(),o=this.editor.getSelectionRotatedPageBounds(),i=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:s}}=this.editor,{shiftKey:a,altKey:c,accelKey:l}=n;this.hitShape=n.shape,this.isDoubleClick=!1,this.didCtrlOnEnter=l;const d=this.editor.getOutermostSelectableShape(n.shape),h=this.editor.findShapeAncestor(d,p=>r.includes(p.id));if(this.didCtrlOnEnter||this.editor.getShapeUtil(n.shape).onClick||d.id===i||r.includes(d.id)||h||r.length>1&&(o!=null&&o.containsPoint(s))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=d;return}this.didSelectOnEnter=!0,a&&!c?(this.editor.cancelDoubleClick(),r.includes(d.id)||(this.editor.markHistoryStoppingPoint("shift selecting shape"),this.editor.setSelectedShapes([...r,d.id]))):(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([d.id]))}onPointerUp(n){var d;const r=this.editor.getSelectedShapeIds(),o=this.editor.getFocusedGroupId(),i=this.editor.getZoomLevel(),{inputs:{currentPagePoint:s}}=this.editor,a=n.shiftKey||n.accelKey,c=this.editor.getShapeAtPoint(s,{margin:this.editor.options.hitTestMargin/i,hitInside:!0,renderingOnly:!0})??this.hitShape,l=c?this.editor.getOutermostSelectableShape(c):this.hitShapeForPointerUp;if(l){const h=this.editor.getShapeUtil(l);if(h.onClick){const p=(d=h.onClick)==null?void 0:d.call(h,l);if(p){this.editor.markHistoryStoppingPoint("shape on click"),this.editor.updateShapes([p]),this.parent.transition("idle",n);return}}if(l.id===o){r.length>0?(this.editor.markHistoryStoppingPoint("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",n);return}}if(!this.didSelectOnEnter){const h=this.editor.getOutermostSelectableShape(c,p=>!r.includes(p.id));if(r.includes(h.id))if(a)this.editor.markHistoryStoppingPoint("deselecting on pointer up"),this.editor.deselect(l);else if(r.includes(l.id)){if(r.length===1){const p=this.editor.getShapeUtil(l).getGeometry(l),f=TO(p),g=f.length===1?f[0]:void 0;if(g){const m=this.editor.getPointInShapeSpace(l,s);if(g.bounds.containsPoint(m,0)&&g.hitTestPoint(m)){this.editor.run(()=>{this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(l.id);const y=this.editor.getShapeUtil(l);this.editor.getIsReadonly()&&!y.canEditInReadOnly(l)||(this.editor.setEditingShape(l.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick&&this.editor.emit("select-all-text",{shapeId:l.id}))});return}}}this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(l.id)}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(l);else if(a){const p=this.editor.getShapeAncestors(h);this.editor.markHistoryStoppingPoint("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(f=>!p.find(g=>g.id===f)),h.id])}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.setSelectedShapes([h.id])}this.parent.transition("idle",n)}onDoubleClick(){this.isDoubleClick=!0}onPointerMove(n){this.editor.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",n):this.startTranslating(n))}onLongPress(n){this.startTranslating(n)}startTranslating(n){this.editor.getIsReadonly()||(this.editor.focus(),this.parent.transition("translating",n))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}P(RO,"id","pointing_shape");class LO extends ae{constructor(){super(...arguments);P(this,"info",{});P(this,"markId","");P(this,"didHoldCommand",!1);P(this,"creationCursorOffset",{x:0,y:0});P(this,"snapshot",{})}onEnter(n){const{isCreating:r=!1,creatingMarkId:o,creationCursorOffset:i={x:0,y:0}}=n;if(this.info=n,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.creationCursorOffset=i,this.snapshot=this._createSnapshot(),this.markId="",r)if(o)this.markId=o;else{const s=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);s&&(this.markId=s)}else this.markId=this.editor.markHistoryStoppingPoint("starting resizing");r&&this.editor.setCursor({type:"cross",rotation:0}),this.handleResizeStart(),this.updateShapes()}onTick({elapsed:n}){const{editor:r}=this;r.edgeScrollManager.updateEdgeScrolling(n)}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var n,r;if(rt(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){(r=(n=this.info).onCreate)==null||r.call(n,this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:n}=this.snapshot,r=[];n.forEach(({shape:o})=>{var a;const i=this.editor.getShapeUtil(o),s=(a=i.onResizeStart)==null?void 0:a.call(i,o);s&&r.push(s)}),r.length>0&&this.editor.updateShapes(r)}handleResizeEnd(){const{shapeSnapshots:n}=this.snapshot,r=[];n.forEach(({shape:o})=>{var c;const i=this.editor.getShape(o.id),s=this.editor.getShapeUtil(o),a=(c=s.onResizeEnd)==null?void 0:c.call(s,o,i);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{altKey:n,shiftKey:r}=this.editor.inputs,{frames:o,shapeSnapshots:i,selectionBounds:s,cursorHandleOffset:a,selectedShapeIds:c,selectionRotation:l,canShapesDeform:d}=this.snapshot;let h=r||!d;if(i.size===1){const I=[...i.values()][0];this.editor.isShapeOfType(I.shape,"text")&&(h=!(this.info.handle==="left"||this.info.handle==="right"))}const{ctrlKey:p}=this.editor.inputs,f=this.editor.inputs.currentPagePoint.clone().sub(a).sub(this.creationCursorOffset),g=this.editor.inputs.originPagePoint.clone().sub(a);if(this.editor.getInstanceState().isGridMode&&!p){const{gridSize:I}=this.editor.getDocumentSettings();f.snapToGrid(I)}const m=this.info.handle,y=w_(m,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!p:p)&&l%it===0){const{nudge:I}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:b.Sub(f,g),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:w_(m,l),isAspectRatioLocked:h,isResizingFromCenter:n});f.add(I)}const v=b.RotWith(n?s.center:s.getHandlePoint(y),s.point,l),_=b.Sub(f,v).rot(-l),w=b.Sub(g,v).rot(-l),x=b.DivV(_,w);Number.isFinite(x.x)||(x.x=1),Number.isFinite(x.y)||(x.y=1);const C=m==="top"||m==="bottom",E=m==="left"||m==="right";h?E?x.y=Math.abs(x.x):C?x.x=Math.abs(x.y):Math.abs(x.x)>Math.abs(x.y)?x.y=Math.abs(x.x)*(x.y<0?-1:1):x.x=Math.abs(x.y)*(x.x<0?-1:1):(C&&(x.x=1),E&&(x.y=1)),this.info.isCreating||this.updateCursor({dragHandle:m,isFlippedX:x.x<0,isFlippedY:x.y<0,rotation:l});for(const I of i.keys()){const T=i.get(I);this.editor.resizeShape(I,x,{initialShape:T.shape,initialBounds:T.bounds,initialPageTransform:T.pageTransform,dragHandle:m,mode:c.length===1&&I===c[0]?"resize_bounds":"scale_shape",scaleOrigin:v,isAspectRatioLocked:h,scaleAxisRotation:l,skipStartAndEndCallbacks:!0})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:I,children:T}of o){if(!T.length)continue;const k=i.get(I).shape,D=this.editor.getShape(I);if(!(k&&D))continue;const A=D.x-k.x,O=D.y-k.y,$=new b(A,O).rot(-k.rotation);if($.x!==0||$.y!==0)for(const z of T)this.editor.updateShape({id:z.id,type:z.type,x:z.x-$.x,y:z.y-$.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:I}of o)if(I.length)for(const T of I)this.editor.updateShape({id:T.id,type:T.type,x:T.x,y:T.y})}}updateCursor({dragHandle:n,isFlippedX:r,isFlippedY:o,rotation:i}){const s={...this.editor.getInstanceState().cursor};switch(n){case"top_left":case"bottom_right":{s.type="nwse-resize",r!==o&&(s.type="nesw-resize");break}case"top_right":case"bottom_left":{s.type="nesw-resize",r!==o&&(s.type="nwse-resize");break}}s.rotation=i,this.editor.setCursor(s)}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()}_createSnapshot(){const n=this.editor.getSelectedShapeIds(),r=this.editor.getSelectionRotation(),{inputs:{originPagePoint:o}}=this.editor,i=this.editor.getSelectionRotatedPageBounds(),s=b.RotWith(i.getHandlePoint(this.info.handle),i.point,r),a=b.Sub(o,s),c=new Map,l=[];n.forEach(h=>{const p=this.editor.getShape(h);if(p){if(p.type==="frame"&&l.push({id:h,children:be(this.editor.getSortedChildIdsForParent(p).map(f=>this.editor.getShape(f)))}),c.set(p.id,this._createShapeSnapshot(p)),this.editor.isShapeOfType(p,"frame")&&n.length===1)return;this.editor.visitDescendants(p.id,f=>{const g=this.editor.getShape(f);if(g&&(c.set(g.id,this._createShapeSnapshot(g)),this.editor.isShapeOfType(g,"frame")))return!1})}});const d=![...c.values()].some(h=>!XI(h.pageRotation,r)||h.isAspectRatioLocked);return{shapeSnapshots:c,selectionBounds:i,cursorHandleOffset:a,selectionRotation:r,selectedShapeIds:n,canShapesDeform:d,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:l}}_createShapeSnapshot(n){const r=this.editor.getShapePageTransform(n),o=this.editor.getShapeUtil(n);return{shape:n,bounds:this.editor.getShapeGeometry(n).bounds,pageTransform:r,pageRotation:J.Decompose(r).rotation,isAspectRatioLocked:o.isAspectRatioLocked(n)}}}P(LO,"id","resizing");const Jf=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function w_(t,e){e=e%Ve;const n=Math.round(e/(ze/4)),r=Jf.indexOf(t);return Jf[(r+n)%Jf.length]}const __=Math.PI/180;class NO extends ae{constructor(){super(...arguments);P(this,"snapshot",{});P(this,"info",{});P(this,"markId","")}onEnter(n){this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("rotate start");const r=iE({editor:this.editor,ids:this.editor.getSelectedShapeIds()});if(!r)return this.parent.transition("idle",this.info);this.snapshot=r;const o=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Cd({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:na[this.info.handle],rotation:o+this.snapshot.initialShapesRotation})}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}update(){const n=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Cd({editor:this.editor,delta:n,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:na[this.info.handle],rotation:n+this.snapshot.initialShapesRotation})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}complete(){Cd({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),rt(this.editor,this.snapshot.shapeSnapshots.map(n=>n.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}_getRotationFromPointerPosition({snapToNearestDegree:n}){const r=this.editor.getSelectionRotation(),o=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:i,currentPagePoint:s}}=this.editor,{initialCursorAngle:a,initialShapesRotation:c}=this.snapshot;if(!o)return c;const d=o.center.clone().rotWith(o.point,r).angle(s)-a;let h=c+d;if(i)h=Au(h,24);else if(n&&(h=Math.round(h/__)*__,this.editor.getInstanceState().isCoarsePointer)){const p=Au(h,4),f=xd(h,p);Math.abs(f)<y7(5)&&(h=p)}return h-c}}P(NO,"id","rotating");class FO extends ae{constructor(){super(...arguments);P(this,"hits",new Set);P(this,"size",0);P(this,"scribbleId","id");P(this,"initialSelectedShapeIds",new Set);P(this,"newlySelectedShapeIds",new Set)}onEnter(){this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const n=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=n.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.updateScribbleSelection(!0)}onPointerUp(){this.complete()}onKeyDown(){this.updateScribbleSelection(!1)}onKeyUp(){this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")}onCancel(){this.cancel()}onComplete(){this.complete()}pushPointToScribble(){const{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,n,r)}updateScribbleSelection(n){const{editor:r}=this,o=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{shiftKey:i,originPagePoint:s,previousPagePoint:a,currentPagePoint:c}}=this.editor,{newlySelectedShapeIds:l,initialSelectedShapeIds:d}=this;n&&this.pushPointToScribble();const h=o;let p,f,g,m;const y=0;for(let _=0,w=h.length;_<w;_++){if(p=h[_],r.isShapeOfType(p,"group")||l.has(p.id)||r.isShapeOrAncestorLocked(p)||(f=r.getShapeGeometry(p),r.isShapeOfType(p,"frame")&&f.bounds.containsPoint(r.getPointInShapeSpace(p,s))))continue;const x=r.getShapePageTransform(p);if(!f||!x)continue;const C=x.clone().invert();g=C.applyToPoint(a),m=C.applyToPoint(c);const{bounds:E}=f;if(!(E.minX-y>Math.max(g.x,m.x)||E.minY-y>Math.max(g.y,m.y)||E.maxX+y<Math.min(g.x,m.x)||E.maxY+y<Math.min(g.y,m.y))&&f.hitTestLineSegment(g,m,y)){const I=this.editor.getOutermostSelectableShape(p),T=this.editor.getShapeMask(I.id);if(T&&OS(a,c,T)!==null&&!Vn(c,T))continue;l.add(I.id)}}const S=r.getSelectedShapeIds(),v=new Set(i?[...l,...d]:[...l]);(S.length!==v.size||S.some(_=>!v.has(_)))&&this.editor.setSelectedShapes(Array.from(v))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}P(FO,"id","scribble_brushing");var zte=Object.create,zO=Object.defineProperty,Bte=Object.getOwnPropertyDescriptor,Ute=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),BO=t=>{throw TypeError(t)},UO=(t,e,n)=>e in t?zO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Hte=t=>[,,,zte(null)],HO=["class","method","getter","setter","accessor","field","value","get","set"],jO=t=>t!==void 0&&typeof t!="function"?BO("Function expected"):t,jte=(t,e,n,r,o)=>({kind:HO[t],name:e,metadata:r,addInitializer:i=>n._?BO("Already initialized"):o.push(jO(i||null))}),Kte=(t,e)=>UO(e,Ute("metadata"),t[3]),Wte=(t,e,n,r)=>{for(var o=0,i=t[e>>1],s=i&&i.length;o<s;o++)i[o].call(n);return r},Gte=(t,e,n,r,o,i)=>{for(var s,a,c,l,d=e&7,h=!!(e&8),p=!!(e&16),f=2,g=HO[d+5],m=t[f]||(t[f]=[]),y=(o=o.prototype,Bte(o,n)),S=r.length-1;S>=0;S--)c=jte(d,n,a={},t[3],m),c.static=h,c.private=p,l=c.access={has:v=>n in v},l.get=v=>v[n],s=(0,r[S])(y[g],c),a._=1,jO(s)&&(y[g]=s);return y&&zO(o,n,y),o},Qf=(t,e,n)=>UO(t,typeof e!="symbol"?e+"":e,n),KO,gp;const Vte=20,Yte=100;KO=[Tn];class Wv{constructor(e){this.editor=e,Wte(gp,5,this),Qf(this,"prevDroppingShapeId",null),Qf(this,"droppingNodeTimer",null),Qf(this,"first",!0),e.disposables.add(this.dispose)}updateDroppingNode(e,n){var r;this.first&&(this.editor.setHintingShapes(e.map(o=>this.editor.findShapeAncestor(o,i=>i.type!=="group")).filter(o=>o)),this.prevDroppingShapeId=((r=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e))==null?void 0:r.id)??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(e,Vte,n):this.editor.inputs.pointerVelocity.len()>.5&&(clearTimeout(this.droppingNodeTimer),this.setDragTimer(e,Yte,n))}setDragTimer(e,n,r){this.droppingNodeTimer=this.editor.timers.setTimeout(()=>{this.editor.run(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,r)}),this.droppingNodeTimer=null},n)}handleDrag(e,n,r){var c,l,d,h,p;n=be(n.map(f=>this.editor.getShape(f.id)));const o=((c=this.editor.getDroppingOverShape(e,n))==null?void 0:c.id)??null;if(o===this.prevDroppingShapeId){this.hintParents(n);return}const{prevDroppingShapeId:i}=this,s=i&&this.editor.getShape(i),a=o&&this.editor.getShape(o);s&&((d=(l=this.editor.getShapeUtil(s)).onDragShapesOut)==null||d.call(l,s,n)),a&&((p=(h=this.editor.getShapeUtil(a)).onDragShapesOver)==null||p.call(h,a,n)),this.hintParents(n),r==null||r(),this.prevDroppingShapeId=o}hintParents(e){const n=new Map;for(const o of e){const i=this.editor.findShapeAncestor(o,s=>s.type!=="group");i&&(n.has(i.id)||n.set(i.id,[]),n.get(i.id).push(o.id))}const r=[];for(const[o,i]of n){const s=this.editor.getShape(o);s&&Nk(this.editor,s).length<i.length&&r.push(s.id)}this.editor.setHintingShapes(r)}dropShapes(e){var r,o;const{prevDroppingShapeId:n}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),n){const i=this.editor.getShape(n);if(!i)return;(o=(r=this.editor.getShapeUtil(i)).onDropShapesOver)==null||o.call(r,i,e)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearTimeout(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}dispose(){this.clear()}}gp=Hte();Gte(gp,1,"dispose",KO,Wv);Kte(gp,Wv);var Xte=Object.create,WO=Object.defineProperty,qte=Object.getOwnPropertyDescriptor,GO=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),VO=t=>{throw TypeError(t)},YO=(t,e,n)=>e in t?WO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Zte=t=>[,,,Xte((t==null?void 0:t[GO("metadata")])??null)],XO=["class","method","getter","setter","accessor","field","value","get","set"],qO=t=>t!==void 0&&typeof t!="function"?VO("Function expected"):t,Jte=(t,e,n,r,o)=>({kind:XO[t],name:e,metadata:r,addInitializer:i=>n._?VO("Already initialized"):o.push(qO(i||null))}),Qte=(t,e)=>YO(e,GO("metadata"),t[3]),ene=(t,e,n,r)=>{for(var o=0,i=t[e>>1],s=i&&i.length;o<s;o++)i[o].call(n);return r},tne=(t,e,n,r,o,i)=>{for(var s,a,c,l,d=e&7,h=!!(e&8),p=!!(e&16),f=2,g=XO[d+5],m=t[f]||(t[f]=[]),y=(o=o.prototype,qte(o,n)),S=r.length-1;S>=0;S--)c=Jte(d,n,a={},t[3],m),c.static=h,c.private=p,l=c.access={has:v=>n in v},l.get=v=>v[n],s=(0,r[S])(y[g],c),a._=1,qO(s)&&(y[g]=s);return y&&WO(o,n,y),o},Yo=(t,e,n)=>YO(t,typeof e!="symbol"?e+"":e,n),ZO,ty,mp;class yp extends(ty=ae,ZO=[Tn],ty){constructor(){super(...arguments),ene(mp,5,this),Yo(this,"info",{}),Yo(this,"selectionSnapshot",{}),Yo(this,"snapshot",{}),Yo(this,"markId",""),Yo(this,"isCloning",!1),Yo(this,"isCreating",!1),Yo(this,"dragAndDropManager",new Wv(this.editor))}onCreate(e){}onEnter(e){var i;const{isCreating:n=!1,creatingMarkId:r,onCreate:o=()=>{}}=e;if(!((i=this.editor.getSelectedShapeIds())!=null&&i.length)){this.parent.transition("idle");return}if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=n,this.markId="",n)if(r)this.markId=r;else{const s=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);s&&(this.markId=s)}else this.markId=this.editor.markHistoryStoppingPoint("translating");if(this.onCreate=o,this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=x_(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()}onTick({elapsed:e}){const{editor:n}=this;this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),n.edgeScrollManager.updateEdgeScrolling(e)}onPointerMove(){this.updateShapes()}onKeyDown(){if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()}onKeyUp(){if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate cloning"),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=x_(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate"),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var e;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),rt(this.editor,this.snapshot.movingShapes.map(n=>n.id)),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?(e=this.onCreate)==null||e.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:e}=this.snapshot,n=[];e.forEach(r=>{var s;const o=this.editor.getShapeUtil(r),i=(s=o.onTranslateStart)==null?void 0:s.call(o,r);i&&n.push(i)}),n.length>0&&this.editor.updateShapes(n),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){const r=b.Average(e.map(i=>this.editor.getShapePageTransform(i.id).point())),o=b.Sub(r,this.selectionSnapshot.averagePagePoint);b.IsNaN(o)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(i=>i.id),offset:{x:o.x,y:o.y}}})}const n=[];e.forEach(r=>{var a;const o=this.editor.getShape(r.id),i=this.editor.getShapeUtil(r),s=(a=i.onTranslateEnd)==null?void 0:a.call(i,r,o);s&&n.push(s)}),n.length>0&&this.editor.updateShapes(n)}updateShapes(){const{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),nne({editor:this.editor,snapshot:e});const{movingShapes:n}=e,r=[];n.forEach(o=>{var c;const i=this.editor.getShape(o.id),s=this.editor.getShapeUtil(o),a=(c=s.onTranslate)==null?void 0:c.call(s,o,i);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateParentTransforms(){const{editor:e,snapshot:{shapeSnapshots:n}}=this;n.forEach(r=>{const o=e.getShape(r.shape.id);if(!o)return null;const i=_n(o.parentId)?null:J.Inverse(e.getShapePageTransform(o.parentId));r.parentTransform=i})}}mp=Zte(ty);tne(mp,1,"updateParentTransforms",ZO,yp);Qte(mp,yp);Yo(yp,"id","translating");function x_(t){var h;const e=[],n=[],r=t.getSelectedShapeIds(),o=be(r.map(p=>{const f=t.getShape(p);if(!f)return null;e.push(f);const g=t.getShapePageTransform(p),m=g.point(),y=g.rotation();n.push(m);const S=Zn.isId(f.parentId)?null:J.Inverse(t.getShapePageTransform(f.parentId));return{shape:f,pagePoint:m,pageRotation:y,parentTransform:S}})),i=t.getOnlySelectedShape();let s=[];if(i)s=t.snaps.shapeBounds.getSnapPoints(i.id);else{const p=t.getSelectionPageBounds();p&&(s=p.cornersAndCenter.map((f,g)=>({id:"selection:"+g,x:f.x,y:f.y})))}let a,c;const{originPagePoint:l}=t.inputs,d=o.filter(p=>t.isShapeOfType(p.shape,"note")&&t.isPointInShape(p.shape,l));if(d.length!==0)if(d.length===1)c=d[0];else{const p=t.getCurrentPageShapesSorted();c=(h=d.map(f=>({snapshot:f,index:p.findIndex(g=>g.id===f.shape.id)})).sort((f,g)=>g.index-f.index)[0])==null?void 0:h.snapshot}return c&&(a=VA(t,c.pageRotation,c.shape.props.scale,c.shape.props.growY??0)),{averagePagePoint:b.Average(n),movingShapes:e,shapeSnapshots:o,initialPageBounds:t.getSelectionPageBounds(),initialSnapPoints:s,noteAdjacentPositions:a,noteSnapshot:c}}function nne({editor:t,snapshot:e}){const{inputs:n}=t,{noteSnapshot:r,noteAdjacentPositions:o,initialPageBounds:i,initialSnapPoints:s,shapeSnapshots:a,averagePagePoint:c}=e,l=t.getInstanceState().isGridMode,d=t.getDocumentSettings().gridSize,h=b.Sub(n.currentPagePoint,n.originPagePoint),p=t.inputs.shiftKey?Math.abs(h.x)<Math.abs(h.y)?"x":"y":null;if(p==="x"?h.x=0:p==="y"&&(h.y=0),t.snaps.clearIndicators(),(t.user.getIsSnapMode()?!n.ctrlKey:n.ctrlKey)&&t.inputs.pointerVelocity.len()<.5){const{nudge:y}=t.snaps.shapeBounds.snapTranslateShapes({dragDelta:h,initialSelectionPageBounds:i,lockedAxis:p,initialSelectionSnapPoints:s});h.add(y)}else if(r&&o){const{scale:y}=r.shape.props,S=r.pagePoint.clone().add(h).add(dp.clone().mul(y).rot(r.pageRotation));let v=WA/t.getZoomLevel(),_=new b(0,0);for(const w of o){const x=b.Sub(S,w),C=x.len();C<v&&(v=C,_=x)}h.sub(_)}const g=b.Add(c,h);l&&!n.ctrlKey&&g.snapToGrid(d);const m=b.Sub(g,c);t.updateShapes(be(a.map(({shape:y,pagePoint:S,parentTransform:v})=>{const _=b.Add(S,m),w=v?J.applyToPoint(v,_):_;return{id:y.id,type:y.type,x:w.x,y:w.y}})))}class Zd extends ae{constructor(){super(...arguments);P(this,"reactor")}static children(){return[ey,jv,Rte,AO,RO,yp,wO,FO,Kv,$O,_O,kO,LO,NO,DO,MO,OO,EO]}cleanUpDuplicateProps(){const n=this.editor.getSelectedShapeIds(),r=this.editor.getInstanceState();if(!r.duplicateProps)return;const o=new Set(r.duplicateProps.shapeIds);n.length===o.size&&n.every(i=>o.has(i))||this.editor.updateInstanceState({duplicateProps:null})}onEnter(){this.reactor=xo("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(n){typeof process<"u",console.error(n)}})}onExit(){var n;(n=this.reactor)==null||n.call(this),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}P(Zd,"id","select"),P(Zd,"initial","idle"),P(Zd,"isLockable",!1);class JO extends ae{constructor(){super(...arguments);P(this,"info",{})}onEnter(n){this.info=n}onPointerDown(){this.parent.transition("pointing",this.info)}}P(JO,"id","idle");class QO extends ae{constructor(){super(...arguments);P(this,"info",{})}onEnter(n){this.info=n}onPointerUp(){this.complete()}onPointerMove(){this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)}onCancel(){this.cancel()}complete(){const{currentScreenPoint:n}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(n,{animation:{duration:220}}):this.editor.zoomIn(n,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}P(QO,"id","pointing");class eD extends ae{constructor(){super(...arguments);P(this,"info",{});P(this,"zoomBrush",new ee)}onEnter(n){this.info=n,this.update()}onExit(){this.editor.updateInstanceState({zoomBrush:null})}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}update(){const{inputs:{originPagePoint:n,currentPagePoint:r}}=this.editor;this.zoomBrush.setTo(ee.FromPoints([n,r])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:n}=this,r=8/this.editor.getZoomLevel();if(n.width<r&&n.height<r){const o=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(o,{animation:{duration:220}}):this.editor.zoomIn(o,{animation:{duration:220}})}else{const o=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(n,{targetZoom:o,animation:{duration:220}})}this.parent.transition("idle",this.info)}}P(eD,"id","zoom_brushing");class Jd extends ae{constructor(){super(...arguments);P(this,"info",{})}static children(){return[JO,eD,QO]}onEnter(n){this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)}onKeyDown(){this.updateCursor()}onKeyUp(n){this.updateCursor(),n.code==="KeyZ"&&this.complete()}onInterrupt(){this.complete()}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}P(Jd,"id","zoom"),P(Jd,"initial","idle"),P(Jd,"isLockable",!1);const rne=[Yd,Xd,qd,Jd,Zd];function one(){const t=F(),e=U("follow",()=>t.getInstanceState().followingUserId,[t]);return e?u(ine,{userId:e}):null}function ine({userId:t}){const e=Ih(t);return e?u("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}let ny={fonts:{draw:`${ti()}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`${ti()}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`${ti()}/fonts/IBMPlexSans-Medium.woff2`,monospace:`${ti()}/fonts/IBMPlexMono-Medium.woff2`}};function tD(t){return ce(()=>t?{fonts:{...ny.fonts,...t==null?void 0:t.fonts}}:ny,[t])}const sne=["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bring-forward","bring-to-front","broken","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","color","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","leading","link","lock","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"];let Ya={...ny,icons:Object.fromEntries(sne.map(t=>[t,`${ti()}/icons/icon/0_merged.svg#${t}`])),translations:Object.fromEntries(Tc.map(t=>[t.locale,`${ti()}/translations/${t.locale}.json`])),embedIcons:Object.fromEntries(sv.map(t=>[t.type,`${ti()}/embed-icons/${t.type}.png`]))};function ane(t){return t?{fonts:Object.assign({...Ya.fonts},{...t==null?void 0:t.fonts}),icons:Object.assign({...Ya.icons},{...t==null?void 0:t.icons}),embedIcons:Object.assign({...Ya.embedIcons},{...t==null?void 0:t.embedIcons}),translations:Object.assign({...Ya.translations},{...t==null?void 0:t.translations})}:Ya}function cne(){const{addToast:t,removeToast:e,clearToasts:n}=to(),{addDialog:r,clearDialogs:o,removeDialog:i}=cs(),a=Sn()<wt.TABLET_SM,c=Ae();return ce(()=>({addToast:t,removeToast:e,clearToasts:n,addDialog:r,removeDialog:i,clearDialogs:o,msg:c,isMobile:a}),[r,t,o,n,c,i,e,a])}function lne(t,e){const n={};for(const r of t)if(r.translations)for(const[o,i]of Dn(r.translations)){let s=n[o];s||(s=n[o]={}),Object.assign(s,i)}return{actions:(r,o)=>{for(const i of t)i.actions&&(o=i.actions(r,o,e));return o},tools:(r,o,i)=>{for(const s of t)s.tools&&(o=s.tools(r,o,{...e,...i}));return o},translations:n}}function nD(t){return ce(()=>t,t)}function dne(t){const e=nD(t==null?[]:Array.isArray(t)?t:[t]);return ce(()=>{const n={};for(const r of e)if(r.translations)for(const[o,i]of Dn(r.translations)){let s=n[o];s||(s=n[o]={}),Object.assign(s,i)}return n},[e])}function une(t){const e=cne(),n=nD(t==null?[]:Array.isArray(t)?t:[t]);return ce(()=>lne(n,e),[n,e])}var Gv="Popover",[rD,jae]=as(Gv,[np]),fl=np(),[hne,_i]=rD(Gv),oD=t=>{const{__scopePopover:e,children:n,open:r,defaultOpen:o,onOpenChange:i,modal:s=!1}=t,a=fl(e),c=B(null),[l,d]=Q(!1),[h=!1,p]=bi({prop:r,defaultProp:o,onChange:i});return u(Sv,{...a,children:u(hne,{scope:e,contentId:Co(),triggerRef:c,open:h,onOpenChange:p,onOpenToggle:V(()=>p(f=>!f),[p]),hasCustomAnchor:l,onCustomAnchorAdd:V(()=>d(!0),[]),onCustomAnchorRemove:V(()=>d(!1),[]),modal:s,children:n})})};oD.displayName=Gv;var iD="PopoverAnchor",pne=X((t,e)=>{const{__scopePopover:n,...r}=t,o=_i(iD,n),i=fl(n),{onCustomAnchorAdd:s,onCustomAnchorRemove:a}=o;return q(()=>(s(),()=>a()),[s,a]),u(vv,{...i,...r,ref:e})});pne.displayName=iD;var sD="PopoverTrigger",aD=X((t,e)=>{const{__scopePopover:n,...r}=t,o=_i(sD,n),i=fl(n),s=st(e,o.triggerRef),a=u(Le.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":hD(o.open),...r,ref:s,onClick:se(t.onClick,o.onOpenToggle)});return o.hasCustomAnchor?a:u(vv,{asChild:!0,...i,children:a})});aD.displayName=sD;var Vv="PopoverPortal",[fne,gne]=rD(Vv,{forceMount:void 0}),cD=t=>{const{__scopePopover:e,forceMount:n,children:r,container:o}=t,i=_i(Vv,e);return u(fne,{scope:e,forceMount:n,children:u(Mr,{present:n||i.open,children:u(ll,{asChild:!0,container:o,children:r})})})};cD.displayName=Vv;var ra="PopoverContent",lD=X((t,e)=>{const n=gne(ra,t.__scopePopover),{forceMount:r=n.forceMount,...o}=t,i=_i(ra,t.__scopePopover);return u(Mr,{present:r||i.open,children:i.modal?u(mne,{...o,ref:e}):u(yne,{...o,ref:e})})});lD.displayName=ra;var mne=X((t,e)=>{const n=_i(ra,t.__scopePopover),r=B(null),o=st(e,r),i=B(!1);return q(()=>{const s=r.current;if(s)return XS(s)},[]),u(Kh,{as:Yi,allowPinchZoom:!0,children:u(dD,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:se(t.onCloseAutoFocus,s=>{var a;s.preventDefault(),i.current||(a=n.triggerRef.current)==null||a.focus()}),onPointerDownOutside:se(t.onPointerDownOutside,s=>{const a=s.detail.originalEvent,c=a.button===0&&a.ctrlKey===!0,l=a.button===2||c;i.current=l},{checkForDefaultPrevented:!1}),onFocusOutside:se(t.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1})})})}),yne=X((t,e)=>{const n=_i(ra,t.__scopePopover),r=B(!1),o=B(!1);return u(dD,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{var s,a;(s=t.onCloseAutoFocus)==null||s.call(t,i),i.defaultPrevented||(r.current||(a=n.triggerRef.current)==null||a.focus(),i.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:i=>{var c,l;(c=t.onInteractOutside)==null||c.call(t,i),i.defaultPrevented||(r.current=!0,i.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const s=i.target;((l=n.triggerRef.current)==null?void 0:l.contains(s))&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&o.current&&i.preventDefault()}})}),dD=X((t,e)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:s,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:l,onInteractOutside:d,...h}=t,p=_i(ra,n),f=fl(n);return YS(),u(Hh,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:i,children:u(cl,{asChild:!0,disableOutsidePointerEvents:s,onInteractOutside:d,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:l,onDismiss:()=>p.onOpenChange(!1),children:u(mM,{"data-state":hD(p.open),role:"dialog",id:p.contentId,...f,...h,ref:e,style:{...h.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),uD="PopoverClose",Sne=X((t,e)=>{const{__scopePopover:n,...r}=t,o=_i(uD,n);return u(Le.button,{type:"button",...r,ref:e,onClick:se(t.onClick,()=>o.onOpenChange(!1))})});Sne.displayName=uD;var vne="PopoverArrow",bne=X((t,e)=>{const{__scopePopover:n,...r}=t,o=fl(n);return u(yM,{...o,...r,ref:e})});bne.displayName=vne;function hD(t){return t?"open":"closed"}var Yv=oD,Xv=aD,qv=cD,Zv=lD;function Jv({id:t,children:e,onOpenChange:n,open:r}){const[o,i]=Fo(t,n);return u(Yv,{onOpenChange:i,open:r||o,children:u("div",{className:"tlui-popover",children:e})})}function Qv({children:t}){return u(Xv,{asChild:!0,dir:"ltr",children:t})}function eb({side:t,children:e,align:n="center",sideOffset:r=8,alignOffset:o=0,disableEscapeKeyDown:i=!1}){const s=At();return u(qv,{container:s,children:u(Zv,{className:"tlui-popover__content",side:t,sideOffset:r,align:n,alignOffset:o,dir:"ltr",onEscapeKeyDown:a=>i&&a.preventDefault(),children:e})})}function wne(t){return t.getSelectedShapeIds().map(r=>t.getShape(r)).filter(r=>{if(!r)return!1;if(t.isShapeOfType(r,"arrow")){const o=En(t,r);if(o.start||o.end)return!1}return!0})}const pD=()=>{const t=F();return U("threeStackableItems",()=>wne(t).length>2,[t])},zo=()=>{const t=F();return U("isInSelectState",()=>t.isIn("select"),[t])},fD=()=>{const t=F();return U("allow group",()=>{const e=t.getSelectedShapes();if(e.length<2)return!1;for(const n of e)if(t.isShapeOfType(n,"arrow")){const r=En(t,n);if(r.start&&!e.some(o=>o.id===r.start.toId)||r.end&&!e.some(o=>o.id===r.end.toId))return!1}return!0},[t])},gD=()=>{const t=F();return U("allowUngroup",()=>t.getSelectedShapeIds().some(e=>{var n;return((n=t.getShape(e))==null?void 0:n.type)==="group"}),[t])},_ne=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function mD(t,e){const n=F();return U("selectedShapes",()=>n.getSelectedShapes().length>=t,[n,t,e])}function vn(t,e){const n=F();return U("selectedShapes",()=>{const r=n.getSelectedShapes().filter(o=>!n.isShapeOrAncestorLocked(o)).length;return t===void 0?r:r>=t},[n])}function xne(){const t=F();return U("showAutoSizeToggle",()=>{const e=t.getSelectedShapes();return e.length===1&&t.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[t])}function yD(){const t=F();return U("hasLinkShapeSelected",()=>{const e=t.getOnlySelectedShape();return!!(e&&e.type!=="embed"&&"url"in e.props&&!e.isLocked)},[t])}function Pne(){const t=F();return U("onlyFlippableShape",()=>{const e=t.getOnlySelectedShape();return e&&(t.isShapeOfType(e,"group")||t.isShapeOfType(e,"image")||t.isShapeOfType(e,"arrow")||t.isShapeOfType(e,"line")||t.isShapeOfType(e,"draw"))},[t])}function SD(){const t=F();return U("useCanRedo",()=>t.getCanRedo(),[t])}function vD(){const t=F();return U("useCanUndo",()=>t.getCanUndo(),[t])}function Ine(){return u(Z,{children:[u(Cne,{}),u(Ene,{}),u(Tne,{}),u(kne,{}),u(Mne,{}),u(Dne,{}),u($ne,{}),u(Rne,{})]})}function Cne(){const t=vn(2),e=zo(),n=t&&e;return u(Z,{children:[u(H,{actionId:"align-left",disabled:!n}),u(H,{actionId:"align-center-horizontal",disabled:!n}),u(H,{actionId:"align-right",disabled:!n}),u(H,{actionId:"stretch-horizontal",disabled:!n}),u(H,{actionId:"align-top",disabled:!n}),u(H,{actionId:"align-center-vertical",disabled:!n}),u(H,{actionId:"align-bottom",disabled:!n}),u(H,{actionId:"stretch-vertical",disabled:!n})]})}function Ene(){const t=vn(3),e=zo(),n=t&&e;return u(Z,{children:[u(H,{actionId:"distribute-horizontal",disabled:!n}),u(H,{actionId:"distribute-vertical",disabled:!n})]})}function Tne(){const t=pD(),e=zo(),n=t&&e;return u(Z,{children:[u(H,{actionId:"stack-horizontal",disabled:!n}),u(H,{actionId:"stack-vertical",disabled:!n})]})}function kne(){const t=vn(1),e=zo(),n=t&&e;return u(Z,{children:[u(H,{actionId:"send-to-back",disabled:!n}),u(H,{actionId:"send-backward",disabled:!n}),u(H,{actionId:"bring-forward",disabled:!n}),u(H,{actionId:"bring-to-front",disabled:!n})]})}function Mne(){return Sn()<wt.TABLET_SM?u(Ane,{}):u(One,{})}function Ane(){const t=F(),e=U("zoom is 1",()=>t.getZoomLevel()===1,[t]);return u(H,{actionId:"zoom-to-100",disabled:e})}function One(){const t=vn(1),e=zo();return u(H,{actionId:"rotate-ccw",disabled:!(t&&e)})}function Dne(){const t=vn(1),e=zo();return u(H,{actionId:"rotate-cw",disabled:!(t&&e)})}function $ne(){const t=yD(),e=zo();return u(H,{actionId:"edit-link",disabled:!(t&&e)})}function Rne(){const t=fD(),e=gD();return t?u(P_,{}):e?u(Lne,{}):u(P_,{})}function P_(){const t=vn(2),e=zo();return u(H,{actionId:"group",disabled:!(t&&e)})}function Lne(){return u(H,{actionId:"ungroup"})}const Nne=$e(function({children:e}){const n=Ae(),r=Sn(),o=No(),i=B(null);vi(i);const s=F(),a=U("should display quick actions when in readonly",()=>s.isInAny("hand","zoom"),[s]),c=e??u(Ine,{});if(!(o&&!a))return u(Jv,{id:"actions-menu",children:[u(Qv,{children:u(ue,{type:"icon","data-testid":"actions-menu.button",title:n("actions-menu.title"),children:u(ke,{icon:"dots-vertical",small:!0})})}),u(eb,{side:r>=wt.TABLET?"bottom":"top",sideOffset:6,children:u("div",{ref:i,className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:u(lr,{type:"icons",sourceId:"actions-menu",children:c})})})]})});function xe({id:t,label:e,children:n}){const{type:r,sourceId:o}=ap(),i=Ae(),s=Ac(e,r),a=s?i(s):void 0;switch(r){case"panel":return u("div",{className:"tlui-menu__group","data-testid":`${o}-group.${t}`,children:n});case"menu":return u(oQ,{"data-testid":`${o}-group.${t}`,children:n});case"context-menu":return u(mA,{dir:"ltr",className:"tlui-menu__group","data-testid":`${o}-group.${t}`,children:n});case"keyboard-shortcuts":return u("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${o}-group.${t}`,children:[u("h2",{className:"tlui-shortcuts-dialog__group__title",children:a}),u("div",{className:"tlui-shortcuts-dialog__group__content",children:n})]});default:return n}}function Nn({id:t,disabled:e=!1,label:n,size:r="small",children:o}){const{type:i,sourceId:s}=ap(),a=At(),c=Ae(),l=n?typeof n=="string"?n:n[i]??n.default:void 0,d=l?c(l):void 0;switch(i){case"menu":return u(tQ,{id:`${s}-sub.${t}`,children:[u(nQ,{id:`${s}-sub.${d?d.toLowerCase()+"-button":""}`,disabled:e,label:d,title:d}),u(rQ,{id:`${s}-sub.${d?d.toLowerCase()+"-content":""}`,size:r,children:o})]});case"context-menu":return e?null:u(Fne,{id:`${s}-sub.${t}`,children:[u(bA,{dir:"ltr",disabled:e,asChild:!0,children:u(ue,{"data-testid":`${s}-sub-trigger.${t}`,type:"menu",className:"tlui-menu__submenu__trigger",children:[u(It,{children:d}),u(ke,{icon:"chevron-right",small:!0})]})}),u(kv,{container:a,children:u(wA,{"data-testid":`${s}-sub-content.${t}`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":r,children:o})})]});default:return o}}function Fne({id:t,children:e}){const[n,r]=Fo(t);return u(vA,{open:n,onOpenChange:r,children:e})}function bD(){return xne()?u(H,{actionId:"toggle-auto-size"}):null}function wD(){return yD()?u(H,{actionId:"edit-link"}):null}function zne(){return vn(1)?u(H,{actionId:"duplicate"}):null}function _D(){const t=F();return U("should display flatten option",()=>{if(t.getSelectedShapeIds().length===0)return!1;const r=t.getOnlySelectedShape();return!(r&&t.isShapeOfType(r,"image"))},[t])?u(H,{actionId:"flatten-to-image"}):null}function xD(){return fD()?u(H,{actionId:"group"}):null}function PD(){return gD()?u(H,{actionId:"ungroup"}):null}function ID(){const t=F();return U("allow unframe",()=>{const n=t.getSelectedShapes();return n.length===0?!1:n.every(r=>t.isShapeOfType(r,"frame"))},[t])?u(H,{actionId:"remove-frame"}):null}function CD(){const t=F();return U("allow fit frame to content",()=>{const n=t.getOnlySelectedShape();return n?t.isShapeOfType(n,"frame")&&t.getSortedChildIdsForParent(n).length>0:!1},[t])?u(H,{actionId:"fit-frame-to-content"}):null}function ED(){const t=F();return U("selected shapes",()=>t.getSelectedShapes().length>0,[t])?u(H,{actionId:"toggle-lock"}):null}function tb(){const t=F(),e=U("isTransparentBg",()=>!t.getInstanceState().exportBackground,[t]);return u(Or,{actionId:"toggle-transparent",checked:e,toggle:!0})}function Bne(){const t=F(),e=U("any shapes",()=>t.getCurrentPageShapeIds().size>0,[t]);return u(H,{actionId:"unlock-all",disabled:!e})}function TD(){const t=F(),e=U("zoomed to 100",()=>t.getZoomLevel()===1,[t]);return u(H,{actionId:"zoom-to-100",noClose:!0,disabled:e})}function kD(){const t=F(),e=U("has shapes",()=>t.getCurrentPageShapeIds().size>0,[t]);return u(H,{actionId:"zoom-to-fit",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function MD(){const t=F(),e=U("has shapes",()=>t.getSelectedShapeIds().length>0,[t]);return u(H,{actionId:"zoom-to-selection",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function AD(){return u(xe,{id:"clipboard",children:[u(Hne,{}),u(jne,{}),u(Kne,{}),u(zne,{}),u(Wne,{})]})}function Une(){var n;const t=F(),e=U("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t]);return u(Nn,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!e,children:[u(xe,{id:"copy-as-group",children:[u(H,{actionId:"copy-as-svg"}),!!((n=window.navigator.clipboard)!=null&&n.write)&&u(H,{actionId:"copy-as-png"}),u(H,{actionId:"copy-as-json"})]}),u(xe,{id:"copy-as-bg",children:u(tb,{})})]})}function Hne(){const t=vn(1);return u(H,{actionId:"cut",disabled:!t})}function jne(){const t=mD(1);return u(H,{actionId:"copy",disabled:!t})}function Kne(){return u(H,{actionId:"paste",disabled:!_ne})}function OD(){const t=F();return U("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t])?u(xe,{id:"conversions",children:[u(Une,{}),u(Nn,{id:"export-as",label:"context-menu.export-as",size:"small",children:[u(xe,{id:"export-as-group",children:[u(H,{actionId:"export-as-svg"}),u(H,{actionId:"export-as-png"}),u(H,{actionId:"export-as-json"})]}),u(xe,{id:"export-as-bg",children:u(tb,{})})]})]}):null}function DD(){const t=F(),e=U("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t]);return u(H,{actionId:"select-all",disabled:!e})}function Wne(){const t=vn(1);return u(H,{actionId:"delete",disabled:!t})}function Gne(){return mD(1)?u(Nn,{id:"edit",label:"context-menu.edit",size:"small",children:[u(xD,{}),u(PD,{}),u(_D,{}),u(wD,{}),u(CD,{}),u(ID,{}),u(RD,{}),u($D,{}),u(bD,{}),u(ED,{})]}):null}function Vne(){const t=vn(2),e=Pne();return t||e?u(Nn,{id:"arrange",label:"context-menu.arrange",size:"small",children:[t&&u(xe,{id:"align",children:[u(H,{actionId:"align-left"}),u(H,{actionId:"align-center-horizontal"}),u(H,{actionId:"align-right"}),u(H,{actionId:"align-top"}),u(H,{actionId:"align-center-vertical"}),u(H,{actionId:"align-bottom"})]}),u(Yne,{}),t&&u(xe,{id:"stretch",children:[u(H,{actionId:"stretch-horizontal"}),u(H,{actionId:"stretch-vertical"})]}),(t||e)&&u(xe,{id:"flip",children:[u(H,{actionId:"flip-horizontal"}),u(H,{actionId:"flip-vertical"})]}),u(Xne,{})]}):null}function Yne(){return vn(3)?u(xe,{id:"distribute",children:[u(H,{actionId:"distribute-horizontal"}),u(H,{actionId:"distribute-vertical"})]}):null}function Xne(){const t=vn(2),e=pD();return t?u(xe,{id:"order",children:[u(H,{actionId:"pack"}),e&&u(H,{actionId:"stack-horizontal"}),e&&u(H,{actionId:"stack-vertical"})]}):null}function qne(){return vn(1)?u(Nn,{id:"reorder",label:"context-menu.reorder",size:"small",children:u(xe,{id:"reorder",children:[u(H,{actionId:"bring-to-front"}),u(H,{actionId:"bring-forward"}),u(H,{actionId:"send-backward"}),u(H,{actionId:"send-to-back"})]})}):null}function Zne(){const t=F(),e=U("pages",()=>t.getPages(),[t]),n=U("current page id",()=>t.getCurrentPageId(),[t]),{addToast:r}=to(),o=Xt();return vn(1)?u(Nn,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[u(xe,{id:"pages",children:e.map(s=>u(jt,{id:s.id,disabled:n===s.id,label:s.name,onSelect:()=>{t.markHistoryStoppingPoint("move_shapes_to_page"),t.moveShapesToPage(t.getSelectedShapeIds(),s.id);const a=t.getPage(s.id);a&&r({title:"Changed Page",description:`Moved to ${a.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{t.markHistoryStoppingPoint("change-page"),t.setCurrentPage(n)}}]}),o("move-to-page",{source:"context-menu"})}},s.id))}),u(xe,{id:"new-page",children:u(H,{actionId:"move-to-new-page"})})]}):null}function $D(){const t=F();return U("oneEmbedSelected",()=>{const n=t.getOnlySelectedShape();return n?!!(t.isShapeOfType(n,"embed")&&n.props.url&&!t.isShapeOrAncestorLocked(n)):!1},[t])?u(H,{actionId:"convert-to-bookmark"}):null}function RD(){const t=F(),e=av();return U("oneEmbeddableBookmarkSelected",()=>{const r=t.getOnlySelectedShape();return r?!!(t.isShapeOfType(r,"bookmark")&&r.props.url&&e(r.props.url)&&!t.isShapeOrAncestorLocked(r)):!1},[t])?u(H,{actionId:"convert-to-embed"}):null}function Jne(){const t=F(),e=U("isSnapMode",()=>t.user.getIsSnapMode(),[t]);return u(Or,{actionId:"toggle-snap-mode",checked:e})}function Qne(){const t=F(),e=U("isToolLock",()=>t.getInstanceState().isToolLocked,[t]);return u(Or,{actionId:"toggle-tool-lock",checked:e})}function ere(){const t=F(),e=U("isGridMode",()=>t.getInstanceState().isGridMode,[t]);return u(Or,{actionId:"toggle-grid",checked:e})}function tre(){const t=F(),e=U("isWrapMode",()=>t.user.getIsWrapMode(),[t]);return u(Or,{actionId:"toggle-wrap-mode",checked:e})}function nre(){const t=F(),e=U("isFocusMode",()=>t.getInstanceState().isFocusMode,[t]);return u(Or,{actionId:"toggle-focus-mode",checked:e})}function rre(){const t=F(),e=U("edgeScrollSpeed",()=>t.user.getEdgeScrollSpeed(),[t]);return u(Or,{actionId:"toggle-edge-scrolling",checked:e===1})}function ore(){const t=F(),e=U("animationSpeed",()=>t.user.getAnimationSpeed(),[t]);return u(Or,{actionId:"toggle-reduce-motion",checked:e===0})}function ire(){const t=F(),e=U("isDebugMode",()=>t.getInstanceState().isDebugMode,[t]);return u(Or,{actionId:"toggle-debug-mode",checked:e})}function sre(){const t=F(),e=U("dynamic resize",()=>t.user.getIsDynamicResizeMode(),[t]);return u(Or,{actionId:"toggle-dynamic-size-mode",checked:e})}function are(){const t=F(),e=U("paste at cursor",()=>t.user.getIsPasteAtCursorMode(),[t]);return u(Or,{actionId:"toggle-paste-at-cursor",checked:e})}function cre(){const t=F();return U("show cursor chat",()=>t.getCurrentToolId()==="select"&&!t.getInstanceState().isCoarsePointer,[t])?u(H,{actionId:"open-cursor-chat"}):null}function lre(){const t=F(),e=Jh(),n=U("isSelectToolActive",()=>t.getCurrentToolId()==="select",[t]),r=U("isSinglePageMode",()=>t.options.maxPages<=1,[t]);return n?u(Z,{children:[e&&u(cre,{}),u(xe,{id:"modify",children:[u(Gne,{}),u(Vne,{}),u(qne,{}),!r&&u(Zne,{})]}),u(AD,{}),u(OD,{}),u(xe,{id:"select-all",children:u(DD,{})})]}):null}const dre=$e(function({children:e,disabled:n=!1}){const r=F(),{Canvas:o}=ht(),i=V(d=>{if(d){if(r.getInstanceState().isCoarsePointer){const h=r.getSelectedShapes(),{inputs:{currentPagePoint:p}}=r,f=r.getShapesAtPoint(p);if(!r.getSelectedShapes().length||!f.some(g=>h.includes(g))){const g=f.filter(m=>r.isShapeOrAncestorLocked(m));g.length&&r.select(...g.map(m=>m.id))}}}else{const h=r.getOnlySelectedShape();h&&r.isShapeOrAncestorLocked(h)&&r.setSelectedShapes([])}},[r]),s=At(),[a,c]=Fo("context menu",i);return u(vJ,{dir:"ltr",onOpenChange:c,modal:!1,children:[u(bJ,{onContextMenu:void 0,dir:"ltr",disabled:n,children:o?u(o,{}):null}),a&&u(wJ,{container:s,children:u(_J,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:Ce,children:u(lr,{type:"context-menu",sourceId:"context-menu",children:e??u(lre,{})})})})]})}),ure=2e3,hre=5e3,pre=Nt(function(){const e=F(),{isChatting:n,chatMessage:r}=e.getInstanceState(),o=B(-1),[i,s]=Q("");return q(()=>{if(!n&&r||n){const c=n?hre:ure;o.current=e.timers.setTimeout(()=>{e.updateInstanceState({chatMessage:"",isChatting:!1}),s(""),e.focus()},c)}return()=>{clearTimeout(o.current)}},[e,r,n]),n?u(gre,{value:i,setValue:s,chatMessage:r}):r.trim()?u(fre,{chatMessage:r}):null});function LD(t){const e=F();je(()=>{var s;if(!t.current)return;const{x:r,y:o}=e.inputs.currentScreenPoint;(s=t.current)==null||s.style.setProperty("transform",`translate(${r}px, ${o}px)`);function i(a){var d;const{minX:c,minY:l}=e.getViewportScreenBounds();(d=t.current)==null||d.style.setProperty("transform",`translate(${a.clientX-c}px, ${a.clientY-l}px)`)}return window.addEventListener("pointermove",i),()=>{window.removeEventListener("pointermove",i)}},[t,e])}const fre=({chatMessage:t})=>{const e=F(),n=B(null);return LD(n),u("div",{ref:n,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:e.user.getColor()},children:t})},gre=Nt(function({chatMessage:e,value:n,setValue:r}){const o=F(),i=Ae(),s=B(null),a=e||i("cursor-chat.type-to-chat");LD(s),je(()=>{const p=s.current;if(!p)return;const f=o.textMeasure.measureText(n||a,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});p.style.setProperty("width",f.w+"px")},[o,n,a]),je(()=>{const p=o.timers.requestAnimationFrame(()=>{var f;(f=s.current)==null||f.focus()});return()=>{cancelAnimationFrame(p)}},[o]);const c=V(()=>{o.updateInstanceState({isChatting:!1}),o.focus()},[o]),l=V(p=>{const{value:f}=p.target;r(f.slice(0,64)),o.updateInstanceState({chatMessage:f})},[o,r]),d=V(p=>{const f=s.current;if(!f)return;const{value:g}=f;switch(p.key){case"Enter":{if(Ce(p),p.stopPropagation(),!g){c();return}r("");break}case"Escape":{Ce(p),p.stopPropagation(),c();break}}},[c,r]),h=V(p=>{p.stopPropagation()},[]);return u("input",{ref:s,className:"tl-cursor-chat",style:{backgroundColor:o.user.getColor()},onBlur:c,onChange:l,onKeyDown:d,onPaste:h,value:n,placeholder:a,spellCheck:!1})});function ry({checked:t}){return u(Xr,{icon:t?"check":"none",className:"tlui-button__icon",small:!0})}function mre(){const t=F(),{addToast:e}=to(),{addDialog:n}=cs(),[r,o]=we.useState(!1);return u(Z,{children:[u(xe,{id:"items",children:[u(jt,{id:"add-toast",onSelect:()=>{e({id:Ye(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),e({id:Ye(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:Ye(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:Ye(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),u(jt,{id:"show-dialog",label:"Show dialog",onSelect:()=>{n({component:({onClose:i})=>u(vre,{displayDontShowAgain:!0,onCancel:()=>i(),onContinue:()=>i()}),onClose:()=>{}})}}),u(jt,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>bre(t,100)}),u(jt,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{var a;const i=t.getSelectedShapes(),s=i.length===0?t.getRenderingShapes():i;window.alert(`Shapes ${s.length}, DOM nodes:${(a=document.querySelector(".tl-shapes").querySelectorAll("*"))==null?void 0:a.length}`)}}),(()=>{if(r)throw Error("oh no!");return null})(),u(jt,{id:"throw-error",onSelect:()=>o(!0),label:"Throw error"}),u(jt,{id:"hard-reset",onSelect:vC,label:"Hard reset"})]}),u(xe,{id:"flags",children:[u(yre,{}),u(Sre,{})]})]})}function yre(){const t=Object.values(Pt);return t.length?u(Nn,{id:"debug flags",label:"Debug Flags",children:u(xe,{id:"debug flags",children:t.map(e=>u(ND,{flag:e},e.name))})}):null}function Sre(){const t=Object.values(x7);return t.length?u(Nn,{id:"feature flags",label:"Feature Flags",children:u(xe,{id:"feature flags",children:t.map(e=>u(ND,{flag:e},e.name))})}):null}function vre({title:t="title",body:e="hello hello hello",cancel:n="Cancel",confirm:r="Continue",displayDontShowAgain:o=!1,onCancel:i,onContinue:s}){const[a,c]=we.useState(!1);return u(Z,{children:[u(Yh,{children:[u(Xh,{children:t}),u(qh,{})]}),u(Mc,{style:{maxWidth:350},children:e}),u(iv,{className:"tlui-dialog__footer__actions",children:[o&&u(ue,{type:"normal",onClick:()=>c(!a),style:{marginRight:"auto"},children:[u(ry,{checked:a}),u(It,{children:"Don’t show again"})]}),u(ue,{type:"normal",onClick:i,children:u(It,{children:n})}),u(ue,{type:"primary",onClick:async()=>s(),children:u(It,{children:r})})]})]})}const ND=Nt(function({flag:e,onChange:n}){const r=e.get();return u(cp,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,o=>`${o[0]} ${o[1].toLowerCase()}`).replace(/^[a-z]/,o=>o.toUpperCase()),checked:r,onSelect:()=>{e.set(!r),n==null||n(!r)}})});let I_=0;function bre(t,e){const n=Array(e),r=Math.floor(Math.sqrt(e));for(let o=0;o<e;o++)I_++,n[o]={id:Xe("box"+I_),type:"geo",x:o%r*132,y:Math.floor(o/r)*132};t.run(()=>{t.createShapes(n).setSelectedShapes(n.map(o=>o.id))})}function wre({children:t}){return u(Zi,{id:"debug",children:[u(Ji,{children:u(ue,{type:"icon",title:"Debug menu",children:u(ke,{icon:"dots-horizontal"})})}),u(Qi,{side:"top",align:"end",alignOffset:0,children:u(lr,{type:"menu",sourceId:"debug-panel",children:t??u(mre,{})})})]})}const _re=$e(function(){const{DebugMenu:e}=xi(),n=B(null);return vi(n),u("div",{ref:n,className:"tlui-debug-panel",children:[u(Pre,{}),u(Ire,{}),e&&u(e,{})]})});function xre(t=!0){const[e,n]=Q(0),r=F();q(()=>{if(!t)return;const o=()=>n(i=>i+1);return r.on("tick",o),()=>{r.off("tick",o)}},[r,t])}const Pre=Nt(function(){xre();const e=F(),n=e.getPath(),r=e.getHoveredShape(),o=e.getOnlySelectedShape(),i=n==="select.idle"||!n.includes("select.")?r:o,s=i&&n.includes("select.")?` / ${i.type||""}${"geo"in i.props?" / "+i.props.geo:""} / [${b.ToInt(e.getPointInShapeSpace(i,e.inputs.currentPagePoint))}]`:"",a=n.startsWith("select.")&&!n.includes(".idle")?` / [${b.ToInt(e.inputs.originPagePoint)}] → [${b.ToInt(e.inputs.currentPagePoint)}] = ${b.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return u("div",{className:"tlui-debug-panel__current-state",children:`${n}${s}${a}`})});function Ire(){const t=F(),e=U("show_fps",()=>Pt.showFps.get(),[Pt]),n=B(null);return q(()=>{if(!e)return;const r=250;let o=0,i=-1,s=performance.now(),a=0,c=0,l=!1;function d(){if(c++,a=performance.now()-s,a>r){const h=Math.round(c*(r/a)*(1e3/r));h>o&&(o=h);const p=o*.75;(h<p&&!l||h>=p&&l)&&(l=!l),n.current.innerHTML=`FPS ${h.toString()}`,n.current.className="tlui-debug-panel__fps"+(l?" tlui-debug-panel__fps__slow":""),a-=r,c=0,s=performance.now()}i=t.timers.requestAnimationFrame(d)}return d(),()=>{cancelAnimationFrame(i)}},[e,t]),e?u("div",{ref:n}):null}const Cre=$e(function(){const e=Sn(),n=B(null);vi(n);const{MainMenu:r,QuickActions:o,ActionsMenu:i,PageMenu:s}=xi(),a=F(),c=U("isSinglePageMode",()=>a.options.maxPages<=1,[a]),l=a.options.actionShortcutsLocation==="menu"?!0:a.options.actionShortcutsLocation==="toolbar"?!1:e>=wt.TABLET;return!r&&!s&&!l?null:u("div",{ref:n,className:"tlui-menu-zone",children:u("div",{className:"tlui-buttons__horizontal",children:[r&&u(r,{}),s&&!c&&u(s,{}),l?u(Z,{children:[o&&u(o,{}),i&&u(i,{})]}):null]})})});function Ere(){const t=F(),e=ls(),[n,r]=Q(!1),o=B(!1);return ri("toggle showback to content",()=>{const i=o.current,s=t.getCurrentPageShapeIds();let a=!1;s.size&&(a=s.size===t.getCulledShapes().size),i!==a&&(r(a),o.current=a)},[t]),n?u(H,{actionId:"back-to-content",onSelect:()=>{e["back-to-content"].onSelect("helper-buttons"),r(!1)}}):null}function Tre(){const t=F();return U("is pen mode",()=>t.getInstanceState().isPenMode,[t])?u(H,{actionId:"exit-pen-mode"}):null}function kre(){const t=F(),e=ls();return U("is following user",()=>!!t.getInstanceState().followingUserId,[t])?u(jt,{...e["stop-following"]}):null}function Mre(){return u(Z,{children:[u(Tre,{}),u(Ere,{}),u(kre,{})]})}function Are({children:t}){return u("div",{className:"tlui-helper-buttons",children:u(lr,{type:"helper-buttons",sourceId:"helper-buttons",children:t??u(Mre,{})})})}function Ore(){const t=Jh();return u(Z,{children:[u(xe,{label:"shortcuts-dialog.tools",id:"tools",children:[u(H,{actionId:"toggle-tool-lock"}),u(H,{actionId:"insert-media"}),u(xn,{toolId:"select"}),u(xn,{toolId:"draw"}),u(xn,{toolId:"eraser"}),u(xn,{toolId:"hand"}),u(xn,{toolId:"rectangle"}),u(xn,{toolId:"ellipse"}),u(xn,{toolId:"arrow"}),u(xn,{toolId:"line"}),u(xn,{toolId:"text"}),u(xn,{toolId:"frame"}),u(xn,{toolId:"note"}),u(xn,{toolId:"laser"}),u(jt,{id:"pointer-down",label:"tool.pointer-down",kbd:",",onSelect:()=>{}})]}),u(xe,{label:"shortcuts-dialog.preferences",id:"preferences",children:[u(H,{actionId:"toggle-dark-mode"}),u(H,{actionId:"toggle-focus-mode"}),u(H,{actionId:"toggle-grid"})]}),u(xe,{label:"shortcuts-dialog.edit",id:"edit",children:[u(H,{actionId:"undo"}),u(H,{actionId:"redo"}),u(H,{actionId:"cut"}),u(H,{actionId:"copy"}),u(H,{actionId:"paste"}),u(H,{actionId:"select-all"}),u(H,{actionId:"delete"}),u(H,{actionId:"duplicate"})]}),u(xe,{label:"shortcuts-dialog.view",id:"view",children:[u(H,{actionId:"zoom-in"}),u(H,{actionId:"zoom-out"}),u(H,{actionId:"zoom-to-100"}),u(H,{actionId:"zoom-to-fit"}),u(H,{actionId:"zoom-to-selection"})]}),u(xe,{label:"shortcuts-dialog.transform",id:"transform",children:[u(H,{actionId:"bring-to-front"}),u(H,{actionId:"bring-forward"}),u(H,{actionId:"send-backward"}),u(H,{actionId:"send-to-back"}),u(H,{actionId:"group"}),u(H,{actionId:"ungroup"}),u(H,{actionId:"flip-horizontal"}),u(H,{actionId:"flip-vertical"}),u(H,{actionId:"align-top"}),u(H,{actionId:"align-center-vertical"}),u(H,{actionId:"align-bottom"}),u(H,{actionId:"align-left"}),u(H,{actionId:"align-center-horizontal"}),u(H,{actionId:"align-right"})]}),t&&u(xe,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:u(H,{actionId:"open-cursor-chat"})})]})}const Dre=$e(function({children:e}){const n=Ae(),r=Sn(),o=e??u(Ore,{});return u(Z,{children:[u(Yh,{className:"tlui-shortcuts-dialog__header",children:[u(Xh,{children:n("shortcuts-dialog.title")}),u(qh,{})]}),u(Mc,{className:de("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":r<=wt.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":r<=wt.TABLET}),children:u(lr,{type:"keyboard-shortcuts",sourceId:"kbd",children:o})}),u("div",{className:"tlui-dialog__scrim"})]})}),$re=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function Rre(){const t=F(),e=Xt(),n=U("colorScheme",()=>t.user.getUserPreferences().colorScheme??(t.user.getIsDarkMode()?"dark":"light"),[t]);return u(Nn,{id:"help menu color-scheme",label:"menu.theme",children:u(xe,{id:"languages",children:$re.map(({colorScheme:r,label:o})=>u(cp,{id:`color-scheme-${r}`,label:o,checked:r===n,onSelect:()=>{t.user.updateUserPreferences({colorScheme:r}),e("color-scheme",{source:"menu",value:r})}},r))})})}function FD(){const t=F(),e=Xt(),n=U("locale",()=>t.user.getLocale(),[t]);return u(Nn,{id:"help menu language",label:"menu.language",children:u(xe,{id:"languages",children:Tc.map(({locale:r,label:o})=>u(cp,{id:`language-${r}`,title:r,label:o,checked:r===n,onSelect:()=>{t.user.updateUserPreferences({locale:r}),e("change-language",{source:"menu",locale:r})}},r))})})}function Lre(){return u(Z,{children:[u(FD,{}),u(zD,{})]})}function zD(){const{KeyboardShortcutsDialog:t}=xi(),{addDialog:e}=cs(),n=V(()=>{t&&e({component:t})},[e,t]);return t?u(jt,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:n}):null}function Nre(){return u(Z,{children:[u(zre,{}),u(jre,{}),u(Fre,{}),u(Kre,{}),u(Wre,{})]})}function Fre(){return u(Nn,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[u(xe,{id:"export-all-as-group",children:[u(H,{actionId:"export-all-as-svg"}),u(H,{actionId:"export-all-as-png"}),u(H,{actionId:"export-all-as-json"})]}),u(xe,{id:"export-all-as-bg",children:u(tb,{})})]})}function zre(){const t=F(),e=U("isSelectToolActive",()=>t.getCurrentToolId()==="select",[t]);return u(Nn,{id:"edit",label:"menu.edit",disabled:!e,children:[u(Hre,{}),u(AD,{}),u(OD,{}),u(Bre,{}),u(Ure,{}),u(xe,{id:"select-all",children:u(DD,{})})]})}function Bre(){return u(xe,{id:"misc",children:[u(xD,{}),u(PD,{}),u(wD,{}),u(bD,{}),u(ID,{}),u(CD,{}),u(RD,{}),u($D,{}),u(_D,{})]})}function Ure(){return u(xe,{id:"lock",children:[u(ED,{}),u(Bne,{})]})}function Hre(){const t=vD(),e=SD();return u(xe,{id:"undo-redo",children:[u(H,{actionId:"undo",disabled:!t}),u(H,{actionId:"redo",disabled:!e})]})}function jre(){return u(Nn,{id:"view",label:"menu.view",children:u(xe,{id:"view-actions",children:[u(H,{actionId:"zoom-in"}),u(H,{actionId:"zoom-out"}),u(TD,{}),u(kD,{}),u(MD,{})]})})}function Kre(){return u(xe,{id:"extras",children:[u(H,{actionId:"insert-embed"}),u(H,{actionId:"insert-media"})]})}function Wre(){return u(xe,{id:"preferences",children:[u(Nn,{id:"preferences",label:"menu.preferences",children:[u(xe,{id:"preferences-actions",children:[u(Jne,{}),u(Qne,{}),u(ere,{}),u(tre,{}),u(nre,{}),u(rre,{}),u(ore,{}),u(sre,{}),u(are,{}),u(ire,{})]}),u(xe,{id:"color-scheme",children:u(Rre,{})})]}),u(FD,{}),u(zD,{})]})}const Gre=$e(function({children:e}){const n=At(),[r,o]=Fo("main menu"),i=Ae(),s=e??u(Nre,{});return u(Av,{dir:"ltr",open:r,onOpenChange:o,modal:!1,children:[u(Ov,{asChild:!0,dir:"ltr",children:u(ue,{type:"icon","data-testid":"main-menu.button",title:i("menu.title"),children:u(ke,{icon:"menu",small:!0})})}),u(sp,{container:n,children:u(Dv,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:u(lr,{type:"menu",sourceId:"main-menu",children:s})})})]})}),eg={};function Xa(t){if(eg[t])return eg[t];const n=document.createElement("canvas").getContext("2d");n.fillStyle=t,n.fillRect(0,0,1,1);const[r,o,i,s]=n.getImageData(0,0,1,1).data,a=new Float32Array([r/255,o/255,i/255,s/255]);return eg[t]=a,a}const Qd=10,BD=4*6*Qd+12+4*12;function Is(t,{center:e,radius:n,numArcSegments:r=20,startAngle:o=0,endAngle:i=Ve,offset:s=0}){const a=(i-o)/r;let c=s;for(let l=o;l<i;l+=a)t[c++]=e.x,t[c++]=e.y,t[c++]=e.x+Math.cos(l)*n,t[c++]=e.y+Math.sin(l)*n,t[c++]=e.x+Math.cos(l+a)*n,t[c++]=e.y+Math.sin(l+a)*n;return t}function Cs(t,e,n,r,o,i){t[e++]=n,t[e++]=r,t[e++]=n,t[e++]=r+i,t[e++]=n+o,t[e++]=r,t[e++]=n+o,t[e++]=r,t[e++]=n,t[e++]=r+i,t[e++]=n+o,t[e++]=r+i}function Vre(t,e,n){const r=Qd;n=Math.min(n,Math.min(e.w,e.h)/2);const o=ee.ExpandBy(e,-n);if(o.w<=0||o.h<=0)return Is(t,{center:e.center,radius:n,numArcSegments:Qd*4}),Qd*4*6;let i=0;return Cs(t,i,o.minX,o.minY,o.w,o.h),i+=12,Cs(t,i,o.minX,e.minY,o.w,n),i+=12,Cs(t,i,o.maxX,o.minY,n,o.h),i+=12,Cs(t,i,o.minX,o.maxY,o.w,n),i+=12,Cs(t,i,e.minX,o.minY,n,o.h),i+=12,Is(t,{numArcSegments:r,offset:i,center:o.point,radius:n,startAngle:ze,endAngle:ze*1.5}),i+=r*6,Is(t,{numArcSegments:r,offset:i,center:b.Add(o.point,new b(o.w,0)),radius:n,startAngle:ze*1.5,endAngle:Ve}),i+=r*6,Is(t,{numArcSegments:r,offset:i,center:b.Add(o.point,o.size),radius:n,startAngle:0,endAngle:it}),i+=r*6,Is(t,{numArcSegments:r,offset:i,center:b.Add(o.point,new b(0,o.h)),radius:n,startAngle:it,endAngle:ze}),BD}function Yre(t){if(!t)throw new Error("Canvas element not found");const e=t.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Failed to get webgl2 context");const n=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,r=e.createShader(e.VERTEX_SHADER);if(!r)throw new Error("Failed to create vertex shader");if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const o=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,i=e.createShader(e.FRAGMENT_SHADER);if(!i)throw new Error("Failed to create fragment shader");if(e.shaderSource(i,o),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const s=e.createProgram();if(!s)throw new Error("Failed to create program");if(e.attachShader(s,r),e.attachShader(s,i),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS))throw new Error("Failed to link program");e.useProgram(s);const a=e.getAttribLocation(s,"shapeVertexPosition");if(a<0)throw new Error("Failed to get shapeVertexPosition attribute location");e.enableVertexAttribArray(a);const c=e.getUniformLocation(s,"canvasPageBounds"),l=e.getUniformLocation(s,"fillColor");if(!e.createBuffer())throw new Error("Failed to create buffer");if(!e.createBuffer())throw new Error("Failed to create buffer");return{context:e,selectedShapes:ud(e,1024),unselectedShapes:ud(e,4096),viewport:ud(e,BD),collaborators:ud(e,1024),prepareTriangles(p,f){e.bindBuffer(e.ARRAY_BUFFER,p.buffer),e.bufferData(e.ARRAY_BUFFER,p.vertices,e.STATIC_DRAW,0,f),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0)},drawTrianglesTransparently(p){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLES,0,p/2),e.disable(e.BLEND)},drawTriangles(p){e.drawArrays(e.TRIANGLES,0,p/2)},setFillColor(p){e.uniform4fv(l,p)},setCanvasPageBounds(p){e.uniform4fv(c,p)}}}function ud(t,e){const n=t.createBuffer();if(!n)throw new Error("Failed to create buffer");return{buffer:n,vertices:new Float32Array(e)}}function C_(t,e,n){let r=t.vertices.length;for(;r<e+n.length;)r*=2;if(r!=t.vertices.length){const o=new Float32Array(r);o.set(t.vertices),t.vertices=o}t.vertices.set(n,e)}var Xre=Object.create,UD=Object.defineProperty,qre=Object.getOwnPropertyDescriptor,Zre=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),HD=t=>{throw TypeError(t)},jD=(t,e,n)=>e in t?UD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Jre=t=>[,,,Xre(null)],KD=["class","method","getter","setter","accessor","field","value","get","set"],WD=t=>t!==void 0&&typeof t!="function"?HD("Function expected"):t,Qre=(t,e,n,r,o)=>({kind:KD[t],name:e,metadata:r,addInitializer:i=>n._?HD("Already initialized"):o.push(WD(i||null))}),eoe=(t,e)=>jD(e,Zre("metadata"),t[3]),toe=(t,e,n,r)=>{for(var o=0,i=t[e>>1],s=i&&i.length;o<s;o++)i[o].call(n);return r},ro=(t,e,n,r,o,i)=>{for(var s,a,c,l,d=e&7,h=!!(e&8),p=!!(e&16),f=2,g=KD[d+5],m=t[f]||(t[f]=[]),y=(o=o.prototype,qre(o,n)),S=r.length-1;S>=0;S--)c=Qre(d,n,a={},t[3],m),c.static=h,c.private=p,l=c.access={has:v=>n in v},l.get=v=>v[n],s=(0,r[S])(y[g],c),a._=1,WD(s)&&(y[g]=s);return y&&UD(o,n,y),o},uo=(t,e,n)=>jD(t,typeof e!="symbol"?e+"":e,n),GD,VD,YD,XD,qD,ZD,JD,QD,e$,t$,Qn;t$=[Tn],e$=[K],QD=[K],JD=[K],ZD=[K],qD=[K],XD=[K],YD=[K],VD=[K],GD=[Tn];class pr{constructor(e,n,r){this.editor=e,this.elem=n,this.container=r,toe(Qn,5,this),uo(this,"disposables",[]),uo(this,"gl"),uo(this,"shapeGeometryCache"),uo(this,"colors"),uo(this,"id",Ye()),uo(this,"canvasBoundingClientRect",Tt("canvasBoundingClientRect",new ee)),uo(this,"originPagePoint",new b),uo(this,"originPageCenter",new b),uo(this,"isInViewport",!1),this.gl=Yre(n),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",o=>{const i=e.getShapeMaskedPageBounds(o.id);if(!i)return null;const s=new Float32Array(12);return Cs(s,0,i.x,i.y,i.w,i.h),s}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),xo("minimap render",this.render))}close(){return this.disposables.forEach(e=>e())}_getColors(){const e=getComputedStyle(this.editor.getContainer());return{shapeFill:Xa(e.getPropertyValue("--color-text-3").trim()),selectFill:Xa(e.getPropertyValue("--color-selected").trim()),viewportFill:Xa(e.getPropertyValue("--color-muted-1").trim()),background:Xa(e.getPropertyValue("--color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const e=this.editor.getViewportPageBounds(),n=this.editor.getCurrentPageBounds();return n?ee.Expand(n,e):e}getContentScreenBounds(){const e=this.getContentPageBounds(),n=this.editor.pageToScreen(e.point),r=this.editor.pageToScreen(new b(e.maxX,e.maxY));return new ee(n.x,n.y,r.x-n.x,r.y-n.y)}_getCanvasBoundingRect(){const{x:e,y:n,width:r,height:o}=this.elem.getBoundingClientRect();return new ee(e,n,r,o)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const e=new ResizeObserver(()=>{const n=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(n)});return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){const e=this.canvasBoundingClientRect.get(),n=this.getDpr();return new b(e.width*n,e.height*n)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const e=this.getCanvasScreenBounds(),n=this.getContentPageBounds(),r=e.width/e.height;let o=n.width,i=o/r;i<n.height&&(i=n.height,o=i*r);const s=new ee(0,0,o,i);return s.center=n.center,s}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:e,y:n,w:r,h:o}=this.getCanvasPageBounds();return new Float32Array([e,n,r,o])}getMinimapPagePoint(e,n){const r=this.getCanvasPageBounds(),o=this.getCanvasScreenBounds();let i=e-o.x,s=n-o.y;return i*=r.width/o.width,s*=r.height/o.height,i+=r.minX,s+=r.minY,new b(i,s,1)}minimapScreenPointToPagePoint(e,n,r=!1,o=!1){const{editor:i}=this,s=i.getViewportPageBounds();let{x:a,y:c}=this.getMinimapPagePoint(e,n);if(o){const l=this.editor.getCurrentPageBounds()??new ee,d=l.minX-s.width/2,h=l.maxX+s.width/2,p=l.minY-s.height/2,f=l.maxY+s.height/2,g=Math.max(0,d+s.width-a),m=Math.max(0,-(h-s.width-a)),y=Math.max(0,p+s.height-c),S=Math.max(0,-(f-s.height-c));a+=(g-m)/2,c+=(y-S)/2,a=Bt(a,d,h),c=Bt(c,p,f)}if(r){const{originPagePoint:l}=this,d=Math.abs(a-l.x),h=Math.abs(c-l.y);d>h?c=l.y:a=l.x}return new b(a,c)}render(){const e=this.gl.context,n=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=n.x,this.elem.height=n.y,e.viewport(0,0,n.x,n.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);const r=new Set(this.editor.getSelectedShapeIds()),o=this.colors;let i=0,s=0;const a=this.editor.getCurrentPageShapeIdsSorted();for(let c=0,l=a.length;c<l;c++){const d=a[c],h=this.shapeGeometryCache.get(d);if(!h)continue;const p=h.length;r.has(d)?(C_(this.gl.selectedShapes,i,h),i+=p):(C_(this.gl.unselectedShapes,s,h),s+=p)}this.drawShapes(this.gl.unselectedShapes,s,o.shapeFill),this.drawShapes(this.gl.selectedShapes,i,o.selectFill),this.drawViewport(),this.drawCollaborators()}drawShapes(e,n,r){this.gl.prepareTriangles(e,n),this.gl.setFillColor(r),this.gl.drawTriangles(n)}drawViewport(){const e=this.editor.getViewportPageBounds(),n=Vre(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,n),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(n),et.isSafari&&(this.gl.drawTrianglesTransparently(n),this.gl.drawTrianglesTransparently(n),this.gl.drawTrianglesTransparently(n))}drawCollaborators(){const e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;const n=20,r=n*6,o=r*e.length;this.gl.collaborators.vertices.length<o&&(this.gl.collaborators.vertices=new Float32Array(o));const i=this.gl.collaborators.vertices;let s=0;const a=this.getZoom();for(const{cursor:c}of e)Is(i,{center:b.From(c),radius:3*a,offset:s,numArcSegments:n}),s+=r;this.gl.prepareTriangles(this.gl.collaborators,o),s=0;for(const{color:c}of e)this.gl.setFillColor(Xa(c)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,s/2,r/2),s+=r}}Qn=Jre();ro(Qn,1,"close",t$,pr);ro(Qn,1,"getDpr",e$,pr);ro(Qn,1,"getContentPageBounds",QD,pr);ro(Qn,1,"getContentScreenBounds",JD,pr);ro(Qn,1,"getCanvasSize",ZD,pr);ro(Qn,1,"getCanvasClientPosition",qD,pr);ro(Qn,1,"getCanvasPageBounds",XD,pr);ro(Qn,1,"getZoom",YD,pr);ro(Qn,1,"getCanvasPageBoundsArray",VD,pr);ro(Qn,1,"render",GD,pr);eoe(Qn,pr);function noe(){const t=F(),e=At(),n=B(null),r=B(!1),o=B();q(()=>{try{const d=new pr(t,n.current,e);return o.current=d,o.current.close}catch(d){t.annotateError(d,{origin:"minimap",willCrashApp:!1}),t.timers.setTimeout(()=>{throw d})}},[t,e]);const i=V(d=>{if(!t.getCurrentPageShapeIds().size||!o.current)return;const h=o.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!1),p=o.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!0);o.current.originPagePoint.setTo(p),o.current.originPageCenter.setTo(t.getViewportPageBounds().center),t.centerOnPoint(h,{animation:{duration:t.options.animationMediumMs}})},[t]),s=V(d=>{if(!o.current)return;const h=d.currentTarget;if(Zc(h,d),!t.getCurrentPageShapeIds().size)return;r.current=!0,o.current.isInViewport=!1;const p=o.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!1),f=t.getViewportPageBounds(),g=o.current.getContentPageBounds();if(new ee(g.x-f.width/2,g.y-f.height/2,g.width+f.width,g.height+f.height).containsPoint(p)&&!f.containsPoint(p)){o.current.isInViewport=f.containsPoint(p);const S=b.Sub(f.center,f.point),v=b.Add(p,S);o.current.originPagePoint.setTo(v),o.current.originPageCenter.setTo(p),t.centerOnPoint(p,{animation:{duration:t.options.animationMediumMs}})}else{const S=o.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!0);o.current.isInViewport=f.containsPoint(S),o.current.originPagePoint.setTo(S),o.current.originPageCenter.setTo(f.center)}function y(S){h&&Jc(h,S),r.current=!1,document.body.removeEventListener("pointerup",y)}document.body.addEventListener("pointerup",y)},[t]),a=V(d=>{if(!o.current)return;const h=o.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,d.shiftKey,!0);if(r.current){if(o.current.isInViewport){const m=o.current.originPagePoint.clone().sub(o.current.originPageCenter);t.centerOnPoint(b.Sub(h,m));return}t.centerOnPoint(h)}const p=o.current.getMinimapPagePoint(d.clientX,d.clientY),f=t.pageToScreen(p),g={type:"pointer",target:"canvas",name:"pointer_move",...Mn(d),point:f,isPen:t.getInstanceState().isPenMode};t.dispatch(g)},[t]),c=V(d=>{const h=aC(d);t.dispatch({type:"wheel",name:"wheel",delta:h,point:new b(d.clientX,d.clientY),shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey,metaKey:d.metaKey,accelKey:rn(d)})},[t]),l=al();return q(()=>{t.timers.setTimeout(()=>{var d,h;(d=o.current)==null||d.updateColors(),(h=o.current)==null||h.render()})},[l,t]),u("div",{className:"tlui-minimap",children:u("canvas",{role:"img","aria-label":"minimap",ref:n,className:"tlui-minimap__canvas",onDoubleClick:i,onPointerMove:a,onPointerDown:s,onWheelCapture:c})})}function roe(t,e){const[n,r]=we.useState(e);we.useLayoutEffect(()=>{const i=Oy(t);if(i)try{r(JSON.parse(i))}catch{console.error(`Could not restore value ${t} from local storage.`)}},[t]);const o=we.useCallback(i=>{r(s=>{const a=typeof i=="function"?i(s):i;return Dy(t,JSON.stringify(a)),a})},[t]);return[n,o]}const ooe=$e(function(){const e=ls(),n=Ae(),r=Sn(),o=B(null);vi(o);const[i,s]=roe("minimap",!0),a=V(()=>{s(d=>!d)},[s]),{ZoomMenu:c,Minimap:l}=xi();return r<wt.MOBILE?null:u("div",{ref:o,className:"tlui-navigation-panel",children:[u("div",{className:"tlui-buttons__horizontal",children:c&&r<wt.TABLET?u(c,{}):i?u(Z,{children:[c&&u(c,{}),l&&u(ue,{type:"icon","data-testid":"minimap.toggle-button",title:n("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:a,children:u(ke,{icon:i?"chevrons-ne":"chevrons-sw"})})]}):u(Z,{children:[u(ue,{type:"icon","data-testid":"minimap.zoom-out",title:`${n(Ac(e["zoom-out"].label))} ${zm(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:u(ke,{icon:"minus"})}),c&&u(c,{}),u(ue,{type:"icon","data-testid":"minimap.zoom-in",title:`${n(Ac(e["zoom-in"].label))} ${zm(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:u(ke,{icon:"plus"})}),l&&u(ue,{type:"icon","data-testid":"minimap.toggle-button",title:n("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:a,children:u(ke,{icon:i?"chevrons-ne":"chevrons-sw"})})]})}),l&&r>=wt.TABLET&&!i&&u(l,{})]})}),ioe=function({name:e,id:n,isCurrentPage:r,onCancel:o}){const i=F(),s=Xt(),a=B(null),c=B(null),l=V(()=>{c.current=i.markHistoryStoppingPoint("rename page")},[i]),d=V(p=>{i.renamePage(n,p||"New Page"),s("rename-page",{source:"page-menu"})},[i,n,s]),h=V(()=>{c.current&&i.bailToMark(c.current),o()},[i,o]);return u(Zh,{className:"tlui-page-menu__item__input",ref:p=>a.current=p,defaultValue:e,onValueChange:d,onCancel:h,onFocus:l,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:r,autoSelect:!0})},oy=(t,e,n,r,o)=>{let i;const s=t.getPages(),a=n>r?s[r-1]:s[r],c=n>r?s[r]:s[r+1];a&&!c?i=Br(a.index):!a&&c?i=n5(s[0].index):i=Pc(a.index,c.index),i!==s[n].index&&(t.markHistoryStoppingPoint("moving page"),t.updatePage({id:e,index:i}),o("move-page",{source:"page-menu"}))},E_=Nt(function({index:e,listSize:n,item:r,onRename:o}){const i=F(),s=Ae(),a=i.getPages(),c=Xt(),l=V(()=>{i.markHistoryStoppingPoint("creating page");const f=Zn.createId();i.duplicatePage(r.id,f),c("duplicate-page",{source:"page-menu"})},[i,r,c]),d=V(()=>{oy(i,r.id,e,e-1,c)},[i,r,e,c]),h=V(()=>{oy(i,r.id,e,e+1,c)},[i,r,e,c]),p=V(()=>{i.markHistoryStoppingPoint("deleting page"),i.deletePage(r.id),c("delete-page",{source:"page-menu"})},[i,r,c]);return u(Zi,{id:`page item submenu ${e}`,children:[u(Ji,{children:u(ue,{type:"icon",title:s("page-menu.submenu.title"),children:u(ke,{icon:"dots-vertical"})})}),u(Qi,{alignOffset:0,side:"right",sideOffset:-4,children:u(lr,{type:"menu",sourceId:"page-menu",children:[u(xe,{id:"modify",children:[o&&u(jt,{id:"rename",label:"page-menu.submenu.rename",onSelect:o}),u(jt,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:l,disabled:a.length>=i.options.maxPages}),e>0&&u(jt,{id:"move-up",onSelect:d,label:"page-menu.submenu.move-up"}),e<n-1&&u(jt,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:h})]}),n>1&&u(xe,{id:"delete",children:u(jt,{id:"delete",onSelect:p,label:"page-menu.submenu.delete"})})]})})]})}),soe=$e(function(){const e=F(),n=Xt(),r=Ae(),o=Sn(),i=V(()=>S(!1),[]),[s,a]=Fo("page-menu",i),c=36,l=B(null),d=U("pages",()=>e.getPages(),[e]),h=U("currentPage",()=>e.getCurrentPage(),[e]),p=U("currentPageId",()=>e.getCurrentPageId(),[e]),f=No(),g=U("maxPageCountReached",()=>e.getPages().length>=e.options.maxPages,[e]),m=U("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[y,S]=Q(!1),v=V(()=>{f||S(O=>!O)},[f]),_=B({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[w,x]=Q(Object.fromEntries(d.map((O,$)=>[O.id,{y:$*c,offsetY:0,isSelected:!1}])));je(()=>{x(Object.fromEntries(d.map((O,$)=>[O.id,{y:$*c,offsetY:0,isSelected:!1}])))},[c,d]),q(()=>{s&&e.timers.requestAnimationFrame(()=>{const O=document.querySelector(`[data-testid="page-menu-item-${p}"]`);if(O){const $=l.current;if(!$)return;const z=O.offsetTop,R=$.scrollTop;z<R&&$.scrollTo({top:z});const W=z+c,j=$.scrollTop+$.offsetHeight;W>j&&$.scrollTo({top:W-$.offsetHeight})}})},[c,p,s,e]);const C=V(O=>{const{clientY:$,currentTarget:z}=O,{dataset:{id:R,index:W}}=z;if(!R||!W)return;const j=_.current;Zc(O.currentTarget,O),j.status="pointing",j.pointing={id:R,index:+W};const le=w[R].y;j.startY=$,j.startIndex=Math.max(0,Math.min(Math.round(le/c),d.length-1))},[c,d.length,w]),E=V(O=>{const $=_.current;if($.status==="pointing"){const{clientY:z}=O,R=z-$.startY;Math.abs(R)>5&&($.status="dragging")}if($.status==="dragging"){const{clientY:z}=O,R=z-$.startY,W=w[$.pointing.id],{startIndex:j,pointing:G}=$,le=W.y+R,he=Math.max(0,Math.min(Math.round(le/c),d.length-1)),ve={...w};if(ve[G.id]={y:W.y,offsetY:R,isSelected:!0},he!==$.dragIndex){$.dragIndex=he;for(let me=0;me<d.length;me++){const Be=d[me];if(Be.id===$.pointing.id)continue;let{y:ie}=ve[Be.id];he===j?ie=me*c:he<j?he<=me&&me<j?ie=(me+1)*c:ie=me*c:he>j&&(he>=me&&me>j?ie=(me-1)*c:ie=me*c),ie!==ve[Be.id].y&&(ve[Be.id]={y:ie,offsetY:0,isSelected:!0})}}x(ve)}},[c,d,w]),I=V(O=>{const $=_.current;if($.status==="dragging"){const{id:z,index:R}=$.pointing;oy(e,z,R,$.dragIndex,n)}Jc(O.currentTarget,O),$.status="idle"},[e,n]),T=V(O=>{const $=_.current;O.key==="Escape"&&($.status==="dragging"&&x(Object.fromEntries(d.map((z,R)=>[z.id,{y:R*c,offsetY:0,isSelected:!1}]))),$.status="idle")},[c,d]),k=V(()=>{f||(e.run(()=>{e.markHistoryStoppingPoint("creating page");const O=Zn.createId();e.createPage({name:r("page-menu.new-page-initial-name"),id:O}),e.setCurrentPage(O),S(!0)}),n("new-page",{source:"page-menu"}))},[e,r,f,n]),D=V(O=>{e.setCurrentPage(O),n("change-page",{source:"page-menu"})},[e,n]),A=V((O,$)=>{e.renamePage(O,$),n("rename-page",{source:"page-menu"})},[e,n]);return u(Jv,{id:"pages",onOpenChange:a,open:s,children:[u(Qv,{"data-testid":"main.page-menu",children:u(ue,{type:"menu",title:h.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[u("div",{className:"tlui-page-menu__name",children:h.name}),u(ke,{icon:"chevron-down",small:!0})]})}),u(eb,{side:"bottom",align:"start",sideOffset:6,disableEscapeKeyDown:y,children:u("div",{className:"tlui-page-menu__wrapper",children:[u("div",{className:"tlui-page-menu__header",children:[u("div",{className:"tlui-page-menu__header__title",children:r("page-menu.title")}),!f&&u("div",{className:"tlui-buttons__horizontal",children:[u(ue,{type:"icon","data-testid":"page-menu.edit",title:r(y?"page-menu.edit-done":"page-menu.edit-start"),onClick:v,children:u(ke,{icon:y?"check":"edit"})}),u(ue,{type:"icon","data-testid":"page-menu.create",title:r(g?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:g,onClick:k,children:u(ke,{icon:"plus"})})]})]}),u("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:c*d.length+4},ref:l,children:d.map((O,$)=>{const z=w[O.id]??{position:$*40,offsetY:0};return y?u("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:O.id===h.id?888:$,transform:`translate(0px, ${z.y+z.offsetY}px)`},children:[u(ue,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:C,onPointerUp:I,onPointerMove:E,onKeyDown:T,"data-id":O.id,"data-index":$,children:u(ke,{icon:"drag-handle-dots"})}),o<wt.TABLET_SM&&m?u(ue,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const R=window.prompt("Rename page",O.name);R&&R!==O.name&&A(O.id,R)},onDoubleClick:v,children:[u(ry,{checked:O.id===h.id}),u(It,{children:O.name})]}):u("div",{className:"tlui-page_menu__item__sortable__title",style:{height:c},children:u(ioe,{id:O.id,name:O.name,isCurrentPage:O.id===h.id,onCancel:()=>{S(!1),e.menus.clearOpenMenus()}})}),!f&&u("div",{className:"tlui-page_menu__item__submenu","data-isediting":y,children:u(E_,{index:$,item:O,listSize:d.length})})]},O.id+"_editing"):u("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[u(ue,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>D(O.id),onDoubleClick:v,title:r("page-menu.go-to-page"),children:[u(ry,{checked:O.id===h.id}),u(It,{children:O.name})]}),!f&&u("div",{className:"tlui-page_menu__item__submenu",children:u(E_,{index:$,item:O,listSize:d.length,onRename:()=>{if(et.isIos){const R=window.prompt("Rename page",O.name);R&&R!==O.name&&A(O.id,R)}else S(!0),p!==O.id&&D(O.id)}})})]},O.id)})})]})})]})});function aoe(){const t=F(),e=vD(),n=SD(),r=vn(1),o=No(),i=U("should display quick actions",()=>t.isInAny("select","hand","zoom"),[t]),s=zo(),a=r&&s;if(!(o&&!i))return u(Z,{children:[u(H,{actionId:"undo",disabled:!e}),u(H,{actionId:"redo",disabled:!n}),u(H,{actionId:"delete",disabled:!a}),u(H,{actionId:"duplicate",disabled:!a})]})}const coe=$e(function({children:e}){return u(lr,{type:"small-icons",sourceId:"quick-actions",children:e??u(aoe,{})})});function loe({userId:t}){const e=Ih(t);return e?u("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:e.color},children:e.userName==="New User"?"":e.userName[0]??""},t):null}const doe=Nt(function({userId:e}){const n=F(),r=Ae(),o=Xt(),i=Ih(e),s=V(()=>{n.getInstanceState().followingUserId===e?(n.stopFollowingUser(),o("stop-following",{source:"people-menu"})):(n.startFollowingUser(e),o("start-following",{source:"people-menu"}))},[n,e,o]),a=(i==null?void 0:i.followingUserId)===n.user.getId(),c=n.getInstanceState().followingUserId===e;return i?u("div",{className:"tlui-people-menu__item tlui-buttons__horizontal",children:[u(ue,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>n.zoomToUser(e),onDoubleClick:s,children:[u(Xr,{icon:"color",color:i.color}),u("div",{className:"tlui-people-menu__name",children:i.userName??"New User"})]}),u(ue,{type:"icon",className:"tlui-people-menu__item__follow",title:r(a?"people-menu.leading":c?"people-menu.following":"people-menu.follow"),onClick:s,disabled:a,"data-active":c||a,children:u(ke,{icon:a?"leading":c?"following":"follow"})})]}):null});function uoe({count:t}){return u("div",{className:"tlui-people-menu__more",children:"+"+Math.abs(t)})}const hoe=Nt(function(){const e=F(),n=At(),r=Ae(),o=Xt(),i=B(!1),[s,a]=Q(!1),c=V(m=>{a(m)},[]),l=e.user.getColor(),d=V(m=>{e.user.updateUserPreferences({color:m}),o("set-color",{source:"people-menu"})},[e,o]),{handleButtonClick:h,handleButtonPointerDown:p,handleButtonPointerEnter:f,handleButtonPointerUp:g}=we.useMemo(()=>{const m=()=>{i.current=!1,window.removeEventListener("pointerup",m)};return{handleButtonClick:w=>{const{id:x}=w.currentTarget.dataset;x&&l!==x&&d(x)},handleButtonPointerDown:w=>{const{id:x}=w.currentTarget.dataset;x&&(d(x),i.current=!0,window.addEventListener("pointerup",m))},handleButtonPointerEnter:w=>{if(!i.current)return;const{id:x}=w.currentTarget.dataset;x&&d(x)},handleButtonPointerUp:w=>{const{id:x}=w.currentTarget.dataset;x&&d(x)}}},[l,d]);return u(Yv,{onOpenChange:c,open:s,children:[u(Xv,{dir:"ltr",asChild:!0,children:u(ue,{type:"icon",className:"tlui-people-menu__user__color",style:{color:e.user.getColor()},title:r("people-menu.change-color"),children:u(ke,{icon:"color"})})}),u(qv,{container:n,children:u(Zv,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:u("div",{className:"tlui-buttons__grid",children:dm.map(m=>u(ue,{type:"icon","data-id":m,"data-testid":m,"aria-label":m,"data-state":l===m?"hinted":void 0,title:m,className:"tlui-button-grid__button",style:{color:m},onPointerEnter:f,onPointerDown:p,onPointerUp:g,onClick:h,children:u(ke,{icon:"color"})},m))})})})]})});function poe(){const t=F(),e=Xt(),n=U("userName",()=>t.user.getName(),[]),r=Ae(),o=B(n),i=B(n),[s,a]=Q(!1),c=V(()=>{a(p=>!p)},[]),l=V(p=>{i.current=p,t.user.updateUserPreferences({name:p})},[t]),d=V(()=>{o.current!==i.current&&(e("change-user-name",{source:"people-menu"}),o.current=i.current)},[e]),h=V(()=>{a(!1),t.user.updateUserPreferences({name:o.current}),t.menus.clearOpenMenus()},[t]);return u("div",{className:"tlui-people-menu__user",children:[u(hoe,{}),s?u(Zh,{className:"tlui-people-menu__user__input",defaultValue:n,onValueChange:l,onComplete:c,onCancel:h,onBlur:d,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):u(Z,{children:[u("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{s||a(!0)},children:n}),n==="New User"?u("div",{className:"tlui-people-menu__user__label",children:r("people-menu.user")}):null]}),u(ue,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:r("people-menu.change-name"),onClick:c,children:u(ke,{icon:s?"check":"edit"})})]})}const foe=Nt(function({children:e}){const n=Ae(),r=At(),o=F(),i=dC(),s=U("user",()=>o.user.getColor(),[o]),a=U("user",()=>o.user.getName(),[o]),[c,l]=Fo("people menu");return u(Yv,{onOpenChange:l,open:c,children:[u(Xv,{dir:"ltr",asChild:!0,children:u("button",{className:"tlui-people-menu__avatars-button",title:n("people-menu.title"),children:[i.length>5&&u(uoe,{count:i.length-5}),u("div",{className:"tlui-people-menu__avatars",children:[i.slice(-5).map(d=>u(loe,{userId:d},d)),u("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:s},children:a==="New User"?"":a[0]??""})]})]})}),u(qv,{container:r,children:u(Zv,{dir:"ltr",className:"tlui-menu",align:"end",side:"bottom",sideOffset:2,alignOffset:-5,onEscapeKeyDown:Ce,children:u("div",{className:"tlui-people-menu__wrapper",children:[u("div",{className:"tlui-people-menu__section",children:u(poe,{})}),i.length>0&&u("div",{className:"tlui-people-menu__section",children:i.map(d=>u(doe,{userId:d},d+"_presence"))}),e]})})})]})});function goe(){return u("div",{className:"tlui-share-zone",draggable:!1,children:u(foe,{})})}const moe=Object.freeze([qn,Wi,Gi,Yr]);function n$(t=moe){const e=F();return U("getRelevantStyles",()=>{var i;const n=new mm(e.getSharedStyles()),r=!!((i=e.root.getCurrent())!=null&&i.shapeType),o=e.isIn("select")&&e.getSelectedShapeIds().length>0;if(n.size===0&&e.isIn("select")&&e.getSelectedShapeIds().length===0)for(const s of t)n.applyValue(s,e.getStyleForNextShape(s));return r||o||n.size>0?n:null},[e])}const sr={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},$i=$e(function(e){const{uiType:n,items:r,title:o,style:i,value:s,onValueChange:a,onHistoryMark:c,theme:l}=e,d=Ae(),h=B(!1),p=B(null),{handleButtonClick:f,handleButtonPointerDown:g,handleButtonPointerEnter:m,handleButtonPointerUp:y}=ce(()=>{const S=()=>{h.current=!1,window.removeEventListener("pointerup",S);const C=p.current;C&&["TEXTAREA","INPUT"].includes(C.nodeName)&&C.focus(),p.current=null};return{handleButtonClick:C=>{const{id:E}=C.currentTarget.dataset;s.type==="shared"&&s.value===E||(c==null||c("point picker item"),a(i,E))},handleButtonPointerDown:C=>{const{id:E}=C.currentTarget.dataset;c==null||c("point picker item"),a(i,E),h.current=!0,p.current=document.activeElement,window.addEventListener("pointerup",S)},handleButtonPointerEnter:C=>{if(!h.current)return;const{id:E}=C.currentTarget.dataset;a(i,E)},handleButtonPointerUp:C=>{const{id:E}=C.currentTarget.dataset;s.type==="shared"&&s.value===E||a(i,E)}}},[s,c,a,i]);return u("div",{"data-testid":`style.${n}`,className:de("tlui-buttons__grid"),children:r.map(S=>u(ue,{type:"icon","data-id":S.value,"data-testid":`style.${n}.${S.value}`,"aria-label":S.value,"data-state":s.type==="shared"&&s.value===S.value?"hinted":void 0,title:o+" — "+d(`${n}-style.${S.value}`),className:de("tlui-button-grid__button"),style:i===qn?{color:l[S.value].solid}:void 0,onPointerEnter:m,onPointerDown:g,onPointerUp:y,onClick:f,children:u(ke,{icon:S.icon})},S.value))})});function r$(t,[e,n]){return Math.min(n,Math.max(e,t))}function yoe(t){const e=B({value:t,previous:t});return ce(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var o$=["PageUp","PageDown"],i$=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],s$={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Ca="Slider",[iy,Soe,voe]=Wh(Ca),[a$,Kae]=as(Ca,[voe]),[boe,Sp]=a$(Ca),c$=X((t,e)=>{const{name:n,min:r=0,max:o=100,step:i=1,orientation:s="horizontal",disabled:a=!1,minStepsBetweenThumbs:c=0,defaultValue:l=[r],value:d,onValueChange:h=()=>{},onValueCommit:p=()=>{},inverted:f=!1,form:g,...m}=t,y=B(new Set),S=B(0),_=s==="horizontal"?woe:_oe,[w=[],x]=bi({prop:d,defaultProp:l,onChange:D=>{var O;(O=[...y.current][S.current])==null||O.focus(),h(D)}}),C=B(w);function E(D){const A=Eoe(w,D);k(D,A)}function I(D){k(D,S.current)}function T(){const D=C.current[S.current];w[S.current]!==D&&p(w)}function k(D,A,{commit:O}={commit:!1}){const $=Aoe(i),z=Ooe(Math.round((D-r)/i)*i+r,$),R=r$(z,[r,o]);x((W=[])=>{const j=Ioe(W,R,A);if(Moe(j,c*i)){S.current=j.indexOf(R);const G=String(j)!==String(W);return G&&O&&p(j),G?j:W}else return W})}return u(boe,{scope:t.__scopeSlider,name:n,disabled:a,min:r,max:o,valueIndexToChangeRef:S,thumbs:y.current,values:w,orientation:s,form:g,children:u(iy.Provider,{scope:t.__scopeSlider,children:u(iy.Slot,{scope:t.__scopeSlider,children:u(_,{"aria-disabled":a,"data-disabled":a?"":void 0,...m,ref:e,onPointerDown:se(m.onPointerDown,()=>{a||(C.current=w)}),min:r,max:o,inverted:f,onSlideStart:a?void 0:E,onSlideMove:a?void 0:I,onSlideEnd:a?void 0:T,onHomeKeyDown:()=>!a&&k(r,0,{commit:!0}),onEndKeyDown:()=>!a&&k(o,w.length-1,{commit:!0}),onStepKeyDown:({event:D,direction:A})=>{if(!a){const z=o$.includes(D.key)||D.shiftKey&&i$.includes(D.key)?10:1,R=S.current,W=w[R],j=i*z*A;k(W+j,R,{commit:!0})}}})})})})});c$.displayName=Ca;var[l$,d$]=a$(Ca,{startEdge:"left",endEdge:"right",size:"width",direction:1}),woe=X((t,e)=>{const{min:n,max:r,dir:o,inverted:i,onSlideStart:s,onSlideMove:a,onSlideEnd:c,onStepKeyDown:l,...d}=t,[h,p]=Q(null),f=st(e,_=>p(_)),g=B(),m=lv(o),y=m==="ltr",S=y&&!i||!y&&i;function v(_){const w=g.current||h.getBoundingClientRect(),x=[0,w.width],E=nb(x,S?[n,r]:[r,n]);return g.current=w,E(_-w.left)}return u(l$,{scope:t.__scopeSlider,startEdge:S?"left":"right",endEdge:S?"right":"left",direction:S?1:-1,size:"width",children:u(u$,{dir:m,"data-orientation":"horizontal",...d,ref:f,style:{...d.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:_=>{const w=v(_.clientX);s==null||s(w)},onSlideMove:_=>{const w=v(_.clientX);a==null||a(w)},onSlideEnd:()=>{g.current=void 0,c==null||c()},onStepKeyDown:_=>{const x=s$[S?"from-left":"from-right"].includes(_.key);l==null||l({event:_,direction:x?-1:1})}})})}),_oe=X((t,e)=>{const{min:n,max:r,inverted:o,onSlideStart:i,onSlideMove:s,onSlideEnd:a,onStepKeyDown:c,...l}=t,d=B(null),h=st(e,d),p=B(),f=!o;function g(m){const y=p.current||d.current.getBoundingClientRect(),S=[0,y.height],_=nb(S,f?[r,n]:[n,r]);return p.current=y,_(m-y.top)}return u(l$,{scope:t.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1,children:u(u$,{"data-orientation":"vertical",...l,ref:h,style:{...l.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:m=>{const y=g(m.clientY);i==null||i(y)},onSlideMove:m=>{const y=g(m.clientY);s==null||s(y)},onSlideEnd:()=>{p.current=void 0,a==null||a()},onStepKeyDown:m=>{const S=s$[f?"from-bottom":"from-top"].includes(m.key);c==null||c({event:m,direction:S?-1:1})}})})}),u$=X((t,e)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:o,onSlideEnd:i,onHomeKeyDown:s,onEndKeyDown:a,onStepKeyDown:c,...l}=t,d=Sp(Ca,n);return u(Le.span,{...l,ref:e,onKeyDown:se(t.onKeyDown,h=>{h.key==="Home"?(s(h),h.preventDefault()):h.key==="End"?(a(h),h.preventDefault()):o$.concat(i$).includes(h.key)&&(c(h),h.preventDefault())}),onPointerDown:se(t.onPointerDown,h=>{const p=h.target;p.setPointerCapture(h.pointerId),h.preventDefault(),d.thumbs.has(p)?p.focus():r(h)}),onPointerMove:se(t.onPointerMove,h=>{h.target.hasPointerCapture(h.pointerId)&&o(h)}),onPointerUp:se(t.onPointerUp,h=>{const p=h.target;p.hasPointerCapture(h.pointerId)&&(p.releasePointerCapture(h.pointerId),i(h))})})}),h$="SliderTrack",p$=X((t,e)=>{const{__scopeSlider:n,...r}=t,o=Sp(h$,n);return u(Le.span,{"data-disabled":o.disabled?"":void 0,"data-orientation":o.orientation,...r,ref:e})});p$.displayName=h$;var sy="SliderRange",f$=X((t,e)=>{const{__scopeSlider:n,...r}=t,o=Sp(sy,n),i=d$(sy,n),s=B(null),a=st(e,s),c=o.values.length,l=o.values.map(p=>m$(p,o.min,o.max)),d=c>1?Math.min(...l):0,h=100-Math.max(...l);return u(Le.span,{"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,...r,ref:a,style:{...t.style,[i.startEdge]:d+"%",[i.endEdge]:h+"%"}})});f$.displayName=sy;var ay="SliderThumb",g$=X((t,e)=>{const n=Soe(t.__scopeSlider),[r,o]=Q(null),i=st(e,a=>o(a)),s=ce(()=>r?n().findIndex(a=>a.ref.current===r):-1,[n,r]);return u(xoe,{...t,ref:i,index:s})}),xoe=X((t,e)=>{const{__scopeSlider:n,index:r,name:o,...i}=t,s=Sp(ay,n),a=d$(ay,n),[c,l]=Q(null),d=st(e,v=>l(v)),h=c?s.form||!!c.closest("form"):!0,p=sM(c),f=s.values[r],g=f===void 0?0:m$(f,s.min,s.max),m=Coe(r,s.values.length),y=p==null?void 0:p[a.size],S=y?Toe(y,g,a.direction):0;return q(()=>{if(c)return s.thumbs.add(c),()=>{s.thumbs.delete(c)}},[c,s.thumbs]),u("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${g}% + ${S}px)`},children:[u(iy.ItemSlot,{scope:t.__scopeSlider,children:u(Le.span,{role:"slider","aria-label":t["aria-label"]||m,"aria-valuemin":s.min,"aria-valuenow":f,"aria-valuemax":s.max,"aria-orientation":s.orientation,"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,tabIndex:s.disabled?void 0:0,...i,ref:d,style:f===void 0?{display:"none"}:t.style,onFocus:se(t.onFocus,()=>{s.valueIndexToChangeRef.current=r})})}),h&&u(Poe,{name:o??(s.name?s.name+(s.values.length>1?"[]":""):void 0),form:s.form,value:f},r)]})});g$.displayName=ay;var Poe=t=>{const{value:e,...n}=t,r=B(null),o=yoe(e);return q(()=>{const i=r.current,s=window.HTMLInputElement.prototype,c=Object.getOwnPropertyDescriptor(s,"value").set;if(o!==e&&c){const l=new Event("input",{bubbles:!0});c.call(i,e),i.dispatchEvent(l)}},[o,e]),u("input",{style:{display:"none"},...n,ref:r,defaultValue:e})};function Ioe(t=[],e,n){const r=[...t];return r[n]=e,r.sort((o,i)=>o-i)}function m$(t,e,n){const i=100/(n-e)*(t-e);return r$(i,[0,100])}function Coe(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function Eoe(t,e){if(t.length===1)return 0;const n=t.map(o=>Math.abs(o-e)),r=Math.min(...n);return n.indexOf(r)}function Toe(t,e,n){const r=t/2,i=nb([0,50],[0,r]);return(r-i(e)*n)*n}function koe(t){return t.slice(0,-1).map((e,n)=>t[n+1]-e)}function Moe(t,e){if(e>0){const n=koe(t);return Math.min(...n)>=e}return!0}function nb(t,e){return n=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(t[1]-t[0]);return e[0]+r*(n-t[0])}}function Aoe(t){return(String(t).split(".")[1]||"").length}function Ooe(t,e){const n=Math.pow(10,e);return Math.round(t*n)/n}var Doe=c$,$oe=p$,Roe=f$,Loe=g$;const Noe=$e(function({onHistoryMark:e,title:n,steps:r,value:o,label:i,onValueChange:s,["data-testid"]:a}){const c=Ae(),l=V(p=>{s(p[0])},[s]),d=V(()=>{e("click slider")},[e]),h=V(()=>{o&&s(o)},[o,s]);return u("div",{className:"tlui-slider__container",children:u(Doe,{"data-testid":a,className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:r,step:1,value:o?[o]:void 0,onPointerDown:d,onValueChange:l,onPointerUp:h,title:n+" — "+c(i),children:[u($oe,{className:"tlui-slider__track",dir:"ltr",children:o!==null&&u(Roe,{className:"tlui-slider__range",dir:"ltr"})}),o!==null&&u(Loe,{className:"tlui-slider__thumb",dir:"ltr"})]})})});function Foe({label:t,uiTypeA:e,uiTypeB:n,labelA:r,labelB:o,itemsA:i,itemsB:s,styleA:a,styleB:c,valueA:l,valueB:d,onValueChange:h}){const p=Ae(),f=ce(()=>{var m;return((m=i.find(y=>l.type==="shared"&&l.value===y.value))==null?void 0:m.icon)??"mixed"},[i,l]),g=ce(()=>{var m;return((m=s.find(y=>d.type==="shared"&&d.value===y.value))==null?void 0:m.icon)??"mixed"},[s,d]);return l===void 0&&d===void 0?null:u("div",{className:"tlui-style-panel__double-select-picker",children:[u("div",{title:p(t),className:"tlui-style-panel__double-select-picker-label",children:p(t)}),u("div",{className:"tlui-buttons__horizontal",children:[u(Zi,{id:`style panel ${e} A`,children:[u(Ji,{children:u(ue,{type:"icon","data-testid":`style.${e}`,title:p(r)+" — "+(l===null||l.type==="mixed"?p("style-panel.mixed"):p(`${e}-style.${l.value}`)),children:u(ke,{icon:f,small:!0,invertIcon:!0})})}),u(Qi,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:u("div",{className:"tlui-buttons__grid",children:i.map((m,y)=>u(Lc,{"data-testid":`style.${e}.${m.value}`,children:u(ue,{type:"icon",onClick:()=>h(a,m.value),title:`${p(r)} — ${p(`${e}-style.${m.value}`)}`,children:u(ke,{icon:m.icon,invertIcon:!0})},m.value)},y))})})]}),u(Zi,{id:`style panel ${n}`,children:[u(Ji,{children:u(ue,{type:"icon","data-testid":`style.${n}`,title:p(o)+" — "+(d===null||d.type==="mixed"?p("style-panel.mixed"):p(`${n}-style.${d.value}`)),children:u(ke,{icon:g,small:!0})})}),u(Qi,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:u("div",{className:"tlui-buttons__grid",children:s.map(m=>u(Lc,{children:u(ue,{type:"icon",title:`${p(o)} — ${p(`${n}-style.${m.value}`)}`,"data-testid":`style.${n}.${m.value}`,onClick:()=>h(c,m.value),children:u(ke,{icon:m.icon})})},m.value))})})]})]})]})}const zoe=$e(Foe);function Boe({id:t,label:e,uiType:n,style:r,items:o,type:i,value:s,onValueChange:a}){const c=Ae(),l=F(),d=ce(()=>{var f;return(f=o.find(g=>s.type==="shared"&&g.value===s.value))==null?void 0:f.icon},[o,s]),h=s.type==="mixed"?c("style-panel.mixed"):c(`${n}-style.${s.value}`),p=e?c(e):"";return u(Zi,{id:`style panel ${t}`,children:[u(Ji,{children:u(ue,{type:i,"data-testid":`style.${n}`,title:h,children:[u(It,{children:p}),u(ke,{icon:d??"mixed"})]})}),u(Qi,{side:"left",align:"center",alignOffset:0,children:u("div",{className:"tlui-buttons__grid",children:o.map(f=>u(Lc,{children:u(ue,{type:"icon","data-testid":`style.${n}.${f.value}`,title:c(`${n}-style.${f.value}`),onClick:()=>{l.markHistoryStoppingPoint("select style dropdown item"),a(r,f.value)},children:u(ke,{icon:f.icon})})},f.value))})})]})}const rb=$e(Boe);function Uoe({styles:t}){const e=al();if(!t)return null;const n=t.get(br),r=t.get(Cu),o=t.get(Iu),i=t.get(Mu),s=t.get(Vr),a=n===void 0,c=r===void 0&&o===void 0,l=i===void 0,d=s===void 0,h=Lo({isDarkMode:e});return u(Z,{children:[u(Hoe,{theme:h,styles:t}),!d&&u(joe,{theme:h,styles:t}),!(a&&c&&l)&&u("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[u(Koe,{styles:t}),u(Goe,{styles:t}),u(Woe,{styles:t})]})]})}function gl(){const t=F(),e=Xt();return we.useMemo(()=>function(r,o){t.run(()=>{t.isIn("select")&&t.setStyleForSelectedShapes(r,o),t.setStyleForNextShapes(r,o),t.updateInstanceState({isChangingStyle:!0})}),e("set-style",{source:"style-panel",id:r.id,value:o})},[t,e])}function Hoe({styles:t,theme:e}){const n=Ae(),r=F(),o=V(h=>r.markHistoryStoppingPoint(h),[r]),i=gl(),s=t.get(qn),a=t.get(Gi),c=t.get(Wi),l=t.get(Yr),d=a!==void 0||c!==void 0||l!==void 0;return u(Z,{children:[u("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[s===void 0?null:u($i,{title:n("style-panel.color"),uiType:"color",style:qn,items:sr.color,value:s,onValueChange:i,theme:e,onHistoryMark:o}),u(Voe,{})]}),d&&u("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[a===void 0?null:u($i,{title:n("style-panel.fill"),uiType:"fill",style:Gi,items:sr.fill,value:a,onValueChange:i,theme:e,onHistoryMark:o}),c===void 0?null:u($i,{title:n("style-panel.dash"),uiType:"dash",style:Wi,items:sr.dash,value:c,onValueChange:i,theme:e,onHistoryMark:o}),l===void 0?null:u($i,{title:n("style-panel.size"),uiType:"size",style:Yr,items:sr.size,value:l,onValueChange:(h,p)=>{i(h,p);const f=r.getSelectedShapeIds();f.length>0&&rt(r,f)},theme:e,onHistoryMark:o})]})]})}function joe({theme:t,styles:e}){const n=Ae(),r=gl(),o=F(),i=V(d=>o.markHistoryStoppingPoint(d),[o]),s=e.get(Vr),a=e.get(im),c=e.get(Tu),l=e.get(ku);return s===void 0&&c===void 0?null:u("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[s===void 0?null:u($i,{title:n("style-panel.font"),uiType:"font",style:Vr,items:sr.font,value:s,onValueChange:r,theme:t,onHistoryMark:i}),a===void 0?null:u("div",{className:"tlui-style-panel__row",children:[u($i,{title:n("style-panel.align"),uiType:"align",style:im,items:sr.textAlign,value:a,onValueChange:r,theme:t,onHistoryMark:i}),u("div",{className:"tlui-style-panel__row__extra-button",children:u(ue,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:u(ke,{icon:"vertical-align-middle"})})})]}),c===void 0?null:u("div",{className:"tlui-style-panel__row",children:[u($i,{title:n("style-panel.align"),uiType:"align",style:Tu,items:sr.horizontalAlign,value:c,onValueChange:r,theme:t,onHistoryMark:i}),u("div",{className:"tlui-style-panel__row__extra-button",children:l===void 0?u(ue,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:u(ke,{icon:"vertical-align-middle"})}):u(rb,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:ku,items:sr.verticalAlign,value:l,onValueChange:r})})]})]})}function Koe({styles:t}){const e=gl(),n=t.get(br);return n===void 0?null:u(rb,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:br,items:sr.geo,value:n,onValueChange:e})}function Woe({styles:t}){const e=gl(),n=t.get(Mu);return n===void 0?null:u(rb,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:Mu,items:sr.spline,value:n,onValueChange:e})}function Goe({styles:t}){const e=gl(),n=t.get(Cu),r=t.get(Iu);return!n||!r?null:u(zoe,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:Iu,itemsA:sr.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:Cu,itemsB:sr.arrowheadEnd,valueB:n,onValueChange:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}const qa=[.1,.25,.5,.75,1];function Voe(){const t=F(),e=V(a=>t.markHistoryStoppingPoint(a),[t]),n=U("opacity",()=>t.getSharedOpacity(),[t]),r=Xt(),o=Ae(),i=we.useCallback(a=>{const c=qa[a];t.run(()=>{t.isIn("select")&&t.setOpacityForSelectedShapes(c),t.setOpacityForNextShapes(c),t.updateInstanceState({isChangingStyle:!0})}),r("set-style",{source:"style-panel",id:"opacity",value:a})},[t,r]);if(n===void 0)return null;const s=n.type==="mixed"?-1:qa.indexOf(IL(qa,a=>Math.abs(a-n.value)));return u(Noe,{"data-testid":"style.opacity",value:s>=0?s:qa.length-1,label:n.type==="mixed"?"style-panel.mixed":`opacity-style.${n.value}`,onValueChange:i,steps:qa.length-1,title:o("style-panel.opacity"),onHistoryMark:e})}const Yoe=$e(function({isMobile:e,children:n}){const r=F(),o=B(null);vi(o);const i=n$(),s=V(()=>{e||r.updateInstanceState({isChangingStyle:!1})},[r,e]),a=n??u(Uoe,{styles:i});return u("div",{ref:o,className:de("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,onPointerLeave:s,children:a})});function Xoe(){const t=F(),e=Ae(),n=n$(),r=n==null?void 0:n.get(qn),o=Lo({isDarkMode:t.user.getIsDarkMode()}),i=((r==null?void 0:r.type)==="shared"?o[r.value]:o.black).solid,s=U("disable style panel",()=>t.isInAny("hand","zoom","eraser","laser"),[t]),a=V(l=>{l||t.updateInstanceState({isChangingStyle:!1})},[t]),{StylePanel:c}=xi();return c?u(Jv,{id:"mobile style menu",onOpenChange:a,children:[u(Qv,{children:u(ue,{type:"tool","data-testid":"mobile-styles.button",style:{color:s?"var(--color-muted-1)":i},title:e("style-panel.title"),disabled:s,children:u(ke,{icon:s?"blob":(r==null?void 0:r.type)==="mixed"?"mixed":"blob"})})}),u(eb,{side:"top",align:"end",children:c&&u(c,{isMobile:!0})})]}):null}function qoe(){return u(Z,{children:[u(Joe,{}),u(Qoe,{}),u(eie,{}),u(tie,{}),u(nie,{}),u(rie,{}),u(oie,{}),u(iie,{}),u(sie,{}),u(aie,{}),u(lie,{}),u(cie,{}),u(hie,{}),u(gie,{}),u(die,{}),u(fie,{}),u(pie,{}),u(uie,{}),u(mie,{}),u(yie,{}),u(Sie,{}),u(vie,{}),u(bie,{}),u(wie,{}),u(_ie,{}),u(xie,{}),u(Iie,{}),u(Pie,{})]})}function Zoe(t){var r;const e=F(),n=(r=t.meta)==null?void 0:r.geo;return U("is tool selected",()=>{const o=e.getCurrentToolId(),i=e.getSharedStyles().getAsKnownValue(br);return n?o==="geo"&&i===n:o===t.id},[e,t.id,n])}function nt({tool:t}){const e=$v(),n=Zoe(e[t]);return u(xn,{toolId:t,isSelected:n})}function Joe(){return u(nt,{tool:"select"})}function Qoe(){return u(nt,{tool:"hand"})}function eie(){return u(nt,{tool:"draw"})}function tie(){return u(nt,{tool:"eraser"})}function nie(){return u(nt,{tool:"arrow"})}function rie(){return u(nt,{tool:"text"})}function oie(){return u(nt,{tool:"note"})}function iie(){return u(xn,{toolId:"asset"})}function sie(){return u(nt,{tool:"rectangle"})}function aie(){return u(nt,{tool:"ellipse"})}function cie(){return u(nt,{tool:"diamond"})}function lie(){return u(nt,{tool:"triangle"})}function die(){return u(nt,{tool:"rhombus"})}function uie(){return u(nt,{tool:"heart"})}function hie(){return u(nt,{tool:"hexagon"})}function pie(){return u(nt,{tool:"cloud"})}function fie(){return u(nt,{tool:"star"})}function gie(){return u(nt,{tool:"oval"})}function mie(){return u(nt,{tool:"x-box"})}function yie(){return u(nt,{tool:"check-box"})}function Sie(){return u(nt,{tool:"arrow-left"})}function vie(){return u(nt,{tool:"arrow-up"})}function bie(){return u(nt,{tool:"arrow-down"})}function wie(){return u(nt,{tool:"arrow-right"})}function _ie(){return u(nt,{tool:"line"})}function xie(){return u(nt,{tool:"highlight"})}function Pie(){return u(nt,{tool:"frame"})}function Iie(){return u(nt,{tool:"laser"})}const tg=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function ng(t,e,n,r){t.addEventListener?t.addEventListener(e,n,r):t.attachEvent&&t.attachEvent("on".concat(e),n)}function Za(t,e,n,r){t.removeEventListener?t.removeEventListener(e,n,r):t.detachEvent&&t.detachEvent("on".concat(e),n)}function y$(t,e){const n=e.slice(0,e.length-1);for(let r=0;r<n.length;r++)n[r]=t[n[r].toLowerCase()];return n}function S$(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let n=e.lastIndexOf("");for(;n>=0;)e[n-1]+=",",e.splice(n,1),n=e.lastIndexOf("");return e}function Cie(t,e){const n=t.length>=e.length?t:e,r=t.length>=e.length?e:t;let o=!0;for(let i=0;i<n.length;i++)r.indexOf(n[i])===-1&&(o=!1);return o}const Nc={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":tg?173:189,"=":tg?61:187,";":tg?59:186,"'":222,"[":219,"]":221,"\\":220},Jr={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},cy={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Ut={16:!1,18:!1,17:!1,91:!1},St={};for(let t=1;t<20;t++)Nc["f".concat(t)]=111+t;let ot=[],yc=null,v$="all";const fo=new Map,ml=t=>Nc[t.toLowerCase()]||Jr[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),Eie=t=>Object.keys(Nc).find(e=>Nc[e]===t),Tie=t=>Object.keys(Jr).find(e=>Jr[e]===t);function b$(t){v$=t||"all"}function Fc(){return v$||"all"}function kie(){return ot.slice(0)}function Mie(){return ot.map(t=>Eie(t)||Tie(t)||String.fromCharCode(t))}function Aie(){const t=[];return Object.keys(St).forEach(e=>{St[e].forEach(n=>{let{key:r,scope:o,mods:i,shortcut:s}=n;t.push({scope:o,shortcut:s,mods:i,keys:r.split("+").map(a=>ml(a))})})}),t}function Oie(t){const e=t.target||t.srcElement,{tagName:n}=e;let r=!0;const o=n==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(o||n==="TEXTAREA"||n==="SELECT")&&!e.readOnly)&&(r=!1),r}function Die(t){return typeof t=="string"&&(t=ml(t)),ot.indexOf(t)!==-1}function $ie(t,e){let n,r;t||(t=Fc());for(const o in St)if(Object.prototype.hasOwnProperty.call(St,o))for(n=St[o],r=0;r<n.length;)n[r].scope===t?n.splice(r,1).forEach(s=>{let{element:a}=s;return ob(a)}):r++;Fc()===t&&b$(e||"all")}function Rie(t){let e=t.keyCode||t.which||t.charCode;const n=ot.indexOf(e);if(n>=0&&ot.splice(n,1),t.key&&t.key.toLowerCase()==="meta"&&ot.splice(0,ot.length),(e===93||e===224)&&(e=91),e in Ut){Ut[e]=!1;for(const r in Jr)Jr[r]===e&&(An[r]=!1)}}function w$(t){if(typeof t>"u")Object.keys(St).forEach(o=>{Array.isArray(St[o])&&St[o].forEach(i=>hd(i)),delete St[o]}),ob(null);else if(Array.isArray(t))t.forEach(o=>{o.key&&hd(o)});else if(typeof t=="object")t.key&&hd(t);else if(typeof t=="string"){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];let[o,i]=n;typeof o=="function"&&(i=o,o=""),hd({key:t,scope:o,method:i,splitKey:"+"})}}const hd=t=>{let{key:e,scope:n,method:r,splitKey:o="+"}=t;S$(e).forEach(s=>{const a=s.split(o),c=a.length,l=a[c-1],d=l==="*"?"*":ml(l);if(!St[d])return;n||(n=Fc());const h=c>1?y$(Jr,a):[],p=[];St[d]=St[d].filter(f=>{const m=(r?f.method===r:!0)&&f.scope===n&&Cie(f.mods,h);return m&&p.push(f.element),!m}),p.forEach(f=>ob(f))})};function T_(t,e,n,r){if(e.element!==r)return;let o;if(e.scope===n||e.scope==="all"){o=e.mods.length>0;for(const i in Ut)Object.prototype.hasOwnProperty.call(Ut,i)&&(!Ut[i]&&e.mods.indexOf(+i)>-1||Ut[i]&&e.mods.indexOf(+i)===-1)&&(o=!1);(e.mods.length===0&&!Ut[16]&&!Ut[18]&&!Ut[17]&&!Ut[91]||o||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(ot),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function k_(t,e){const n=St["*"];let r=t.keyCode||t.which||t.charCode;if(!An.filter.call(this,t))return;if((r===93||r===224)&&(r=91),ot.indexOf(r)===-1&&r!==229&&ot.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(a=>{const c=cy[a];t[a]&&ot.indexOf(c)===-1?ot.push(c):!t[a]&&ot.indexOf(c)>-1?ot.splice(ot.indexOf(c),1):a==="metaKey"&&t[a]&&ot.length===3&&(t.ctrlKey||t.shiftKey||t.altKey||(ot=ot.slice(ot.indexOf(c))))}),r in Ut){Ut[r]=!0;for(const a in Jr)Jr[a]===r&&(An[a]=!0);if(!n)return}for(const a in Ut)Object.prototype.hasOwnProperty.call(Ut,a)&&(Ut[a]=t[cy[a]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(ot.indexOf(17)===-1&&ot.push(17),ot.indexOf(18)===-1&&ot.push(18),Ut[17]=!0,Ut[18]=!0);const o=Fc();if(n)for(let a=0;a<n.length;a++)n[a].scope===o&&(t.type==="keydown"&&n[a].keydown||t.type==="keyup"&&n[a].keyup)&&T_(t,n[a],o,e);if(!(r in St))return;const i=St[r],s=i.length;for(let a=0;a<s;a++)if((t.type==="keydown"&&i[a].keydown||t.type==="keyup"&&i[a].keyup)&&i[a].key){const c=i[a],{splitKey:l}=c,d=c.key.split(l),h=[];for(let p=0;p<d.length;p++)h.push(ml(d[p]));h.sort().join("")===ot.sort().join("")&&T_(t,c,o,e)}}function An(t,e,n){ot=[];const r=S$(t);let o=[],i="all",s=document,a=0,c=!1,l=!0,d="+",h=!1,p=!1;for(n===void 0&&typeof e=="function"&&(n=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(i=e.scope),e.element&&(s=e.element),e.keyup&&(c=e.keyup),e.keydown!==void 0&&(l=e.keydown),e.capture!==void 0&&(h=e.capture),typeof e.splitKey=="string"&&(d=e.splitKey),e.single===!0&&(p=!0)),typeof e=="string"&&(i=e),p&&w$(t,i);a<r.length;a++)t=r[a].split(d),o=[],t.length>1&&(o=y$(Jr,t)),t=t[t.length-1],t=t==="*"?"*":ml(t),t in St||(St[t]=[]),St[t].push({keyup:c,keydown:l,scope:i,mods:o,shortcut:r[a],method:n,key:r[a],splitKey:d,element:s});if(typeof s<"u"&&window){if(!fo.has(s)){const f=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return k_(m,s)},g=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;k_(m,s),Rie(m)};fo.set(s,{keydownListener:f,keyupListenr:g,capture:h}),ng(s,"keydown",f,h),ng(s,"keyup",g,h)}if(!yc){const f=()=>{ot=[]};yc={listener:f,capture:h},ng(window,"focus",f,h)}}}function Lie(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(St).forEach(n=>{St[n].filter(o=>o.scope===e&&o.shortcut===t).forEach(o=>{o&&o.method&&o.method()})})}function ob(t){const e=Object.values(St).flat();if(e.findIndex(r=>{let{element:o}=r;return o===t})<0){const{keydownListener:r,keyupListenr:o,capture:i}=fo.get(t)||{};r&&o&&(Za(t,"keyup",o,i),Za(t,"keydown",r,i),fo.delete(t))}if((e.length<=0||fo.size<=0)&&(Object.keys(fo).forEach(o=>{const{keydownListener:i,keyupListenr:s,capture:a}=fo.get(o)||{};i&&s&&(Za(o,"keyup",s,a),Za(o,"keydown",i,a),fo.delete(o))}),fo.clear(),Object.keys(St).forEach(o=>delete St[o]),yc)){const{listener:o,capture:i}=yc;Za(window,"focus",o,i),yc=null}}const rg={getPressedKeyString:Mie,setScope:b$,getScope:Fc,deleteScope:$ie,getPressedKeyCodes:kie,getAllKeyCodes:Aie,isPressed:Die,filter:Oie,trigger:Lie,unbind:w$,keyMap:Nc,modifier:Jr,modifierMap:cy};for(const t in rg)Object.prototype.hasOwnProperty.call(rg,t)&&(An[t]=rg[t]);if(typeof window<"u"){const t=window.hotkeys;An.noConflict=e=>(e&&window.hotkeys===An&&(window.hotkeys=t),An),window.hotkeys=An}const M_=["copy","cut","paste","asset"];function Nie(){const t=F(),e=No(),n=ls(),r=$v(),o=U("is focused",()=>t.getInstanceState().isFocused,[t]);q(()=>{if(!o)return;const i=new Array,s=(c,l)=>{An(c,{element:document.body},l),i.push(()=>{An.unbind(c,l)})},a=(c,l)=>{An(c,{element:document.body,keyup:!0,keydown:!1},l),i.push(()=>{An.unbind(c,l)})};for(const c of Object.values(n))c.kbd&&(e&&!c.readonlyOk||M_.includes(c.id)||s(A_(c.kbd),l=>{ac(t)||(Ce(l),c.onSelect("kbd"))}));for(const c of Object.values(r))!c.kbd||!c.readonlyOk&&t.getIsReadonly()||M_.includes(c.id)||s(A_(c.kbd),l=>{ac(t)||(Ce(l),c.onSelect("kbd"))});return s(",",c=>{if(ac(t)||t.inputs.keys.has("Comma"))return;Ce(c),t.focus(),t.inputs.keys.add("Comma");const{x:l,y:d,z:h}=t.inputs.currentPagePoint,p=t.pageToScreen({x:l,y:d}),f={type:"pointer",name:"pointer_down",point:{x:p.x,y:p.y,z:h},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,metaKey:c.metaKey,accelKey:rn(c),pointerId:0,button:0,isPen:t.getInstanceState().isPenMode,target:"canvas"};t.dispatch(f)}),a(",",c=>{if(ac(t)||!t.inputs.keys.has("Comma"))return;t.inputs.keys.delete("Comma");const{x:l,y:d,z:h}=t.inputs.currentScreenPoint,p={type:"pointer",name:"pointer_up",point:{x:l,y:d,z:h},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,metaKey:c.metaKey,accelKey:rn(c),pointerId:0,button:0,isPen:t.getInstanceState().isPenMode,target:"canvas"};t.dispatch(p)}),()=>{i.forEach(c=>c())}},[n,r,e,t,o])}function A_(t){return Fie(t).map(e=>{let n="";const r=e.split("");return r.length===1?n=r[0]:r[0]==="!"?n=`shift+${r[1]}`:r[0]==="?"?r.length===3&&r[1]==="!"?n=`alt+shift+${r[2]}`:n=`alt+${r[1]}`:r[0]==="$"?r[1]==="!"?n=`cmd+shift+${r[2]},ctrl+shift+${r[2]}`:r[1]==="?"?n=`cmd+⌥+${r[2]},ctrl+alt+${r[2]}`:n=`cmd+${r[1]},ctrl+${r[1]}`:n=e,n}).join(",")}function Fie(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let n=e.lastIndexOf("");for(;n>=0;)e[n-1]+=",",e.splice(n,1),n=e.lastIndexOf("");return e}function ac(t){return t.menus.hasAnyOpenMenus()||t.getEditingShapeId()!==null||t.getCrashingError()}const zie=Ze(!1);function Bie({children:t}){const e=F(),n=fC(),r=Sn(),o=Ae(),i=Math.min(8,5+r),[s,a]=Q(0),c=B(null),[l,d]=Q(null),h=ce(()=>{const f=l?`:not([data-value="${l}"])`:"";return`
			#${n}_main > *:nth-child(n + ${i+(l?1:2)})${f} {
				display: none;
			}
			#${n}_more > *:nth-child(-n + ${i}) {
				display: none;
			}
        `},[l,n,i]),p=Oh(()=>{if(!c.current)return;const f=Array.from(c.current.children);a(f.length),f.findIndex(y=>y.getAttribute("data-value")===l)<=i&&d(null);const m=Array.from(c.current.children).findIndex(y=>y.getAttribute("aria-checked")==="true");m!==-1&&m>=i&&d(f[m].getAttribute("data-value"))});return je(()=>{p()}),je(()=>{if(!c.current)return;const f=new MutationObserver(p);return f.observe(c.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-checked"]}),()=>{f.disconnect()}},[p]),q(()=>{const f=[["1",0],["2",1],["3",2],["4",3],["5",4],["6",5],["7",6],["8",7],["9",8],["0",9]];for(const[g,m]of f)An(g,y=>{var _;if(ac(e))return;Ce(y);const v=Array.from(((_=c.current)==null?void 0:_.children)??[]).filter(w=>!(w instanceof HTMLElement)||w.tagName.toLowerCase()!=="button"?!1:!!(w.offsetWidth||w.offsetHeight))[m];v&&v.click()});return()=>{An.unbind("1,2,3,4,5,6,7,8,9,0")}},[e]),u(Z,{children:[u("style",{children:h}),u("div",{className:de("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":r<wt.TABLET_SM}),role:"radiogroup",children:[u("div",{id:`${n}_main`,ref:c,className:"tlui-toolbar__tools__list",children:u(lr,{type:"toolbar",sourceId:"toolbar",children:t})}),s>i+1&&u(zie.Provider,{value:!0,children:u(Zi,{id:"toolbar overflow",modal:!1,children:[u(Ji,{children:u(ue,{title:o("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:u(ke,{icon:"chevron-up"})})}),u(Qi,{side:"top",align:"center",children:u("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",id:`${n}_more`,children:u(lr,{type:"toolbar-overflow",sourceId:"toolbar",children:t})})})]})})]})]})}function Uie({activeToolId:t}){const e=F(),n=Sn(),r=Ae(),o=U("is tool locked",()=>e.getInstanceState().isToolLocked,[e]),i=U("current tool",()=>e.getCurrentTool(),[e]);return!t||!i.isLockable?null:u(ue,{type:"normal",title:r("action.toggle-tool-lock"),"data-testid":"tool-lock",className:de("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":n<wt.TABLET_SM}),onClick:()=>e.updateInstanceState({isToolLocked:!o}),children:u(ke,{icon:o?"lock":"unlock",small:!0})})}const Hie=$e(function({children:e}){const n=F(),r=Sn(),o=No(),i=U("current tool id",()=>n.getCurrentToolId(),[n]),s=B(null);vi(s);const{ActionsMenu:a,QuickActions:c}=xi(),l=n.options.actionShortcutsLocation==="menu"?!1:n.options.actionShortcutsLocation==="toolbar"?!0:r<wt.TABLET;return u("div",{ref:s,className:"tlui-toolbar",children:u("div",{className:"tlui-toolbar__inner",children:[u("div",{className:"tlui-toolbar__left",children:[!o&&u("div",{className:"tlui-toolbar__extras",children:[l&&u("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[c&&u(c,{}),a&&u(a,{})]}),u(Uie,{activeToolId:i})]}),u(Bie,{children:e??u(qoe,{})})]}),r<wt.TABLET_SM&&!o&&u("div",{className:"tlui-toolbar__tools",children:u(Xoe,{})})]})})});function jie(){const t=Ae();return u("div",{className:de("tlui-offline-indicator"),children:[t("status.offline"),u(Xr,{"aria-label":"offline",icon:"status-offline",small:!0})]})}function Kie({maxWidth:t=420,ignoreRightWidth:e=0,stylePanelWidth:n=148,marginBetweenZones:r=12,squeezeAmount:o=52,children:i}){const s=B(null),a=Sn(),c=V(()=>{const l=s.current;if(!l)return;const d=l.parentElement.parentElement,h=d.querySelector(".tlui-layout__top__left"),p=d.querySelector(".tlui-layout__top__right"),f=d.offsetWidth,g=h.offsetWidth,m=p.offsetWidth,y=l.offsetWidth-e;let S=(f-y)/2;f%2!==0&&(S-=.5);const v=g+r,_=l.offsetLeft,w=Math.min(f-m-g-2*r,t),x=Math.max(S,v)-_;p.offsetWidth>n&&a<=6?l.style.setProperty("max-width",w-o+"px"):l.style.setProperty("max-width",w+"px"),l.style.setProperty("transform",`translate(${x}px, 0px)`)},[a,e,r,t,o,n]);return je(()=>{const l=s.current;if(!l)return;const d=l.parentElement.parentElement,h=d.querySelector(".tlui-layout__top__left"),p=d.querySelector(".tlui-layout__top__right"),f=new ResizeObserver(c);return f.observe(h),f.observe(p),f.observe(d),f.observe(l),c(),()=>{f.disconnect()}},[c]),je(()=>{c()}),u("div",{ref:s,className:"tlui-top-panel__container",children:i})}function Wie(){const t=eq()==="offline";return u(Kie,{children:t&&u(jie,{})})}function Gie(){return u(Z,{children:[u(H,{actionId:"zoom-in",noClose:!0}),u(H,{actionId:"zoom-out",noClose:!0}),u(TD,{}),u(kD,{}),u(MD,{})]})}const Vie=$e(function({children:e}){const n=At(),[r,o]=Fo("zoom menu");return u(Av,{dir:"ltr",open:r,onOpenChange:o,modal:!1,children:[u(Ov,{asChild:!0,dir:"ltr",children:u(Yie,{})}),u(sp,{container:n,children:u(Dv,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:u(lr,{type:"menu",sourceId:"zoom-menu",children:e??u(Gie,{})})})})]})}),Yie=X(function(e,n){const r=F(),o=Sn(),i=U("zoom",()=>r.getZoomLevel(),[r]),s=Ae(),a=V(()=>{r.resetZoom(r.getViewportScreenCenter(),{animation:{duration:r.options.animationMediumMs}})},[r]);return u(ue,{ref:n,...e,type:"icon",title:`${s("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu-button",className:o<wt.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:a,children:o<wt.MOBILE?null:u("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(i*100),"%"]})})}),_$=Ze(null);function Xie({overrides:t={},children:e}){const n=tl(t),r=Jh();return u(_$.Provider,{value:ce(()=>({ContextMenu:dre,ActionsMenu:Nne,HelpMenu:null,ZoomMenu:Vie,MainMenu:Gre,Minimap:noe,StylePanel:Yoe,PageMenu:soe,NavigationPanel:ooe,Toolbar:Hie,KeyboardShortcutsDialog:Dre,QuickActions:coe,HelperButtons:Are,DebugPanel:_re,DebugMenu:wre,MenuPanel:Cre,SharePanel:r?goe:null,CursorChatBubble:r?pre:null,TopPanel:r?Wie:null,...n}),[n,r]),children:e})}function xi(){const t=tt(_$);if(!t)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return t}const qie=Nt(function({overrides:e,components:n,assetUrls:r,onUiEvent:o,forceMobile:i,mediaMimeTypes:s,children:a}){const c=F();return u(Yk.Provider,{value:s,children:u(BY,{assetUrls:ane(r),children:u(jY,{overrides:dne(e),locale:c.user.getLocale(),children:u(uY,{onEvent:o,children:u(zY,{children:u(hY,{context:c.contextId,children:u(ZJ,{forceMobile:i,children:u(Xie,{overrides:n,children:u(Zie,{overrides:e,children:a})})})})})})})})})});function Zie({overrides:t,children:e}){const n=une(t);return u(rq,{overrides:n.actions,children:u(iQ,{overrides:n.tools,children:e})})}function Jie(){const t=F(),{addToast:e}=to();q(()=>{function n({name:r,count:o}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${r} (${o}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return t.addListener("max-shapes",n),()=>{t.removeListener("max-shapes",n)}},[t,e])}const Qie=we.memo(function({renderDebugMenuItems:e,children:n,hideUi:r,components:o,...i}){return u(qie,{...i,components:o,children:u(ese,{hideUi:r,renderDebugMenuItems:e,children:n})})}),ese=we.memo(function({children:e,hideUi:n,...r}){return u(Z,{children:[e,n?null:u(tse,{...r})]})}),tse=we.memo(function(){const e=F(),n=Ae(),r=Sn(),o=No(),i=U("focus",()=>e.getInstanceState().isFocusMode,[e]),s=U("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:a,TopPanel:c,MenuPanel:l,StylePanel:d,Toolbar:h,HelpMenu:p,NavigationPanel:f,HelperButtons:g,DebugPanel:m,CursorChatBubble:y}=xi();Nie(),TX(),Jie();const{"toggle-focus-mode":S}=ls();return u("div",{className:de("tlui-layout",{"tlui-layout__mobile":r<wt.TABLET_SM}),"data-breakpoint":r,children:[i?u("div",{className:"tlui-layout__top",children:u(ue,{type:"icon",className:"tlui-focus-button",title:n("focus-mode.toggle-focus-mode"),onClick:()=>S.onSelect("menu"),children:u(ke,{icon:"dot"})})}):u(Z,{children:[u("div",{className:"tlui-layout__top",children:[u("div",{className:"tlui-layout__top__left",children:[l&&u(l,{}),g&&u(g,{})]}),u("div",{className:"tlui-layout__top__center",children:c&&u(c,{})}),u("div",{className:"tlui-layout__top__right",children:[a&&u(a,{}),d&&r>=wt.TABLET_SM&&!o&&u(d,{})]})]}),u("div",{className:"tlui-layout__bottom",children:[u("div",{className:"tlui-layout__bottom__main",children:[f&&u(f,{}),h&&u(h,{}),p&&u(p,{})]}),s&&m&&u(m,{})]})]}),u(VY,{}),u(fY,{}),u(one,{}),y&&u(y,{})]})});async function nse(t,e){const{url:n,style:r="normal",weight:o="500",display:i,featureSettings:s,stretch:a,unicodeRange:c,variant:l,format:d}=e,h={style:r,weight:o,display:i,featureSettings:s,stretch:a,unicodeRange:c,variant:l},p=new FontFace(t,`url(${n})`,h);return await p.load(),document.fonts.add(p),p.$$_url=n,p.$$_fontface=`
@font-face {
	font-family: ${p.family};
	font-stretch: ${p.stretch};
	font-weight: ${p.weight};
	font-style: ${p.style};
	src: url("${n}") format("${d}")
}`,p}const pd=(t,e)=>{const[n,r]=Q(2);return q(()=>{let o=!1;return r(2),nse(t,e).then(()=>{o||r(0)}).catch(i=>{o||(console.error(i),r(1))}),()=>{o=!0}},[t,e]),n};function rse(t){return{draw:{url:t.fonts.draw,format:t.fonts.draw.split(".").pop()},serif:{url:t.fonts.serif,format:t.fonts.serif.split(".").pop()},sansSerif:{url:t.fonts.sansSerif,format:t.fonts.sansSerif.split(".").pop()},monospace:{url:t.fonts.monospace,format:t.fonts.monospace.split(".").pop()}}}function x$(t){const e=ce(()=>rse(t),[t]),n=[pd("tldraw_draw",e.draw),pd("tldraw_serif",e.serif),pd("tldraw_sans",e.sansSerif),pd("tldraw_mono",e.monospace)];return{error:n.some(r=>r===1),done:!n.some(r=>r===2)}}function ose(t){const{children:e,maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:o,acceptedVideoMimeTypes:i,onMount:s,components:a={},shapeUtils:c=[],bindingUtils:l=[],tools:d=[],embeds:h,...p}=t,f=tl(a),g=ce(()=>({Scribble:U1,ShapeIndicators:mQ,CollaboratorScribble:U1,SelectionForeground:pQ,SelectionBackground:uQ,Handles:sQ,...f}),[f]),m=Jo(c),y=ce(()=>[...yO,...m],[m]),S=Jo(l),v=ce(()=>[...BA,...S],[S]),_=Jo(d),w=ce(()=>[...rne,...qQ,..._],[_]),x=Jo(o??ah),C=Jo(i??Ty),E=ce(()=>[...x,...C],[x,C]),I=tD(p.assetUrls),{done:T,error:k}=x$(I);return k?u(j2,{children:"Could not load assets. Please refresh the page."}):T?u(bG,{initialState:"select",...p,components:g,shapeUtils:y,bindingUtils:v,tools:w,children:u(Qie,{...p,components:g,mediaMimeTypes:E,children:[u(ise,{maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:x,acceptedVideoMimeTypes:C,onMount:s,embeds:h}),e]})}):u(KS,{children:u(TS,{})})}function ise({maxImageDimension:t=5e3,maxAssetSize:e=10*1024*1024,acceptedImageMimeTypes:n=ah,acceptedVideoMimeTypes:r=Ty,onMount:o,embeds:i}){const s=F(),a=to(),c=Ae();K2(()=>{const h=s.getShapeUtil("embed");h&&i&&h.setEmbedDefinitions(i);const p=[];return p.push(Ete(s)),DQ(s,{maxImageDimension:t,maxAssetSize:e,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:r},{toasts:a,msg:c}),p.push(s.store.props.onMount(s)),p.push(o==null?void 0:o(s)),()=>{p.forEach(f=>f==null?void 0:f())}});const{Canvas:l}=ht(),{ContextMenu:d}=xi();return d?u(d,{}):l?u(l,{}):null}$e(function(e){const[n,r]=Q(null),[o,i]=Q(null),s=Jo(e.shapeUtils??[]),a=ce(()=>[...yO,...s],[s]),c=Jo(e.bindingUtils??[]),l=ce(()=>[...BA,...c],[c]),d=EG({snapshot:e.snapshot,shapeUtils:a}),h=tD(e.assetUrls),{done:p,error:f}=x$(h),{pageId:g,bounds:m,scale:y,background:S,padding:v,darkMode:_,preserveAspectRatio:w,format:x="svg",licenseKey:C}=e;return je(()=>{if(!o||!d||!p)return;let E=!1;const I=document.createElement("div");o.appendChild(I),o.classList.add("tl-container","tl-theme__light");const T=new te({store:d,shapeUtils:a,bindingUtils:l,tools:[],getContainer:()=>I,licenseKey:C});g&&T.setCurrentPage(g);const k=T.getCurrentPageShapeIds();async function D(){const A=await T.getSvgString([...k],{bounds:m,scale:y,background:S,padding:v,darkMode:_,preserveAspectRatio:w});if(A&&!E){if(x==="svg"){if(!E){const O=new Blob([A.svg],{type:"image/svg+xml"}),$=URL.createObjectURL(O);r($)}}else if(x==="png"){const O=await Wk(T,A.svg,{type:x,quality:1,scale:2,width:A.width,height:A.height});if(O&&!E){const $=URL.createObjectURL(O);r($)}}}T.dispose()}return D(),()=>{E=!0}},[x,o,d,a,l,g,m,y,S,v,_,w,p,f,C]),f?u(j2,{children:"Could not load assets."}):p?u("div",{ref:i,style:{position:"relative",width:"100%",height:"100%"},children:n&&u("img",{src:n,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})}):u(KS,{children:u(TS,{})})});$e(function({children:e}){const n=Ae(),r=Sn(),o=B(null);vi(o);const i=e??u(Lre,{});return r<wt.MOBILE?null:u("div",{ref:o,className:"tlui-help-menu",children:u(Zi,{id:"help menu",children:[u(Ji,{children:u(ue,{type:"help",title:n("help-menu.title"),"data-testid":"help-menu.button",children:u(ke,{icon:"question-mark",small:!0})})}),u(Qi,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:u(lr,{type:"menu",sourceId:"help-menu",children:i})})]})})});const sse=Me({schemaVersion:cn(1),storeVersion:_d,recordVersions:xu(Se,Me({version:_d,subTypeVersions:xu(Se,_d).optional(),subTypeKey:Se.optional()}))}),ase=Me({schemaVersion:cn(2),sequences:xu(Se,_d)});Me({tldrawFileFormatVersion:o9,schema:i9("schemaVersion",{1:sse,2:ase}),records:Kt(Me({id:Se,typeName:Se}).allowUnknownProperties())});fi("tldraw","3.3.1","esm");function cse(){return u("div",{style:{position:"fixed",inset:0},children:u(ose,{})})}var On=function(){return On=Object.assign||function(e){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},On.apply(this,arguments)};function eh(t,e,n){if(n||arguments.length===2)for(var r=0,o=e.length,i;r<o;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}var lse=function(e,n,r,o){var i=r?r.call(o,e,n):void 0;if(i!==void 0)return!!i;if(e===n)return!0;if(typeof e!="object"||!e||typeof n!="object"||!n)return!1;var s=Object.keys(e),a=Object.keys(n);if(s.length!==a.length)return!1;for(var c=Object.prototype.hasOwnProperty.bind(n),l=0;l<s.length;l++){var d=s[l];if(!c(d))return!1;var h=e[d],p=n[d];if(i=r?r.call(o,h,p,d):void 0,i===!1||i===void 0&&h!==p)return!1}return!0};const dse=ts(lse);var dt="-ms-",Sc="-moz-",Ge="-webkit-",P$="comm",vp="rule",ib="decl",use="@import",I$="@keyframes",hse="@layer",C$=Math.abs,sb=String.fromCharCode,ly=Object.assign;function pse(t,e){return Dt(t,0)^45?(((e<<2^Dt(t,0))<<2^Dt(t,1))<<2^Dt(t,2))<<2^Dt(t,3):0}function E$(t){return t.trim()}function go(t,e){return(t=e.exec(t))?t[0]:t}function Ie(t,e,n){return t.replace(e,n)}function eu(t,e,n){return t.indexOf(e,n)}function Dt(t,e){return t.charCodeAt(e)|0}function oa(t,e,n){return t.slice(e,n)}function Nr(t){return t.length}function T$(t){return t.length}function cc(t,e){return e.push(t),t}function fse(t,e){return t.map(e).join("")}function O_(t,e){return t.filter(function(n){return!go(n,e)})}var bp=1,ia=1,k$=0,dr=0,Et=0,Ea="";function wp(t,e,n,r,o,i,s,a){return{value:t,root:e,parent:n,type:r,props:o,children:i,line:bp,column:ia,length:s,return:"",siblings:a}}function Xo(t,e){return ly(wp("",null,null,"",null,null,0,t.siblings),t,{length:-t.length},e)}function xs(t){for(;t.root;)t=Xo(t.root,{children:[t]});cc(t,t.siblings)}function gse(){return Et}function mse(){return Et=dr>0?Dt(Ea,--dr):0,ia--,Et===10&&(ia=1,bp--),Et}function xr(){return Et=dr<k$?Dt(Ea,dr++):0,ia++,Et===10&&(ia=1,bp++),Et}function zi(){return Dt(Ea,dr)}function tu(){return dr}function _p(t,e){return oa(Ea,t,e)}function dy(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function yse(t){return bp=ia=1,k$=Nr(Ea=t),dr=0,[]}function Sse(t){return Ea="",t}function og(t){return E$(_p(dr-1,uy(t===91?t+2:t===40?t+1:t)))}function vse(t){for(;(Et=zi())&&Et<33;)xr();return dy(t)>2||dy(Et)>3?"":" "}function bse(t,e){for(;--e&&xr()&&!(Et<48||Et>102||Et>57&&Et<65||Et>70&&Et<97););return _p(t,tu()+(e<6&&zi()==32&&xr()==32))}function uy(t){for(;xr();)switch(Et){case t:return dr;case 34:case 39:t!==34&&t!==39&&uy(Et);break;case 40:t===41&&uy(t);break;case 92:xr();break}return dr}function wse(t,e){for(;xr()&&t+Et!==57;)if(t+Et===84&&zi()===47)break;return"/*"+_p(e,dr-1)+"*"+sb(t===47?t:xr())}function _se(t){for(;!dy(zi());)xr();return _p(t,dr)}function xse(t){return Sse(nu("",null,null,null,[""],t=yse(t),0,[0],t))}function nu(t,e,n,r,o,i,s,a,c){for(var l=0,d=0,h=s,p=0,f=0,g=0,m=1,y=1,S=1,v=0,_="",w=o,x=i,C=r,E=_;y;)switch(g=v,v=xr()){case 40:if(g!=108&&Dt(E,h-1)==58){eu(E+=Ie(og(v),"&","&\f"),"&\f",C$(l?a[l-1]:0))!=-1&&(S=-1);break}case 34:case 39:case 91:E+=og(v);break;case 9:case 10:case 13:case 32:E+=vse(g);break;case 92:E+=bse(tu()-1,7);continue;case 47:switch(zi()){case 42:case 47:cc(Pse(wse(xr(),tu()),e,n,c),c);break;default:E+="/"}break;case 123*m:a[l++]=Nr(E)*S;case 125*m:case 59:case 0:switch(v){case 0:case 125:y=0;case 59+d:S==-1&&(E=Ie(E,/\f/g,"")),f>0&&Nr(E)-h&&cc(f>32?$_(E+";",r,n,h-1,c):$_(Ie(E," ","")+";",r,n,h-2,c),c);break;case 59:E+=";";default:if(cc(C=D_(E,e,n,l,d,o,a,_,w=[],x=[],h,i),i),v===123)if(d===0)nu(E,e,C,C,w,i,h,a,x);else switch(p===99&&Dt(E,3)===110?100:p){case 100:case 108:case 109:case 115:nu(t,C,C,r&&cc(D_(t,C,C,0,0,o,a,_,o,w=[],h,x),x),o,x,h,a,r?w:x);break;default:nu(E,C,C,C,[""],x,0,a,x)}}l=d=f=0,m=S=1,_=E="",h=s;break;case 58:h=1+Nr(E),f=g;default:if(m<1){if(v==123)--m;else if(v==125&&m++==0&&mse()==125)continue}switch(E+=sb(v),v*m){case 38:S=d>0?1:(E+="\f",-1);break;case 44:a[l++]=(Nr(E)-1)*S,S=1;break;case 64:zi()===45&&(E+=og(xr())),p=zi(),d=h=Nr(_=E+=_se(tu())),v++;break;case 45:g===45&&Nr(E)==2&&(m=0)}}return i}function D_(t,e,n,r,o,i,s,a,c,l,d,h){for(var p=o-1,f=o===0?i:[""],g=T$(f),m=0,y=0,S=0;m<r;++m)for(var v=0,_=oa(t,p+1,p=C$(y=s[m])),w=t;v<g;++v)(w=E$(y>0?f[v]+" "+_:Ie(_,/&\f/g,f[v])))&&(c[S++]=w);return wp(t,e,n,o===0?vp:a,c,l,d,h)}function Pse(t,e,n,r){return wp(t,e,n,P$,sb(gse()),oa(t,2,-2),0,r)}function $_(t,e,n,r,o){return wp(t,e,n,ib,oa(t,0,r),oa(t,r+1,-1),r,o)}function M$(t,e,n){switch(pse(t,e)){case 5103:return Ge+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Ge+t+t;case 4789:return Sc+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return Ge+t+Sc+t+dt+t+t;case 5936:switch(Dt(t,e+11)){case 114:return Ge+t+dt+Ie(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return Ge+t+dt+Ie(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return Ge+t+dt+Ie(t,/[svh]\w+-[tblr]{2}/,"lr")+t}case 6828:case 4268:case 2903:return Ge+t+dt+t+t;case 6165:return Ge+t+dt+"flex-"+t+t;case 5187:return Ge+t+Ie(t,/(\w+).+(:[^]+)/,Ge+"box-$1$2"+dt+"flex-$1$2")+t;case 5443:return Ge+t+dt+"flex-item-"+Ie(t,/flex-|-self/g,"")+(go(t,/flex-|baseline/)?"":dt+"grid-row-"+Ie(t,/flex-|-self/g,""))+t;case 4675:return Ge+t+dt+"flex-line-pack"+Ie(t,/align-content|flex-|-self/g,"")+t;case 5548:return Ge+t+dt+Ie(t,"shrink","negative")+t;case 5292:return Ge+t+dt+Ie(t,"basis","preferred-size")+t;case 6060:return Ge+"box-"+Ie(t,"-grow","")+Ge+t+dt+Ie(t,"grow","positive")+t;case 4554:return Ge+Ie(t,/([^-])(transform)/g,"$1"+Ge+"$2")+t;case 6187:return Ie(Ie(Ie(t,/(zoom-|grab)/,Ge+"$1"),/(image-set)/,Ge+"$1"),t,"")+t;case 5495:case 3959:return Ie(t,/(image-set\([^]*)/,Ge+"$1$`$1");case 4968:return Ie(Ie(t,/(.+:)(flex-)?(.*)/,Ge+"box-pack:$3"+dt+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Ge+t+t;case 4200:if(!go(t,/flex-|baseline/))return dt+"grid-column-align"+oa(t,e)+t;break;case 2592:case 3360:return dt+Ie(t,"template-","")+t;case 4384:case 3616:return n&&n.some(function(r,o){return e=o,go(r.props,/grid-\w+-end/)})?~eu(t+(n=n[e].value),"span",0)?t:dt+Ie(t,"-start","")+t+dt+"grid-row-span:"+(~eu(n,"span",0)?go(n,/\d+/):+go(n,/\d+/)-+go(t,/\d+/))+";":dt+Ie(t,"-start","")+t;case 4896:case 4128:return n&&n.some(function(r){return go(r.props,/grid-\w+-start/)})?t:dt+Ie(Ie(t,"-end","-span"),"span ","")+t;case 4095:case 3583:case 4068:case 2532:return Ie(t,/(.+)-inline(.+)/,Ge+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Nr(t)-1-e>6)switch(Dt(t,e+1)){case 109:if(Dt(t,e+4)!==45)break;case 102:return Ie(t,/(.+:)(.+)-([^]+)/,"$1"+Ge+"$2-$3$1"+Sc+(Dt(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~eu(t,"stretch",0)?M$(Ie(t,"stretch","fill-available"),e,n)+t:t}break;case 5152:case 5920:return Ie(t,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(r,o,i,s,a,c,l){return dt+o+":"+i+l+(s?dt+o+"-span:"+(a?c:+c-+i)+l:"")+t});case 4949:if(Dt(t,e+6)===121)return Ie(t,":",":"+Ge)+t;break;case 6444:switch(Dt(t,Dt(t,14)===45?18:11)){case 120:return Ie(t,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Ge+(Dt(t,14)===45?"inline-":"")+"box$3$1"+Ge+"$2$3$1"+dt+"$2box$3")+t;case 100:return Ie(t,":",":"+dt)+t}break;case 5719:case 2647:case 2135:case 3927:case 2391:return Ie(t,"scroll-","scroll-snap-")+t}return t}function th(t,e){for(var n="",r=0;r<t.length;r++)n+=e(t[r],r,t,e)||"";return n}function Ise(t,e,n,r){switch(t.type){case hse:if(t.children.length)break;case use:case ib:return t.return=t.return||t.value;case P$:return"";case I$:return t.return=t.value+"{"+th(t.children,r)+"}";case vp:if(!Nr(t.value=t.props.join(",")))return""}return Nr(n=th(t.children,r))?t.return=t.value+"{"+n+"}":""}function Cse(t){var e=T$(t);return function(n,r,o,i){for(var s="",a=0;a<e;a++)s+=t[a](n,r,o,i)||"";return s}}function Ese(t){return function(e){e.root||(e=e.return)&&t(e)}}function Tse(t,e,n,r){if(t.length>-1&&!t.return)switch(t.type){case ib:t.return=M$(t.value,t.length,n);return;case I$:return th([Xo(t,{value:Ie(t.value,"@","@"+Ge)})],r);case vp:if(t.length)return fse(n=t.props,function(o){switch(go(o,r=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":xs(Xo(t,{props:[Ie(o,/:(read-\w+)/,":"+Sc+"$1")]})),xs(Xo(t,{props:[o]})),ly(t,{props:O_(n,r)});break;case"::placeholder":xs(Xo(t,{props:[Ie(o,/:(plac\w+)/,":"+Ge+"input-$1")]})),xs(Xo(t,{props:[Ie(o,/:(plac\w+)/,":"+Sc+"$1")]})),xs(Xo(t,{props:[Ie(o,/:(plac\w+)/,dt+"input-$1")]})),xs(Xo(t,{props:[o]})),ly(t,{props:O_(n,r)});break}return""})}}var kse={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Un={},sa=typeof process<"u"&&Un!==void 0&&(Un.REACT_APP_SC_ATTR||Un.SC_ATTR)||"data-styled",A$="active",O$="data-styled-version",xp="6.1.13",ab=`/*!sc*/
`,nh=typeof window<"u"&&"HTMLElement"in window,Mse=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&Un!==void 0&&Un.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&Un.REACT_APP_SC_DISABLE_SPEEDY!==""?Un.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&Un.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&Un!==void 0&&Un.SC_DISABLE_SPEEDY!==void 0&&Un.SC_DISABLE_SPEEDY!==""&&Un.SC_DISABLE_SPEEDY!=="false"&&Un.SC_DISABLE_SPEEDY),Pp=Object.freeze([]),aa=Object.freeze({});function Ase(t,e,n){return n===void 0&&(n=aa),t.theme!==n.theme&&t.theme||e||n.theme}var D$=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),Ose=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,Dse=/(^-|-$)/g;function R_(t){return t.replace(Ose,"-").replace(Dse,"")}var $se=/(a)(d)/gi,fd=52,L_=function(t){return String.fromCharCode(t+(t>25?39:97))};function hy(t){var e,n="";for(e=Math.abs(t);e>fd;e=e/fd|0)n=L_(e%fd)+n;return(L_(e%fd)+n).replace($se,"$1-$2")}var ig,$$=5381,Fs=function(t,e){for(var n=e.length;n;)t=33*t^e.charCodeAt(--n);return t},R$=function(t){return Fs($$,t)};function Rse(t){return hy(R$(t)>>>0)}function Lse(t){return t.displayName||t.name||"Component"}function sg(t){return typeof t=="string"&&!0}var L$=typeof Symbol=="function"&&Symbol.for,N$=L$?Symbol.for("react.memo"):60115,Nse=L$?Symbol.for("react.forward_ref"):60112,Fse={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},zse={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},F$={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Bse=((ig={})[Nse]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},ig[N$]=F$,ig);function N_(t){return("type"in(e=t)&&e.type.$$typeof)===N$?F$:"$$typeof"in t?Bse[t.$$typeof]:Fse;var e}var Use=Object.defineProperty,Hse=Object.getOwnPropertyNames,F_=Object.getOwnPropertySymbols,jse=Object.getOwnPropertyDescriptor,Kse=Object.getPrototypeOf,z_=Object.prototype;function z$(t,e,n){if(typeof e!="string"){if(z_){var r=Kse(e);r&&r!==z_&&z$(t,r,n)}var o=Hse(e);F_&&(o=o.concat(F_(e)));for(var i=N_(t),s=N_(e),a=0;a<o.length;++a){var c=o[a];if(!(c in zse||n&&n[c]||s&&c in s||i&&c in i)){var l=jse(e,c);try{Use(t,c,l)}catch{}}}}return t}function ca(t){return typeof t=="function"}function cb(t){return typeof t=="object"&&"styledComponentId"in t}function Ri(t,e){return t&&e?"".concat(t," ").concat(e):t||e||""}function B_(t,e){if(t.length===0)return"";for(var n=t[0],r=1;r<t.length;r++)n+=t[r];return n}function zc(t){return t!==null&&typeof t=="object"&&t.constructor.name===Object.name&&!("props"in t&&t.$$typeof)}function py(t,e,n){if(n===void 0&&(n=!1),!n&&!zc(t)&&!Array.isArray(t))return e;if(Array.isArray(e))for(var r=0;r<e.length;r++)t[r]=py(t[r],e[r]);else if(zc(e))for(var r in e)t[r]=py(t[r],e[r]);return t}function lb(t,e){Object.defineProperty(t,"toString",{value:e})}function yl(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(t," for more information.").concat(e.length>0?" Args: ".concat(e.join(", ")):""))}var Wse=function(){function t(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return t.prototype.indexOfGroup=function(e){for(var n=0,r=0;r<e;r++)n+=this.groupSizes[r];return n},t.prototype.insertRules=function(e,n){if(e>=this.groupSizes.length){for(var r=this.groupSizes,o=r.length,i=o;e>=i;)if((i<<=1)<0)throw yl(16,"".concat(e));this.groupSizes=new Uint32Array(i),this.groupSizes.set(r),this.length=i;for(var s=o;s<i;s++)this.groupSizes[s]=0}for(var a=this.indexOfGroup(e+1),c=(s=0,n.length);s<c;s++)this.tag.insertRule(a,n[s])&&(this.groupSizes[e]++,a++)},t.prototype.clearGroup=function(e){if(e<this.length){var n=this.groupSizes[e],r=this.indexOfGroup(e),o=r+n;this.groupSizes[e]=0;for(var i=r;i<o;i++)this.tag.deleteRule(r)}},t.prototype.getGroup=function(e){var n="";if(e>=this.length||this.groupSizes[e]===0)return n;for(var r=this.groupSizes[e],o=this.indexOfGroup(e),i=o+r,s=o;s<i;s++)n+="".concat(this.tag.getRule(s)).concat(ab);return n},t}(),ru=new Map,rh=new Map,ou=1,gd=function(t){if(ru.has(t))return ru.get(t);for(;rh.has(ou);)ou++;var e=ou++;return ru.set(t,e),rh.set(e,t),e},Gse=function(t,e){ou=e+1,ru.set(t,e),rh.set(e,t)},Vse="style[".concat(sa,"][").concat(O$,'="').concat(xp,'"]'),Yse=new RegExp("^".concat(sa,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),Xse=function(t,e,n){for(var r,o=n.split(","),i=0,s=o.length;i<s;i++)(r=o[i])&&t.registerName(e,r)},qse=function(t,e){for(var n,r=((n=e.textContent)!==null&&n!==void 0?n:"").split(ab),o=[],i=0,s=r.length;i<s;i++){var a=r[i].trim();if(a){var c=a.match(Yse);if(c){var l=0|parseInt(c[1],10),d=c[2];l!==0&&(Gse(d,l),Xse(t,d,c[3]),t.getTag().insertRules(l,o)),o.length=0}else o.push(a)}}},U_=function(t){for(var e=document.querySelectorAll(Vse),n=0,r=e.length;n<r;n++){var o=e[n];o&&o.getAttribute(sa)!==A$&&(qse(t,o),o.parentNode&&o.parentNode.removeChild(o))}};function Zse(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var B$=function(t){var e=document.head,n=t||e,r=document.createElement("style"),o=function(a){var c=Array.from(a.querySelectorAll("style[".concat(sa,"]")));return c[c.length-1]}(n),i=o!==void 0?o.nextSibling:null;r.setAttribute(sa,A$),r.setAttribute(O$,xp);var s=Zse();return s&&r.setAttribute("nonce",s),n.insertBefore(r,i),r},Jse=function(){function t(e){this.element=B$(e),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var r=document.styleSheets,o=0,i=r.length;o<i;o++){var s=r[o];if(s.ownerNode===n)return s}throw yl(17)}(this.element),this.length=0}return t.prototype.insertRule=function(e,n){try{return this.sheet.insertRule(n,e),this.length++,!0}catch{return!1}},t.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},t.prototype.getRule=function(e){var n=this.sheet.cssRules[e];return n&&n.cssText?n.cssText:""},t}(),Qse=function(){function t(e){this.element=B$(e),this.nodes=this.element.childNodes,this.length=0}return t.prototype.insertRule=function(e,n){if(e<=this.length&&e>=0){var r=document.createTextNode(n);return this.element.insertBefore(r,this.nodes[e]||null),this.length++,!0}return!1},t.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},t.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},t}(),eae=function(){function t(e){this.rules=[],this.length=0}return t.prototype.insertRule=function(e,n){return e<=this.length&&(this.rules.splice(e,0,n),this.length++,!0)},t.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},t.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},t}(),H_=nh,tae={isServer:!nh,useCSSOMInjection:!Mse},U$=function(){function t(e,n,r){e===void 0&&(e=aa),n===void 0&&(n={});var o=this;this.options=On(On({},tae),e),this.gs=n,this.names=new Map(r),this.server=!!e.isServer,!this.server&&nh&&H_&&(H_=!1,U_(this)),lb(this,function(){return function(i){for(var s=i.getTag(),a=s.length,c="",l=function(h){var p=function(S){return rh.get(S)}(h);if(p===void 0)return"continue";var f=i.names.get(p),g=s.getGroup(h);if(f===void 0||!f.size||g.length===0)return"continue";var m="".concat(sa,".g").concat(h,'[id="').concat(p,'"]'),y="";f!==void 0&&f.forEach(function(S){S.length>0&&(y+="".concat(S,","))}),c+="".concat(g).concat(m,'{content:"').concat(y,'"}').concat(ab)},d=0;d<a;d++)l(d);return c}(o)})}return t.registerId=function(e){return gd(e)},t.prototype.rehydrate=function(){!this.server&&nh&&U_(this)},t.prototype.reconstructWithOptions=function(e,n){return n===void 0&&(n=!0),new t(On(On({},this.options),e),this.gs,n&&this.names||void 0)},t.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},t.prototype.getTag=function(){return this.tag||(this.tag=(e=function(n){var r=n.useCSSOMInjection,o=n.target;return n.isServer?new eae(o):r?new Jse(o):new Qse(o)}(this.options),new Wse(e)));var e},t.prototype.hasNameForId=function(e,n){return this.names.has(e)&&this.names.get(e).has(n)},t.prototype.registerName=function(e,n){if(gd(e),this.names.has(e))this.names.get(e).add(n);else{var r=new Set;r.add(n),this.names.set(e,r)}},t.prototype.insertRules=function(e,n,r){this.registerName(e,n),this.getTag().insertRules(gd(e),r)},t.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},t.prototype.clearRules=function(e){this.getTag().clearGroup(gd(e)),this.clearNames(e)},t.prototype.clearTag=function(){this.tag=void 0},t}(),nae=/&/g,rae=/^\s*\/\/.*$/gm;function H$(t,e){return t.map(function(n){return n.type==="rule"&&(n.value="".concat(e," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(e," ")),n.props=n.props.map(function(r){return"".concat(e," ").concat(r)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=H$(n.children,e)),n})}function j$(t){var e,n,r,o=t===void 0?aa:t,i=o.options,s=i===void 0?aa:i,a=o.plugins,c=a===void 0?Pp:a,l=function(p,f,g){return g.startsWith(n)&&g.endsWith(n)&&g.replaceAll(n,"").length>0?".".concat(e):p},d=c.slice();d.push(function(p){p.type===vp&&p.value.includes("&")&&(p.props[0]=p.props[0].replace(nae,n).replace(r,l))}),s.prefix&&d.push(Tse),d.push(Ise);var h=function(p,f,g,m){f===void 0&&(f=""),g===void 0&&(g=""),m===void 0&&(m="&"),e=m,n=f,r=new RegExp("\\".concat(n,"\\b"),"g");var y=p.replace(rae,""),S=xse(g||f?"".concat(g," ").concat(f," { ").concat(y," }"):y);s.namespace&&(S=H$(S,s.namespace));var v=[];return th(S,Cse(d.concat(Ese(function(_){return v.push(_)})))),v};return h.hash=c.length?c.reduce(function(p,f){return f.name||yl(15),Fs(p,f.name)},$$).toString():"",h}var oae=new U$,fy=j$(),db=we.createContext({shouldForwardProp:void 0,styleSheet:oae,stylis:fy});db.Consumer;var iae=we.createContext(void 0);function gy(){return tt(db)}function sae(t){var e=Q(t.stylisPlugins),n=e[0],r=e[1],o=gy().styleSheet,i=ce(function(){var c=o;return t.sheet?c=t.sheet:t.target&&(c=c.reconstructWithOptions({target:t.target},!1)),t.disableCSSOMInjection&&(c=c.reconstructWithOptions({useCSSOMInjection:!1})),c},[t.disableCSSOMInjection,t.sheet,t.target,o]),s=ce(function(){return j$({options:{namespace:t.namespace,prefix:t.enableVendorPrefixes},plugins:n})},[t.enableVendorPrefixes,t.namespace,n]);q(function(){dse(n,t.stylisPlugins)||r(t.stylisPlugins)},[t.stylisPlugins]);var a=ce(function(){return{shouldForwardProp:t.shouldForwardProp,styleSheet:i,stylis:s}},[t.shouldForwardProp,i,s]);return we.createElement(db.Provider,{value:a},we.createElement(iae.Provider,{value:s},t.children))}var aae=function(){function t(e,n){var r=this;this.inject=function(o,i){i===void 0&&(i=fy);var s=r.name+i.hash;o.hasNameForId(r.id,s)||o.insertRules(r.id,s,i(r.rules,s,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=n,lb(this,function(){throw yl(12,String(r.name))})}return t.prototype.getName=function(e){return e===void 0&&(e=fy),this.name+e.hash},t}(),cae=function(t){return t>="A"&&t<="Z"};function j_(t){for(var e="",n=0;n<t.length;n++){var r=t[n];if(n===1&&r==="-"&&t[0]==="-")return t;cae(r)?e+="-"+r.toLowerCase():e+=r}return e.startsWith("ms-")?"-"+e:e}var K$=function(t){return t==null||t===!1||t===""},W$=function(t){var e,n,r=[];for(var o in t){var i=t[o];t.hasOwnProperty(o)&&!K$(i)&&(Array.isArray(i)&&i.isCss||ca(i)?r.push("".concat(j_(o),":"),i,";"):zc(i)?r.push.apply(r,eh(eh(["".concat(o," {")],W$(i),!1),["}"],!1)):r.push("".concat(j_(o),": ").concat((e=o,(n=i)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||e in kse||e.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return r};function Bi(t,e,n,r){if(K$(t))return[];if(cb(t))return[".".concat(t.styledComponentId)];if(ca(t)){if(!ca(i=t)||i.prototype&&i.prototype.isReactComponent||!e)return[t];var o=t(e);return Bi(o,e,n,r)}var i;return t instanceof aae?n?(t.inject(n,r),[t.getName(r)]):[t]:zc(t)?W$(t):Array.isArray(t)?Array.prototype.concat.apply(Pp,t.map(function(s){return Bi(s,e,n,r)})):[t.toString()]}function lae(t){for(var e=0;e<t.length;e+=1){var n=t[e];if(ca(n)&&!cb(n))return!1}return!0}var dae=R$(xp),uae=function(){function t(e,n,r){this.rules=e,this.staticRulesId="",this.isStatic=(r===void 0||r.isStatic)&&lae(e),this.componentId=n,this.baseHash=Fs(dae,n),this.baseStyle=r,U$.registerId(n)}return t.prototype.generateAndInjectStyles=function(e,n,r){var o=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,n,r):"";if(this.isStatic&&!r.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))o=Ri(o,this.staticRulesId);else{var i=B_(Bi(this.rules,e,n,r)),s=hy(Fs(this.baseHash,i)>>>0);if(!n.hasNameForId(this.componentId,s)){var a=r(i,".".concat(s),void 0,this.componentId);n.insertRules(this.componentId,s,a)}o=Ri(o,s),this.staticRulesId=s}else{for(var c=Fs(this.baseHash,r.hash),l="",d=0;d<this.rules.length;d++){var h=this.rules[d];if(typeof h=="string")l+=h;else if(h){var p=B_(Bi(h,e,n,r));c=Fs(c,p+d),l+=p}}if(l){var f=hy(c>>>0);n.hasNameForId(this.componentId,f)||n.insertRules(this.componentId,f,r(l,".".concat(f),void 0,this.componentId)),o=Ri(o,f)}}return o},t}(),G$=we.createContext(void 0);G$.Consumer;var ag={};function hae(t,e,n){var r=cb(t),o=t,i=!sg(t),s=e.attrs,a=s===void 0?Pp:s,c=e.componentId,l=c===void 0?function(w,x){var C=typeof w!="string"?"sc":R_(w);ag[C]=(ag[C]||0)+1;var E="".concat(C,"-").concat(Rse(xp+C+ag[C]));return x?"".concat(x,"-").concat(E):E}(e.displayName,e.parentComponentId):c,d=e.displayName,h=d===void 0?function(w){return sg(w)?"styled.".concat(w):"Styled(".concat(Lse(w),")")}(t):d,p=e.displayName&&e.componentId?"".concat(R_(e.displayName),"-").concat(e.componentId):e.componentId||l,f=r&&o.attrs?o.attrs.concat(a).filter(Boolean):a,g=e.shouldForwardProp;if(r&&o.shouldForwardProp){var m=o.shouldForwardProp;if(e.shouldForwardProp){var y=e.shouldForwardProp;g=function(w,x){return m(w,x)&&y(w,x)}}else g=m}var S=new uae(n,p,r?o.componentStyle:void 0);function v(w,x){return function(C,E,I){var T=C.attrs,k=C.componentStyle,D=C.defaultProps,A=C.foldedComponentIds,O=C.styledComponentId,$=C.target,z=we.useContext(G$),R=gy(),W=C.shouldForwardProp||R.shouldForwardProp,j=Ase(E,z,D)||aa,G=function(ie,at,Ke){for(var We,Ee=On(On({},at),{className:void 0,theme:Ke}),Je=0;Je<ie.length;Je+=1){var Ne=ca(We=ie[Je])?We(Ee):We;for(var vt in Ne)Ee[vt]=vt==="className"?Ri(Ee[vt],Ne[vt]):vt==="style"?On(On({},Ee[vt]),Ne[vt]):Ne[vt]}return at.className&&(Ee.className=Ri(Ee.className,at.className)),Ee}(T,E,j),le=G.as||$,he={};for(var ve in G)G[ve]===void 0||ve[0]==="$"||ve==="as"||ve==="theme"&&G.theme===j||(ve==="forwardedAs"?he.as=G.forwardedAs:W&&!W(ve,le)||(he[ve]=G[ve]));var me=function(ie,at){var Ke=gy(),We=ie.generateAndInjectStyles(at,Ke.styleSheet,Ke.stylis);return We}(k,G),Be=Ri(A,O);return me&&(Be+=" "+me),G.className&&(Be+=" "+G.className),he[sg(le)&&!D$.has(le)?"class":"className"]=Be,he.ref=I,kt(le,he)}(_,w,x)}v.displayName=h;var _=we.forwardRef(v);return _.attrs=f,_.componentStyle=S,_.displayName=h,_.shouldForwardProp=g,_.foldedComponentIds=r?Ri(o.foldedComponentIds,o.styledComponentId):"",_.styledComponentId=p,_.target=r?o.target:t,Object.defineProperty(_,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(w){this._foldedDefaultProps=r?function(x){for(var C=[],E=1;E<arguments.length;E++)C[E-1]=arguments[E];for(var I=0,T=C;I<T.length;I++)py(x,T[I],!0);return x}({},o.defaultProps,w):w}}),lb(_,function(){return".".concat(_.styledComponentId)}),i&&z$(_,t,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),_}function K_(t,e){for(var n=[t[0]],r=0,o=e.length;r<o;r+=1)n.push(e[r],t[r+1]);return n}var W_=function(t){return Object.assign(t,{isCss:!0})};function pae(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ca(t)||zc(t))return W_(Bi(K_(Pp,eh([t],e,!0))));var r=t;return e.length===0&&r.length===1&&typeof r[0]=="string"?Bi(r):W_(Bi(K_(r,e)))}function my(t,e,n){if(n===void 0&&(n=aa),!e)throw yl(1,e);var r=function(o){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];return t(e,n,pae.apply(void 0,eh([o],i,!1)))};return r.attrs=function(o){return my(t,e,On(On({},n),{attrs:Array.prototype.concat(n.attrs,o).filter(Boolean)}))},r.withConfig=function(o){return my(t,e,On(On({},n),o))},r}var V$=function(t){return my(hae,t)},fae=V$;D$.forEach(function(t){fae[t]=V$(t)});class gae extends HTMLElement{constructor(){super(...arguments),this.content=null,this.config=null,this._render=()=>{Vs(u(sae,{target:this,children:u("ha-card",{children:u(cse,{})})}),this)}}set hass(e){console.log("hass",e),this._render()}setConfig(e){console.log("config",e),this._render()}getCardSize(){return 1}}customElements.define("content-card-example3",gae);window.customCards=window.customCards||[];window.customCards.push({type:"boilerplate-card",name:"Boilerplate Card",preview:!1,description:"Boilerplate Card x React"});
